

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>abapy.mesh &mdash; abapy 2.3.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="abapy 2.3.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">abapy 2.3.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for abapy.mesh</h1><div class="highlight"><pre>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Mesh</span>
<span class="sd">====</span>
<span class="sd">&#39;&#39;&#39;</span>

<div class="viewcode-block" id="Nodes"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Nodes">[docs]</a><span class="k">class</span> <span class="nc">Nodes</span><span class="p">:</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Manages nodes for finite element modeling pre/postprocessing and further graphical representations.</span>
<span class="sd">  </span>
<span class="sd">  :param labels: list of node labels.  </span>
<span class="sd">  :type labels: list of int &gt; 0</span>
<span class="sd">  :param x: x coordinate of nodes.  </span>
<span class="sd">  :type x: list floats</span>
<span class="sd">  :param y: y coordinate of nodes.  </span>
<span class="sd">  :type y: list floats</span>
<span class="sd">  :param z: z coordinate of nodes.  </span>
<span class="sd">  :type z: list floats</span>
<span class="sd">  :param sets: node sets  </span>
<span class="sd">  :type sets: dict with str keys and where values are list of ints &gt; 0.</span>
<span class="sd">  :param dti: int data type in array.array</span>
<span class="sd">  :type dti: &#39;I&#39; or &#39;H&#39;</span>
<span class="sd">  :param dtf: float data type in array.array</span>
<span class="sd">  :type dtf: &#39;f&#39; or &#39;d&#39;</span>
<span class="sd">  </span>
<span class="sd">  </span>
<span class="sd">  &gt;&gt;&gt; from abapy.mesh import Nodes </span>
<span class="sd">  &gt;&gt;&gt; labels = [1,2]</span>
<span class="sd">  &gt;&gt;&gt; x = [0., 1.]</span>
<span class="sd">  &gt;&gt;&gt; y = [0., 2.]</span>
<span class="sd">  &gt;&gt;&gt; z = [0., 0.]</span>
<span class="sd">  &gt;&gt;&gt; sets = {&#39;mySet&#39;: [1,2]}</span>
<span class="sd">  &gt;&gt;&gt; nodes = Nodes(labels = labels, x = x, y = y, z = z, sets = sets)</span>
<span class="sd">  &gt;&gt;&gt; nodes</span>
<span class="sd">  &lt;Nodes class instance: 2 nodes&gt;</span>
<span class="sd">  &gt;&gt;&gt; print nodes</span>
<span class="sd">  Nodes class instance:</span>
<span class="sd">  Nodes:</span>
<span class="sd">  Label	x	y	z</span>
<span class="sd">  1	0.0	0.0	0.0</span>
<span class="sd">  2	1.0	2.0	0.0</span>
<span class="sd">  Sets:</span>
<span class="sd">  Label	Nodes</span>
<span class="sd">  myset	1,2</span>
<span class="sd">  &gt;&gt;&gt; from abapy.mesh import Nodes</span>
<span class="sd">  &gt;&gt;&gt; labels = range(1,11) # 10 nodes</span>
<span class="sd">  &gt;&gt;&gt; x = labels</span>
<span class="sd">  &gt;&gt;&gt; y = labels</span>
<span class="sd">  &gt;&gt;&gt; z = [0. for i in x]</span>
<span class="sd">  &gt;&gt;&gt; nodes = Nodes(labels=labels, x=x, y=y, z=z)</span>
<span class="sd">  &gt;&gt;&gt; nodes.add_set(&#39;myset&#39;,[4,5,6,9]) # A set</span>
<span class="sd">  &gt;&gt;&gt; print nodes</span>
<span class="sd">  Nodes class instance:</span>
<span class="sd">  Nodes:</span>
<span class="sd">  Label	x	y	z</span>
<span class="sd">  1	1.0	1.0	0.0</span>
<span class="sd">  2	2.0	2.0	0.0</span>
<span class="sd">  3	3.0	3.0	0.0</span>
<span class="sd">  4	4.0	4.0	0.0</span>
<span class="sd">  5	5.0	5.0	0.0</span>
<span class="sd">  6	6.0	6.0	0.0</span>
<span class="sd">  7	7.0	7.0	0.0</span>
<span class="sd">  8	8.0	8.0	0.0</span>
<span class="sd">  9	9.0	9.0	0.0</span>
<span class="sd">  10	10.0	10.0	0.0</span>
<span class="sd">  Sets:</span>
<span class="sd">  Label	Nodes</span>
<span class="sd">  myset	4,5,6,9</span>
<span class="sd">  &gt;&gt;&gt; print nodes[5] # requesting node 5</span>
<span class="sd">  Nodes class instance:</span>
<span class="sd">  Nodes:</span>
<span class="sd">  Label	x	y	z</span>
<span class="sd">  5	5.0	5.0	0.0</span>
<span class="sd">  Sets:</span>
<span class="sd">  Label	Nodes</span>
<span class="sd">  myset	5</span>
<span class="sd">  &gt;&gt;&gt; print nodes[5,4,10]  # requesting nodes 5, 4 and 10. Note that output has ordered nodes and kept sets.</span>
<span class="sd">  Nodes class instance:</span>
<span class="sd">  Nodes:</span>
<span class="sd">  Label	x	y	z</span>
<span class="sd">  4	4.0	4.0	0.0</span>
<span class="sd">  5	5.0	5.0	0.0</span>
<span class="sd">  10	10.0	10.0	0.0</span>
<span class="sd">  Sets:</span>
<span class="sd">  Label	Nodes</span>
<span class="sd">  myset	5,4</span>
<span class="sd">  &gt;&gt;&gt; print nodes[&#39;myset&#39;] # requesting nodes using set key</span>
<span class="sd">  Nodes class instance:</span>
<span class="sd">  Nodes:</span>
<span class="sd">  Label	x	y	z</span>
<span class="sd">  4	4.0	4.0	0.0</span>
<span class="sd">  5	5.0	5.0	0.0</span>
<span class="sd">  6	6.0	6.0	0.0</span>
<span class="sd">  9	9.0	9.0	0.0</span>
<span class="sd">  Sets:</span>
<span class="sd">  Label	Nodes</span>
<span class="sd">  myset	4,5,6,9</span>
<span class="sd">  &gt;&gt;&gt; print nodes[&#39;myset&#39;,10] # mixed request: nodes in myset AND node 10.</span>
<span class="sd">  Nodes class instance:</span>
<span class="sd">  Nodes:</span>
<span class="sd">  Label	x	y	z</span>
<span class="sd">  4	4.0	4.0	0.0</span>
<span class="sd">  5	5.0	5.0	0.0</span>
<span class="sd">  6	6.0	6.0	0.0</span>
<span class="sd">  9	9.0	9.0	0.0</span>
<span class="sd">  10	10.0	10.0	0.0</span>
<span class="sd">  Sets:</span>
<span class="sd">  Label	Nodes</span>
<span class="sd">  myset	4,5,6,9</span>
<span class="sd">  &gt;&gt;&gt; print nodes[1:9:2] # slice</span>
<span class="sd">  Nodes class instance:</span>
<span class="sd">  Nodes:</span>
<span class="sd">  Label	x	y	z</span>
<span class="sd">  1	1.0	1.0	0.0</span>
<span class="sd">  3	3.0	3.0	0.0</span>
<span class="sd">  5	5.0	5.0	0.0</span>
<span class="sd">  7	7.0	7.0	0.0</span>
<span class="sd">  Sets:</span>
<span class="sd">  Label	Nodes</span>
<span class="sd">  myset	5</span>

<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="p">[],</span><span class="n">x</span><span class="o">=</span><span class="p">[],</span><span class="n">y</span><span class="o">=</span><span class="p">[],</span><span class="n">z</span><span class="o">=</span><span class="p">[],</span><span class="n">sets</span><span class="o">=</span><span class="p">{},</span><span class="n">dtf</span><span class="o">=</span><span class="s">&#39;f&#39;</span><span class="p">,</span><span class="n">dti</span><span class="o">=</span><span class="s">&#39;I&#39;</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">labels</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="p">:</span> <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="p">:</span> <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="p">:</span> <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)]))</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span> 
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;labels, x, y and z args should have the same length&#39;</span><span class="p">)</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,[])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,[])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,[])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dti</span><span class="p">,[])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sets</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">sets</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
<div class="viewcode-block" id="Nodes.add_node"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Nodes.add_node">[docs]</a>  <span class="k">def</span> <span class="nf">add_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span><span class="n">z</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span><span class="n">toset</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Adds one node to Nodes instance.</span>
<span class="sd">    </span>
<span class="sd">    :param label: If None, label is automatically chosen to be the highest existing label + 1 (default: None). If label (and susequently node) already exists, a warning is printed and the node is not added and sets that could be created ar not created.</span>
<span class="sd">    :type labels: int &gt; 0</span>
<span class="sd">    :param x: x coordinate of node.  </span>
<span class="sd">    :type x: float</span>
<span class="sd">    :param y: y coordinate of node.  </span>
<span class="sd">    :type y: float</span>
<span class="sd">    :param z: z coordinate of node.  </span>
<span class="sd">    :type z: float</span>
<span class="sd">    :param tosets: set(s) to which the node should be added. If a set does not exist, it is created. If None, the node is not added to any set.</span>
<span class="sd">    :type sets: None, string or list of strings.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from abapy.mesh import Nodes </span>
<span class="sd">    &gt;&gt;&gt; nodes = Nodes()</span>
<span class="sd">    &gt;&gt;&gt; nodes.add_node(label = 10, x = 0., y = 0., z = 0., toset = &#39;firstSet&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print nodes</span>
<span class="sd">    Nodes class instance:</span>
<span class="sd">    Nodes:</span>
<span class="sd">    Label	x	y	z</span>
<span class="sd">    10	0.0	0.0	0.0</span>
<span class="sd">    Sets:</span>
<span class="sd">    Label	Nodes</span>
<span class="sd">    firstset	10</span>
<span class="sd">    &gt;&gt;&gt; nodes.add_node(x = 0., y = 0., z = 0., toset = [&#39;firstSet&#39;, &#39;secondSet&#39;])</span>
<span class="sd">    &gt;&gt;&gt; print nodes</span>
<span class="sd">    Nodes class instance:</span>
<span class="sd">    Nodes:</span>
<span class="sd">    Label	x	y	z</span>
<span class="sd">    10	0.0	0.0	0.0</span>
<span class="sd">    11	0.0	0.0	0.0</span>
<span class="sd">    Sets:</span>
<span class="sd">    Label	Nodes</span>
<span class="sd">    firstset	10,11</span>
<span class="sd">    secondset	11</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
    <span class="n">sets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">label</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="k">if</span> <span class="n">label</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;node labels must be &gt; 0.&#39;</span>
      <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
      <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
      <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
      <span class="n">Z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> 
        <span class="n">label</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">Z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">label</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">Z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
          <span class="k">else</span><span class="p">:</span>
            <span class="n">dummy</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
            <span class="n">dummy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">dummy</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="k">del</span> <span class="n">dummy</span> <span class="c"># Is it necessary ?</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">label</span><span class="p">)</span>
            <span class="n">X</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
            <span class="n">Y</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
            <span class="n">Z</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="k">print</span> <span class="s">&#39;Info: node with label {0} already exists, nothing changed.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
          <span class="k">return</span>
    <span class="k">if</span> <span class="n">toset</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">toset</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="n">toset</span><span class="p">,[</span><span class="n">label</span><span class="p">])</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">&#39;__getitem__&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">toset</span><span class="p">):</span>
          <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">toset</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="n">s</span><span class="p">,[</span><span class="n">label</span><span class="p">])</span></div>
<div class="viewcode-block" id="Nodes.drop_node"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Nodes.drop_node">[docs]</a>  <span class="k">def</span> <span class="nf">drop_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Removes one node to Nodes instance. The node is also removed from sets, if a set happens to be empty, it is also removed.</span>
<span class="sd">    </span>
<span class="sd">    :param label: node be removed&#39;s label.</span>
<span class="sd">    :type label: int &gt; 0</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from abapy.mesh import Nodes </span>
<span class="sd">    &gt;&gt;&gt; nodes = labels = [1,2]</span>
<span class="sd">    &gt;&gt;&gt; x = [0., 1.]</span>
<span class="sd">    &gt;&gt;&gt; y = [0., 2.]</span>
<span class="sd">    &gt;&gt;&gt; z = [0., 0.]</span>
<span class="sd">    &gt;&gt;&gt; sets = {&#39;mySet&#39;: [2]}</span>
<span class="sd">    &gt;&gt;&gt; nodes = Nodes(labels = labels, x = x, y = y, z = z, sets = sets)</span>
<span class="sd">    &gt;&gt;&gt; print nodes</span>
<span class="sd">    Nodes class instance:</span>
<span class="sd">    Nodes:</span>
<span class="sd">    Label	x	y	z</span>
<span class="sd">    1	0.0	0.0	0.0</span>
<span class="sd">    2	1.0	2.0	0.0</span>
<span class="sd">    Sets:</span>
<span class="sd">    Label	Nodes</span>
<span class="sd">    myset	2</span>
<span class="sd">    &gt;&gt;&gt; nodes.drop_node(2)</span>
<span class="sd">    &gt;&gt;&gt; print nodes</span>
<span class="sd">    Nodes class instance:</span>
<span class="sd">    Nodes:</span>
<span class="sd">    Label	x	y	z</span>
<span class="sd">    1	0.0	0.0	0.0</span>
<span class="sd">    Sets:</span>
<span class="sd">    Label	Nodes&#39;&#39;&#39;</span>
    
    <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span> 
    <span class="n">sets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
    <span class="n">labels</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
    <span class="n">x</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">y</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">z</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">sets</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span> <span class="n">sets</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>  
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sets</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">del</span> <span class="n">sets</span><span class="p">[</span><span class="n">k</span><span class="p">]</span></div>
<div class="viewcode-block" id="Nodes.add_set"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Nodes.add_set">[docs]</a>  <span class="k">def</span> <span class="nf">add_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">nodes</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Adds a node set to the Nodes instance or appends nodes to existing node sets. </span>
<span class="sd">    </span>
<span class="sd">    :param label: set to be added&#39;s label.</span>
<span class="sd">    :type label: string</span>
<span class="sd">    :param nodes: nodes to be added in the set.</span>
<span class="sd">    :type nodes: int or list of ints</span>
<span class="sd">    </span>
<span class="sd">    .. note:: set labels are always lower case in this class to be case insensitive. This way to proceed is coherent with Abaqus.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from abapy.mesh import Nodes</span>
<span class="sd">    &gt;&gt;&gt; nodes = Nodes()</span>
<span class="sd">    &gt;&gt;&gt; labels = [1,2]</span>
<span class="sd">    &gt;&gt;&gt; x = [0., 1.]</span>
<span class="sd">    &gt;&gt;&gt; y = [0., 2.]</span>
<span class="sd">    &gt;&gt;&gt; z = [0., 0.]</span>
<span class="sd">    &gt;&gt;&gt; sets = {&#39;mySet&#39;: 2}</span>
<span class="sd">    &gt;&gt;&gt; nodes = Nodes(labels = labels, x = x, y = y, z = z, sets = sets)</span>
<span class="sd">    &gt;&gt;&gt; print nodes</span>
<span class="sd">    Nodes class instance:</span>
<span class="sd">    Nodes:</span>
<span class="sd">    Label	x	y	z</span>
<span class="sd">    1	0.0	0.0	0.0</span>
<span class="sd">    2	1.0	2.0	0.0</span>
<span class="sd">    Sets:</span>
<span class="sd">    Label	Nodes</span>
<span class="sd">    myset	2</span>
<span class="sd">    &gt;&gt;&gt; nodes.add_set(&#39;MYSET&#39;,1)</span>
<span class="sd">    &gt;&gt;&gt; print nodes</span>
<span class="sd">    Nodes class instance:</span>
<span class="sd">    Nodes:</span>
<span class="sd">    Label	x	y	z</span>
<span class="sd">    1	0.0	0.0	0.0</span>
<span class="sd">    2	1.0	2.0	0.0</span>
<span class="sd">    Sets:</span>
<span class="sd">    Label	Nodes</span>
<span class="sd">    myset	2,1</span>
<span class="sd">    &gt;&gt;&gt; nodes.add_set(&#39;MyNeWseT&#39;,[1,2])</span>
<span class="sd">    &gt;&gt;&gt; print nodes</span>
<span class="sd">    Nodes class instance:</span>
<span class="sd">    Nodes:</span>
<span class="sd">    Label	x	y	z</span>
<span class="sd">    1	0.0	0.0	0.0</span>
<span class="sd">    2	1.0	2.0	0.0</span>
<span class="sd">    Sets:</span>
<span class="sd">    Label	Nodes</span>
<span class="sd">    myset	2,1</span>
<span class="sd">    mynewset	1,2&#39;&#39;&#39;</span>
    
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="n">sets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span>
    <span class="n">label2</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    if label != label2:</span>
<span class="sd">      try: </span>
<span class="sd">        print &#39;Info: node set label {0} was changed to {1}.&#39;.format(label, label2)</span>
<span class="sd">      except:</span>
<span class="sd">        print &#39;A node set was renamed&#39;</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">label</span> <span class="o">=</span> <span class="n">label2</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sets</span><span class="p">:</span> <span class="n">sets</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dti</span><span class="p">,[])</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">sets</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span> <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">nodes</span><span class="p">]</span>
    <span class="k">if</span> <span class="s">&#39;__getitem__&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">nodes</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">node</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">node</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="n">label</span><span class="p">]:</span> 
            <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
          <span class="k">else</span><span class="p">:</span>
           <span class="k">print</span> <span class="s">&#39;Info: node {0} was already in set {1}, node was not added to set&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="k">print</span> <span class="s">&#39;Info: node {0} does not exist, node was not added to set&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
  </div>
<div class="viewcode-block" id="Nodes.add_set_by_func"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Nodes.add_set_by_func">[docs]</a>  <span class="k">def</span> <span class="nf">add_set_by_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Creates a node set using a function of x, y, z and labels (given as ``numpy.array``). Must get back a boolean array of the same size.</span>
<span class="sd">    </span>
<span class="sd">    :param name: set label.</span>
<span class="sd">    :type name: string</span>
<span class="sd">    :param func: function of x, y ,z and labels</span>
<span class="sd">    :type func: function</span>
<span class="sd">     </span>
<span class="sd">    &gt;&gt;&gt; mesh.nodes.add_set_by_func(&#39;setlabel&#39;, lambda x, y, z, labels: x == 0.)</span>

<span class="sd">     &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span><span class="p">,</span> <span class="n">float32</span><span class="p">,</span> <span class="n">float64</span><span class="p">,</span> <span class="n">uint32</span><span class="p">,</span> <span class="n">where</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;set labels must be strings, got {0}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;f&#39;</span><span class="p">:</span> <span class="n">n_dtf</span> <span class="o">=</span> <span class="n">float32</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="n">n_dtf</span> <span class="o">=</span> <span class="n">float64</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">n_dtf</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">n_dtf</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">n_dtf</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">uint32</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">out</span> <span class="o">==</span> <span class="bp">True</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">labs</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">out</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">labels</span> <span class="o">!=</span> <span class="p">[]:</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">labs</span><span class="p">)</span>
    
    
  </div>
<div class="viewcode-block" id="Nodes.translate"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Nodes.translate">[docs]</a>  <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span><span class="n">z</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Translates all the nodes.</span>
<span class="sd">    </span>
<span class="sd">    :param x: translation along x value.</span>
<span class="sd">    :type x: float</span>
<span class="sd">    :param y: translation along y value.</span>
<span class="sd">    :type y: float</span>
<span class="sd">    :param z: translation along z value.</span>
<span class="sd">    :type z: float</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from abapy.mesh import Nodes</span>
<span class="sd">    &gt;&gt;&gt; nodes = Nodes()</span>
<span class="sd">    &gt;&gt;&gt; labels = [1,2]</span>
<span class="sd">    &gt;&gt;&gt; x = [0., 1.]</span>
<span class="sd">    &gt;&gt;&gt; y = [0., 2.]</span>
<span class="sd">    &gt;&gt;&gt; z = [0., 0.]</span>
<span class="sd">    &gt;&gt;&gt; sets = {&#39;mySet&#39;: 2}</span>
<span class="sd">    &gt;&gt;&gt; nodes = Nodes(labels = labels, x = x, y = y, z = z, sets = sets)</span>
<span class="sd">    &gt;&gt;&gt; nodes.translate(x = 1., y=0., z = -4.)</span>
<span class="sd">    &gt;&gt;&gt; print nodes</span>
<span class="sd">    Nodes class instance:</span>
<span class="sd">    Nodes:</span>
<span class="sd">    Label	x	y	z</span>
<span class="sd">    1	1.0	0.0	-4.0</span>
<span class="sd">    2	2.0	2.0	-4.0</span>
<span class="sd">    Sets:</span>
<span class="sd">    Label	Nodes</span>
<span class="sd">    myset	2&#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">ones_like</span>
    
    <span class="k">def</span> <span class="nf">func</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">zz</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">ones_like</span><span class="p">(</span><span class="n">xx</span><span class="p">),</span> <span class="n">y</span><span class="o">*</span><span class="n">ones_like</span><span class="p">(</span><span class="n">yy</span><span class="p">),</span> <span class="n">z</span><span class="o">*</span><span class="n">ones_like</span><span class="p">(</span><span class="n">zz</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eval_vectorFunction</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">apply_displacement</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
  </div>
<div class="viewcode-block" id="Nodes.dump2inp"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Nodes.dump2inp">[docs]</a>  <span class="k">def</span> <span class="nf">dump2inp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Dumps Nodes instance to Abaqus INP format.</span>
<span class="sd">    </span>
<span class="sd">    :rtype: string</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from abapy.mesh import Nodes</span>
<span class="sd">    &gt;&gt;&gt; nodes = Nodes()</span>
<span class="sd">    &gt;&gt;&gt; labels = [1,2]</span>
<span class="sd">    &gt;&gt;&gt; x = [0., 1.]</span>
<span class="sd">    &gt;&gt;&gt; y = [0., 2.]</span>
<span class="sd">    &gt;&gt;&gt; z = [0., 0.]</span>
<span class="sd">    &gt;&gt;&gt; sets = {&#39;mySet&#39;: 2}</span>
<span class="sd">    &gt;&gt;&gt; nodes = Nodes(labels = labels, x = x, y = y, z = z, sets = sets)</span>
<span class="sd">    &gt;&gt;&gt; out = nodes.dump2inp()&#39;&#39;&#39;</span> 
    
    <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
    <span class="n">sets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span>
    <span class="n">out</span> <span class="o">=</span><span class="s">&#39;**----------------------------------</span><span class="se">\n</span><span class="s">** NODES</span><span class="se">\n</span><span class="s">**----------------------------------</span><span class="se">\n</span><span class="s">*Node, NSET=ALLNODES</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;  {0}, {1}, {2}, {3}</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
      <span class="n">out</span> <span class="o">+=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">out</span> <span class="o">+=</span><span class="s">&#39;**----------------------------------</span><span class="se">\n</span><span class="s">** NODE SETS</span><span class="se">\n</span><span class="s">**----------------------------------</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;*NSET, NSET={0}</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">pattern1</span> <span class="o">=</span> <span class="s">&#39;{0},&#39;</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="n">nset</span> <span class="o">=</span> <span class="n">sets</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
      <span class="n">out</span> <span class="o">+=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
      <span class="n">nCount</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">nset</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="n">pattern1</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="n">nCount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">nCount</span> <span class="o">&gt;=</span> <span class="mi">9</span><span class="p">:</span> 
          <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
          <span class="n">nCount</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> 
    <span class="k">return</span> <span class="n">out</span></div>
  <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;&lt;Nodes class instance: {} nodes&gt;&#39;</span>
    <span class="k">return</span> <span class="n">pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">))</span>  
  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
    <span class="n">x</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
    <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
    <span class="n">out</span> <span class="o">=</span><span class="s">&#39;Nodes class instance:</span><span class="se">\n</span><span class="s">Nodes:</span><span class="se">\n</span><span class="s">Label</span><span class="se">\t</span><span class="s">x</span><span class="se">\t</span><span class="s">y</span><span class="se">\t</span><span class="s">z</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
      <span class="n">out</span> <span class="o">+=</span>  <span class="s">&#39;{0}</span><span class="se">\t</span><span class="s">{1}</span><span class="se">\t</span><span class="s">{2}</span><span class="se">\t</span><span class="s">{3}</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">out</span><span class="o">+=</span> <span class="s">&#39;Sets:</span><span class="se">\n</span><span class="s">Label</span><span class="se">\t</span><span class="s">Nodes</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="n">out</span> <span class="o">+=</span>  <span class="s">&#39;{0}</span><span class="se">\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;{0},&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
      <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="k">return</span> <span class="n">out</span>
  <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="n">labs</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">slice</span><span class="p">:</span>
      <span class="n">start</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">start</span>
      <span class="n">stop</span>  <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">stop</span>
      <span class="n">step</span>  <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">step</span>
      <span class="n">labs</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="n">step</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">]:</span>  
      <span class="n">labs</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
       <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span><span class="n">labs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
       <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span><span class="n">labs</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
      <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> 
      <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">labs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">labs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
    <span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span>
    <span class="n">dti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dti</span>
    <span class="n">sets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span>
    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
    <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
    <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">Nodes</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labs</span><span class="p">:</span>
      <span class="n">toset</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="n">i</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">sk</span> <span class="ow">in</span> <span class="n">sets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">sets</span><span class="p">[</span><span class="n">sk</span><span class="p">]:</span>
          <span class="n">toset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sk</span><span class="p">)</span>
      <span class="n">N</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">l</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">toset</span> <span class="o">=</span> <span class="n">toset</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">N</span>      
<div class="viewcode-block" id="Nodes.drop_set"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Nodes.drop_set">[docs]</a>  <span class="k">def</span> <span class="nf">drop_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Drops a set without removing elements and nodes.</span>
<span class="sd">    </span>
<span class="sd">    :param label: label of the to be removed.</span>
<span class="sd">    :type label: string</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from abapy.mesh import Nodes</span>
<span class="sd">    &gt;&gt;&gt; labels = range(1,11)</span>
<span class="sd">    &gt;&gt;&gt; x = labels</span>
<span class="sd">    &gt;&gt;&gt; y = labels</span>
<span class="sd">    &gt;&gt;&gt; z = [0. for i in x]</span>
<span class="sd">    &gt;&gt;&gt; nodes = Nodes(labels=labels, x=x, y=y, z=z)</span>
<span class="sd">    &gt;&gt;&gt; nodes.add_set(&#39;myset&#39;,[4,5,6,9])</span>
<span class="sd">    &gt;&gt;&gt; print nodes</span>
<span class="sd">    Nodes class instance:</span>
<span class="sd">    Nodes:</span>
<span class="sd">    Label	x	y	z</span>
<span class="sd">    1	1.0	1.0	0.0</span>
<span class="sd">    2	2.0	2.0	0.0</span>
<span class="sd">    3	3.0	3.0	0.0</span>
<span class="sd">    4	4.0	4.0	0.0</span>
<span class="sd">    5	5.0	5.0	0.0</span>
<span class="sd">    6	6.0	6.0	0.0</span>
<span class="sd">    7	7.0	7.0	0.0</span>
<span class="sd">    8	8.0	8.0	0.0</span>
<span class="sd">    9	9.0	9.0	0.0</span>
<span class="sd">    10	10.0	10.0	0.0</span>
<span class="sd">    Sets:</span>
<span class="sd">    Label	Nodes</span>
<span class="sd">    myset	4,5,6,9</span>
<span class="sd">    &gt;&gt;&gt; nodes.drop_set(&#39;someSet&#39;)</span>
<span class="sd">    Info: sets someset does not exist and cannot be dropped.</span>
<span class="sd">    &gt;&gt;&gt; nodes.drop_set(&#39;MYSET&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print nodes</span>
<span class="sd">    Nodes class instance:</span>
<span class="sd">    Nodes:</span>
<span class="sd">    Label	x	y	z</span>
<span class="sd">    1	1.0	1.0	0.0</span>
<span class="sd">    2	2.0	2.0	0.0</span>
<span class="sd">    3	3.0	3.0	0.0</span>
<span class="sd">    4	4.0	4.0	0.0</span>
<span class="sd">    5	5.0	5.0	0.0</span>
<span class="sd">    6	6.0	6.0	0.0</span>
<span class="sd">    7	7.0	7.0	0.0</span>
<span class="sd">    8	8.0	8.0	0.0</span>
<span class="sd">    9	9.0	9.0	0.0</span>
<span class="sd">    10	10.0	10.0	0.0</span>
<span class="sd">    Sets:</span>
<span class="sd">    Label	Nodes&#39;&#39;&#39;</span>
    
    <span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&#39;Info: sets {0} does not exist and cannot be dropped.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>     
  </div>
<div class="viewcode-block" id="Nodes.eval_function"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Nodes.eval_function">[docs]</a>  <span class="k">def</span> <span class="nf">eval_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Evals a function at each node and returns a ``FieldOutput`` instance.</span>
<span class="sd">    </span>
<span class="sd">    :param function: a function with arguments x, y and z (float ``numpy.arrays`` containing nodes coordinates) and labels (int ``numpy.array``). Field should not depend on labels but on some vicious problem, it could be useful. The function should return 1 array.</span>
<span class="sd">    :type function: function</span>
<span class="sd">    :rtype: ```FieldOutput``` instance.</span>
<span class="sd">    </span>
<span class="sd">    .. plot:: example_code/mesh/Nodes-eval_function.py</span>
<span class="sd">       :include-source:</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">postproc</span> <span class="kn">import</span> <span class="n">FieldOutput</span> 
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span> <span class="k">as</span> <span class="n">n_array</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">float32</span><span class="p">,</span> <span class="n">float64</span><span class="p">,</span> <span class="n">uint32</span><span class="p">,</span> <span class="n">uint64</span>
    <span class="n">dtf</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dti</span>
    <span class="k">if</span> <span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;f&#39;</span><span class="p">:</span> <span class="n">n_dtf</span> <span class="o">=</span> <span class="n">float32</span>
    <span class="k">if</span> <span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="n">n_dtf</span> <span class="o">=</span> <span class="n">float64</span>
    <span class="k">if</span> <span class="n">dti</span> <span class="o">==</span> <span class="s">&#39;H&#39;</span><span class="p">:</span> <span class="n">n_dti</span> <span class="o">=</span> <span class="n">float16</span>
    <span class="k">if</span> <span class="n">dti</span> <span class="o">==</span> <span class="s">&#39;I&#39;</span><span class="p">:</span> <span class="n">n_dti</span> <span class="o">=</span> <span class="n">float32</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">n_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">n_dtf</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">n_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">n_dtf</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">n_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">n_dtf</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
    <span class="n">n_labels</span> <span class="o">=</span> <span class="n">n_array</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">n_dti</span><span class="p">)</span> 
    <span class="n">data</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">n_labels</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="Nodes.eval_vectorFunction"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Nodes.eval_vectorFunction">[docs]</a>  <span class="k">def</span> <span class="nf">eval_vectorFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Evals a vector function at each node and returns a ``VectorFieldOutput`` instance.</span>
<span class="sd">    </span>
<span class="sd">    :param function: a vector function with arguments x, y and z (float ``numpy.arrays`` containing nodes coordinates) and labels (int ``numpy.array``). Field should not depend on labels but on some vicious problem, it could be useful. The function should return 3 arrays.</span>
<span class="sd">    :type function: function</span>
<span class="sd">    :rtype: ```FieldOutput``` instance.</span>
<span class="sd">    </span>
<span class="sd">    .. plot:: example_code/mesh/Nodes-eval_vectorFunction.py</span>
<span class="sd">       :include-source:</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">postproc</span> <span class="kn">import</span> <span class="n">VectorFieldOutput</span><span class="p">,</span> <span class="n">FieldOutput</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span> <span class="k">as</span> <span class="n">n_array</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">float32</span><span class="p">,</span> <span class="n">float64</span><span class="p">,</span> <span class="n">uint32</span><span class="p">,</span> <span class="n">uint64</span>
    <span class="n">dtf</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dti</span>
    <span class="k">if</span> <span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;f&#39;</span><span class="p">:</span> <span class="n">n_dtf</span> <span class="o">=</span> <span class="n">float32</span>
    <span class="k">if</span> <span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="n">n_dtf</span> <span class="o">=</span> <span class="n">float64</span>
    <span class="k">if</span> <span class="n">dti</span> <span class="o">==</span> <span class="s">&#39;H&#39;</span><span class="p">:</span> <span class="n">n_dti</span> <span class="o">=</span> <span class="n">float16</span>
    <span class="k">if</span> <span class="n">dti</span> <span class="o">==</span> <span class="s">&#39;I&#39;</span><span class="p">:</span> <span class="n">n_dti</span> <span class="o">=</span> <span class="n">float32</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">n_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">n_dtf</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">n_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">n_dtf</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">n_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">n_dtf</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
    <span class="n">n_labels</span> <span class="o">=</span> <span class="n">n_array</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">n_dti</span><span class="p">)</span> 
    <span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">,</span> <span class="n">data3</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">n_labels</span><span class="p">)</span>
    <span class="n">data1</span> <span class="o">=</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data1</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="n">data2</span> <span class="o">=</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data2</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="n">data3</span> <span class="o">=</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data3</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">VectorFieldOutput</span><span class="p">(</span><span class="n">data1</span> <span class="o">=</span> <span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="o">=</span><span class="n">data2</span><span class="p">,</span> <span class="n">data3</span><span class="o">=</span><span class="n">data3</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="Nodes.eval_tensorFunction"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Nodes.eval_tensorFunction">[docs]</a>  <span class="k">def</span> <span class="nf">eval_tensorFunction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Evaluates a tensor function at each node and returns a ``tensorFieldOutput`` instance.</span>
<span class="sd">    </span>
<span class="sd">    :param function: a tensor function with arguments x, y and z (float ``numpy.arrays`` containing nodes coordinates) and labels (int ``numpy.array``). Field should not depend on labels but on some vicious problem, it could be useful. The function should return 6 arrays corresponding to indices ordered as follows: 11, 22, 33, 12, 13, 23.</span>
<span class="sd">    :type function: function</span>
<span class="sd">    :rtype: ```FieldOutput``` instance.</span>
<span class="sd">    </span>
<span class="sd">    .. plot:: example_code/mesh/Nodes-eval_tensorFunction.py</span>
<span class="sd">       :include-source:</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">postproc</span> <span class="kn">import</span> <span class="n">TensorFieldOutput</span><span class="p">,</span> <span class="n">FieldOutput</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span> <span class="k">as</span> <span class="n">n_array</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">float32</span><span class="p">,</span> <span class="n">float64</span><span class="p">,</span> <span class="n">uint32</span><span class="p">,</span> <span class="n">uint64</span>
    <span class="n">dtf</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dti</span>
    <span class="k">if</span> <span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;f&#39;</span><span class="p">:</span> <span class="n">n_dtf</span> <span class="o">=</span> <span class="n">float32</span>
    <span class="k">if</span> <span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="n">n_dtf</span> <span class="o">=</span> <span class="n">float64</span>
    <span class="k">if</span> <span class="n">dti</span> <span class="o">==</span> <span class="s">&#39;H&#39;</span><span class="p">:</span> <span class="n">n_dti</span> <span class="o">=</span> <span class="n">float16</span>
    <span class="k">if</span> <span class="n">dti</span> <span class="o">==</span> <span class="s">&#39;I&#39;</span><span class="p">:</span> <span class="n">n_dti</span> <span class="o">=</span> <span class="n">float32</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">n_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">n_dtf</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">n_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">n_dtf</span><span class="p">)</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">n_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">n_dtf</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
    <span class="n">n_labels</span> <span class="o">=</span> <span class="n">n_array</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">n_dti</span><span class="p">)</span> 
    <span class="n">data11</span><span class="p">,</span> <span class="n">data22</span><span class="p">,</span> <span class="n">data33</span><span class="p">,</span> <span class="n">data12</span><span class="p">,</span> <span class="n">data13</span><span class="p">,</span> <span class="n">data23</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">n_labels</span><span class="p">)</span>
    <span class="n">data11</span> <span class="o">=</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data11</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="n">data22</span> <span class="o">=</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data22</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="n">data33</span> <span class="o">=</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data33</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="n">data12</span> <span class="o">=</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data12</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="n">data13</span> <span class="o">=</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data13</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="n">data23</span> <span class="o">=</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data23</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">TensorFieldOutput</span><span class="p">(</span><span class="n">data11</span> <span class="o">=</span> <span class="n">data11</span><span class="p">,</span> <span class="n">data22</span><span class="o">=</span><span class="n">data22</span><span class="p">,</span> <span class="n">data33</span><span class="o">=</span><span class="n">data33</span><span class="p">,</span> <span class="n">data12</span><span class="o">=</span><span class="n">data12</span><span class="p">,</span> <span class="n">data13</span><span class="o">=</span> <span class="n">data13</span><span class="p">,</span> <span class="n">data23</span><span class="o">=</span><span class="n">data23</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="Nodes.apply_displacement"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Nodes.apply_displacement">[docs]</a>  <span class="k">def</span> <span class="nf">apply_displacement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">disp</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Applies a displacement field to the nodes.</span>
<span class="sd">    </span>
<span class="sd">    :param disp: displacement field.</span>
<span class="sd">    :type disp: ``VectorFieldOutput`` instance</span>
<span class="sd">    </span>
<span class="sd">    .. plot:: example_code/mesh/Nodes-apply_displacement.py</span>
<span class="sd">       :include-source:</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">postproc</span> <span class="kn">import</span> <span class="n">VectorFieldOutput</span>
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span> <span class="k">as</span> <span class="n">n_array</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span> <span class="k">as</span> <span class="n">a_array</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">float32</span><span class="p">,</span> <span class="n">float64</span>
    <span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span>
    <span class="k">if</span> <span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;f&#39;</span><span class="p">:</span> <span class="n">n_dtf</span> <span class="o">=</span> <span class="n">float32</span>
    <span class="k">if</span> <span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="n">n_dtf</span> <span class="o">=</span> <span class="n">float64</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">disp</span><span class="p">,</span><span class="n">VectorFieldOutput</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;disp must be VectorFieldOutput instance.&#39;</span>
    <span class="c"># labels = set(mesh.nodes.labels.tolist() + disp.labels.tolist()) # Dangerous method</span>
    <span class="n">n_labels</span><span class="p">,</span> <span class="n">u_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="n">disp</span><span class="o">.</span><span class="n">labels</span>
    <span class="k">if</span> <span class="n">n_labels</span> <span class="o">!=</span> <span class="n">u_labels</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;Nodes labels and VectorFieldOutput labels must be identical.&#39;</span>
    <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">,</span> <span class="n">n3</span> <span class="o">=</span> <span class="n">n_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">n_dtf</span><span class="p">),</span> <span class="n">n_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">n_dtf</span><span class="p">),</span> <span class="n">n_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">n_dtf</span><span class="p">)</span>
    <span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="n">u3</span> <span class="o">=</span> <span class="n">n_array</span><span class="p">(</span><span class="n">disp</span><span class="o">.</span><span class="n">data1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">n_dtf</span><span class="p">),</span> <span class="n">n_array</span><span class="p">(</span><span class="n">disp</span><span class="o">.</span><span class="n">data2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">n_dtf</span><span class="p">),</span> <span class="n">n_array</span><span class="p">(</span><span class="n">disp</span><span class="o">.</span><span class="n">data3</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">n_dtf</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">a_array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,</span> <span class="p">(</span> <span class="n">n1</span> <span class="o">+</span> <span class="n">u1</span> <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">a_array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,</span> <span class="p">(</span> <span class="n">n2</span> <span class="o">+</span> <span class="n">u2</span> <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">a_array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,</span> <span class="p">(</span> <span class="n">n3</span> <span class="o">+</span> <span class="n">u3</span> <span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="p">)</span>
  </div>
<div class="viewcode-block" id="Nodes.closest_node"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Nodes.closest_node">[docs]</a>  <span class="k">def</span> <span class="nf">closest_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Finds the closest node of an existing node.</span>
<span class="sd">    </span>
<span class="sd">    :param label: node label to be used.</span>
<span class="sd">    :type label: int &gt; 0</span>
<span class="sd">    :rtype: label (int &gt; 0) and distance (float) of the closest node.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span><span class="p">,</span> <span class="n">float32</span><span class="p">,</span> <span class="n">uint32</span><span class="p">,</span> <span class="n">where</span><span class="p">,</span> <span class="n">delete</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">float32</span><span class="p">)</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">float32</span><span class="p">)</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">float32</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">uint32</span><span class="p">)</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="n">Z</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">pos</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span>
    <span class="n">Dist</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="n">X</span><span class="o">-</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">Y</span><span class="o">-</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">Z</span><span class="o">-</span><span class="n">z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span><span class="o">**.</span><span class="mi">5</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">Dist</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">Dist</span> <span class="o">==</span> <span class="n">dist</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">lab</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">lab</span><span class="p">,</span> <span class="n">dist</span>    
  </div>
<div class="viewcode-block" id="Nodes.replace_node"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Nodes.replace_node">[docs]</a>  <span class="k">def</span> <span class="nf">replace_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Replaces a node of given label (old) by another existing node (new).</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">nlabels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
    <span class="n">nsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span>
    <span class="n">nlabels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
    <span class="c"># Some verifications</span>
    <span class="k">if</span> <span class="n">old</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nlabels</span> <span class="ow">or</span> <span class="n">new</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nlabels</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;Both node labels must exist.&#39;</span>
    <span class="c"># Let&#39;s proceed</span>
    <span class="n">i_old</span><span class="p">,</span> <span class="n">i_new</span> <span class="o">=</span> <span class="n">nlabels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">old</span><span class="p">),</span> <span class="n">nlabels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
    <span class="n">nlabels</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i_old</span><span class="p">)</span>
    <span class="n">x</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i_old</span><span class="p">)</span>
    <span class="n">y</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i_old</span><span class="p">)</span>
    <span class="n">z</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i_old</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">nsk</span> <span class="ow">in</span> <span class="n">nsets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="n">ns</span> <span class="o">=</span> <span class="n">nsets</span><span class="p">[</span><span class="n">nsk</span><span class="p">]</span> 
      <span class="k">if</span> <span class="n">old</span> <span class="ow">in</span> <span class="n">ns</span><span class="p">:</span>
        <span class="n">ns</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">old</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">new</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ns</span><span class="p">:</span> <span class="n">ns</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new</span><span class="p">)</span></div>
<div class="viewcode-block" id="Nodes.boundingBox"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Nodes.boundingBox">[docs]</a>  <span class="k">def</span> <span class="nf">boundingBox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">margin</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the dimensions of a cartesian box containing the mesh with a relative margin.</span>
<span class="sd">    </span>
<span class="sd">    :param margin: relative margin of the box. O. means no margin, 0.1 is default.</span>
<span class="sd">    :type margin: float </span>
<span class="sd">    :rtype: tuple containing 3 tuples with x, y and z limits of the box.    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
    <span class="n">zmin</span><span class="p">,</span> <span class="n">zmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
    <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">dz</span> <span class="o">=</span> <span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">,</span>  <span class="n">zmax</span> <span class="o">-</span> <span class="n">zmin</span>
    <span class="k">return</span> <span class="p">(</span> <span class="p">(</span><span class="n">xmin</span> <span class="o">-</span> <span class="n">margin</span> <span class="o">*</span> <span class="n">dx</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">+</span> <span class="n">margin</span> <span class="o">*</span> <span class="n">dx</span> <span class="p">),</span> <span class="p">(</span><span class="n">ymin</span> <span class="o">-</span> <span class="n">margin</span> <span class="o">*</span> <span class="n">dy</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">+</span> <span class="n">margin</span> <span class="o">*</span> <span class="n">dy</span> <span class="p">),</span> <span class="p">(</span><span class="n">zmin</span> <span class="o">-</span> <span class="n">margin</span> <span class="o">*</span> <span class="n">dz</span><span class="p">,</span> <span class="n">zmax</span> <span class="o">+</span> <span class="n">margin</span> <span class="o">*</span> <span class="n">dz</span> <span class="p">)</span> <span class="p">)</span></div>
  <span class="k">def</span> <span class="nf">apply_reflection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">point</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">normal</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Applies a reflection symmetry to the nodes instance. The reflection plane is defined by a point and a normal direction.</span>
<span class="sd">    </span>
<span class="sd">    :param point: coordinates of a point of the reflection plane.</span>
<span class="sd">    :type point: tuple or list containing 3 floats</span>
<span class="sd">    :param normal: normal vector to the reflection plane</span>
<span class="sd">    :type normal: tuple or list containing 3 floats</span>
<span class="sd">    </span>
<span class="sd">    :rtype: ``Mesh`` instances</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span> <span class="k">as</span> <span class="n">n_array</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">float32</span><span class="p">,</span> <span class="n">float64</span><span class="p">,</span> <span class="n">sqrt</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span> <span class="k">as</span> <span class="n">a_array</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">point</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;point must be a list  of length 3.&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">normal</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;normal must be a list  of length 3.&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;f&#39;</span> <span class="p">:</span> <span class="n">a_dtf</span> <span class="o">=</span> <span class="n">float32</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;d&#39;</span> <span class="p">:</span> <span class="n">a_dtf</span> <span class="o">=</span> <span class="n">float64</span>
    <span class="n">xp</span><span class="p">,</span> <span class="n">yp</span><span class="p">,</span> <span class="n">zp</span> <span class="o">=</span> <span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">point</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> 
    <span class="n">xn</span><span class="p">,</span> <span class="n">yn</span><span class="p">,</span> <span class="n">zn</span> <span class="o">=</span> <span class="n">normal</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">normal</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">normal</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> 
    <span class="n">norm</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span> <span class="n">xn</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">yn</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">zn</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span> 
    <span class="n">xn</span><span class="p">,</span> <span class="n">yn</span><span class="p">,</span> <span class="n">zn</span> <span class="o">=</span> <span class="n">xn</span> <span class="o">/</span> <span class="n">norm</span><span class="p">,</span> <span class="n">yn</span> <span class="o">/</span> <span class="n">norm</span><span class="p">,</span> <span class="n">zn</span> <span class="o">/</span> <span class="n">norm</span> 
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">n_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span> <span class="n">a_dtf</span><span class="p">),</span> <span class="n">n_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span> <span class="n">a_dtf</span><span class="p">),</span> <span class="n">n_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span> <span class="n">a_dtf</span><span class="p">)</span>
    <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="n">xp</span><span class="p">,</span> <span class="n">y</span> <span class="o">-</span> <span class="n">yp</span><span class="p">,</span> <span class="n">z</span> <span class="o">-</span><span class="n">zp</span>
    <span class="n">vn</span> <span class="o">=</span> <span class="n">vx</span> <span class="o">*</span> <span class="n">xn</span> <span class="o">+</span> <span class="n">vy</span> <span class="o">*</span> <span class="n">yn</span> <span class="o">+</span> <span class="n">vz</span> <span class="o">*</span><span class="n">zn</span>
    <span class="n">vx</span><span class="p">,</span> <span class="n">vy</span><span class="p">,</span> <span class="n">vz</span> <span class="o">=</span> <span class="n">vx</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">vn</span> <span class="o">*</span> <span class="n">xn</span><span class="p">,</span> <span class="n">vy</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">vn</span> <span class="o">*</span> <span class="n">yn</span><span class="p">,</span> <span class="n">vz</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">vn</span> <span class="o">*</span> <span class="n">zn</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">vx</span> <span class="o">+</span> <span class="n">xp</span><span class="p">,</span> <span class="n">vy</span> <span class="o">+</span> <span class="n">yp</span><span class="p">,</span> <span class="n">vz</span> <span class="o">+</span> <span class="n">zp</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">z</span> <span class="o">=</span> <span class="n">a_array</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span> <span class="n">a_array</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">tolist</span><span class="p">()),</span> <span class="n">a_array</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span> <span class="n">z</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">out</span>
    
    </div>
<div class="viewcode-block" id="Mesh"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Mesh">[docs]</a><span class="k">class</span> <span class="nc">Mesh</span><span class="p">:</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Manages meshes for finite element modeling pre/postprocessing and further graphical representations.</span>
<span class="sd">  </span>
<span class="sd">  :param nodes: nodes container. If None, a void Nodes instance will be used. The values of dti and dtf used by nodes are extended to mesh.</span>
<span class="sd">  :type nodes: Nodes class instance or None</span>
<span class="sd">  :param labels: elements labels</span>
<span class="sd">  :type label: list of ints &gt; 0</span>
<span class="sd">  :param connectivity: elements connectivities using node labels</span>
<span class="sd">  :type connectivity: list of lists each containing ints &gt; 0</span>
<span class="sd">  :param space: elements embedded spaces. This formulation is simple and allows to distinguish 1D elements (space = 1), surface elements (space = 2) and volumic elements (space = 3)</span>
<span class="sd">  :type space: list of ints in [1,2,3]</span>
<span class="sd">  :param name: elements names used, for example in a FEM code: &#39;CAX4, C3D8, ...&#39;</span>
<span class="sd">  :type name: list of strings</span>
<span class="sd">  :param sets: element sets</span>
<span class="sd">  :type sets: dict with string keys and list of ints &gt; 0 values</span>
<span class="sd">  :type surfaces: element surfaces.</span>
<span class="sd">  :param surface: dict with str keys containing tuples with 2 elements, the first being the name of an element set and the second the number of the face.</span>
<span class="sd">  </span>
<span class="sd">  &gt;&gt;&gt; from abapy.mesh import Mesh, Nodes</span>
<span class="sd">  &gt;&gt;&gt; mesh = Mesh()</span>
<span class="sd">  &gt;&gt;&gt; nodes = mesh.nodes</span>
<span class="sd">  &gt;&gt;&gt; # Adding some nodes</span>
<span class="sd">  &gt;&gt;&gt; nodes.add_node(label = 1, x = 0. ,y = 0. , z = 0.)</span>
<span class="sd">  &gt;&gt;&gt; nodes.add_node(label = 2, x = 1. ,y = 0. , z = 0.)</span>
<span class="sd">  &gt;&gt;&gt; nodes.add_node(label = 3, x = 1. ,y = 1. , z = 0.)</span>
<span class="sd">  &gt;&gt;&gt; nodes.add_node(label = 4, x = 0. ,y = 1. , z = 0.)</span>
<span class="sd">  &gt;&gt;&gt; nodes.add_node(label = 5, x = 2. ,y = 0. , z = 0.)</span>
<span class="sd">  &gt;&gt;&gt; nodes.add_node(label = 6, x = 2. ,y = 1. , z = 0.)</span>
<span class="sd">  &gt;&gt;&gt; # Adding some elements</span>
<span class="sd">  &gt;&gt;&gt; mesh.add_element(label=1, connectivity = (1,2,3,4), space =2, name = &#39;QUAD4&#39;, toset=&#39;mySet&#39; )</span>
<span class="sd">  &gt;&gt;&gt; mesh.add_element(label=2, connectivity = (2,5,6,3), space =2, name = &#39;QUAD4&#39; )</span>
<span class="sd">  &gt;&gt;&gt; print mesh[1]</span>
<span class="sd">  Mesh class instance:</span>
<span class="sd">  Elements:</span>
<span class="sd">  Label	Connectivity		Space	Name</span>
<span class="sd">  1	[1L, 2L, 3L, 4L]	2D	QUAD4</span>
<span class="sd">  Sets:</span>
<span class="sd">  Label	Elements</span>
<span class="sd">  myset	1</span>
<span class="sd">  &gt;&gt;&gt; print mesh[1,2] # requesting elements with labels 1 and 2</span>
<span class="sd">  Mesh class instance:</span>
<span class="sd">  Elements:</span>
<span class="sd">  Label	Connectivity		Space	Name</span>
<span class="sd">  1	[1L, 2L, 3L, 4L]	2D	QUAD4</span>
<span class="sd">  2	[2L, 5L, 6L, 3L]	2D	QUAD4</span>
<span class="sd">  Sets:</span>
<span class="sd">  Label	Elements</span>
<span class="sd">  myset	1</span>
<span class="sd">  &gt;&gt;&gt; print mesh[1:2:1] # requesting elements with labels in range(1,2,1)</span>
<span class="sd">  Mesh class instance:</span>
<span class="sd">  Elements:</span>
<span class="sd">  Label	Connectivity		Space	Name</span>
<span class="sd">  1	[1L, 2L, 3L, 4L]	2D	QUAD4</span>
<span class="sd">  Sets:</span>
<span class="sd">  Label	Elements</span>
<span class="sd">  myset	1</span>
<span class="sd">  &gt;&gt;&gt; print mesh[&#39;mySet&#39;]</span>
<span class="sd">  Mesh class instance:</span>
<span class="sd">  Elements:</span>
<span class="sd">  Label	Connectivity		Space	Name</span>
<span class="sd">  1	[1L, 2L, 3L, 4L]	2D	QUAD4</span>
<span class="sd">  Sets:</span>
<span class="sd">  Label	Elements</span>
<span class="sd">  myset	1</span>
<span class="sd">  &gt;&gt;&gt; print mesh[&#39;myset&#39;] # requesting elements that belong to set &#39;myset&#39;</span>
<span class="sd">  Mesh class instance:</span>
<span class="sd">  Elements:</span>
<span class="sd">  Label	Connectivity		Space	Name</span>
<span class="sd">  1	[1L, 2L, 3L, 4L]	2D	QUAD4</span>
<span class="sd">  Sets:</span>
<span class="sd">  Label	Elements</span>
<span class="sd">  myset	1</span>
<span class="sd">  &gt;&gt;&gt; print mesh[&#39;ImNoSet&#39;]</span>
<span class="sd">  Mesh class instance:</span>
<span class="sd">  Elements:</span>
<span class="sd">  Label	Connectivity		Space	Name</span>
<span class="sd">  Sets:</span>
<span class="sd">  Label	Elements&#39;&#39;&#39;</span>
  
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">nodes</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span><span class="n">connectivity</span><span class="o">=</span><span class="p">[],</span><span class="n">space</span><span class="o">=</span><span class="p">[],</span><span class="n">labels</span><span class="o">=</span><span class="p">[],</span><span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">sets</span><span class="o">=</span><span class="p">{},</span> <span class="n">surfaces</span> <span class="o">=</span> <span class="p">{}):</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="k">if</span> <span class="n">nodes</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">nodes</span> <span class="o">=</span> <span class="n">Nodes</span><span class="p">()</span> 
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span><span class="n">Nodes</span><span class="p">):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">nodes</span> 
      <span class="bp">self</span><span class="o">.</span><span class="n">dti</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">dti</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">dtf</span>
      <span class="n">dti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dti</span>
      <span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;nodes argument must be a Nodes class instance.&#39;</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">name</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dti</span><span class="p">,[])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">space</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&#39;H&#39;</span><span class="p">,[])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sets</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">surfaces</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">connectivity</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;connectivity must have the same length as labels.&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">space</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;space must have the same length as labels.&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;if not None, name must have the same length as labels.&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">space</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sets</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">dict</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;sets type must be dict.&#39;</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">sets</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">surfaces</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">add_surface</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">surface</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
  
  <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="n">labs</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">slice</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">start</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span> 
        <span class="n">start</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">start</span>
      <span class="k">else</span><span class="p">:</span> 
        <span class="n">start</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">stop</span>  <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">stop</span>
      <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">step</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span> 
        <span class="n">step</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">step</span>
      <span class="k">else</span><span class="p">:</span> 
        <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">labs</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="n">step</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">]:</span>  
      <span class="n">labs</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
       <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span><span class="n">labs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
       <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span><span class="n">labs</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">lower</span><span class="p">()]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
      <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
      <span class="k">if</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">labs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">labs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">elabels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
    <span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span>
    <span class="n">dti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dti</span>
    <span class="n">esets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span>
    <span class="n">connectivity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span>
    <span class="n">space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">space</span>
    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
    <span class="n">nlabels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">labels</span>
    <span class="n">nsets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">Nodes</span><span class="p">(</span><span class="n">dti</span><span class="o">=</span><span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span><span class="o">=</span><span class="n">dtf</span><span class="p">)</span>
    <span class="n">E</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">N</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labs</span><span class="p">:</span>
      <span class="n">toset</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="n">i</span> <span class="o">=</span> <span class="n">elabels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">sk</span> <span class="ow">in</span> <span class="n">esets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">esets</span><span class="p">[</span><span class="n">sk</span><span class="p">]:</span>
          <span class="n">toset</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sk</span><span class="p">)</span>
      <span class="n">E</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">l</span><span class="p">,</span> <span class="n">connectivity</span> <span class="o">=</span> <span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">space</span> <span class="o">=</span> <span class="n">space</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">toset</span> <span class="o">=</span> <span class="n">toset</span><span class="p">)</span>
    <span class="n">nlabs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">connectivity</span><span class="p">)):</span>
      <span class="n">nlabs</span> <span class="o">+=</span> <span class="n">E</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">nlabs</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">nlabs</span><span class="p">)]</span>
    <span class="n">E</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">nlabs</span><span class="p">]</span>
         
    <span class="k">return</span> <span class="n">E</span>      
  
  <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;&lt;Mesh class instance: {} elements&gt;&#39;</span>
    <span class="k">return</span> <span class="n">pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">))</span>  
  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
    <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span>
    <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">space</span>
    <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
    <span class="n">out</span> <span class="o">=</span><span class="s">&#39;Mesh class instance:</span><span class="se">\n</span><span class="s">Elements:</span><span class="se">\n</span><span class="s">Label</span><span class="se">\t</span><span class="s">Connectivity</span><span class="se">\t\t</span><span class="s">Space</span><span class="se">\t</span><span class="s">Name</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
      <span class="n">out</span> <span class="o">+=</span>  <span class="s">&#39;{0}</span><span class="se">\t</span><span class="s">{1}</span><span class="se">\t</span><span class="s">{2}</span><span class="se">\t</span><span class="s">{3}</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span><span class="s">&#39;{0}D&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span><span class="n">n</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">out</span><span class="o">+=</span> <span class="s">&#39;Sets:</span><span class="se">\n</span><span class="s">Label</span><span class="se">\t</span><span class="s">Elements</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="n">out</span> <span class="o">+=</span>  <span class="s">&#39;{0}</span><span class="se">\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;{0},&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
      <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
    
    <span class="k">return</span> <span class="n">out</span>
<div class="viewcode-block" id="Mesh.add_element"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Mesh.add_element">[docs]</a>  <span class="k">def</span> <span class="nf">add_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">connectivity</span><span class="p">,</span> <span class="n">space</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">toset</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Adds an element.</span>
<span class="sd">    </span>
<span class="sd">    :param connectivity: element connectivity using node labels.</span>
<span class="sd">    :type connectivity: list of int &gt; 0</span>
<span class="sd">    :param space: element embedded space, can be 1 for lineic element, 2 for surfacic element and 3 for volumic element.</span>
<span class="sd">    :type space: int in [1,2,3]</span>
<span class="sd">    :param name: element name used in fem code. </span>
<span class="sd">    :type name: string</span>
<span class="sd">    :param toset: set(s) to which element is to be added. If a set does not exist, it is created. </span>
<span class="sd">    :type toset: string or list of strings</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from abapy.mesh import Mesh, Nodes</span>
<span class="sd">    &gt;&gt;&gt; mesh = Mesh()</span>
<span class="sd">    &gt;&gt;&gt; nodes = mesh.nodes</span>
<span class="sd">    &gt;&gt;&gt; # Adding some nodes</span>
<span class="sd">    ... nodes.add_node(label = 1, x = 0. ,y = 0. , z = 0.)</span>
<span class="sd">    &gt;&gt;&gt; nodes.add_node(label = 2, x = 1. ,y = 0. , z = 0.)</span>
<span class="sd">    &gt;&gt;&gt; nodes.add_node(label = 3, x = 1. ,y = 1. , z = 0.)</span>
<span class="sd">    &gt;&gt;&gt; nodes.add_node(label = 4, x = 0. ,y = 1. , z = 0.)</span>
<span class="sd">    &gt;&gt;&gt; nodes.add_node(label = 5, x = 2. ,y = 0. , z = 0.)</span>
<span class="sd">    &gt;&gt;&gt; nodes.add_node(label = 6, x = 2. ,y = 1. , z = 0.)</span>
<span class="sd">    &gt;&gt;&gt; # Adding some elements</span>
<span class="sd">    ... mesh.add_element(label=1, connectivity = (1,2,3,4), space =2, name = &#39;QUAD4&#39;, toset=&#39;mySet&#39; )</span>
<span class="sd">    &gt;&gt;&gt; mesh.add_element(label=2, connectivity = (2,5,6,3), space =2, name = &#39;QUAD4&#39;, toset = [&#39;mySet&#39;,&#39;myOtherSet&#39;] )</span>
<span class="sd">    &gt;&gt;&gt; print mesh</span>
<span class="sd">    Mesh class instance:</span>
<span class="sd">    Elements:</span>
<span class="sd">    Label	Connectivity		Space	Name</span>
<span class="sd">    1	[1L, 2L, 3L, 4L]	2D	QUAD4</span>
<span class="sd">    2	[2L, 5L, 6L, 3L]	2D	QUAD4</span>
<span class="sd">    Sets:</span>
<span class="sd">    Label	Elements</span>
<span class="sd">    myotherset	2</span>
<span class="sd">    myset	1,2&#39;&#39;&#39;</span>
    
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
    <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dti</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span>
    <span class="c"># Input verifications</span>
    <span class="n">connect</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dti</span><span class="p">,</span><span class="n">connectivity</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">label</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> 
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">label</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">label</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;element labels must be int.&#39;</span>
    <span class="k">if</span> <span class="n">space</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;space must be 1,2 or 3&#39;</span>
    <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;name type must be str&#39;</span>  
    
    <span class="c"># inputs processing</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span> 
      <span class="k">print</span> <span class="s">&#39;Info: node {0} already exists, nothing changed.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
      <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">connect</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">space</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span> 
        <span class="k">if</span> <span class="n">label</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">):</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">connect</span><span class="p">)</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">space</span><span class="p">)</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">dummy</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
          <span class="n">dummy</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
          <span class="n">i</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">dummy</span><span class="p">)</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
          <span class="k">del</span> <span class="n">dummy</span> <span class="c"># Is it necessary ?</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">label</span><span class="p">)</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">connect</span><span class="p">)</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">space</span><span class="p">)</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">name</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">toset</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">toset</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="n">toset</span><span class="p">,[</span><span class="n">label</span><span class="p">])</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="s">&#39;__getitem__&#39;</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">toset</span><span class="p">):</span>
          <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">toset</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="n">s</span><span class="p">,[</span><span class="n">label</span><span class="p">])</span>
  </div>
<div class="viewcode-block" id="Mesh.drop_element"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Mesh.drop_element">[docs]</a>  <span class="k">def</span> <span class="nf">drop_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Removes one element to Mesh instance. The element is also removed from sets and surfaces, if a set or surface happens to be empty, it is also removed.</span>
<span class="sd">    </span>
<span class="sd">    :param label: element to be removed&#39;s label.</span>
<span class="sd">    :type label: int &gt; 0</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from abapy.indentation import ParamInfiniteMesh</span>
<span class="sd">    &gt;&gt;&gt; from copy import copy</span>
<span class="sd">    &gt;&gt;&gt; </span>
<span class="sd">    &gt;&gt;&gt; # Let&#39;s create a mesh containing a surface:</span>
<span class="sd">    ... m = ParamInfiniteMesh(Na = 2, Nb = 2)</span>
<span class="sd">    &gt;&gt;&gt; print m.surfaces</span>
<span class="sd">    {&#39;samp_surf&#39;: [(&#39;top_elem&#39;, 3)]}</span>
<span class="sd">    &gt;&gt;&gt; elem_to_remove = copy(m.sets[&#39;top_elem&#39;])</span>
<span class="sd">    &gt;&gt;&gt; # Let&#39;s remove all elements in the surface:</span>
<span class="sd">    ... for e in elem_to_remove:</span>
<span class="sd">    ...   m.drop_element(e)</span>
<span class="sd">    ... # We can see that sets and surfaces are removed when they become empty</span>
<span class="sd">    ... </span>
<span class="sd">    &gt;&gt;&gt; print m.surfaces</span>
<span class="sd">    {}</span>

<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span>
    <span class="n">sets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span>
    <span class="n">surfaces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfaces</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
    <span class="n">labels</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
    <span class="n">conn</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">sets</span><span class="p">[</span><span class="n">k</span><span class="p">]:</span> <span class="n">sets</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> 
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sets</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
        <span class="k">del</span> <span class="n">sets</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>    
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">surfaces</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
          <span class="n">surf</span> <span class="o">=</span> <span class="n">surfaces</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">surf</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">surf</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">k</span><span class="p">:</span>
              <span class="k">del</span> <span class="n">surf</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">surfaces</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">surfaces</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">==</span> <span class="p">[]:</span> <span class="k">del</span> <span class="n">surfaces</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>          
    </div>
<div class="viewcode-block" id="Mesh.drop_node"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Mesh.drop_node">[docs]</a>  <span class="k">def</span> <span class="nf">drop_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Drops a node from mesh.nodes instance. This method differs from to the nodes.drop_node element because it removes the node but also all elements containing the node in the mesh instance.</span>
<span class="sd">    </span>
<span class="sd">    :param label: node to be removed&#39;s label.</span>
<span class="sd">    :type label: int &gt; 0</span>
<span class="sd">    </span>
<span class="sd">    .. plot:: example_code/mesh/Mesh-drop_node.py</span>
<span class="sd">     :include-source:</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">drop_node</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span>
    <span class="n">elem2remove</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
      <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">conn</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">elem2remove</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">elem2remove</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">drop_element</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        
      
    
          </div>
<div class="viewcode-block" id="Mesh.add_set"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Mesh.add_set">[docs]</a>  <span class="k">def</span> <span class="nf">add_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">,</span><span class="n">elements</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Adds a new set or appends elements to an existing set.</span>
<span class="sd">    </span>
<span class="sd">    :param label: set label to be added.</span>
<span class="sd">    :type label: string</span>
<span class="sd">    :param elements: element(s) that belong to the step.</span>
<span class="sd">    :type elements: int &gt; 0 or list of int &gt; 0</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from abapy.mesh import Mesh, Nodes</span>
<span class="sd">    &gt;&gt;&gt; mesh = Mesh()</span>
<span class="sd">    &gt;&gt;&gt; nodes = mesh.nodes</span>
<span class="sd">    &gt;&gt;&gt; # Adding some nodes</span>
<span class="sd">    &gt;&gt;&gt; nodes.add_node(label = 1, x = 0. ,y = 0. , z = 0.)</span>
<span class="sd">    &gt;&gt;&gt; nodes.add_node(label = 2, x = 1. ,y = 0. , z = 0.)</span>
<span class="sd">    &gt;&gt;&gt; nodes.add_node(label = 3, x = 1. ,y = 1. , z = 0.)</span>
<span class="sd">    &gt;&gt;&gt; nodes.add_node(label = 4, x = 0. ,y = 1. , z = 0.)</span>
<span class="sd">    &gt;&gt;&gt; nodes.add_node(label = 5, x = 2. ,y = 0. , z = 0.)</span>
<span class="sd">    &gt;&gt;&gt; nodes.add_node(label = 6, x = 2. ,y = 1. , z = 0.)</span>
<span class="sd">    &gt;&gt;&gt; # Adding some elements</span>
<span class="sd">    &gt;&gt;&gt; mesh.add_element(label=1, connectivity = (1,2,3,4), space =2, name = &#39;QUAD4&#39;)</span>
<span class="sd">    &gt;&gt;&gt; mesh.add_element(label=2, connectivity = (2,5,6,3), space =2, name = &#39;QUAD4&#39;)</span>
<span class="sd">    &gt;&gt;&gt; # Adding sets</span>
<span class="sd">    &gt;&gt;&gt; mesh.add_set(label = &#39;niceSet&#39;, elements = 1)</span>
<span class="sd">    &gt;&gt;&gt; mesh.add_set(label = &#39;veryNiceSet&#39;, elements = [1,2])</span>
<span class="sd">    &gt;&gt;&gt; mesh.add_set(label = &#39;simplyTheBestSet&#39;, elements = 1)</span>
<span class="sd">    &gt;&gt;&gt; mesh.add_set(label = &#39;simplyTheBestSet&#39;, elements = 2)</span>
<span class="sd">    &gt;&gt;&gt; print mesh</span>
<span class="sd">    Mesh class instance:</span>
<span class="sd">    Elements:</span>
<span class="sd">    Label	Connectivity		Space	Name</span>
<span class="sd">    1	[1L, 2L, 3L, 4L]	2D	QUAD4</span>
<span class="sd">    2	[2L, 5L, 6L, 3L]	2D	QUAD4</span>
<span class="sd">    Sets:</span>
<span class="sd">    Label	Elements</span>
<span class="sd">    niceset	1</span>
<span class="sd">    veryniceset	1,2</span>
<span class="sd">    simplythebestset	1,2</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;set names must be strings.&#39;</span>
    <span class="n">label2</span> <span class="o">=</span> <span class="n">label</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">label2</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="n">label2</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dti</span><span class="p">,[])</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">==</span> <span class="nb">long</span><span class="p">:</span> <span class="n">elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">elements</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="k">return</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="n">label2</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span> <span class="s">&#39;Info: element {0} does not exist, it was not added to set {1}.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">label2</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="n">label2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="n">label2</span><span class="p">]))</span>
  </div>
<div class="viewcode-block" id="Mesh.add_surface"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Mesh.add_surface">[docs]</a>  <span class="k">def</span> <span class="nf">add_surface</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">description</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Adds or expands an element surface (*i. e.* a group a element faces). Surfaces are used to define contact interactions in simulations.</span>
<span class="sd">    </span>
<span class="sd">    :param label: surface label.</span>
<span class="sd">    :type label: string</span>
<span class="sd">    :param description: list of ( element set label , face number ) tuples.</span>
<span class="sd">    :type description: list containing tuples each containing a string and an int</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from abapy.mesh import RegularQuadMesh</span>
<span class="sd">    &gt;&gt;&gt; mesh = RegularQuadMesh()</span>
<span class="sd">    &gt;&gt;&gt; mesh.add_surface(&#39;topsurface&#39;, [ (&#39;top&#39;, 1) ])</span>
<span class="sd">    &gt;&gt;&gt; mesh.add_surface(&#39;topsurface&#39;, [ (&#39;top&#39;, 2) ])</span>
<span class="sd">    &gt;&gt;&gt; mesh.surfaces</span>
<span class="sd">    {&#39;topsurface&#39;: [(&#39;top&#39;, 1), (&#39;top&#39;, 2)]}</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;Surface labels must be string, got {0} instead&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">label</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">description</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;Surface description must be list, got {0} instead&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">description</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">description</span><span class="p">)):</span>
      <span class="n">t</span> <span class="o">=</span> <span class="n">description</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span> <span class="p">,</span> <span class="s">&#39;Surface description elements must have 2 elements, got {0} instead&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
      <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;(In surface) Element sets keys must must be str, got {0} instead&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
      <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;Face numbers must keys must be int (generally in [1...6]), got {0} instead&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfaces</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfaces</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">surf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfaces</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">description</span><span class="p">)):</span>
      <span class="n">t</span> <span class="o">=</span> <span class="n">description</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">tt</span> <span class="o">=</span> <span class="p">(</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span> <span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
      <span class="k">if</span> <span class="n">tt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">surf</span><span class="p">:</span> <span class="n">surf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tt</span><span class="p">)</span>
        
    </div>
<div class="viewcode-block" id="Mesh.dump2inp"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Mesh.dump2inp">[docs]</a>  <span class="k">def</span> <span class="nf">dump2inp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Dumps the whole mesh (*i. e.* elements + nodes) to Abaqus INP format.</span>
<span class="sd">    </span>
<span class="sd">    :rtype: string</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from abapy.mesh import Mesh, Nodes</span>
<span class="sd">    &gt;&gt;&gt; mesh = Mesh()</span>
<span class="sd">    &gt;&gt;&gt; nodes = mesh.nodes</span>
<span class="sd">    &gt;&gt;&gt; # Adding some nodes</span>
<span class="sd">    &gt;&gt;&gt; nodes.add_node(label = 1, x = 0. ,y = 0. , z = 0.)</span>
<span class="sd">    &gt;&gt;&gt; nodes.add_node(label = 2, x = 1. ,y = 0. , z = 0.)</span>
<span class="sd">    &gt;&gt;&gt; nodes.add_node(label = 3, x = 1. ,y = 1. , z = 0.)</span>
<span class="sd">    &gt;&gt;&gt; nodes.add_node(label = 4, x = 0. ,y = 1. , z = 0.)</span>
<span class="sd">    &gt;&gt;&gt; nodes.add_node(label = 5, x = 2. ,y = 0. , z = 0.)</span>
<span class="sd">    &gt;&gt;&gt; nodes.add_node(label = 6, x = 2. ,y = 1. , z = 0.)</span>
<span class="sd">    &gt;&gt;&gt; # Adding some elements</span>
<span class="sd">    &gt;&gt;&gt; mesh.add_element(label=1, connectivity = (1,2,3,4), space =2, name = &#39;QUAD4&#39;)</span>
<span class="sd">    &gt;&gt;&gt; mesh.add_element(label=2, connectivity = (2,5,6,3), space =2, name = &#39;QUAD4&#39;)</span>
<span class="sd">    &gt;&gt;&gt; # Adding sets</span>
<span class="sd">    &gt;&gt;&gt; mesh.add_set(label = &#39;veryNiceSet&#39;, elements = [1,2])</span>
<span class="sd">    &gt;&gt;&gt; # Adding surfaces</span>
<span class="sd">    &gt;&gt;&gt; mesh.add_surface(label = &#39;superNiceSurface&#39;, description = [ (&#39;veryNiceSet&#39;, 2) ])</span>
<span class="sd">    &gt;&gt;&gt; out = mesh.dump2inp()&#39;&#39;&#39;</span>
    
    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">dump2inp</span><span class="p">()</span>
    <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;**----------------------------------</span><span class="se">\n</span><span class="s">** ELEMENTS</span><span class="se">\n</span><span class="s">**----------------------------------</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">elTypes</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">elType</span> <span class="ow">in</span> <span class="n">elTypes</span><span class="p">:</span> <span class="n">elements</span><span class="p">[</span><span class="n">elType</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)):</span> <span class="n">elements</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">elType</span> <span class="ow">in</span> <span class="n">elements</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="n">els</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="n">elType</span><span class="p">]</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">els</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">+=</span><span class="s">&#39;*ELEMENT, TYPE={0}, ELSET={0}_ELEMENTS</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">elType</span><span class="p">)</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;{0}, &#39;</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">els</span><span class="p">)):</span>
          <span class="n">label</span> <span class="o">=</span> <span class="n">els</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
          <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
          <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
          <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;  {0}, &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> 
          <span class="k">for</span> <span class="n">summit</span> <span class="ow">in</span> <span class="n">conn</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">+=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">summit</span><span class="p">)</span>
          <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> 
    <span class="c"># ELEMENT SETS</span>
    <span class="n">out</span> <span class="o">+=</span><span class="s">&#39;**----------------------------------</span><span class="se">\n</span><span class="s">** ELEMENT SETS</span><span class="se">\n</span><span class="s">**----------------------------------</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;*ELSET, ELSET={0}</span><span class="se">\n</span><span class="s"> &#39;</span>
    <span class="n">pattern1</span> <span class="o">=</span> <span class="s">&#39; {0},&#39;</span>
    <span class="n">sets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span> 
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">sets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="n">eset</span> <span class="o">=</span> <span class="n">sets</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
      <span class="n">out</span> <span class="o">+=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
      <span class="n">nCount</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">eset</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="n">pattern1</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
        <span class="n">nCount</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">nCount</span> <span class="o">&gt;=</span> <span class="mi">9</span><span class="p">:</span> 
          <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
          <span class="n">nCount</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>      
    <span class="c"># SURFACES</span>
    <span class="n">out</span> <span class="o">+=</span><span class="s">&#39;**----------------------------------</span><span class="se">\n</span><span class="s">** ELEMENT SURFACES</span><span class="se">\n</span><span class="s">**----------------------------------</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;*SURFACE, TYPE=ELEMENT, NAME={0}</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">pattern1</span> <span class="o">=</span> <span class="s">&#39; {0}, S{1}</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">surfaces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfaces</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">surfaces</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="n">surf</span> <span class="o">=</span> <span class="n">surfaces</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
      <span class="n">out</span> <span class="o">+=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
      <span class="k">for</span> <span class="n">surfset</span> <span class="ow">in</span> <span class="n">surf</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="n">pattern1</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">surfset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">surfset</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">out</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    </div>
<div class="viewcode-block" id="Mesh.convert2tri3"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Mesh.convert2tri3">[docs]</a>  <span class="k">def</span> <span class="nf">convert2tri3</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mapping</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts 2D elements to 3 noded triangles only. </span>
<span class="sd">    </span>
<span class="sd">    :param mapping: gives the mapping of element name changes to be applied when elements are splitted. Example: mapping = {&#39;CAX4&#39;:&#39;CAX3&#39;}</span>
<span class="sd">    :type mapping: dict with string keys and values  </span>
<span class="sd">    :rtype: Mesh instance containing only triangular elements.</span>
<span class="sd">      </span>
<span class="sd">    .. note:: This function was mainly developped to allow easy ploting in matplotlib using ``matplotlib.plyplot.triplot``, ``matplotlib.plyplot.tricontour`` and ``matplotlib.plyplot.contourf`` which rely on full triangle meshes. On a practical point of view, it easily used wrapped inside the ``abapy.Mesh.dump2triplot`` methods which rewrites connectivity in an easier to plot way.</span>
<span class="sd">      </span>
<span class="sd">    .. plot:: example_code/mesh/Mesh-convert2tri3.py</span>
<span class="sd">     :include-source:</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
    <span class="n">dti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dti</span>
    <span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">)</span>
    <span class="c">#surfaces = deepcopy(self.surfaces)</span>
    <span class="n">el2</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)):</span>
      <span class="n">l</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
      <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">sets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">sk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
          <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="n">sk</span><span class="p">]:</span> <span class="n">sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sk</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mapping</span> <span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
          <span class="k">if</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="n">n2</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span> 
          <span class="n">n2</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
          <span class="n">el2</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">connectivity</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span><span class="n">space</span> <span class="o">=</span> <span class="n">s</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">n</span><span class="p">,</span> <span class="n">sets</span> <span class="o">=</span> <span class="n">sets</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
          <span class="n">el2</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">connectivity</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">space</span> <span class="o">=</span> <span class="n">s</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">n2</span><span class="p">,</span> <span class="n">toset</span> <span class="o">=</span> <span class="n">sets</span><span class="p">)</span>
          <span class="n">el2</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">connectivity</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">space</span> <span class="o">=</span> <span class="n">s</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">n2</span><span class="p">,</span> <span class="n">toset</span> <span class="o">=</span> <span class="n">sets</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
          <span class="n">el2</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">connectivity</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">5</span><span class="p">]],</span> <span class="n">space</span> <span class="o">=</span> <span class="n">s</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">n2</span><span class="p">,</span> <span class="n">toset</span> <span class="o">=</span> <span class="n">sets</span><span class="p">)</span>
          <span class="n">el2</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">connectivity</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">]],</span> <span class="n">space</span> <span class="o">=</span> <span class="n">s</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">n2</span><span class="p">,</span> <span class="n">toset</span> <span class="o">=</span> <span class="n">sets</span><span class="p">)</span>
          <span class="n">el2</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">connectivity</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">5</span><span class="p">]],</span> <span class="n">space</span> <span class="o">=</span> <span class="n">s</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">n2</span><span class="p">,</span> <span class="n">toset</span> <span class="o">=</span> <span class="n">sets</span><span class="p">)</span>
          <span class="n">el2</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">connectivity</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span> <span class="n">space</span> <span class="o">=</span> <span class="n">s</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">n2</span><span class="p">,</span> <span class="n">toset</span> <span class="o">=</span> <span class="n">sets</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
          <span class="n">el2</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">connectivity</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">7</span><span class="p">]],</span> <span class="n">space</span> <span class="o">=</span> <span class="n">s</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">n2</span><span class="p">,</span> <span class="n">toset</span> <span class="o">=</span> <span class="n">sets</span><span class="p">)</span>
          <span class="n">el2</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">connectivity</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">5</span><span class="p">]],</span> <span class="n">space</span> <span class="o">=</span> <span class="n">s</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">n2</span><span class="p">,</span> <span class="n">toset</span> <span class="o">=</span> <span class="n">sets</span><span class="p">)</span>
          <span class="n">el2</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">connectivity</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">6</span><span class="p">]],</span> <span class="n">space</span> <span class="o">=</span> <span class="n">s</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">n2</span><span class="p">,</span> <span class="n">toset</span> <span class="o">=</span> <span class="n">sets</span><span class="p">)</span>
          <span class="n">el2</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">connectivity</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span> <span class="n">space</span> <span class="o">=</span> <span class="n">s</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">n2</span><span class="p">,</span> <span class="n">toset</span> <span class="o">=</span> <span class="n">sets</span><span class="p">)</span>
          <span class="n">el2</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">connectivity</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">6</span><span class="p">]],</span> <span class="n">space</span> <span class="o">=</span> <span class="n">s</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">n2</span><span class="p">,</span> <span class="n">toset</span> <span class="o">=</span> <span class="n">sets</span><span class="p">)</span>
          <span class="n">el2</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">connectivity</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">6</span><span class="p">]],</span> <span class="n">space</span> <span class="o">=</span> <span class="n">s</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">n2</span><span class="p">,</span> <span class="n">toset</span> <span class="o">=</span> <span class="n">sets</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">el2</span></div>
<div class="viewcode-block" id="Mesh.get_border"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Mesh.get_border">[docs]</a>  <span class="k">def</span> <span class="nf">get_border</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmin</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">ymin</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">zmin</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">zmax</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the list of edges belonging to the border of the meshed domain. Edges are given as x and y lists with None separator for faster ploting in ``matplotlib.pyplot``. </span>
<span class="sd">    </span>
<span class="sd">    :rtype: 3 lists of coordinates directly plotable in matplotlib</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">z</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span>
    <span class="n">borderEdges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">xe</span><span class="p">,</span><span class="n">ye</span><span class="p">,</span> <span class="n">ze</span> <span class="o">=</span><span class="p">[],[],[]</span>
    <span class="n">bi</span> <span class="o">=</span> <span class="n">borderEdges</span><span class="o">.</span><span class="n">index</span>
    <span class="n">ni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span>
    <span class="k">for</span> <span class="n">ne</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)):</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="p">[</span><span class="n">ne</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">el</span> <span class="o">=</span> <span class="n">conn</span><span class="p">[</span><span class="n">ne</span><span class="p">]</span>
        <span class="n">el</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">el</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">el</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
          <span class="n">edge</span> <span class="o">=</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
          <span class="n">revert</span> <span class="o">=</span> <span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> 
          <span class="k">if</span> <span class="n">revert</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">borderEdges</span> <span class="ow">and</span> <span class="n">edge</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">borderEdges</span><span class="p">:</span>
            <span class="n">borderEdges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
          <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">revert</span> <span class="ow">in</span> <span class="n">borderEdges</span><span class="p">:</span> 
              <span class="n">borderEdges</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">bi</span><span class="p">(</span><span class="n">revert</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span> 
              <span class="n">borderEdges</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">bi</span><span class="p">(</span><span class="n">edge</span><span class="p">))</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="p">[</span><span class="n">ne</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">el</span> <span class="o">=</span> <span class="n">conn</span><span class="p">[</span><span class="n">ne</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
          <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">,</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="p">,</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
          <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">5</span><span class="p">])]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
          <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">7</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">7</span><span class="p">])]</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
          <span class="n">revert</span> <span class="o">=</span> <span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> 
          <span class="n">b0</span> <span class="o">=</span> <span class="n">edge</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">borderEdges</span>
          <span class="n">b1</span> <span class="o">=</span> <span class="n">revert</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">borderEdges</span>
          <span class="k">if</span> <span class="n">b0</span> <span class="ow">and</span> <span class="n">b1</span><span class="p">:</span>
            <span class="n">borderEdges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
          <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">b0</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span> 
              <span class="n">borderEdges</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">bi</span><span class="p">(</span><span class="n">edge</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">b1</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span> 
              <span class="n">borderEdges</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">bi</span><span class="p">(</span><span class="n">revert</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">xmin</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">xmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xmax</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">xmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ymin</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">ymin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ymax</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">ymax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">zmin</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">zmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">zmax</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">zmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">test_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
      <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">      Tests if the node is in the bb.</span>
<span class="sd">      &#39;&#39;&#39;</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">xmin</span><span class="p">)</span> <span class="ow">and</span>  <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">xmax</span><span class="p">)</span> <span class="ow">and</span>  <span class="p">(</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">ymin</span><span class="p">)</span> <span class="ow">and</span>  <span class="p">(</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">ymax</span><span class="p">)</span> <span class="ow">and</span>  <span class="p">(</span><span class="n">z</span> <span class="o">&gt;=</span> <span class="n">zmin</span><span class="p">)</span> <span class="ow">and</span>  <span class="p">(</span><span class="n">z</span> <span class="o">&lt;=</span> <span class="n">zmax</span><span class="p">)</span>
        
    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">borderEdges</span><span class="p">:</span>
      <span class="n">n0</span><span class="p">,</span> <span class="n">n1</span> <span class="o">=</span> <span class="n">ni</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">ni</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">n0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">n0</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">n0</span><span class="p">]</span>
      <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">z1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">n1</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">n1</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">n1</span><span class="p">]</span> 
      <span class="k">if</span> <span class="p">(</span><span class="n">test_func</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">z0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">test_func</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">z0</span><span class="p">)):</span>
        <span class="n">xe</span> <span class="o">+=</span> <span class="p">[</span><span class="n">x0</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span>
        <span class="n">ye</span> <span class="o">+=</span> <span class="p">[</span><span class="n">y0</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span>
        <span class="n">ze</span> <span class="o">+=</span> <span class="p">[</span><span class="n">z0</span><span class="p">,</span><span class="n">z1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span>
    <span class="n">xe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">xe</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xe</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">ye</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">ye</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ye</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">ze</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">ze</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ze</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">xe</span><span class="p">,</span> <span class="n">ye</span><span class="p">,</span> <span class="n">ze</span>
  </div>
<div class="viewcode-block" id="Mesh.get_edges"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Mesh.get_edges">[docs]</a>  <span class="k">def</span> <span class="nf">get_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xmin</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">ymin</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">zmin</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">zmax</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the list of edges composing the meshed domain. Edges are given as x and y lists with None separator for faster ploting in ``matplotlib.pyplot``. </span>
<span class="sd">    </span>
<span class="sd">    :rtype: 3 lists of coordinates directly plotable in matplotlib</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">z</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span>
    <span class="n">borderEdges</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">xe</span><span class="p">,</span><span class="n">ye</span><span class="p">,</span> <span class="n">ze</span> <span class="o">=</span><span class="p">[],[],[]</span>
    <span class="n">bi</span> <span class="o">=</span> <span class="n">borderEdges</span><span class="o">.</span><span class="n">index</span>
    <span class="n">ni</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span>
    <span class="k">for</span> <span class="n">ne</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)):</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="p">[</span><span class="n">ne</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">el</span> <span class="o">=</span> <span class="n">conn</span><span class="p">[</span><span class="n">ne</span><span class="p">]</span>
        <span class="n">el</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">el</span><span class="p">]</span><span class="o">+</span><span class="p">[</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">el</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
          <span class="n">edge</span> <span class="o">=</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
          <span class="n">revert</span> <span class="o">=</span> <span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> 
          <span class="k">if</span> <span class="n">revert</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">borderEdges</span> <span class="ow">and</span> <span class="n">edge</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">borderEdges</span><span class="p">:</span>
            <span class="n">borderEdges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="p">[</span><span class="n">ne</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">el</span> <span class="o">=</span> <span class="n">conn</span><span class="p">[</span><span class="n">ne</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
          <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">,</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="p">,</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
          <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">5</span><span class="p">])]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span>
          <span class="n">edges</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">7</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span> <span class="p">(</span><span class="n">el</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">el</span><span class="p">[</span><span class="mi">7</span><span class="p">])]</span>
        <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">:</span>
          <span class="n">revert</span> <span class="o">=</span> <span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> 
          <span class="k">if</span> <span class="n">revert</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">borderEdges</span> <span class="ow">and</span> <span class="n">edge</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">borderEdges</span><span class="p">:</span>
            <span class="n">borderEdges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">edge</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xmin</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">xmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xmax</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">xmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ymin</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">ymin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ymax</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">ymax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">zmin</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">zmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">zmax</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">zmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">test_func</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
      <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">      Tests if the node is in the bb.</span>
<span class="sd">      &#39;&#39;&#39;</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="n">xmin</span><span class="p">)</span> <span class="ow">and</span>  <span class="p">(</span><span class="n">x</span> <span class="o">&lt;=</span> <span class="n">xmax</span><span class="p">)</span> <span class="ow">and</span>  <span class="p">(</span><span class="n">y</span> <span class="o">&gt;=</span> <span class="n">ymin</span><span class="p">)</span> <span class="ow">and</span>  <span class="p">(</span><span class="n">y</span> <span class="o">&lt;=</span> <span class="n">ymax</span><span class="p">)</span> <span class="ow">and</span>  <span class="p">(</span><span class="n">z</span> <span class="o">&gt;=</span> <span class="n">zmin</span><span class="p">)</span> <span class="ow">and</span>  <span class="p">(</span><span class="n">z</span> <span class="o">&lt;=</span> <span class="n">zmax</span><span class="p">)</span>
        
    <span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">borderEdges</span><span class="p">:</span>
      <span class="n">n0</span><span class="p">,</span> <span class="n">n1</span> <span class="o">=</span> <span class="n">ni</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">ni</span><span class="p">(</span><span class="n">edge</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">n0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">n0</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">n0</span><span class="p">]</span>
      <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">z1</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">n1</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">n1</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">n1</span><span class="p">]</span> 
      <span class="k">if</span> <span class="p">(</span><span class="n">test_func</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">z0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">test_func</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">z0</span><span class="p">)):</span>
        <span class="n">xe</span> <span class="o">+=</span> <span class="p">[</span><span class="n">x0</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span>
        <span class="n">ye</span> <span class="o">+=</span> <span class="p">[</span><span class="n">y0</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span>
        <span class="n">ze</span> <span class="o">+=</span> <span class="p">[</span><span class="n">z0</span><span class="p">,</span><span class="n">z1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span>
    <span class="n">xe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">xe</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xe</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">ye</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">ye</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ye</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">ze</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">ze</span><span class="p">,</span> <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ze</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">xe</span><span class="p">,</span> <span class="n">ye</span><span class="p">,</span> <span class="n">ze</span>
   </div>
<div class="viewcode-block" id="Mesh.drop_set"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Mesh.drop_set">[docs]</a>  <span class="k">def</span> <span class="nf">drop_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Goal: drops a set without removing elements and nodes.</span>
<span class="sd">    Inputs:</span>
<span class="sd">      * label: set label to be dropped, must be string.   </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&#39;Info: sets {0} does not exist and cannot be dropped.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>     
   </div>
<div class="viewcode-block" id="Mesh.extrude"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Mesh.extrude">[docs]</a>  <span class="k">def</span> <span class="nf">extrude</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">quad</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">mapping</span> <span class="o">=</span> <span class="p">{}):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Extrudes a mesh in z direction. The method is made to be applied to 2D mesh, it may work on shell elements but may lead to inside out elements. </span>
<span class="sd">    </span>
<span class="sd">    :param N: number of ELEMENTS along z, must &gt; 0.</span>
<span class="sd">    :type N: int</span>
<span class="sd">    :param l: length of the extrusion along z, should be &gt; 0 to avoid inside out elements.</span>
<span class="sd">    :type l: float</span>
<span class="sd">    :param quad: specifies if quadratic elements should be used instead of linear elements (default). Doesn&#39;t work yet. Linear and quadratic elements should not be mixed in the same mesh.</span>
<span class="sd">    :type quad: boolean</span>
<span class="sd">    :param mapping: gives the way to translate element names during extrusion. Example: {&#39;CAX4&#39;:&#39;C3D8&#39;,&#39;CAX3&#39;:&#39;C3D6&#39;}. If 2D element name is not in the mapping, names will be chosen in the basic continuum elements used by Abaqus: &#39;C3D6&#39; and &#39;C3D8&#39;.   </span>
<span class="sd">    :type mapping: boolean</span>
<span class="sd">    </span>
<span class="sd">    .. plot:: example_code/mesh/Mesh-extrude.py</span>
<span class="sd">      :include-source:    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">/</span><span class="n">N</span> <span class="c"># Delta to be applied along z axis</span>
    <span class="n">inodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="c"># Input nodes</span>
    <span class="n">omesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">inodes</span><span class="p">))</span> <span class="c"># Output Mesh</span>
    <span class="n">tempmesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">inodes</span><span class="p">))</span> <span class="c"># Temporary Mesh</span>
    <span class="c"># Selection of 2D elements</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)):</span>
      <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="c">#print label,conn,space, name</span>
      <span class="k">if</span> <span class="n">space</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">quad</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
          <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]:</span> 
            <span class="n">tempmesh</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">,</span> <span class="n">connectivity</span> <span class="o">=</span> <span class="n">conn</span><span class="p">,</span><span class="n">space</span> <span class="o">=</span> <span class="n">space</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">sk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="n">tempmesh</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="n">sk</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="n">sk</span><span class="p">])</span>
    <span class="c">#nNodes, nElements = len(tempmesh.nodes.labels), len(tempmesh.labels) </span>
    <span class="n">nmax</span><span class="p">,</span> <span class="n">emax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">labels</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
    <span class="c"># Creating new nodes and elements</span>
    <span class="k">if</span> <span class="n">quad</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="c"># Nodes</span>
        <span class="n">tn</span> <span class="o">=</span>  <span class="n">tempmesh</span><span class="o">.</span><span class="n">nodes</span>
        <span class="n">te</span> <span class="o">=</span>  <span class="n">tempmesh</span>
        <span class="n">tns</span> <span class="o">=</span> <span class="n">tempmesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span>
        <span class="n">tes</span> <span class="o">=</span> <span class="n">tempmesh</span><span class="o">.</span><span class="n">sets</span>
        <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tn</span><span class="o">.</span><span class="n">labels</span><span class="p">)):</span>
          <span class="n">oldLabel</span> <span class="o">=</span> <span class="n">tn</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span>
          <span class="n">label</span> <span class="o">=</span> <span class="n">oldLabel</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nmax</span>
          <span class="n">x</span> <span class="o">=</span> <span class="n">tn</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span>
          <span class="n">y</span> <span class="o">=</span> <span class="n">tn</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span>
          <span class="n">z</span> <span class="o">=</span> <span class="n">tn</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
          <span class="n">omesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">label</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
         
        <span class="c"># Elements</span>
        <span class="k">for</span> <span class="n">ne</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">te</span><span class="o">.</span><span class="n">labels</span><span class="p">)):</span>
          <span class="n">oldLabel</span> <span class="o">=</span> <span class="n">te</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">ne</span><span class="p">]</span>
          <span class="n">label</span> <span class="o">=</span> <span class="n">oldLabel</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">emax</span>
          <span class="n">conn</span>  <span class="o">=</span> <span class="n">te</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">ne</span><span class="p">]</span>
          <span class="n">conn</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">nmax</span>  <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conn</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">c</span> <span class="o">+</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nmax</span>  <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">conn</span><span class="p">]</span>
          <span class="n">name</span>  <span class="o">=</span> <span class="n">te</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">ne</span><span class="p">]</span>
          <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
          <span class="k">else</span><span class="p">:</span> 
            <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;C3D{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">conn</span><span class="p">))</span>
          <span class="n">omesh</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">,</span><span class="n">connectivity</span> <span class="o">=</span> <span class="n">conn</span><span class="p">,</span><span class="n">space</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
          <span class="k">for</span> <span class="n">sk</span> <span class="ow">in</span> <span class="n">tes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">tes</span><span class="p">[</span><span class="n">sk</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">oldLabel</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
              <span class="n">omesh</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="n">sk</span><span class="p">,</span><span class="n">label</span><span class="p">)</span>
    <span class="c"># Managing sets</span>
    <span class="k">if</span> <span class="n">quad</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="n">ins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span>
      <span class="n">onodes</span> <span class="o">=</span> <span class="n">omesh</span><span class="o">.</span><span class="n">nodes</span>
      <span class="n">ies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span>
      <span class="n">omesh</span> <span class="o">=</span> <span class="n">omesh</span>
      <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ins</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="c"># Nodes</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">ins</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">os</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
          <span class="n">os</span> <span class="o">+=</span> <span class="p">[</span> <span class="n">l</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">nmax</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">s</span><span class="p">]</span>
        <span class="n">onodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">os</span><span class="p">))</span> 
      <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ies</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="c"># Elements</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">ies</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">os</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
          <span class="n">os</span> <span class="o">+=</span> <span class="p">[</span> <span class="n">l</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">emax</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">s</span><span class="p">]</span>
        <span class="n">omesh</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">os</span><span class="p">))</span>   
    <span class="c"># Managing surfaces:</span>
    <span class="n">set_pattern</span> <span class="o">=</span> <span class="s">&#39;{0}_f{1}_{2}&#39;</span>
    <span class="k">if</span> <span class="n">quad</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="n">isurf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfaces</span>
      <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">isurf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">isurf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">elems</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span> <span class="n">etype</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">couple</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
          <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="n">couple</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
          <span class="n">face</span> <span class="o">=</span> <span class="n">couple</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
          <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
            <span class="n">elems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
            <span class="n">faces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
            <span class="n">etype</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>   
        <span class="n">F</span> <span class="o">=</span> <span class="p">{</span><span class="mi">3</span><span class="p">:[],</span><span class="mi">4</span><span class="p">:[],</span><span class="mi">5</span><span class="p">:[],</span><span class="mi">6</span><span class="p">:[]</span> <span class="p">}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elems</span><span class="p">)):</span>
          <span class="n">l</span> <span class="o">=</span> <span class="n">elems</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
          <span class="n">f</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
          <span class="n">t</span> <span class="o">=</span> <span class="n">etype</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
          <span class="n">F</span><span class="p">[</span><span class="n">f</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="n">emax</span> <span class="o">*</span> <span class="n">layer</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
        <span class="n">surf</span> <span class="o">=</span> <span class="p">[]</span>  
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">):</span>
          <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
          <span class="n">set_label</span> <span class="o">=</span> <span class="n">set_pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
          <span class="k">while</span> <span class="n">set_label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">set_label</span> <span class="o">=</span> <span class="n">set_pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
          <span class="k">if</span> <span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="p">[]:</span> 
            <span class="n">omesh</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="n">set_label</span><span class="p">,</span> <span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">surf</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">set_label</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
        <span class="n">omesh</span><span class="o">.</span><span class="n">add_surface</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">surf</span><span class="p">)</span>  
    <span class="k">return</span> <span class="n">omesh</span>
    </div>
<div class="viewcode-block" id="Mesh.sweep"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Mesh.sweep">[docs]</a>  <span class="k">def</span> <span class="nf">sweep</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">N</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span><span class="n">sweep_angle</span> <span class="o">=</span> <span class="mf">45.</span><span class="p">,</span> <span class="n">quad</span> <span class="o">=</span> <span class="bp">False</span> <span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="p">{},</span> <span class="n">extrude</span> <span class="o">=</span> <span class="bp">False</span> <span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sweeps a mesh in around z axis. The method is made to be applied to 2D mesh, it may work on shell elements but may lead to inside out elements. </span>
<span class="sd">    </span>
<span class="sd">    :param N: number of ELEMENTS along z, must &gt; 0.</span>
<span class="sd">    :type N: int</span>
<span class="sd">    :param sweep_angle: sweep angle around the z axis in degrees. Should be &gt; 0 to avoid inside out elements.</span>
<span class="sd">    :type sweep_angle: float</span>
<span class="sd">    :param quad: specifies if quadratic elements should be used instead of linear elements (default). Doesn&#39;t work yet. Linear and quadratic elements should not be mixed in the same mesh.</span>
<span class="sd">    :type quad: boolean</span>
<span class="sd">    :param mapping: gives the way to translate element names during extrusion. Example: {&#39;CAX4&#39;:&#39;C3D8&#39;,&#39;CAX3&#39;:&#39;C3D6&#39;}. If 2D element name is not in the mapping, names will be chosen in the basic continuum elements used by Abaqus: &#39;C3D6&#39; and &#39;C3D8&#39;.   </span>
<span class="sd">    :type mapping: dictionary</span>
<span class="sd">    :param extrude: if True, this param will modify the transformation used to produce the sweep. The result will be a mixed form of sweep and extrusion useful to produce pyramids. When using this option, the sweep angle must be lower than 90 degrees.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    .. plot:: example_code/mesh/Mesh-sweep.py</span>
<span class="sd">      :include-source:    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">tan</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">radians</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">sweep_angle</span><span class="p">)</span><span class="o">/</span><span class="n">N</span><span class="p">)</span> <span class="c"># Delta to be applied along z axis</span>
    <span class="n">inodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span> <span class="c"># Input nodes</span>
    <span class="n">omesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">inodes</span><span class="p">))</span> <span class="c"># Output Mesh</span>
    
    <span class="n">tempmesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">inodes</span><span class="p">))</span> <span class="c"># Temporary Mesh</span>
    <span class="c"># Selection of 2D elements</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)):</span>
      <span class="n">label</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="c">#print label,conn,space, name</span>
      <span class="k">if</span> <span class="n">space</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">quad</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
          <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]:</span> 
            <span class="n">tempmesh</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">,</span> <span class="n">connectivity</span> <span class="o">=</span> <span class="n">conn</span><span class="p">,</span><span class="n">space</span> <span class="o">=</span> <span class="n">space</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">sk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="n">tempmesh</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="n">sk</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="n">sk</span><span class="p">])</span>
    <span class="n">nmax</span><span class="p">,</span> <span class="n">emax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">labels</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
    <span class="c"># Creating new nodes and elements</span>
    <span class="k">def</span> <span class="nf">transform_sweep</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">delta</span><span class="o">*</span><span class="p">(</span><span class="n">layer</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">))</span> <span class="o">+</span> <span class="n">z0</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">delta</span> <span class="o">*</span> <span class="p">(</span><span class="n">layer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
      <span class="n">y</span> <span class="o">=</span> <span class="n">y0</span>
      <span class="n">z</span> <span class="o">=</span> <span class="n">z0</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">delta</span><span class="o">*</span><span class="p">(</span><span class="n">layer</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">))</span> <span class="o">-</span> <span class="n">x0</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">delta</span> <span class="o">*</span> <span class="p">(</span><span class="n">layer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
      <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>
    <span class="k">def</span> <span class="nf">transform_extrude</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
      <span class="n">x</span> <span class="o">=</span> <span class="n">x0</span> 
      <span class="n">y</span> <span class="o">=</span> <span class="n">y0</span>
      <span class="n">z</span> <span class="o">=</span> <span class="n">z0</span> <span class="o">-</span> <span class="n">x0</span> <span class="o">*</span> <span class="n">tan</span><span class="p">(</span><span class="n">delta</span> <span class="o">*</span> <span class="p">(</span><span class="n">layer</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
      <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span>
    <span class="k">if</span> <span class="n">extrude</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
      <span class="n">transform</span> <span class="o">=</span> <span class="n">transform_extrude</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">transform</span> <span class="o">=</span> <span class="n">transform_sweep</span>
    <span class="k">if</span> <span class="n">quad</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="c"># Nodes</span>
        <span class="n">tn</span> <span class="o">=</span>  <span class="n">tempmesh</span><span class="o">.</span><span class="n">nodes</span>
        <span class="n">te</span> <span class="o">=</span>  <span class="n">tempmesh</span>
        <span class="n">tns</span> <span class="o">=</span> <span class="n">tempmesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span>
        <span class="n">tes</span> <span class="o">=</span> <span class="n">tempmesh</span><span class="o">.</span><span class="n">sets</span>
        <span class="k">for</span> <span class="n">nn</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tn</span><span class="o">.</span><span class="n">labels</span><span class="p">)):</span>
          <span class="n">oldLabel</span> <span class="o">=</span> <span class="n">tn</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span>
          <span class="n">label</span> <span class="o">=</span> <span class="n">oldLabel</span> <span class="o">+</span> <span class="p">(</span><span class="n">layer</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nmax</span>
          <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span> <span class="o">=</span> <span class="n">tn</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="n">tn</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">nn</span><span class="p">],</span> <span class="n">tn</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">nn</span><span class="p">]</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">x0</span> <span class="o">==</span> <span class="mf">0.</span> <span class="ow">and</span> <span class="n">z0</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span> 
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">z0</span><span class="p">,</span> <span class="n">layer</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>
            <span class="n">omesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">label</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
            
            
        <span class="c"># Elements</span>
        <span class="k">def</span> <span class="nf">get_nodesOnAxis</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span>
          <span class="n">nodesOnAxis</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">oldconn</span><span class="p">]</span>
          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">oldconn</span><span class="p">)):</span>
            <span class="n">indice</span> <span class="o">=</span> <span class="n">tn</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">oldconn</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span> <span class="o">=</span> <span class="n">tn</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">indice</span><span class="p">],</span> <span class="n">tn</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">indice</span><span class="p">],</span> <span class="n">tn</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">indice</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mf">0.</span> <span class="ow">and</span> <span class="n">z</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span> <span class="n">nodesOnAxis</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
          <span class="k">return</span> <span class="n">nodesOnAxis</span>
          
        <span class="k">for</span> <span class="n">ne</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">te</span><span class="o">.</span><span class="n">labels</span><span class="p">)):</span>
          <span class="n">oldLabel</span> <span class="o">=</span> <span class="n">te</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">ne</span><span class="p">]</span>
          <span class="n">label</span> <span class="o">=</span> <span class="n">oldLabel</span> <span class="o">+</span> <span class="n">layer</span> <span class="o">*</span> <span class="n">emax</span>
          <span class="n">oldconn</span><span class="p">,</span> <span class="n">newconn</span>  <span class="o">=</span> <span class="n">te</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">ne</span><span class="p">],</span> <span class="bp">None</span>
          <span class="n">nodesOnAxis</span> <span class="o">=</span> <span class="n">get_nodesOnAxis</span><span class="p">(</span><span class="n">oldconn</span><span class="p">)</span>
          <span class="n">nnoa</span> <span class="o">=</span> <span class="n">nodesOnAxis</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
          <span class="k">if</span> <span class="n">nnoa</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">newconn</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="o">+</span> <span class="p">(</span><span class="n">layer</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nmax</span>  <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">oldconn</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">c</span> <span class="o">+</span> <span class="n">layer</span> <span class="o">*</span> <span class="n">nmax</span>  <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">oldconn</span><span class="p">]</span>
          <span class="k">if</span> <span class="n">nnoa</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">oldconn</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
              <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">              newconn = []</span>
<span class="sd">              for i in xrange(3):</span>
<span class="sd">              </span>
<span class="sd">                if nodesOnAxis[i] == True: </span>
<span class="sd">                  out_of_axis = i</span>
<span class="sd">                  newconn.append(oldconn[i])</span>
<span class="sd">                else:</span>
<span class="sd">                  newconn.append(oldconn[i] + layer * nmax)</span>
<span class="sd">              newconn.append(oldconn[out_of_axis] + (layer+1) * nmax)</span>
<span class="sd">              &quot;&quot;&quot;</span>
              <span class="k">while</span> <span class="n">nodesOnAxis</span> <span class="o">!=</span> <span class="p">[</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">]:</span>
                <span class="n">oldconn</span> <span class="o">=</span> <span class="p">[</span><span class="n">oldconn</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="n">oldconn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">oldconn</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">nodesOnAxis</span> <span class="o">=</span> <span class="n">get_nodesOnAxis</span><span class="p">(</span><span class="n">oldconn</span><span class="p">)</span>
              <span class="n">newconn</span> <span class="o">=</span> <span class="p">[</span><span class="n">oldconn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">oldconn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">layer</span> <span class="o">*</span> <span class="n">nmax</span><span class="p">,</span> <span class="n">oldconn</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">oldconn</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">layer</span> <span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nmax</span><span class="p">]</span>
              
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">oldconn</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
              <span class="k">while</span> <span class="n">nodesOnAxis</span> <span class="o">!=</span> <span class="p">[</span><span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">]:</span>
                <span class="n">oldconn</span> <span class="o">=</span> <span class="p">[</span><span class="n">oldconn</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">oldconn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">oldconn</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">oldconn</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
                <span class="n">nodesOnAxis</span> <span class="o">=</span> <span class="n">get_nodesOnAxis</span><span class="p">(</span><span class="n">oldconn</span><span class="p">)</span>
              <span class="n">newconn</span> <span class="o">=</span> <span class="p">[</span><span class="n">oldconn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">layer</span> <span class="o">*</span> <span class="n">nmax</span>  <span class="o">+</span> <span class="n">oldconn</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="n">layer</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nmax</span>  <span class="o">+</span> <span class="n">oldconn</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">oldconn</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">layer</span> <span class="o">*</span> <span class="n">nmax</span>  <span class="o">+</span> <span class="n">oldconn</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="n">layer</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nmax</span>  <span class="o">+</span> <span class="n">oldconn</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span> 
          <span class="k">if</span> <span class="n">newconn</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span> 
            <span class="n">name</span>  <span class="o">=</span> <span class="n">te</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="n">ne</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">mapping</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
              <span class="n">name</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span> 
              <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;C3D{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">newconn</span><span class="p">))</span>
            <span class="n">omesh</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">label</span><span class="p">,</span><span class="n">connectivity</span> <span class="o">=</span> <span class="n">newconn</span><span class="p">,</span><span class="n">space</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
          <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;element {0} has not been sweeped&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">oldLabel</span><span class="p">)</span>
    <span class="c"># Managing sets</span>
    <span class="k">if</span> <span class="n">quad</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="n">ins</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span>
      <span class="n">onodes</span> <span class="o">=</span> <span class="n">omesh</span><span class="o">.</span><span class="n">nodes</span>
      <span class="n">ies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span>
      <span class="n">omesh</span> <span class="o">=</span> <span class="n">omesh</span>
      <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ins</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="c"># Nodes</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">ins</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">os</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
          <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">l2</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">nmax</span>
            <span class="k">if</span> <span class="n">l2</span> <span class="ow">in</span> <span class="n">omesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l2</span><span class="p">)</span>
        <span class="n">onodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">os</span><span class="p">))</span> 
      <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ies</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="c"># Elements</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">ies</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">os</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
          <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
            <span class="n">l2</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">emax</span>
            <span class="k">if</span> <span class="n">l2</span> <span class="ow">in</span> <span class="n">omesh</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l2</span><span class="p">)</span>
        <span class="n">omesh</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">os</span><span class="p">))</span>   
      <span class="c"># front and back node sets</span>
      <span class="n">frontnodes</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inodes</span><span class="o">.</span><span class="n">labels</span><span class="p">)):</span>
        <span class="n">oldLabel</span> <span class="o">=</span> <span class="n">inodes</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">inodes</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">inodes</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">inodes</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
        <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="mf">0.</span> <span class="ow">or</span> <span class="n">z</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span> <span class="n">frontnodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">oldLabel</span><span class="p">)</span>
      <span class="n">omesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;front_nodes&#39;</span><span class="p">,</span><span class="n">frontnodes</span><span class="p">)</span>
      <span class="n">omesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;back_nodes&#39;</span><span class="p">,[</span><span class="n">nl</span> <span class="o">+</span> <span class="n">nmax</span> <span class="o">*</span> <span class="n">N</span> <span class="k">for</span> <span class="n">nl</span> <span class="ow">in</span> <span class="n">frontnodes</span><span class="p">])</span>
    <span class="c"># Managing surfaces:</span>
    <span class="n">set_pattern</span> <span class="o">=</span> <span class="s">&#39;{0}_f{1}_{2}&#39;</span>
    <span class="k">if</span> <span class="n">quad</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="n">isurf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surfaces</span>
      <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">isurf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">isurf</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">elems</span><span class="p">,</span> <span class="n">faces</span><span class="p">,</span> <span class="n">etype</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">couple</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
          <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="n">couple</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
          <span class="n">face</span> <span class="o">=</span> <span class="n">couple</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
          <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
            <span class="n">elems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
            <span class="n">faces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">face</span><span class="p">)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
            <span class="n">etype</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>   
        <span class="n">F</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">:[],</span><span class="mi">2</span><span class="p">:[],</span><span class="mi">3</span><span class="p">:[],</span><span class="mi">4</span><span class="p">:[],</span><span class="mi">5</span><span class="p">:[],</span><span class="mi">6</span><span class="p">:[]</span> <span class="p">}</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elems</span><span class="p">)):</span>
          <span class="n">l</span> <span class="o">=</span> <span class="n">elems</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
          <span class="n">f</span> <span class="o">=</span> <span class="n">faces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
          <span class="n">t</span> <span class="o">=</span> <span class="n">etype</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
          <span class="n">pos</span> <span class="o">=</span> <span class="n">omesh</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
          <span class="n">t2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">omesh</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">pos</span><span class="p">])</span>
          <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t2</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span> <span class="n">F</span><span class="p">[</span><span class="n">f</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="n">emax</span> <span class="o">*</span> <span class="n">layer</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">t2</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span> 
              <span class="c">#pos0 = pos = self.labels.index(l)</span>
              <span class="c">#oldconn = self.connectivity[pos0]</span>
              <span class="c">#newconn = omesh.connectivity[pos]</span>
              <span class="c">#nnoa = newconn[-1]-nmax</span>
              <span class="c">#innoa = oldconn.index(nnoa)</span>
              <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">F</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="n">emax</span> <span class="o">*</span> <span class="n">layer</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
              <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">F</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="n">emax</span> <span class="o">*</span> <span class="n">layer</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
              <span class="c">#if f == 3 and innoa in [3,1] : F[4] += [l + emax * layer for layer in xrange(N)]</span>
              
          <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t2</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span> <span class="n">F</span><span class="p">[</span><span class="n">f</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="n">emax</span> <span class="o">*</span> <span class="n">layer</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
            <span class="k">if</span> <span class="n">t2</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span> 
              <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">F</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="n">emax</span> <span class="o">*</span> <span class="n">layer</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
              <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">F</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="n">emax</span> <span class="o">*</span> <span class="n">layer</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
              <span class="k">if</span> <span class="n">f</span> <span class="o">==</span> <span class="mi">3</span> <span class="p">:</span> <span class="n">F</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="p">[</span><span class="n">l</span> <span class="o">+</span> <span class="n">emax</span> <span class="o">*</span> <span class="n">layer</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">N</span><span class="p">)]</span>
              
        <span class="n">surf</span> <span class="o">=</span> <span class="p">[]</span>  
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">):</span>
          <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
          <span class="n">set_label</span> <span class="o">=</span> <span class="n">set_pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
          <span class="k">while</span> <span class="n">set_label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">set_label</span> <span class="o">=</span> <span class="n">set_pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span>
          <span class="k">if</span> <span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="p">[]:</span> 
            <span class="n">omesh</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="n">set_label</span><span class="p">,</span> <span class="n">F</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">surf</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">set_label</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
        <span class="n">omesh</span><span class="o">.</span><span class="n">add_surface</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">surf</span><span class="p">)</span>      
    <span class="k">if</span> <span class="n">sweep_angle</span> <span class="o">==</span> <span class="mf">360.</span> <span class="p">:</span> <span class="n">omesh</span><span class="o">.</span><span class="n">simplify_nodes</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">omesh</span>
      
    </div>
<div class="viewcode-block" id="Mesh.dump2vtk"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Mesh.dump2vtk">[docs]</a>  <span class="k">def</span> <span class="nf">dump2vtk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Dumps the mesh to the VTK format. VTK format can be visualized using Mayavi2 or Paraview. This method is particularly useful for 3D mesh. For 2D mesh, it may be more efficient to work with matplotlib using methods like: get_edges, get_border and dump2triplot.</span>
<span class="sd">    </span>
<span class="sd">    :rtype: string</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s">&#39;# vtk DataFile Version 2.0</span><span class="se">\n</span><span class="s">Unstructured Grid Example</span><span class="se">\n</span><span class="s">ASCII</span><span class="se">\n</span><span class="s">DATASET UNSTRUCTURED_GRID</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="c"># Nodes</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span>
    <span class="n">nnodes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">ni</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span>
    <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;POINTS {0} float</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nnodes</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">nnodes</span><span class="p">):</span>
      <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;{0} {1} {2}</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nodes</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nodes</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="c"># Elements:</span>
    
    <span class="n">esize</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nel</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">nel</span><span class="p">):</span> <span class="n">esize</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;CELLS {0} {1}</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nel</span><span class="p">,</span> <span class="n">esize</span><span class="p">)</span>
    <span class="n">eTypes</span> <span class="o">=</span> <span class="s">&#39;CELL_TYPES {0}</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nel</span><span class="p">)</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;{0} &#39;</span>
    <span class="n">pattern2</span> <span class="o">=</span> <span class="s">&#39;{0}</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">nel</span><span class="p">):</span>
      <span class="n">c</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">space</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">lc</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
      <span class="n">out</span> <span class="o">+=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lc</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span> 
        <span class="n">out</span> <span class="o">+=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ni</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
      <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
      <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">lc</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span> <span class="n">ecode</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">if</span> <span class="n">lc</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span> <span class="n">ecode</span> <span class="o">=</span> <span class="mi">9</span>
      <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">lc</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span> <span class="n">ecode</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="n">lc</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span> <span class="n">ecode</span> <span class="o">=</span> <span class="mi">13</span>
        <span class="k">if</span> <span class="n">lc</span> <span class="o">==</span> <span class="mi">8</span><span class="p">:</span> <span class="n">ecode</span> <span class="o">=</span> <span class="mi">12</span>
      <span class="n">eTypes</span> <span class="o">+=</span> <span class="n">pattern2</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ecode</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">+=</span> <span class="n">eTypes</span>
    <span class="k">return</span> <span class="n">out</span>
    
      
      </div>
<div class="viewcode-block" id="Mesh.dump2triplot"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Mesh.dump2triplot">[docs]</a>  <span class="k">def</span> <span class="nf">dump2triplot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Allows any 2D mesh to be triangulized and formated in a suitable way to be used by triplot, tricontour and tricontourf in matplotlib.pyplot. This is the best way to produce clean 2D plots of 2D meshs. Returns 4 arrays/lists: x, y and z coordinates of nodes and triangles connectivity. It can be directly used in matplotlib.pyplot using:</span>
<span class="sd">    </span>
<span class="sd">    :rtype: 4 lists</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; from abapy.mesh import RegularQuadMesh</span>
<span class="sd">    &gt;&gt;&gt; plt.figure()</span>
<span class="sd">    &gt;&gt;&gt; plt.axis(&#39;off&#39;)</span>
<span class="sd">    &gt;&gt;&gt; plt.gca().set_aspect(&#39;equal&#39;)</span>
<span class="sd">    &gt;&gt;&gt; mesh = RegularQuadMesh(N1 = 10 , N2 = 10)</span>
<span class="sd">    &gt;&gt;&gt; x,y,z,tri = mesh.dump2triplot()</span>
<span class="sd">    &gt;&gt;&gt; plt.triplot(x,y,tri)</span>
<span class="sd">    &gt;&gt;&gt; plt.show()&#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
    <span class="n">dti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dti</span>
    <span class="n">m3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert2tri3</span><span class="p">()</span>
    <span class="n">c0</span> <span class="o">=</span> <span class="n">m3</span><span class="o">.</span><span class="n">connectivity</span>
    <span class="n">ni</span> <span class="o">=</span> <span class="n">m3</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span>
    <span class="n">c</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">t0</span> <span class="ow">in</span> <span class="n">c0</span><span class="p">:</span>
      <span class="n">t</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dti</span><span class="p">,[])</span>
      <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">t0</span><span class="p">:</span>
        <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ni</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
      <span class="n">c</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">m3</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">m3</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">m3</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span>
  </div>
<div class="viewcode-block" id="Mesh.replace_node"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Mesh.replace_node">[docs]</a>  <span class="k">def</span> <span class="nf">replace_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Replaces a node of given label (old) by another existing node (new). This version of ``replace_node`` differs from the version of the ``Nodes`` class because it also updates elements connectivity. When working with mesh (an not only nodes), this version should be used.</span>
<span class="sd">    </span>
<span class="sd">    :param old: node label to be replaced.</span>
<span class="sd">    :type old: int &gt; 0</span>
<span class="sd">    :param new: node label of the node replacing old.</span>
<span class="sd">    :type new: int &gt; 0</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from abapy.mesh import RegularQuadMesh</span>
<span class="sd">    &gt;&gt;&gt; N1, N2 = 1,1</span>
<span class="sd">    &gt;&gt;&gt; mesh = RegularQuadMesh(N1, N2)</span>
<span class="sd">    &gt;&gt;&gt; mesh.replace_node(1,2)</span>
<span class="sd">    Info: element 1 maybe have become degenerate due du node replacing.</span>
<span class="sd">    &gt;&gt;&gt; print mesh </span>
<span class="sd">    Mesh class instance:</span>
<span class="sd">    Elements:</span>
<span class="sd">    Label	Connectivity		Space	Name</span>
<span class="sd">    1	[2L, 4L, 3L]	2D	QUAD4</span>
<span class="sd">    Sets:</span>
<span class="sd">    Label	Elements</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">elabels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
    <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">connectivity</span>
    <span class="n">esets</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sets</span>
    <span class="n">nlabels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">labels</span>
    <span class="c"># Some verifications</span>
    <span class="k">if</span> <span class="n">old</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nlabels</span> <span class="ow">or</span> <span class="n">new</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">nlabels</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;Both node labels must exist.&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">replace_node</span><span class="p">(</span><span class="n">old</span><span class="p">,</span> <span class="n">new</span><span class="p">)</span>
    <span class="c"># Let&#39;s proceed</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">elabels</span><span class="p">)):</span>
      <span class="n">c</span> <span class="o">=</span> <span class="n">conn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">old</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">old</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">new</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">c</span><span class="p">:</span>
          <span class="n">c</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="n">new</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">el</span> <span class="o">=</span> <span class="n">elabels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
          <span class="k">print</span> <span class="s">&#39;Info: element {0} maybe have become degenerate due du node replacing.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">el</span><span class="p">)</span>  
</div>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  def simplify_nodes(self, crit_distance = 1.e-10):</span>
<span class="sd">    from copy import copy</span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="sd">    Looks for duplicated nodes and removes them.</span>
<span class="sd">    </span>
<span class="sd">    :param crit_istance: critical under which two nodes are considered as identical.</span>
<span class="sd">    :type crit_distance: float &gt; 0.                                                            </span>
<span class="sd">    &quot;&quot;&quot;</span>
<span class="sd">    nodes = self.nodes</span>
<span class="sd">    nlabels = nodes.labels</span>
<span class="sd">    nlabels2 = copy(nlabels) # nlabels may change in the process</span>
<span class="sd">    for nlabel in nlabels2:</span>
<span class="sd">      if nlabel in nlabels:</span>
<span class="sd">        closest_label, distance = nodes.closest_node(nlabel)</span>
<span class="sd">        if distance &lt;= crit_distance:</span>
<span class="sd">          self.replace_node(closest_label, nlabel)</span>
<span class="sd">  &#39;&#39;&#39;</span>
  
<div class="viewcode-block" id="Mesh.simplify_nodes"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Mesh.simplify_nodes">[docs]</a>  <span class="k">def</span> <span class="nf">simplify_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crit_distance</span> <span class="o">=</span> <span class="mf">1.e-10</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Looks for duplicated nodes and removes them.</span>
<span class="sd">    </span>
<span class="sd">    :param crit_istance: critical under which two nodes are considered as identical.</span>
<span class="sd">    :type crit_distance: float &gt; 0.                                                            </span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">z</span><span class="p">)</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">neighbors</span> <span class="o">=</span> <span class="n">get_neighbors</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">crit_dist</span> <span class="o">=</span> <span class="n">crit_distance</span><span class="p">)</span>
    <span class="n">nlabels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">neighbors</span><span class="p">)):</span>
      <span class="n">new_label</span> <span class="o">=</span> <span class="n">nlabels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">n</span> <span class="o">=</span> <span class="n">neighbors</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="p">[]:</span>
        <span class="n">old_labels</span> <span class="o">=</span> <span class="n">nlabels</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">old_label</span> <span class="ow">in</span> <span class="n">old_labels</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">replace_node</span><span class="p">(</span><span class="n">old_label</span><span class="p">,</span> <span class="n">new_label</span><span class="p">)</span>
          </div>
<div class="viewcode-block" id="Mesh.union"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Mesh.union">[docs]</a>  <span class="k">def</span> <span class="nf">union</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other_mesh</span><span class="p">,</span> <span class="n">crit_distance</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">simplify</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Computes the union of 2 Mesh instances. The second operand&#39;s labels are increased to be compatible with the first. All sets are kepts and merged if they share the same name. Nodes which are too close (&lt; crit_distance) are merged. If crit_distance is None, the defautl value value of ``simplify_mesh`` is used.</span>
<span class="sd">    </span>
<span class="sd">    :param other_mesh: mesh to be added to current mesh.</span>
<span class="sd">    :type other_mesh: ``Mesh`` instance</span>
<span class="sd">    :param crit_distance: critical distance under which nodes are considered identical.</span>
<span class="sd">    :type crit_distance: float &gt; 0</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span> <span class="k">as</span> <span class="n">n_array</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other_mesh</span><span class="p">,</span> <span class="n">Mesh</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;other_mesh should be Mesh instance, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other_mesh</span><span class="p">))</span>
    <span class="n">dti</span><span class="p">,</span> <span class="n">odti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dti</span><span class="p">,</span> <span class="n">other_mesh</span><span class="o">.</span><span class="n">dti</span>
    <span class="n">dtf</span><span class="p">,</span> <span class="n">odtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span> <span class="n">other_mesh</span><span class="o">.</span><span class="n">dtf</span>
    <span class="k">if</span> <span class="n">dti</span> <span class="o">==</span> <span class="s">&#39;I&#39;</span> <span class="ow">or</span> <span class="n">odti</span> <span class="o">==</span> <span class="s">&#39;I&#39;</span><span class="p">:</span> 
      <span class="n">new_dti</span> <span class="o">=</span> <span class="s">&#39;I&#39;</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">new_dti</span> <span class="o">=</span> <span class="s">&#39;H&#39;</span>
    <span class="k">if</span> <span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;d&#39;</span> <span class="ow">or</span> <span class="n">odtf</span> <span class="o">==</span> <span class="s">&#39;d&#39;</span><span class="p">:</span> 
      <span class="n">new_dtf</span> <span class="o">=</span> <span class="s">&#39;d&#39;</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">new_dtf</span> <span class="o">=</span> <span class="s">&#39;f&#39;</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span>
    <span class="n">max_nlabel</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">nodes</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">max_elabel</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">onodes</span> <span class="o">=</span> <span class="n">other_mesh</span><span class="o">.</span><span class="n">nodes</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">onodes</span><span class="o">.</span><span class="n">labels</span><span class="p">)):</span>
      <span class="n">l</span> <span class="o">=</span> <span class="n">onodes</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">node</span> <span class="o">=</span> <span class="n">onodes</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
      <span class="n">toset</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">sets</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
      <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">node</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">node</span><span class="o">.</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">nodes</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">max_nlabel</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">,</span> <span class="n">toset</span> <span class="o">=</span> <span class="n">toset</span>  <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">other_mesh</span><span class="o">.</span><span class="n">labels</span><span class="p">)):</span>
      <span class="n">l</span> <span class="o">=</span> <span class="n">other_mesh</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">element</span> <span class="o">=</span> <span class="n">other_mesh</span><span class="p">[</span><span class="n">l</span><span class="p">]</span>
      <span class="n">toset</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">sets</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
      <span class="n">conn</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span> <span class="o">+</span> <span class="n">max_nlabel</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">element</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">]</span>
      <span class="n">space</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">space</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">name</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">l</span> <span class="o">+</span> <span class="n">max_elabel</span><span class="p">,</span> <span class="n">connectivity</span> <span class="o">=</span> <span class="n">conn</span><span class="p">,</span> <span class="n">space</span> <span class="o">=</span> <span class="n">space</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">toset</span> <span class="o">=</span> <span class="n">toset</span>  <span class="p">)</span>
    <span class="k">if</span> <span class="n">simplify</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">crit_distance</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simplify_nodes</span><span class="p">()</span>    
      <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simplify_nodes</span><span class="p">(</span><span class="n">crit_distance</span> <span class="o">=</span> <span class="n">crit_distance</span><span class="p">)</span>
  </div>
<div class="viewcode-block" id="Mesh.apply_reflection"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.Mesh.apply_reflection">[docs]</a>  <span class="k">def</span> <span class="nf">apply_reflection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">point</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">normal</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Applies a reflection symmetry to the mesh instance. The reflection plane is defined by a point and a normal direction.</span>
<span class="sd">    </span>
<span class="sd">    :param point: coordinates of a point of the reflection plane.</span>
<span class="sd">    :type point: tuple or list containing 3 floats</span>
<span class="sd">    :param normal: normal vector to the reflection plane</span>
<span class="sd">    :type normal: tuple or list containing 3 floats</span>
<span class="sd">    :rtype: ``Mesh`` instance</span>
<span class="sd">    </span>
<span class="sd">    ..note: This method can lead to coherence problems with surfaces, this problem will be addressed in the future. Surfaces are removed by this operation untill this problem is solved.</span>
<span class="sd">    </span>
<span class="sd">    .. plot:: example_code/mesh/Mesh_apply_reflection.py</span>
<span class="sd">     :include-source:</span>
<span class="sd">    &#39;&#39;&#39;</span>  
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">apply_reflection</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="n">point</span><span class="p">,</span> <span class="n">normal</span><span class="o">=</span><span class="n">normal</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">surfaces</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">connectivity</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">out</span>
       
    
    </div></div>
<div class="viewcode-block" id="RegularQuadMesh"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.RegularQuadMesh">[docs]</a><span class="k">def</span> <span class="nf">RegularQuadMesh</span><span class="p">(</span><span class="n">N1</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">N2</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">l1</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span><span class="n">l2</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;QUAD4&#39;</span><span class="p">,</span><span class="n">dtf</span><span class="o">=</span><span class="s">&#39;f&#39;</span><span class="p">,</span><span class="n">dti</span><span class="o">=</span><span class="s">&#39;I&#39;</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;Generates a 2D regular quadrangle mesh.</span>
<span class="sd">  </span>
<span class="sd">  :param N1: number of elements respectively along y.</span>
<span class="sd">  :type N1: int &gt; 0</span>
<span class="sd">  :param N2: number of elements respectively along y.</span>
<span class="sd">  :type N2: int &gt; 0</span>
<span class="sd">  :param l1: length of the mesh respectively along x.</span>
<span class="sd">  :type l1: float</span>
<span class="sd">  :param l2: length of the mesh respectively along y.</span>
<span class="sd">  :type l2: float</span>
<span class="sd">  :param name: elements names, for example &#39;CPS4&#39;.</span>
<span class="sd">  :type name: string</span>
<span class="sd">  :param dti: int data type in array.array</span>
<span class="sd">  :type dti: &#39;I&#39;, &#39;H&#39;</span>
<span class="sd">  :param dtf: float data type in array.array</span>
<span class="sd">  :type dtf: &#39;f&#39;, &#39;d&#39;</span>
<span class="sd">  :rtype: Mesh instance  </span>

<span class="sd">  </span>
<span class="sd">  .. plot:: example_code/mesh/RegularQuadMesh.py</span>
<span class="sd">     :include-source:</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
  <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span> <span class="k">as</span> <span class="n">array</span>
  <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">l1</span><span class="p">,</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">l2</span><span class="p">,</span><span class="n">N2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,(</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">N2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
  <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">y</span><span class="p">,(</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">N2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
  <span class="n">Cx</span><span class="p">,</span><span class="n">Cy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">),(</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N2</span><span class="p">))</span>
  <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Cx</span><span class="p">,</span><span class="n">N1</span><span class="o">*</span><span class="n">N2</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Cy</span><span class="p">,</span><span class="n">N1</span><span class="o">*</span><span class="n">N2</span><span class="p">)</span> 
  <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">Nodes</span><span class="p">(</span><span class="n">dtf</span><span class="o">=</span><span class="n">dtf</span><span class="p">,</span><span class="n">dti</span><span class="o">=</span><span class="n">dti</span><span class="p">))</span>
  <span class="n">nodes</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)):</span> <span class="n">nodes</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mf">0.</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="p">)):</span> 
    <span class="n">mesh</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">connectivity</span> <span class="o">=</span> <span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">N1</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">space</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
  <span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;bottomleft&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;bottomright&#39;</span><span class="p">,</span> <span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;topleft&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;topright&#39;</span><span class="p">,(</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">N2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
  <span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;bottom&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N1</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span>
  <span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;top&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="p">((</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">N2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
  <span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;left&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,(</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N2</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
  <span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;right&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">,(</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">N2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">mesh</span>
 </div>
<div class="viewcode-block" id="RegularQuadMesh_like"><a class="viewcode-back" href="../../mesh.html#abapy.mesh.RegularQuadMesh_like">[docs]</a><span class="k">def</span> <span class="nf">RegularQuadMesh_like</span><span class="p">(</span><span class="n">x_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="n">y_list</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;QUAD4&#39;</span><span class="p">,</span><span class="n">dtf</span><span class="o">=</span><span class="s">&#39;f&#39;</span><span class="p">,</span><span class="n">dti</span><span class="o">=</span><span class="s">&#39;I&#39;</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;Generates a 2D regular quadrangle mesh from 2 lists of positions. This version of RegularQuadMesh is an alternative to the normal one in some cases where fine tuning of x, y positions is required.</span>
<span class="sd">  </span>
<span class="sd">  :param x_list: list of x values</span>
<span class="sd">  :type x_list: list, array.array or numpy.array</span>
<span class="sd">  :param y_list: list of y values</span>
<span class="sd">  :type y_list: list, array.array or numpy.array</span>
<span class="sd">  :param name: elements names, for example &#39;CPS4&#39;.</span>
<span class="sd">  :type name: string</span>
<span class="sd">  :param dti: int data type in array.array</span>
<span class="sd">  :type dti: &#39;I&#39;, &#39;H&#39;</span>
<span class="sd">  :param dtf: float data type in array.array</span>
<span class="sd">  :type dtf: &#39;f&#39;, &#39;d&#39;</span>
<span class="sd">  :rtype: Mesh instance  </span>

<span class="sd">  </span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
  <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span> <span class="k">as</span> <span class="n">array</span>
  <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x_list</span><span class="p">,</span><span class="n">y_list</span><span class="p">)</span>
  <span class="n">N1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_list</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
  <span class="n">N2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y_list</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
  <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">x</span><span class="p">,(</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">N2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
  <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">y</span><span class="p">,(</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">N2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
  <span class="n">Cx</span><span class="p">,</span><span class="n">Cy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">),(</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">N2</span><span class="p">))</span>
  <span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Cx</span><span class="p">,</span><span class="n">N1</span><span class="o">*</span><span class="n">N2</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Cy</span><span class="p">,</span><span class="n">N1</span><span class="o">*</span><span class="n">N2</span><span class="p">)</span> 
  <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">nodes</span> <span class="o">=</span> <span class="n">Nodes</span><span class="p">(</span><span class="n">dtf</span><span class="o">=</span><span class="n">dtf</span><span class="p">,</span><span class="n">dti</span><span class="o">=</span><span class="n">dti</span><span class="p">))</span>
  <span class="n">nodes</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)):</span> <span class="n">nodes</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span><span class="n">X</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">Y</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mf">0.</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="p">)):</span> 
    <span class="n">mesh</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">connectivity</span> <span class="o">=</span> <span class="p">(</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">N1</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">C</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">space</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
  <span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;bottomleft&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
  <span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;bottomright&#39;</span><span class="p">,</span> <span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;topleft&#39;</span><span class="p">,</span> <span class="p">(</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;topright&#39;</span><span class="p">,(</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">N2</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
  <span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;bottom&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N1</span><span class="o">+</span><span class="mi">2</span><span class="p">))</span>
  <span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;top&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="p">((</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N2</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">N2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
  <span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;left&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,(</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">N2</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
  <span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;right&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">,(</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">N2</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">N1</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">mesh</span>

</div>
<span class="k">def</span> <span class="nf">get_neighbors</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">crit_dist</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">max_hits</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Internal use function performing nearest neighbor search using KDTree algorithm.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="kn">import</span> <span class="nn">scipy.spatial</span> <span class="kn">as</span> <span class="nn">spatial</span>
  <span class="n">t</span> <span class="o">=</span> <span class="n">spatial</span><span class="o">.</span><span class="n">cKDTree</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">points</span><span class="p">)</span>
  <span class="n">neighbors</span><span class="p">,</span> <span class="n">hits</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">data</span><span class="p">)):</span>
    <span class="n">dist</span><span class="p">,</span> <span class="n">loc</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="n">max_hits</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">dist</span> <span class="o">&lt;=</span> <span class="n">crit_dist</span>  
    <span class="n">neighbors</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">neighbors</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loc</span><span class="p">)):</span>
      <span class="n">l</span> <span class="o">=</span> <span class="n">loc</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
      <span class="n">d</span> <span class="o">=</span> <span class="n">dist</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">d</span> <span class="ow">and</span> <span class="p">(</span><span class="n">l</span> <span class="o">&gt;</span> <span class="n">i</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">l</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">hits</span><span class="p">):</span> 
        <span class="n">n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>  
        <span class="n">hits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">neighbors</span> 
  
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">abapy 2.3.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Ludovic Charleux.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>