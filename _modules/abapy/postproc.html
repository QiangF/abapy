

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>abapy.postproc &mdash; abapy 2.3.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="abapy 2.3.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">abapy 2.3.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for abapy.postproc</h1><div class="highlight"><pre>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Post Processing</span>
<span class="sd">===============</span>
<span class="sd">&#39;&#39;&#39;</span>




<div class="viewcode-block" id="GetMesh"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.GetMesh">[docs]</a><span class="k">def</span> <span class="nf">GetMesh</span><span class="p">(</span><span class="n">odb</span><span class="p">,</span><span class="n">instance</span><span class="p">,</span><span class="n">dti</span><span class="o">=</span><span class="s">&#39;I&#39;</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;Retrieves mesh on an instance in an Abaqus Output Database. </span>
<span class="sd">  </span>
<span class="sd">  :param odb: output database</span>
<span class="sd">  :type odb: odb object</span>
<span class="sd">  :param instance: instance name declared in the Abaqus inp file.</span>
<span class="sd">  :type instance: string</span>
<span class="sd">  :param dti: int data type in array.array</span>
<span class="sd">  :type dti: &#39;I&#39; or &#39;H&#39;</span>
<span class="sd">  </span>
<span class="sd">  :rtype: Mesh instance</span>
<span class="sd">  </span>
<span class="sd">  .. literalinclude:: example_code/postproc/GetMesh.py</span>
<span class="sd">  </span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="kn">from</span> <span class="nn">mesh</span> <span class="kn">import</span> <span class="n">Mesh</span><span class="p">,</span> <span class="n">Nodes</span>
  <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
  <span class="n">inst</span> <span class="o">=</span> <span class="n">odb</span><span class="o">.</span><span class="n">rootAssembly</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="n">instance</span><span class="p">]</span>
  <span class="c"># Managing precision: float32 or float64</span>
  <span class="n">precision</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">odb</span><span class="o">.</span><span class="n">jobData</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">precision</span> <span class="o">==</span> <span class="s">&#39;SINGLE_PRECISION&#39;</span><span class="p">:</span> <span class="n">dtf</span> <span class="o">=</span> <span class="s">&#39;f&#39;</span>
  <span class="k">if</span> <span class="n">precision</span> <span class="o">==</span> <span class="s">&#39;DOUBLE_PRECISION&#39;</span><span class="p">:</span> <span class="n">dtf</span> <span class="o">=</span> <span class="s">&#39;d&#39;</span>
  <span class="n">nodes</span> <span class="o">=</span> <span class="n">Nodes</span><span class="p">(</span><span class="n">dtf</span><span class="o">=</span><span class="n">dtf</span><span class="p">,</span><span class="n">dti</span><span class="o">=</span><span class="n">dti</span><span class="p">)</span>
  <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">nodes</span><span class="o">=</span><span class="n">nodes</span><span class="p">)</span>
  <span class="n">ni</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span>
  <span class="c"># Managing nodes</span>
  <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">inst</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">coordinates</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">label</span>
    <span class="c">#print l, c</span>
    <span class="n">nodes</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
  <span class="k">for</span> <span class="n">nsk</span> <span class="ow">in</span> <span class="n">inst</span><span class="o">.</span><span class="n">nodeSets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">nset</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">nodeSets</span><span class="p">[</span><span class="n">nsk</span><span class="p">]</span><span class="o">.</span><span class="n">nodes</span>
    <span class="n">ns</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">nset</span><span class="p">]</span>
    <span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="n">nsk</span><span class="p">,</span><span class="n">ns</span><span class="p">)</span>
  <span class="c"># Managing elements</span>
  <span class="n">embeddedSpace</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">inst</span><span class="o">.</span><span class="n">embeddedSpace</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">embeddedSpace</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;TWO_D_PLANAR&#39;</span><span class="p">,</span> <span class="s">&#39;AXISYMMETRIC&#39;</span><span class="p">]:</span> <span class="n">space</span> <span class="o">=</span><span class="mi">2</span> <span class="c"># To be completed </span>
  <span class="k">if</span> <span class="n">embeddedSpace</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;THREE_D&#39;</span><span class="p">]:</span> <span class="n">space</span> <span class="o">=</span><span class="mi">3</span> <span class="c"># To be completed </span>
  <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">inst</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
    <span class="n">l</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">label</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">connectivity</span>
    <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">l</span><span class="p">,</span> <span class="n">connectivity</span> <span class="o">=</span> <span class="n">c</span> <span class="p">,</span><span class="n">space</span> <span class="o">=</span> <span class="n">space</span> <span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">esk</span> <span class="ow">in</span> <span class="n">inst</span><span class="o">.</span><span class="n">elementSets</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">eset</span> <span class="o">=</span> <span class="n">inst</span><span class="o">.</span><span class="n">elementSets</span><span class="p">[</span><span class="n">esk</span><span class="p">]</span><span class="o">.</span><span class="n">elements</span>
    <span class="n">es</span> <span class="o">=</span> <span class="p">[</span><span class="n">element</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">eset</span><span class="p">]</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="n">esk</span><span class="p">,</span><span class="n">es</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">mesh</span>






</div>
<div class="viewcode-block" id="HistoryOutput"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.HistoryOutput">[docs]</a><span class="k">class</span> <span class="nc">HistoryOutput</span><span class="p">:</span>
  <span class="sd">&#39;&#39;&#39; Stores history output data from and allows useful operations. The key idea of this class is to allow easy storage of time dependant data without merging steps to allow further separating of each test steps (loading, unloading,...). The class allows additions, multiplication, ... between class instances and between class instances and int/floats. These operations only affect y data as long as time has no reason to be affected. </span>
<span class="sd">  </span>
<span class="sd">  :param time: time represented by nested lists, each one corresponding to a step.</span>
<span class="sd">  :type time: list of list/array.array containing floats</span>
<span class="sd">  :param data: data (ex: displacement, force, energy ...).  It is represented by nested lists, each one corresponding to a step.</span>
<span class="sd">  :type data: list of list/array.array containing floats</span>
<span class="sd">  :param dtf: float data type used by array.array</span>
<span class="sd">  :type dtf: &#39;f&#39;, &#39;d&#39;</span>
<span class="sd">  </span>

<span class="sd">  &gt;&gt;&gt; from abapy.postproc import HistoryOutput</span>
<span class="sd">  &gt;&gt;&gt; time = [ [1., 2.,3.] , [3.,4.,5.] , [5.,6.,7.] ] # Time separated in 3 steps</span>
<span class="sd">  &gt;&gt;&gt; data = [ [2.,2.,2.] , [3.,3.,3.] , [4.,4.,4.] ] # Data separated in 3 steps</span>
<span class="sd">  &gt;&gt;&gt; Data = HistoryOutput(time, data)</span>
<span class="sd">  &gt;&gt;&gt; print Data </span>
<span class="sd">  Field output instance: 3 steps</span>
<span class="sd">  Step 0: 3 points</span>
<span class="sd">  Time	Data</span>
<span class="sd">  1.0	2.0</span>
<span class="sd">  2.0	2.0</span>
<span class="sd">  3.0	2.0</span>
<span class="sd">  Step 1: 3 points</span>
<span class="sd">  Time	Data</span>
<span class="sd">  3.0	3.0</span>
<span class="sd">  4.0	3.0</span>
<span class="sd">  5.0	3.0</span>
<span class="sd">  Step 2: 3 points</span>
<span class="sd">  Time	Data</span>
<span class="sd">  5.0	4.0</span>
<span class="sd">  6.0	4.0</span>
<span class="sd">  7.0	4.0</span>
<span class="sd">  &gt;&gt;&gt; # +, *, **, abs, neg act only on data, not on time</span>
<span class="sd">  ... print Data + Data + 1. # addition</span>
<span class="sd">  Field output instance: 3 steps</span>
<span class="sd">  Step 0: 3 points</span>
<span class="sd">  Time	Data</span>
<span class="sd">  1.0	5.0</span>
<span class="sd">  2.0	5.0</span>
<span class="sd">  3.0	5.0</span>
<span class="sd">  Step 1: 3 points</span>
<span class="sd">  Time	Data</span>
<span class="sd">  3.0	7.0</span>
<span class="sd">  4.0	7.0</span>
<span class="sd">  5.0	7.0</span>
<span class="sd">  Step 2: 3 points</span>
<span class="sd">  Time	Data</span>
<span class="sd">  5.0	9.0</span>
<span class="sd">  6.0	9.0</span>
<span class="sd">  7.0	9.0</span>
<span class="sd">  &gt;&gt;&gt; print Data * Data * 2. # multiplication</span>
<span class="sd">  Field output instance: 3 steps</span>
<span class="sd">  Step 0: 3 points</span>
<span class="sd">  Time	Data</span>
<span class="sd">  1.0	8.0</span>
<span class="sd">  2.0	8.0</span>
<span class="sd">  3.0	8.0</span>
<span class="sd">  Step 1: 3 points</span>
<span class="sd">  Time	Data</span>
<span class="sd">  3.0	18.0</span>
<span class="sd">  4.0	18.0</span>
<span class="sd">  5.0	18.0</span>
<span class="sd">  Step 2: 3 points</span>
<span class="sd">  Time	Data</span>
<span class="sd">  5.0	32.0</span>
<span class="sd">  6.0	32.0</span>
<span class="sd">  7.0	32.0</span>
<span class="sd">  &gt;&gt;&gt; print ( Data / Data ) / 2. # division</span>
<span class="sd">  Field output instance: 3 steps</span>
<span class="sd">  Step 0: 3 points</span>
<span class="sd">  Time	Data</span>
<span class="sd">  1.0	0.5</span>
<span class="sd">  2.0	0.5</span>
<span class="sd">  3.0	0.5</span>
<span class="sd">  Step 1: 3 points</span>
<span class="sd">  Time	Data</span>
<span class="sd">  3.0	0.5</span>
<span class="sd">  4.0	0.5</span>
<span class="sd">  5.0	0.5</span>
<span class="sd">  Step 2: 3 points</span>
<span class="sd">  Time	Data</span>
<span class="sd">  5.0	0.5</span>
<span class="sd">  6.0	0.5</span>
<span class="sd">  7.0	0.5</span>
<span class="sd">  &gt;&gt;&gt; print Data ** 2</span>
<span class="sd">  Field output instance: 3 steps</span>
<span class="sd">  Step 0: 3 points</span>
<span class="sd">  Time	Data</span>
<span class="sd">  1.0	4.0</span>
<span class="sd">  2.0	4.0</span>
<span class="sd">  3.0	4.0</span>
<span class="sd">  Step 1: 3 points</span>
<span class="sd">  Time	Data</span>
<span class="sd">  3.0	9.0</span>
<span class="sd">  4.0	9.0</span>
<span class="sd">  5.0	9.0</span>
<span class="sd">  Step 2: 3 points</span>
<span class="sd">  Time	Data</span>
<span class="sd">  5.0	16.0</span>
<span class="sd">  6.0	16.0</span>
<span class="sd">  7.0	16.0</span>
<span class="sd">  &gt;&gt;&gt; print abs(Data)</span>
<span class="sd">  Field output instance: 3 steps</span>
<span class="sd">  Step 0: 3 points</span>
<span class="sd">  Time	Data</span>
<span class="sd">  1.0	2.0</span>
<span class="sd">  2.0	2.0</span>
<span class="sd">  3.0	2.0</span>
<span class="sd">  Step 1: 3 points</span>
<span class="sd">  Time	Data</span>
<span class="sd">  3.0	3.0</span>
<span class="sd">  4.0	3.0</span>
<span class="sd">  5.0	3.0</span>
<span class="sd">  Step 2: 3 points</span>
<span class="sd">  Time	Data</span>
<span class="sd">  5.0	4.0</span>
<span class="sd">  6.0	4.0</span>
<span class="sd">  7.0	4.0</span>
<span class="sd">  &gt;&gt;&gt; print Data[1] # step 1</span>
<span class="sd">  Field output instance: 1 steps</span>
<span class="sd">  Step 0: 3 points</span>
<span class="sd">  Time	Data</span>
<span class="sd">  3.0	3.0</span>
<span class="sd">  4.0	3.0</span>
<span class="sd">  5.0	3.0</span>
<span class="sd">  &gt;&gt;&gt; print Data[0:2]</span>
<span class="sd">  Field output instance: 2 steps</span>
<span class="sd">  Step 0: 3 points</span>
<span class="sd">  Time	Data</span>
<span class="sd">  1.0	2.0</span>
<span class="sd">  2.0	2.0</span>
<span class="sd">  3.0	2.0</span>
<span class="sd">  Step 1: 3 points</span>
<span class="sd">  Time	Data</span>
<span class="sd">  3.0	3.0</span>
<span class="sd">  4.0	3.0</span>
<span class="sd">  5.0	3.0</span>
<span class="sd">  &gt;&gt;&gt; print Data[0,2]</span>
<span class="sd">  Field output instance: 2 steps</span>
<span class="sd">  Step 0: 3 points</span>
<span class="sd">  Time	Data</span>
<span class="sd">  1.0	2.0</span>
<span class="sd">  2.0	2.0</span>
<span class="sd">  3.0	2.0</span>
<span class="sd">  Step 1: 3 points</span>
<span class="sd">  Time	Data</span>
<span class="sd">  5.0	4.0</span>
<span class="sd">  6.0	4.0</span>
<span class="sd">  7.0	4.0&#39;&#39;&#39;</span>
  
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">time</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">data</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">dtf</span><span class="o">=</span><span class="s">&#39;f&#39;</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="n">time_size</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">time</span><span class="p">]</span>
    <span class="n">data_size</span> <span class="o">=</span> <span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">data_size</span> <span class="o">!=</span> <span class="n">time_size</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;time and data must have the same structure.&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)):</span> 
      <span class="n">time_step</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">data_step</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">time_step</span><span class="p">,</span> <span class="n">data_step</span><span class="p">)</span>
<div class="viewcode-block" id="HistoryOutput.add_step"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.HistoryOutput.add_step">[docs]</a>  <span class="k">def</span> <span class="nf">add_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">time_step</span><span class="p">,</span><span class="n">data_step</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Adds data to an HistoryOutput instance.</span>
<span class="sd">    </span>
<span class="sd">    :param time_step: time data to be added.</span>
<span class="sd">    :type time_step: list, array.array, np.array containing floats</span>
<span class="sd">    :param data_step: data to be added.</span>
<span class="sd">    :type data_step: list, array.array, np.array containing floats</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from abapy.postproc import HistoryOutput</span>
<span class="sd">    &gt;&gt;&gt; time = [ [0.,0.5, 1.] , [1., 1.5, 2.] ]</span>
<span class="sd">    &gt;&gt;&gt; force = [ [4.,2., 1.] , [1., .5, .2] ] ]</span>
<span class="sd">    &gt;&gt;&gt; Force = HistoryOutput(time,force)</span>
<span class="sd">    &gt;&gt;&gt; Force.time # time</span>
<span class="sd">    [array(&#39;f&#39;, [0.0, 0.5, 1.0]), array(&#39;f&#39;, [1.0, 1.5, 2.0])]</span>
<span class="sd">    &gt;&gt;&gt; Force.add_step([5.,5.,5.],[4.,4.,4.]) </span>
<span class="sd">    &gt;&gt;&gt; Force.time</span>
<span class="sd">    [array(&#39;f&#39;, [0.0, 0.5, 1.0]), array(&#39;f&#39;, [1.0, 1.5, 2.0]), array(&#39;f&#39;, [5.0, 5.0, 5.0])]</span>
<span class="sd">    &gt;&gt;&gt; Force.data</span>
<span class="sd">    [array(&#39;f&#39;, [4.0, 2.0, 1.0]), array(&#39;f&#39;, [1.0, 0.5, 0.20000000298023224]), array(&#39;f&#39;, [4.0, 4.0, 4.0])]</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span>
    <span class="n">zipped</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">time_step</span><span class="p">,</span> <span class="n">data_step</span><span class="p">)</span> <span class="c"># fancy sorting using zip</span>
    <span class="n">time_step</span><span class="p">,</span> <span class="n">data_step</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span> <span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="n">zipped</span><span class="p">)</span> <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,</span><span class="n">time_step</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,</span><span class="n">data_step</span><span class="p">))</span>
    </div>
<div class="viewcode-block" id="HistoryOutput.plotable"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.HistoryOutput.plotable">[docs]</a>  <span class="k">def</span> <span class="nf">plotable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Gives back plotable version of the history output. Plotable differs from toArray on one point, toArray will concatenate steps into one single array for x and one for y where plotable will add None between steps before concatenation. Adding None allows matplotlib to draw discontinuous lines between steps without requiring ploting several independant arrays. By the way, the None methode is far faster.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    :rtype: 2 lists of floats and None</span>
<span class="sd">      </span>
<span class="sd">    .. plot:: example_code/postproc/historyOutput-plotable.py</span>
<span class="sd">       :include-source:</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">time0</span><span class="p">,</span> <span class="n">data0</span> <span class="o">=</span> <span class="p">[],[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)):</span>
      <span class="n">time0</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">+</span><span class="p">[</span><span class="bp">None</span><span class="p">]</span>
      <span class="n">data0</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="o">+</span><span class="p">[</span><span class="bp">None</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">time0</span><span class="p">,</span> <span class="n">data0</span>
    </div>
<div class="viewcode-block" id="HistoryOutput.toArray"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.HistoryOutput.toArray">[docs]</a>  <span class="k">def</span> <span class="nf">toArray</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns an array.array of concatenated steps for x and y.</span>
<span class="sd">    </span>
<span class="sd">    :rtype: array.array </span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from abapy.postproc import HistoryOutput</span>
<span class="sd">    &gt;&gt;&gt; time = [ [1., 2.,3.] , [3.,4.,5.] , [5.,6.,7.] ]</span>
<span class="sd">    &gt;&gt;&gt; force = [ [2.,2.,2.] , [3.,3.,3.] , [4.,4.,4.] ]</span>
<span class="sd">    &gt;&gt;&gt; Force = HistoryOutput(time, force)</span>
<span class="sd">    &gt;&gt;&gt; x,y = Force.toArray()</span>
<span class="sd">    &gt;&gt;&gt; x</span>
<span class="sd">    array(&#39;f&#39;, [1.0, 2.0, 3.0, 3.0, 4.0, 5.0, 5.0, 6.0, 7.0])</span>
<span class="sd">    &gt;&gt;&gt; y</span>
<span class="sd">    array(&#39;f&#39;, [2.0, 2.0, 2.0, 3.0, 3.0, 3.0, 4.0, 4.0, 4.0])</span>


<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span>
    <span class="n">time0</span><span class="p">,</span> <span class="n">data0</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,[]),</span><span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,[])</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)):</span>
      <span class="n">time0</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">data0</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">time0</span><span class="p">,</span> <span class="n">data0</span>
  </div>
  <span class="k">def</span> <span class="nf">_PreProcess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span> <span class="k">as</span> <span class="n">n_array</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">float32</span><span class="p">,</span> <span class="n">float64</span><span class="p">,</span> <span class="n">ones_like</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c"># Other is one of us !</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;d&#39;</span><span class="p">:</span>
        <span class="n">dtf</span> <span class="o">=</span> <span class="s">&#39;d&#39;</span>
      <span class="k">if</span> <span class="n">other</span><span class="o">.</span><span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;d&#39;</span><span class="p">:</span> 
        <span class="n">dtf</span> <span class="o">=</span> <span class="s">&#39;d&#39;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">time</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">dtf</span> <span class="o">=</span> <span class="s">&#39;f&#39;</span>
        <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
      <span class="k">if</span> <span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;f&#39;</span><span class="p">:</span> <span class="n">n_dtf</span> <span class="o">=</span> <span class="n">float32</span>
      <span class="k">if</span> <span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="n">n_dtf</span> <span class="o">=</span> <span class="n">float64</span>
      <span class="n">n_other</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_array</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">n_dtf</span><span class="p">)</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span> <span class="p">]</span>
      <span class="n">n_self</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_array</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">n_dtf</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="p">]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">long</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
      <span class="n">other</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
      <span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span>
      <span class="k">if</span> <span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;f&#39;</span><span class="p">:</span> <span class="n">n_dtf</span> <span class="o">=</span> <span class="n">float32</span>
      <span class="k">if</span> <span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="n">n_dtf</span> <span class="o">=</span> <span class="n">float64</span>
      <span class="n">n_self</span> <span class="o">=</span> <span class="p">[</span><span class="n">n_array</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">n_dtf</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="p">]</span>
      <span class="n">n_other</span> <span class="o">=</span> <span class="p">[</span><span class="n">other</span> <span class="o">*</span> <span class="n">ones_like</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">n_self</span> <span class="p">]</span>
      <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
    <span class="k">return</span> <span class="n">time</span><span class="p">,</span> <span class="n">n_self</span><span class="p">,</span> <span class="n">n_other</span><span class="p">,</span> <span class="n">dtf</span>
    
  <span class="k">def</span> <span class="nf">_PostProcess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time</span><span class="p">,</span> <span class="n">n_out</span><span class="p">,</span> <span class="n">dtf</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="n">a_out</span> <span class="o">=</span> <span class="p">[</span><span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,</span> <span class="n">no</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="k">for</span> <span class="n">no</span> <span class="ow">in</span> <span class="n">n_out</span><span class="p">]</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">HistoryOutput</span><span class="p">(</span><span class="n">time</span> <span class="o">=</span> <span class="n">time</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">a_out</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>  
    <span class="k">return</span> <span class="n">out</span>  
      
  <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
    <span class="n">time</span><span class="p">,</span> <span class="n">n_self</span><span class="p">,</span> <span class="n">n_other</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="n">n_out</span> <span class="o">=</span> <span class="p">[</span> <span class="n">n_self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">n_other</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n_self</span><span class="p">))</span> <span class="p">]</span> 
    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PostProcess</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">n_out</span><span class="p">,</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>
    
  <span class="n">__radd__</span> <span class="o">=</span> <span class="n">__add__</span>
  
  <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
    <span class="n">time</span><span class="p">,</span> <span class="n">n_self</span><span class="p">,</span> <span class="n">n_other</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="n">n_out</span> <span class="o">=</span> <span class="p">[</span> <span class="n">n_self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_other</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n_self</span><span class="p">))</span> <span class="p">]</span> 
    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PostProcess</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">n_out</span><span class="p">,</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>
   
  <span class="n">__rmul__</span> <span class="o">=</span> <span class="n">__mul__</span>  
  
  <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">+</span><span class="p">(</span><span class="n">other</span><span class="o">*-</span><span class="mi">1</span><span class="p">)</span>
    
  <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">*-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">other</span>
  
  <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
    <span class="n">time</span><span class="p">,</span> <span class="n">n_self</span><span class="p">,</span> <span class="n">n_other</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="n">n_out</span> <span class="o">=</span> <span class="p">[</span> <span class="n">n_self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">n_other</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n_self</span><span class="p">))</span> <span class="p">]</span> 
    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PostProcess</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">n_out</span><span class="p">,</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>
  
  <span class="k">def</span> <span class="nf">__rdiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">out</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">**-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">out</span>
  
  <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
    <span class="n">time</span><span class="p">,</span> <span class="n">n_self</span><span class="p">,</span> <span class="n">n_other</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="n">n_out</span> <span class="o">=</span> <span class="p">[</span> <span class="n">n_self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="n">n_other</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n_self</span><span class="p">))</span> <span class="p">]</span> 
    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PostProcess</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">n_out</span><span class="p">,</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>
  
  <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">*-</span><span class="mi">1</span>
    
  <span class="k">def</span> <span class="nf">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">time</span><span class="p">,</span> <span class="n">n_self</span><span class="p">,</span> <span class="n">n_other</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">n_out</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">abs</span><span class="p">(</span><span class="n">n_self</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n_self</span><span class="p">))</span> <span class="p">]</span> 
    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PostProcess</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">n_out</span><span class="p">,</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>
    
  <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
    <span class="n">labs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="n">labs</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">slice</span><span class="p">:</span>
      <span class="n">start</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">start</span>
      <span class="n">stop</span>  <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">stop</span>
      <span class="n">step</span>  <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">step</span>
      <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">labs</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="n">step</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span> <span class="n">array</span><span class="p">]:</span>  
      <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span><span class="n">labs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span>
    <span class="n">time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">HistoryOutput</span><span class="p">(</span><span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">labs</span><span class="p">:</span> <span class="n">out</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">out</span>
    
  <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&#39;&lt;HistoryOutput instance: {0} steps&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">))</span>
  
  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">time</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
    <span class="n">nstep</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s">&#39;History output instance: {0} steps</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">nstep</span><span class="p">)</span>
    <span class="n">pattern0</span> <span class="o">=</span> <span class="s">&#39;Step {0}: {1} points</span><span class="se">\n</span><span class="s">Time</span><span class="se">\t</span><span class="s">Data</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="n">pattern1</span> <span class="o">=</span> <span class="s">&#39;{0}</span><span class="se">\t</span><span class="s">{1}</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">nstep</span><span class="p">):</span>
      <span class="n">time_step</span><span class="p">,</span> <span class="n">data_step</span> <span class="o">=</span> <span class="n">time</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
      <span class="n">npoints</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">time_step</span><span class="p">)</span>
      <span class="n">out</span> <span class="o">+=</span> <span class="n">pattern0</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">npoints</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">npoints</span><span class="p">):</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="n">pattern1</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time_step</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="n">data_step</span><span class="p">[</span><span class="n">p</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">out</span>    
  
<div class="viewcode-block" id="HistoryOutput.total"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.HistoryOutput.total">[docs]</a>  <span class="k">def</span> <span class="nf">total</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the total of all data.</span>
<span class="sd">    </span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">time</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toArray</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    
  </div>
<div class="viewcode-block" id="HistoryOutput.average"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.HistoryOutput.average">[docs]</a>  <span class="k">def</span> <span class="nf">average</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s">&#39;trapz&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the average of all data over time using ``integral``. This average is performed step by step to avoid errors due to disconnected steps.</span>
<span class="sd">     </span>
<span class="sd">    :param method: choice between trapezoid rule (&#39;trapz&#39;) or Simpson rule (&#39;simps&#39;).</span>
<span class="sd">    :type method: string</span>
<span class="sd">    :rtype: float</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from abapy.postproc import HistoryOutput</span>
<span class="sd">    &gt;&gt;&gt; from math import sin, pi</span>
<span class="sd">    &gt;&gt;&gt; N = 100</span>
<span class="sd">    &gt;&gt;&gt; hist = HistoryOutput()</span>
<span class="sd">    &gt;&gt;&gt; time = [pi / 2 * float(i)/N for i in xrange(N+1)]</span>
<span class="sd">    &gt;&gt;&gt; data = [sin(t) for t in time]</span>
<span class="sd">    &gt;&gt;&gt; hist.add_step(time_step = time, data_step = data)</span>
<span class="sd">    &gt;&gt;&gt; time2 = [10., 11.]</span>
<span class="sd">    &gt;&gt;&gt; data2 = [1., 1.]</span>
<span class="sd">    &gt;&gt;&gt; hist.add_step(time_step = time2, data_step = data2)</span>
<span class="sd">    &gt;&gt;&gt; sol = 2. / pi + 1.</span>
<span class="sd">    &gt;&gt;&gt; print &#39;Print computed value:&#39;, hist.average()</span>
<span class="sd">    Print computed value: 1.63660673935</span>
<span class="sd">    &gt;&gt;&gt; print &#39;Analytic solution:&#39;, sol</span>
<span class="sd">    Analytic solution: 1.63661977237</span>
<span class="sd">    &gt;&gt;&gt; print &#39;Relative error: {0:.4}%&#39;.format( (hist.average() - sol)/sol * 100.)</span>
<span class="sd">    Relative error: -0.0007963%</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">out</span><span class="p">,</span> <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">)):</span>
      <span class="n">dt</span> <span class="o">+=</span> <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">duration</span><span class="p">()</span>
      <span class="n">out</span> <span class="o">+=</span>  <span class="bp">self</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">integral</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span><span class="o">/</span><span class="n">dt</span>
  </div>
<div class="viewcode-block" id="HistoryOutput.duration"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.HistoryOutput.duration">[docs]</a>  <span class="k">def</span> <span class="nf">duration</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the duration of the output by computing max(time) - min(time).</span>
<span class="sd">    </span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">time</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toArray</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">time</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="HistoryOutput.data_min"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.HistoryOutput.data_min">[docs]</a>  <span class="k">def</span> <span class="nf">data_min</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the minimum value of data.</span>
<span class="sd">    </span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">time</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toArray</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
  </div>
<div class="viewcode-block" id="HistoryOutput.data_max"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.HistoryOutput.data_max">[docs]</a>  <span class="k">def</span> <span class="nf">data_max</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the maximum value of data.</span>
<span class="sd">    </span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">time</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toArray</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
   </div>
<div class="viewcode-block" id="HistoryOutput.time_min"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.HistoryOutput.time_min">[docs]</a>  <span class="k">def</span> <span class="nf">time_min</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the minimum value of time.</span>
<span class="sd">    </span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">time</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toArray</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>  
    </div>
<div class="viewcode-block" id="HistoryOutput.time_max"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.HistoryOutput.time_max">[docs]</a>  <span class="k">def</span> <span class="nf">time_max</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the maximum value of time.</span>
<span class="sd">    </span>
<span class="sd">    :rtype: float</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">time</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toArray</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
  </div>
<div class="viewcode-block" id="HistoryOutput.integral"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.HistoryOutput.integral">[docs]</a>  <span class="k">def</span> <span class="nf">integral</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">method</span> <span class="o">=</span> <span class="s">&#39;trapz&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the integral of the history output using the trapezoid or Simpson rule.</span>
<span class="sd">    </span>
<span class="sd">    :param method: choice between trapezoid rule (&#39;trapz&#39;) or Simpson rule (&#39;simps&#39;).</span>
<span class="sd">    :type method: string</span>
<span class="sd">    :rtype: float</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from abapy.postproc import HistoryOutput</span>
<span class="sd">    &gt;&gt;&gt; time = [ [0., 1.], [3., 4.] ]</span>
<span class="sd">    &gt;&gt;&gt; data = [ [.5, 1.5], [.5, 1.5] ]</span>
<span class="sd">    &gt;&gt;&gt; hist = HistoryOutput(time = time, data = data)</span>
<span class="sd">    &gt;&gt;&gt; hist[0].integral()</span>
<span class="sd">    1.0</span>
<span class="sd">    &gt;&gt;&gt; hist[1].integral()</span>
<span class="sd">    1.0</span>
<span class="sd">    &gt;&gt;&gt; hist.integral()</span>
<span class="sd">    2.0</span>
<span class="sd">    &gt;&gt;&gt; N = 10</span>
<span class="sd">    &gt;&gt;&gt; from math import sin, pi</span>
<span class="sd">    &gt;&gt;&gt; time = [pi / 2 * float(i)/N for i in xrange(N+1)]</span>
<span class="sd">    &gt;&gt;&gt; data = [sin(t) for t in time]</span>
<span class="sd">    &gt;&gt;&gt; hist = HistoryOutput()</span>
<span class="sd">    &gt;&gt;&gt; hist.add_step(time_step = time, data_step = data)</span>
<span class="sd">    &gt;&gt;&gt; trap = hist.integral()</span>
<span class="sd">    &gt;&gt;&gt; simp = hist.integral(method = &#39;simps&#39;)</span>
<span class="sd">    &gt;&gt;&gt; trap_error = (trap -1.)</span>
<span class="sd">    &gt;&gt;&gt; simp_error = (simp -1.)</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    Relative errors:</span>
<span class="sd">      * Trapezoid rule: -0.21%</span>
<span class="sd">      * Simpson rule: 0.00033%</span>
<span class="sd">      </span>
<span class="sd">    .. note:: uses ``scipy``</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span><span class="p">,</span> <span class="n">float32</span><span class="p">,</span> <span class="n">float64</span>
    <span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">simps</span><span class="p">,</span> <span class="n">trapz</span>
    <span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span>
    <span class="k">if</span> <span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;f&#39;</span><span class="p">:</span> <span class="n">ndtf</span> <span class="o">=</span> <span class="n">float32</span>
    <span class="k">if</span> <span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="n">ndtf</span> <span class="o">=</span> <span class="n">float64</span>
    <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;trapz&#39;</span><span class="p">,</span> <span class="s">&#39;simps&#39;</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;method must be trapz or simps&#39;</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;trapz&#39;</span><span class="p">:</span> <span class="n">rule</span> <span class="o">=</span> <span class="n">trapz</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s">&#39;simps&#39;</span><span class="p">:</span> <span class="n">rule</span> <span class="o">=</span> <span class="n">simps</span>
    <span class="n">time</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
    <span class="n">out</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time</span><span class="p">)):</span>
      <span class="n">t</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">time</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">ndtf</span><span class="p">)</span>
      <span class="n">d</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">ndtf</span><span class="p">)</span>
      <span class="n">out</span> <span class="o">+=</span> <span class="n">rule</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">d</span><span class="p">)</span>
      <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">      dt = t[1:] - t[:-1]</span>
<span class="sd">      d2 = (d[1:] + d[:-1])/2</span>
<span class="sd">      out += (d2 / dt).sum()</span>
<span class="sd">      &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">out</span>  
    

     


</div></div>
<div class="viewcode-block" id="GetHistoryOutputByKey"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.GetHistoryOutputByKey">[docs]</a><span class="k">def</span> <span class="nf">GetHistoryOutputByKey</span><span class="p">(</span><span class="n">odb</span><span class="p">,</span><span class="n">key</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Retrieves an history output in an odb object using key (U2, EVOL, RF2,...)</span>
<span class="sd">  </span>
<span class="sd">  :param odb: Abaqus output database object produced by odbAcces.openOdb.</span>
<span class="sd">  :type odb: odb object</span>
<span class="sd">  :param key: name of the requested variable (*i. e.* &#39;U2&#39;, &#39;COOR1&#39;, ...)</span>
<span class="sd">  :type key: string</span>
<span class="sd">  :rtype: dict of HistoryOutput instance where keys are HistoryRegions names (*i. e.* locations)</span>
<span class="sd">  </span>
<span class="sd">  &gt;&gt;&gt; from odbAccess import openOdb</span>
<span class="sd">  &gt;&gt;&gt; odb = openOdb(&#39;mySimulation.odb&#39;)</span>
<span class="sd">  &gt;&gt;&gt; from abapy.postproc import GetHistoryOutputByKey</span>
<span class="sd">  &gt;&gt;&gt; u_2 = GetHistoryOutputByKey(odb,&#39;U2&#39;)</span>

<span class="sd">  &#39;&#39;&#39;</span>
  <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
  <span class="n">precision</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">odb</span><span class="o">.</span><span class="n">jobData</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">precision</span> <span class="o">==</span> <span class="s">&#39;SINGLE_PRECISION&#39;</span><span class="p">:</span> <span class="n">dtf</span> <span class="o">=</span> <span class="s">&#39;f&#39;</span>
  <span class="k">if</span> <span class="n">precision</span> <span class="o">==</span> <span class="s">&#39;DOUBLE_PRECISION&#39;</span><span class="p">:</span> <span class="n">dtf</span> <span class="o">=</span> <span class="s">&#39;d&#39;</span>
  <span class="n">out</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">steps</span> <span class="o">=</span> <span class="n">odb</span><span class="o">.</span><span class="n">steps</span>
  <span class="k">for</span> <span class="n">stepk</span> <span class="ow">in</span> <span class="n">steps</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
    <span class="n">hrs</span> <span class="o">=</span> <span class="n">steps</span><span class="p">[</span><span class="n">stepk</span><span class="p">]</span><span class="o">.</span><span class="n">historyRegions</span>
    <span class="n">startTime</span> <span class="o">=</span> <span class="n">steps</span><span class="p">[</span><span class="n">stepk</span><span class="p">]</span><span class="o">.</span><span class="n">totalTime</span>
    <span class="k">for</span> <span class="n">hrk</span> <span class="ow">in</span> <span class="n">hrs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
      <span class="n">hos</span> <span class="o">=</span> <span class="n">hrs</span><span class="p">[</span><span class="n">hrk</span><span class="p">]</span><span class="o">.</span><span class="n">historyOutputs</span>
      <span class="n">hoks</span> <span class="o">=</span> <span class="n">hos</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
      <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">hoks</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">hrk</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span> <span class="n">out</span><span class="p">[</span><span class="n">hrk</span><span class="p">]</span> <span class="o">=</span> <span class="n">HistoryOutput</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">hos</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="n">time</span><span class="p">,</span><span class="n">data</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,[]),</span> <span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,[])</span> 
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
          <span class="n">time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">startTime</span><span class="p">)</span>
          <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">out</span><span class="p">[</span><span class="n">hrk</span><span class="p">]</span><span class="o">.</span><span class="n">add_step</span><span class="p">(</span><span class="n">time_step</span> <span class="o">=</span> <span class="n">time</span><span class="p">,</span> <span class="n">data_step</span> <span class="o">=</span> <span class="n">data</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">out</span>

 

   </div>
<div class="viewcode-block" id="GetFieldOutput"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.GetFieldOutput">[docs]</a><span class="k">def</span> <span class="nf">GetFieldOutput</span><span class="p">(</span><span class="n">odb</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">subField</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">dti</span><span class="o">=</span><span class="s">&#39;I&#39;</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Retrieves a field output in an Abaqus odb object and stores it in a FieldOutput class instance. Field output that are classically available at integration points must be interpolated at nodes. This can be requested in the Abaqus *inp* file using: *Element Output, position = nodes*.</span>
<span class="sd">  </span>
<span class="sd">  </span>
<span class="sd">  </span>
<span class="sd">  </span>
<span class="sd">  </span>
<span class="sd">  </span>
<span class="sd">  :param odb: odb object produced by odbAccess.openOdb in abaqus python or abaqus viewer -noGUI</span>
<span class="sd">  :type odb: odb object.</span>
<span class="sd">  :param step: step name defined in the abaqus inp file. May be the upper case version of original string name.</span>
<span class="sd">  :type step: string</span>
<span class="sd">  :param frame: requested frame indice in the odb.</span>
<span class="sd">  :type frame: int</span>
<span class="sd">  :param instance: instance name defined in the abaqus odb file. May be the upper case version of the original name. </span>
<span class="sd">  :type instance: string </span>
<span class="sd">  :param position: position at which the output is to be computed.</span>
<span class="sd">  :type position: &#39;node&#39;, &#39;element&#39;</span>
<span class="sd">  :param field: requested field output (&#39;LE&#39;,&#39;S&#39;,&#39;U&#39;,&#39;AC YIELD&#39;,...).</span>
<span class="sd">  :type field: string</span>
<span class="sd">  :param subField: requested subfield in the case of non scalar fields, can be a component (U1, S12) or an invariant (mises, tresca, inv3, maxPrincipal). In the case of scalar fields, it has to be None</span>
<span class="sd">  :type subField: string or None</span>
<span class="sd">  :param labels: if not None, it provides a set of locations (elements/nodes labels or node/element set label) where the field is to be computed. if None, every available location is used and labels are sorted</span>
<span class="sd">  :type labels: list, array.array, numpy.array of unsigned non zero ints or string</span>
<span class="sd">  :param dti: int data type in ``array.array``</span>
<span class="sd">  :type dti: &#39;I&#39;, &#39;H&#39;</span>
<span class="sd">  :rtype: ``FieldOutput`` instance</span>
<span class="sd">  </span>
<span class="sd">  .. note:: This function can only be executed in abaqus python or abaqus viewer -noGUI</span>
<span class="sd">  </span>
<span class="sd">  &gt;&gt;&gt; from abapy.postproc import GetFieldOutput</span>
<span class="sd">  &gt;&gt;&gt; from odbAccess import openOdb</span>
<span class="sd">  &gt;&gt;&gt; odb = openOdb(&#39;indentation.odb&#39;)</span>
<span class="sd">  &gt;&gt;&gt; U2 = GetFieldOutput(odb, step = &#39;LOADING0&#39;, frame = -1, instance =&#39;I_SAMPLE&#39;, position =  &#39;node&#39;, field = &#39;U&#39;, subField = &#39;U1&#39;) # Gets U2 at all nodes of instance &#39;I_SAMPLE&#39;</span>
<span class="sd">  &gt;&gt;&gt; U1 = GetFieldOutput(odb, step = &#39;LOADING0&#39;, frame = -1, instance =&#39;I_SAMPLE&#39;, position =  &#39;node&#39;, field = &#39;U&#39;, subField = &#39;U1&#39;, labels = [5,6]) # Here labels refer to nodes 5 and 6</span>
<span class="sd">  &gt;&gt;&gt; S11 = GetFieldOutput(odb, step = &#39;LOADING0&#39;, frame = -1, instance =&#39;I_SAMPLE&#39;, position =  &#39;node&#39;, field = &#39;S&#39;, subField = &#39;S11&#39;, labels = &#39;CORE&#39;) # Here labels refers to nodes belonging to the node set &#39;CORE&#39;</span>
<span class="sd">  &gt;&gt;&gt; S12 = GetFieldOutput(odb, step = &#39;LOADING0&#39;, frame = -1, instance =&#39;I_SAMPLE&#39;, position =  &#39;element&#39;, field = &#39;S&#39;, subField = &#39;S12&#39;, labels = &#39;CORE&#39;) # Here labels refers to nodes belonging to the node set &#39;CORE&#39;</span>

<span class="sd">  </span>
<span class="sd">  .. note::</span>
<span class="sd">       * If dti=&#39;H&#39; is chosen, labels are stored as unsigned 16 bits ints. If more than 65k labels are stored, an OverFlow error will be raised.</span>
<span class="sd">       * This function had memory usage problems in its early version, these have been solved by using more widely array.array. It is still a bit slow but with the lack of numpy in Abaqus, no better solutions have been found yet. I&#39;m open to any faster solution even involving the used temporary rpt files procuced by Abaqus&#39;&#39;&#39;</span>
  
  <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
  <span class="kn">from</span> <span class="nn">abaqusConstants</span> <span class="kn">import</span> <span class="n">WHOLE_ELEMENT</span><span class="p">,</span> <span class="n">NODAL</span><span class="p">,</span> <span class="n">ELEMENT_NODAL</span><span class="p">,</span> <span class="n">INTEGRATION_POINT</span><span class="p">,</span> <span class="n">SCALAR</span>
  <span class="n">Instance</span> <span class="o">=</span> <span class="n">odb</span><span class="o">.</span><span class="n">rootAssembly</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="n">instance</span><span class="p">]</span>
  <span class="c"># Finding precision</span>
  <span class="n">precision</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">odb</span><span class="o">.</span><span class="n">jobData</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">precision</span> <span class="o">==</span> <span class="s">&#39;SINGLE_PRECISION&#39;</span><span class="p">:</span> <span class="n">dtf</span> <span class="o">=</span> <span class="s">&#39;f&#39;</span>
  <span class="k">if</span> <span class="n">precision</span> <span class="o">==</span> <span class="s">&#39;DOUBLE_PRECISION&#39;</span><span class="p">:</span> <span class="n">dtf</span> <span class="o">=</span> <span class="s">&#39;d&#39;</span>
  <span class="c"># Building some references in the odb</span>
  <span class="n">abqFieldOutput</span> <span class="o">=</span> <span class="n">odb</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">step</span><span class="p">]</span><span class="o">.</span><span class="n">frames</span><span class="p">[</span><span class="n">frame</span><span class="p">]</span><span class="o">.</span><span class="n">fieldOutputs</span><span class="p">[</span><span class="n">field</span><span class="p">]</span>
  <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="s">&#39;node&#39;</span><span class="p">:</span> 
    <span class="n">getLabel</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">nodeLabel</span>
    <span class="n">abqPositions</span> <span class="o">=</span> <span class="p">[</span><span class="n">NODAL</span><span class="p">,</span> <span class="n">ELEMENT_NODAL</span><span class="p">]</span>
    <span class="n">positionLabel</span> <span class="o">=</span> <span class="s">&#39;nodeLabel&#39;</span>
    <span class="k">if</span> <span class="n">labels</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Instance</span><span class="o">.</span><span class="n">nodes</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
      <span class="n">abqNodeSet</span> <span class="o">=</span> <span class="n">odb</span><span class="o">.</span><span class="n">rootAssembly</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="n">instance</span><span class="p">]</span><span class="o">.</span><span class="n">nodeSets</span><span class="p">[</span><span class="n">labels</span><span class="p">]</span><span class="o">.</span><span class="n">nodes</span>
      <span class="n">labels</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dti</span><span class="p">,[</span> <span class="n">abqNode</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">abqNode</span> <span class="ow">in</span> <span class="n">abqNodeSet</span> <span class="p">])</span>
  <span class="k">if</span> <span class="n">position</span> <span class="o">==</span> <span class="s">&#39;element&#39;</span><span class="p">:</span> 
    <span class="n">getLabel</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span> <span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">elementLabel</span>
    <span class="n">abqPositions</span> <span class="o">=</span> <span class="p">[</span><span class="n">WHOLE_ELEMENT</span><span class="p">,</span> <span class="n">INTEGRATION_POINT</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">labels</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Instance</span><span class="o">.</span><span class="n">elements</span><span class="p">]</span>
    <span class="n">positionLabel</span> <span class="o">=</span> <span class="s">&#39;elementLabel&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
      <span class="n">abqElemSet</span> <span class="o">=</span> <span class="n">odb</span><span class="o">.</span><span class="n">rootAssembly</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="n">instance</span><span class="p">]</span><span class="o">.</span><span class="n">elementSets</span><span class="p">[</span><span class="n">labels</span><span class="p">]</span><span class="o">.</span><span class="n">elements</span>
      <span class="n">labels</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dti</span><span class="p">,[</span> <span class="n">abqElem</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">abqElem</span> <span class="ow">in</span> <span class="n">abqElemSet</span> <span class="p">])</span>
  <span class="n">labels</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dti</span><span class="p">,</span><span class="nb">sorted</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>
  <span class="n">li</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">index</span>
  <span class="n">Nitems</span>  <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="c"># Number of nodes/elements where the field is to be extracted</span>
  <span class="n">availablePositions</span> <span class="o">=</span> <span class="p">[</span><span class="n">loc</span><span class="o">.</span><span class="n">position</span> <span class="k">for</span> <span class="n">loc</span> <span class="ow">in</span> <span class="n">abqFieldOutput</span><span class="o">.</span><span class="n">locations</span><span class="p">]</span> <span class="c"># Available Abaqus positions for the requested field</span>
  <span class="k">for</span> <span class="n">abqloc</span> <span class="ow">in</span> <span class="n">availablePositions</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">abqloc</span> <span class="ow">in</span> <span class="n">abqPositions</span><span class="p">:</span> <span class="n">matchedPosition</span> <span class="o">=</span> <span class="n">abqloc</span>
  <span class="n">Values</span> <span class="o">=</span> <span class="n">abqFieldOutput</span><span class="o">.</span><span class="n">getSubset</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="n">Instance</span><span class="p">)</span><span class="o">.</span><span class="n">getSubset</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">matchedPosition</span><span class="p">)</span>
  <span class="n">Nvalues</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Values</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">subField</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">Values</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">SCALAR</span><span class="p">:</span>
      <span class="n">scalarValues</span> <span class="o">=</span> <span class="n">Values</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;field output is not scalar, maybe because subfield is None.&#39;</span> 
  <span class="k">if</span> <span class="n">subField</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span> 
    <span class="n">fieldInvariants</span> <span class="o">=</span> <span class="n">abqFieldOutput</span><span class="o">.</span><span class="n">validInvariants</span> <span class="c"># Warning: using getsubset or getscalarfield can lead abaqus to give wrong field invariants or field components. This bug bug seems to be avoided by requestions invariants and components before subseting or scalaring the field.</span>
    <span class="n">fieldComponents</span> <span class="o">=</span> <span class="n">abqFieldOutput</span><span class="o">.</span><span class="n">componentLabels</span>  
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">fieldComponents</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">subField</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">scalarValues</span> <span class="o">=</span> <span class="n">Values</span><span class="o">.</span><span class="n">getScalarField</span><span class="p">(</span><span class="n">componentLabel</span> <span class="o">=</span> <span class="n">key</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">fieldInvariants</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">subField</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>  <span class="n">scalarValues</span> <span class="o">=</span> <span class="n">Values</span><span class="o">.</span><span class="n">getScalarField</span><span class="p">(</span><span class="n">invariant</span> <span class="o">=</span> <span class="n">key</span><span class="p">)</span>
  <span class="n">count</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dti</span><span class="p">,[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">Nitems</span><span class="p">)])</span>
  <span class="n">temp</span> <span class="o">=</span>  <span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,[</span><span class="mf">0.</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">Nitems</span><span class="p">)])</span>
  <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">scalarValues</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">__getattribute__</span><span class="p">(</span><span class="n">positionLabel</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
      <span class="n">l</span> <span class="o">=</span> <span class="n">li</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
      <span class="n">count</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
      <span class="n">temp</span><span class="p">[</span><span class="n">l</span><span class="p">]</span> <span class="o">+=</span> <span class="n">v</span><span class="o">.</span><span class="n">data</span>
  <span class="n">out_data</span><span class="p">,</span> <span class="n">out_labels</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,[])</span> <span class="p">,</span> <span class="n">array</span><span class="p">(</span><span class="n">dti</span><span class="p">,</span> <span class="p">[])</span>  
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">Nitems</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">count</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">out_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">count</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
      <span class="n">out_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
  <span class="c">#data = array(dtf,[temp[i]/count[i] for i in xrange(Nitems)])</span>
  <span class="n">out</span> <span class="o">=</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span><span class="n">out_data</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">out_labels</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span> <span class="p">)</span>
  <span class="k">return</span> <span class="n">out</span>
</div>
<div class="viewcode-block" id="GetVectorFieldOutput"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.GetVectorFieldOutput">[docs]</a><span class="k">def</span> <span class="nf">GetVectorFieldOutput</span><span class="p">(</span><span class="n">odb</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">dti</span><span class="o">=</span><span class="s">&#39;I&#39;</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Returns a VectorFieldOutput from an odb object.</span>
<span class="sd">  </span>
<span class="sd">  :param odb: odb object produced by odbAccess.openOdb in abaqus python or abaqus viewer -noGUI</span>
<span class="sd">  :type odb: odb object.</span>
<span class="sd">  :param step: step name defined in the abaqus inp file. May be the upper case version of original string name.</span>
<span class="sd">  :type step: string</span>
<span class="sd">  :param frame: requested frame indice in the odb.</span>
<span class="sd">  :type frame: int</span>
<span class="sd">  :param instance: instance name defined in the abaqus odb file. May be the upper case version of the original name. </span>
<span class="sd">  :type instance: string </span>
<span class="sd">  :param position: position at which the output is to be computed.</span>
<span class="sd">  :type position: &#39;node&#39;, &#39;element&#39;</span>
<span class="sd">  :param field: requested vector field output (&#39;U&#39;,...).</span>
<span class="sd">  :type field: string</span>
<span class="sd">  :param labels: if not None, it provides a set of locations (elements/nodes labels or node/element set label) where the field is to be computed. if None, every available location is used and labels are sorted</span>
<span class="sd">  :type labels: list, array.array, numpy.array of unsigned non zero ints or string</span>
<span class="sd">  :param dti: int data type in ``array.array``</span>
<span class="sd">  :type dti: &#39;I&#39;, &#39;H&#39;</span>
<span class="sd">  :rtype: ``VectorFieldOutput`` instance</span>
<span class="sd">  </span>
<span class="sd">  .. note:: This function can only be executed in abaqus python or abaqus viewer -noGUI</span>
<span class="sd">  </span>
<span class="sd">  &gt;&gt;&gt; from abapy.postproc import GetFieldOutput, GetVectorFieldOutput</span>
<span class="sd">  &gt;&gt;&gt; from odbAccess import openOdb</span>
<span class="sd">  &gt;&gt;&gt; odb = openOdb(&#39;indentation.odb&#39;)</span>
<span class="sd">  &gt;&gt;&gt; U = GetVectorFieldOutput(odb, step = &#39;LOADING&#39;, frame = -1, instance =&#39;I_SAMPLE&#39;, position =  &#39;node&#39;, field = &#39;U&#39;) </span>
<span class="sd">  &gt;&gt;&gt; odb.close()</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="c"># First we need to find the number of components: if we are in 3D, it should be 3, in 2D it will be 2.</span>
  <span class="n">components</span> <span class="o">=</span> <span class="n">odb</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">step</span><span class="p">]</span><span class="o">.</span><span class="n">frames</span><span class="p">[</span><span class="n">frame</span><span class="p">]</span><span class="o">.</span><span class="n">fieldOutputs</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">componentLabels</span>
  <span class="n">comp_number</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
  <span class="c"># Now let&#39;s find the data we need</span>
  <span class="n">Field</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">ncomp</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">comp_number</span><span class="p">):</span>
    <span class="n">Field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">GetFieldOutput</span><span class="p">(</span><span class="n">odb</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="n">step</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="p">,</span> <span class="n">instance</span> <span class="o">=</span> <span class="n">instance</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span>  <span class="n">position</span> <span class="p">,</span> <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="p">,</span> <span class="n">subField</span><span class="o">=</span> <span class="n">components</span><span class="p">[</span><span class="n">ncomp</span><span class="p">],</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span> <span class="p">)</span>  <span class="p">)</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">VectorFieldOutput</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span> <span class="n">data1</span> <span class="o">=</span> <span class="n">Field</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="n">data2</span> <span class="o">=</span> <span class="n">Field</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>  
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">VectorFieldOutput</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span> <span class="n">data1</span> <span class="o">=</span> <span class="n">Field</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="n">data2</span> <span class="o">=</span> <span class="n">Field</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data3</span> <span class="o">=</span> <span class="n">Field</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>  

</div>
<div class="viewcode-block" id="GetTensorFieldOutput"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.GetTensorFieldOutput">[docs]</a><span class="k">def</span> <span class="nf">GetTensorFieldOutput</span><span class="p">(</span><span class="n">odb</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">dti</span><span class="o">=</span><span class="s">&#39;I&#39;</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Returns a TensorFieldOutput from an odb object.</span>
<span class="sd">  </span>
<span class="sd">  :param odb: odb object produced by odbAccess.openOdb in abaqus python or abaqus viewer -noGUI</span>
<span class="sd">  :type odb: odb object.</span>
<span class="sd">  :param step: step name defined in the abaqus inp file. May be the upper case version of original string name.</span>
<span class="sd">  :type step: string</span>
<span class="sd">  :param frame: requested frame indice in the odb.</span>
<span class="sd">  :type frame: int</span>
<span class="sd">  :param instance: instance name defined in the abaqus odb file. May be the upper case version of the original name. </span>
<span class="sd">  :type instance: string </span>
<span class="sd">  :param position: position at which the output is to be computed.</span>
<span class="sd">  :type position: &#39;node&#39;, &#39;element&#39;</span>
<span class="sd">  :param field: requested tensor field output (&#39;LE&#39;,&#39;S&#39;,...).</span>
<span class="sd">  :type field: string</span>
<span class="sd">  :param labels: if not None, it provides a set of locations (elements/nodes labels or node/element set label) where the field is to be computed. if None, every available location is used and labels are sorted</span>
<span class="sd">  :type labels: list, array.array, numpy.array of unsigned non zero ints or string</span>
<span class="sd">  :param dti: int data type in ``array.array``</span>
<span class="sd">  :type dti: &#39;I&#39;, &#39;H&#39;</span>
<span class="sd">  :rtype: ``TensorFieldOutput`` instance</span>
<span class="sd">  </span>
<span class="sd">  .. note:: This function can only be executed in abaqus python or abaqus viewer -noGUI</span>
<span class="sd">  </span>
<span class="sd">  &gt;&gt;&gt; from abapy.postproc import GetFieldOutput, GetVectorFieldOutput, GetTensorFieldOutput</span>
<span class="sd">  &gt;&gt;&gt; from odbAccess import openOdb</span>
<span class="sd">  &gt;&gt;&gt; odb = openOdb(&#39;indentation.odb&#39;)</span>
<span class="sd">  &gt;&gt;&gt; S = GetTensorFieldOutput(odb, step = &#39;LOADING&#39;, frame = -1, instance =&#39;I_SAMPLE&#39;, position =  &#39;node&#39;, field = &#39;S&#39;)</span>
<span class="sd">  &gt;&gt;&gt; odb.close()</span>
<span class="sd">  </span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="c"># First we need to find the number of components: if we are in 3D, it should be 6, in 2D it will be 4.</span>
  <span class="n">components</span> <span class="o">=</span> <span class="n">odb</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">step</span><span class="p">]</span><span class="o">.</span><span class="n">frames</span><span class="p">[</span><span class="n">frame</span><span class="p">]</span><span class="o">.</span><span class="n">fieldOutputs</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">componentLabels</span>
  <span class="n">comp_number</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">components</span><span class="p">)</span>
  <span class="c"># Now let&#39;s find the data we need</span>
  <span class="n">Field</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">ncomp</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">comp_number</span><span class="p">):</span>
    <span class="n">Field</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">GetFieldOutput</span><span class="p">(</span><span class="n">odb</span><span class="p">,</span> <span class="n">step</span> <span class="o">=</span> <span class="n">step</span><span class="p">,</span> <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="p">,</span> <span class="n">instance</span> <span class="o">=</span> <span class="n">instance</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span>  <span class="n">position</span> <span class="p">,</span> <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="p">,</span> <span class="n">subField</span><span class="o">=</span> <span class="n">components</span><span class="p">[</span><span class="n">ncomp</span><span class="p">]</span> <span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span> <span class="p">)</span>  <span class="p">)</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">TensorFieldOutput</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span> <span class="n">data11</span> <span class="o">=</span> <span class="n">Field</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data22</span> <span class="o">=</span> <span class="n">Field</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data33</span> <span class="o">=</span> <span class="n">Field</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">data12</span> <span class="o">=</span> <span class="n">Field</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>  
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">TensorFieldOutput</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span> <span class="n">data11</span> <span class="o">=</span> <span class="n">Field</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">data22</span> <span class="o">=</span> <span class="n">Field</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data33</span> <span class="o">=</span> <span class="n">Field</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">data12</span> <span class="o">=</span> <span class="n">Field</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">data13</span> <span class="o">=</span> <span class="n">Field</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">data23</span> <span class="o">=</span> <span class="n">Field</span><span class="p">[</span><span class="mi">5</span><span class="p">])</span>  

</div>
<div class="viewcode-block" id="MakeFieldOutputReport"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.MakeFieldOutputReport">[docs]</a><span class="k">def</span> <span class="nf">MakeFieldOutputReport</span><span class="p">(</span><span class="n">odb</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">report_name</span><span class="p">,</span> <span class="n">original_position</span><span class="p">,</span> <span class="n">new_position</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">sub_field</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">sub_set_type</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">sub_set</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Writes a field output report using Abaqus. The major interrest of this function is that it is really fast compared to ``GetFieldOutput`` which tends to get badly slow on odbs containing more than 1500 elements. One other interrest is that it doesn&#39;t require to used ``position = nodes`` option in the INP file to evaluate fields at nodes. It is especially efficient when averaging is necessary (example: computing stress at nodes). The two drawbacks are that it requires ``abaqus viewer`` (or ``cae``) using the ``-noGUI`` where GetFieldOutput only requires ``abaqus python`` so it depends on the license server lag (which can be of several seconds). The second drawback is that it requires to write a file in place where you have write permission. This function is made to used in conjunction with ``ReadFieldOutputReport``. </span>
<span class="sd">  </span>
<span class="sd">  :param odb: output database to be used.</span>
<span class="sd">  :type odb: odb instance produced by ``odbAccess.openOdb``</span>
<span class="sd">  :param instance: instance to use.</span>
<span class="sd">  :type instance: string</span>
<span class="sd">  :param step: step to use, this argument can be either the step number or the step label.</span>
<span class="sd">  :type step: string or int</span>
<span class="sd">  :param frame: frame number, can be negative for reverse counting.</span>
<span class="sd">  :type frame: int</span>
<span class="sd">  :param report_name: name or path+name of the report to written.</span>
<span class="sd">  :type report_name: string</span>
<span class="sd">  :param original_position: position at which the field is expressed. Can be &#39;NODAL&#39;, &#39;WHOLE_ELEMENT&#39; or &#39;INTEGRATION_POINT&#39;.</span>
<span class="sd">  :type string:</span>
<span class="sd">  :param new_position: position at which you would like the field to be expressed. Can be &#39;NODAL&#39;, &#39;WHOLE_ELEMENT&#39; or &#39;INTEGRATION_POINT&#39; or &#39;ELEMENT_NODAL&#39;. Note that ``ReadFieldOutputReport`` will be capable of averaging values over elements when &#39;INTEGRATION_POINT&#39; or &#39;ELEMENT_NODAL&#39; option is sellected.</span>
<span class="sd">  :type new_position: string</span>
<span class="sd">  :param field: field to export, example: &#39;S&#39;, &#39;U&#39;, &#39;EVOL&#39;,...</span>
<span class="sd">  :type field: string</span>
<span class="sd">  :param sub_field: can be a component of an invariant, example: 11, 2, &#39;Mises&#39;, &#39;Magnitude&#39;. Here the use of &#39;Mises&#39; instead of &#39;MISES&#39; can be surprising that&#39;s the way abaqus is written..</span>
<span class="sd">  :type sub_field: string or int</span>
<span class="sd">  :param sub_set: set to which the report is restricted, must be the label of an existing node or element set.</span>
<span class="sd">  :type sub_set: string</span>
<span class="sd">  :param sub_set_type: type of the sub_set, can be node or element.</span>
<span class="sd">  :type sub_set_type: string</span>
<span class="sd">  </span>
<span class="sd">  </span>
<span class="sd">  All examples below are performed on a small indentation ODB: </span>
<span class="sd">  :download:`indentation.odb &lt;example_code/postproc/indentation.odb&gt;`</span>
<span class="sd">  </span>
<span class="sd">  &gt;&gt;&gt; from odbAccess import openOdb</span>
<span class="sd">  &gt;&gt;&gt; from abapy.postproc import MakeFieldOutputReport</span>
<span class="sd">  &gt;&gt;&gt; # Some settings</span>
<span class="sd">  &gt;&gt;&gt; odb_name = &#39;indentation.odb&#39;</span>
<span class="sd">  &gt;&gt;&gt; report_name = &#39;indentation_core_step0_frame1_S11_nodes.rpt&#39;</span>
<span class="sd">  &gt;&gt;&gt; step = 0</span>
<span class="sd">  &gt;&gt;&gt; frame = -1</span>
<span class="sd">  &gt;&gt;&gt; new_position = &#39;NODAL&#39;</span>
<span class="sd">  &gt;&gt;&gt; original_position = &#39;INTEGRATION_POINT&#39;</span>
<span class="sd">  &gt;&gt;&gt; field = &#39;S&#39;</span>
<span class="sd">  &gt;&gt;&gt; sub_field = 11</span>
<span class="sd">  &gt;&gt;&gt; instance = &#39;I_SAMPLE&#39;</span>
<span class="sd">  &gt;&gt;&gt; sub_set = &#39;CORE&#39;</span>
<span class="sd">  &gt;&gt;&gt; sub_set_type = &#39;element&#39;</span>
<span class="sd">  &gt;&gt;&gt; # Function testing</span>
<span class="sd">  &gt;&gt;&gt; odb = openOdb(odb_name)</span>
<span class="sd">  &gt;&gt;&gt; MakeFieldOutputReport(</span>
<span class="sd">  ...   odb = odb, </span>
<span class="sd">  ...   instance = instance, </span>
<span class="sd">  ...   step = step,</span>
<span class="sd">  ...   frame = frame,</span>
<span class="sd">  ...   report_name = report_name, </span>
<span class="sd">  ...   original_position = original_position, </span>
<span class="sd">  ...   new_position = new_position, </span>
<span class="sd">  ...   field = field, </span>
<span class="sd">  ...   sub_field = sub_field, </span>
<span class="sd">  ...   sub_set_type = sub_set_type, </span>
<span class="sd">  ...   sub_set = sub_set)</span>
<span class="sd">  &gt;&gt;&gt; new_position = &#39;INTEGRATION_POINT&#39;</span>
<span class="sd">  &gt;&gt;&gt; report_name = &#39;indentation_core_step0_frame1_S11_elements.rpt&#39;   </span>
<span class="sd">  &gt;&gt;&gt; MakeFieldOutputReport(</span>
<span class="sd">  ...   odb = odb, </span>
<span class="sd">  ...   instance = instance, </span>
<span class="sd">  ...   step = step,</span>
<span class="sd">  ...   frame = frame,</span>
<span class="sd">  ...   report_name = report_name, </span>
<span class="sd">  ...   original_position = original_position, </span>
<span class="sd">  ...   new_position = new_position, </span>
<span class="sd">  ...   field = field, </span>
<span class="sd">  ...   sub_field = sub_field, </span>
<span class="sd">  ...   sub_set_type = sub_set_type, </span>
<span class="sd">  ...   sub_set = sub_set)</span>
<span class="sd">  &gt;&gt;&gt; new_position = &#39;ELEMENT_NODAL&#39;</span>
<span class="sd">  &gt;&gt;&gt; report_name = &#39;indentation_core_step0_frame1_S11_element-nodal.rpt&#39;   </span>
<span class="sd">  &gt;&gt;&gt; MakeFieldOutputReport(</span>
<span class="sd">  ...   odb = odb, </span>
<span class="sd">  ...   instance = instance, </span>
<span class="sd">  ...   step = step,</span>
<span class="sd">  ...   frame = frame,</span>
<span class="sd">  ...   report_name = report_name, </span>
<span class="sd">  ...   original_position = original_position, </span>
<span class="sd">  ...   new_position = new_position, </span>
<span class="sd">  ...   field = field, </span>
<span class="sd">  ...   sub_field = sub_field, </span>
<span class="sd">  ...   sub_set_type = sub_set_type, </span>
<span class="sd">  ...   sub_set = sub_set)</span>
<span class="sd">  &gt;&gt;&gt; field = &#39;U&#39;</span>
<span class="sd">  &gt;&gt;&gt; sub_field = &#39;Magnitude&#39;</span>
<span class="sd">  &gt;&gt;&gt; original_position = &#39;NODAL&#39;</span>
<span class="sd">  &gt;&gt;&gt; new_position = &#39;NODAL&#39;</span>
<span class="sd">  &gt;&gt;&gt; report_name = &#39;indentation_core_step0_frame1_U-MAG_nodal.rpt&#39;   </span>
<span class="sd">  &gt;&gt;&gt; MakeFieldOutputReport(</span>
<span class="sd">  ...   odb = odb, </span>
<span class="sd">  ...   instance = instance, </span>
<span class="sd">  ...   step = step,</span>
<span class="sd">  ...   frame = frame,</span>
<span class="sd">  ...   report_name = report_name, </span>
<span class="sd">  ...   original_position = original_position, </span>
<span class="sd">  ...   new_position = new_position, </span>
<span class="sd">  ...   field = field, </span>
<span class="sd">  ...   sub_field = sub_field, </span>
<span class="sd">  ...   sub_set_type = sub_set_type, </span>
<span class="sd">  ...   sub_set = sub_set)</span>
<span class="sd">  </span>
<span class="sd">  </span>
<span class="sd">  Four reports were produced:</span>
<span class="sd">    *  :download:`indentation_core_step0_frame1_S11_nodes.rpt &lt;example_code/postproc/indentation_core_step0_frame1_S11_nodes.rpt&gt;`</span>
<span class="sd">    *  :download:`indentation_core_step0_frame1_S11_elements.rpt &lt;example_code/postproc/indentation_core_step0_frame1_S11_elements.rpt&gt;`</span>
<span class="sd">    *  :download:`indentation_core_step0_frame1_S11_element-nodal.rpt &lt;example_code/postproc/indentation_core_step0_frame1_S11_element-nodal.rpt&gt;`</span>
<span class="sd">    *  :download:`indentation_core_step0_frame1_U-MAG_nodal.rpt &lt;example_code/postproc/indentation_core_step0_frame1_U-MAG_nodal.rpt&gt;`</span>
<span class="sd">  </span>
<span class="sd">  </span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="kn">from</span> <span class="nn">abaqus</span> <span class="kn">import</span> <span class="n">session</span><span class="p">,</span> <span class="n">NumberFormat</span>
  <span class="kn">import</span> <span class="nn">visualization</span>
  <span class="kn">import</span> <span class="nn">displayGroupOdbToolset</span> <span class="kn">as</span> <span class="nn">dgo</span>
  <span class="kn">from</span> <span class="nn">abaqusConstants</span> <span class="kn">import</span> <span class="n">NODAL</span><span class="p">,</span> <span class="n">INTEGRATION_POINT</span><span class="p">,</span> <span class="n">COMPONENT</span><span class="p">,</span> <span class="n">INVARIANT</span><span class="p">,</span> <span class="n">WHOLE_ELEMENT</span><span class="p">,</span> <span class="n">ELEMENT_CENTROID</span><span class="p">,</span> <span class="n">ELEMENT_NODAL</span><span class="p">,</span> <span class="n">OFF</span><span class="p">,</span> <span class="n">ENGINEERING</span>
  <span class="c">#import pickle</span>
  <span class="k">if</span> <span class="n">original_position</span> <span class="o">==</span> <span class="s">&#39;INTEGRATION_POINT&#39;</span><span class="p">:</span> <span class="n">original_abqposition</span> <span class="o">=</span> <span class="n">INTEGRATION_POINT</span>
  <span class="k">if</span> <span class="n">original_position</span> <span class="o">==</span> <span class="s">&#39;NODAL&#39;</span><span class="p">:</span> <span class="n">original_abqposition</span> <span class="o">=</span> <span class="n">NODAL</span>
  <span class="k">if</span> <span class="n">original_position</span> <span class="o">==</span> <span class="s">&#39;WHOLE_ELEMENT&#39;</span><span class="p">:</span> <span class="n">original_abqposition</span> <span class="o">=</span> <span class="n">WHOLE_ELEMENT</span>
  <span class="k">if</span> <span class="n">new_position</span> <span class="o">==</span> <span class="s">&#39;NODAL&#39;</span><span class="p">:</span>
    <span class="n">new_abqposition</span> <span class="o">=</span> <span class="n">NODAL</span>
    <span class="n">sortItem</span> <span class="o">=</span> <span class="s">&#39;Node Label&#39;</span>
  <span class="k">if</span> <span class="n">new_position</span> <span class="o">==</span> <span class="s">&#39;ELEMENT_NODAL&#39;</span><span class="p">:</span>
    <span class="n">new_abqposition</span> <span class="o">=</span> <span class="n">ELEMENT_NODAL</span>
    <span class="n">sortItem</span> <span class="o">=</span> <span class="s">&#39;Node Label&#39;</span>
  <span class="k">if</span> <span class="n">new_position</span> <span class="o">==</span> <span class="s">&#39;WHOLE_ELEMENT&#39;</span><span class="p">:</span>
    <span class="n">new_abqposition</span> <span class="o">=</span> <span class="n">WHOLE_ELEMENT</span>
    <span class="n">sortItem</span> <span class="o">=</span> <span class="s">&#39;Element Label&#39;</span>
  <span class="k">if</span> <span class="n">new_position</span> <span class="o">==</span> <span class="s">&#39;INTEGRATION_POINT&#39;</span><span class="p">:</span>
    <span class="n">new_abqposition</span> <span class="o">=</span> <span class="n">INTEGRATION_POINT</span>
    <span class="n">sortItem</span> <span class="o">=</span> <span class="s">&#39;Element Label&#39;</span>
  <span class="n">variable</span> <span class="o">=</span> <span class="p">[</span><span class="n">field</span><span class="p">]</span>
  <span class="n">variable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">original_abqposition</span><span class="p">)</span>
  <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">step</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span> <span class="n">step</span> <span class="o">=</span> <span class="n">odb</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">step</span><span class="p">)</span> 
  <span class="k">if</span> <span class="n">sub_field</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sub_field</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
      <span class="n">sub_field_type</span> <span class="o">=</span> <span class="n">COMPONENT</span>
      <span class="n">sub_field_flag</span> <span class="o">=</span> <span class="n">field</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">sub_field</span><span class="p">)</span> 
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sub_field</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
      <span class="n">sub_field_type</span> <span class="o">=</span> <span class="n">INVARIANT</span>
      <span class="n">sub_field_flag</span> <span class="o">=</span> <span class="n">sub_field</span>
    <span class="n">variable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span> <span class="p">(</span><span class="n">sub_field_type</span><span class="p">,</span> <span class="n">sub_field_flag</span><span class="p">)</span> <span class="p">,</span> <span class="p">)</span> <span class="p">)</span>  
  <span class="c">#print variable  </span>
  <span class="k">if</span> <span class="n">sub_set</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">leaf</span> <span class="o">=</span> <span class="n">dgo</span><span class="o">.</span><span class="n">LeafFromPartInstance</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">sub_set_type</span> <span class="o">==</span> <span class="s">&#39;node&#39;</span><span class="p">:</span>
      <span class="n">leaf</span> <span class="o">=</span> <span class="n">dgo</span><span class="o">.</span><span class="n">LeafFromNodeSets</span><span class="p">(</span><span class="n">instance</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">sub_set</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sub_set_type</span> <span class="o">==</span> <span class="s">&#39;element&#39;</span><span class="p">:</span>
      <span class="n">leaf</span> <span class="o">=</span> <span class="n">dgo</span><span class="o">.</span><span class="n">LeafFromElementSets</span><span class="p">(</span><span class="n">instance</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> <span class="o">+</span> <span class="n">sub_set</span><span class="p">)</span>
  
  <span class="k">if</span> <span class="n">frame</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">frames_list</span> <span class="o">=</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">odb</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span> <span class="n">odb</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="n">step</span><span class="p">]</span> <span class="p">]</span><span class="o">.</span><span class="n">frames</span><span class="p">))</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">frames_list</span><span class="p">[</span><span class="n">frame</span><span class="p">]</span>
  <span class="n">session</span><span class="o">.</span><span class="n">viewports</span><span class="p">[</span><span class="s">&#39;Viewport: 1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">setValues</span><span class="p">(</span><span class="n">displayedObject</span><span class="o">=</span><span class="n">odb</span><span class="p">)</span>
  <span class="n">dg</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">viewports</span><span class="p">[</span><span class="s">&#39;Viewport: 1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">odbDisplay</span><span class="o">.</span><span class="n">displayGroup</span>
  <span class="n">dg</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">DisplayGroup</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;Dummy&#39;</span><span class="p">,</span> <span class="n">leaf</span> <span class="o">=</span> <span class="n">leaf</span><span class="p">)</span>
  <span class="n">session</span><span class="o">.</span><span class="n">viewports</span><span class="p">[</span><span class="s">&#39;Viewport: 1&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">odbDisplay</span><span class="o">.</span><span class="n">setValues</span><span class="p">(</span><span class="n">visibleDisplayGroups</span><span class="o">=</span><span class="p">(</span><span class="n">dg</span><span class="p">,</span> <span class="p">))</span>
  <span class="n">odb</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">odbs</span><span class="p">[</span><span class="n">odb</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
  <span class="n">session</span><span class="o">.</span><span class="n">fieldReportOptions</span><span class="o">.</span><span class="n">setValues</span><span class="p">(</span>
    <span class="n">printTotal</span> <span class="o">=</span> <span class="n">OFF</span><span class="p">,</span> 
    <span class="n">printMinMax</span> <span class="o">=</span> <span class="n">OFF</span><span class="p">)</span>
  <span class="n">nf</span> <span class="o">=</span> <span class="n">NumberFormat</span><span class="p">(</span><span class="n">numDigits</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">format</span><span class="o">=</span><span class="n">ENGINEERING</span><span class="p">)</span>
  <span class="n">session</span><span class="o">.</span><span class="n">writeFieldReport</span><span class="p">(</span>
    <span class="n">fileName</span><span class="o">=</span><span class="n">report_name</span><span class="p">,</span> 
    <span class="n">append</span><span class="o">=</span><span class="n">OFF</span><span class="p">,</span> 
    <span class="n">sortItem</span><span class="o">=</span><span class="n">sortItem</span><span class="p">,</span> 
    <span class="n">odb</span><span class="o">=</span><span class="n">odb</span><span class="p">,</span> 
    <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="p">,</span> 
    <span class="n">frame</span><span class="o">=</span><span class="n">frame</span><span class="p">,</span> 
    <span class="n">outputPosition</span><span class="o">=</span><span class="n">new_abqposition</span><span class="p">,</span> 
    <span class="n">variable</span><span class="o">=</span><span class="p">(</span><span class="n">variable</span><span class="p">,)</span>
    <span class="p">)</span>
</div>
<div class="viewcode-block" id="ReadFieldOutputReport"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.ReadFieldOutputReport">[docs]</a><span class="k">def</span> <span class="nf">ReadFieldOutputReport</span><span class="p">(</span><span class="n">report_name</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="s">&#39;node&#39;</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="s">&#39;I&#39;</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="s">&#39;f&#39;</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Reads a report file generated by Abaqus (for example using ``MakeFieldOutputReport`` and converts it in FieldOutputFormat.</span>
<span class="sd">  </span>
<span class="sd">  :param report_name: report_name or path + name of the report to read.</span>
<span class="sd">  :type report_name: string</span>
<span class="sd">  :param position: position where the ``FieldOutput`` is to be declared. The function will look at the first and the last column of the report. The first will be considered as the label (*i. e.* element or node) and the last the value. In some case, like reports written using &#39;ELEMENT_NODAL&#39; or &#39;INTEGRATION_POINT&#39; locations, each label will appear several times. The present function will collect all the corresponding values and average them. At the end, the only possibilities for this parameter should be &#39;node&#39; or &#39;element&#39; as described in the doc of ``FieldOutput``.</span>
<span class="sd">  :type position: &#39;node&#39; or &#39;element&#39;</span>
<span class="sd">  :param dti: int data type in array.array</span>
<span class="sd">  :type dti: &#39;I&#39;, &#39;H&#39;</span>
<span class="sd">  :param dtf: float data type in array.array</span>
<span class="sd">  :type dtf: &#39;f&#39;, &#39;d&#39;</span>
<span class="sd">  :rtype: ``FieldOutput`` instance.</span>
<span class="sd">  </span>
<span class="sd">  .. note:: This function can be run either in abaqus python, abaqus viewer -noGUI, abaqus cae -noGUI and regular python.</span>
<span class="sd">  </span>
<span class="sd">  &gt;&gt;&gt; from abapy.postproc import ReadFieldOutputReport</span>
<span class="sd">  &gt;&gt;&gt; report_name = &#39;indentation_core_step0_frame1_S11_nodes.rpt&#39;</span>
<span class="sd">  &gt;&gt;&gt; S11 = ReadFieldOutputReport(report_name, position = &#39;nodes&#39;, dti = &#39;I&#39;, dtf = &#39;f&#39;)</span>
<span class="sd">  &#39;&#39;&#39;</span>
  
  <span class="kn">from</span> <span class="nn">abapy.postproc</span> <span class="kn">import</span> <span class="n">FieldOutput</span>
  <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
  <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">report_name</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
  <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span> 
  <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
  <span class="n">labels</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span> <span class="n">dti</span><span class="p">,</span> <span class="p">[]</span> <span class="p">)</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span> <span class="n">dtf</span> <span class="p">,</span> <span class="p">[]</span> <span class="p">)</span>
  <span class="n">counter</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span> <span class="n">dti</span><span class="p">,</span> <span class="p">[]</span> <span class="p">)</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>
    <span class="n">line</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">label</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="n">value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">words</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="k">pass</span>  
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="n">counter</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
        <span class="n">counter</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">data</span><span class="p">[</span><span class="n">pos</span><span class="p">]</span> <span class="o">+=</span> <span class="n">value</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
    <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="n">counter</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
  <span class="k">return</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>      
</div>
<div class="viewcode-block" id="GetFieldOutput_byRpt"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.GetFieldOutput_byRpt">[docs]</a><span class="k">def</span> <span class="nf">GetFieldOutput_byRpt</span><span class="p">(</span><span class="n">odb</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">original_position</span><span class="p">,</span> <span class="n">new_position</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">sub_field</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">sub_set_type</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">sub_set</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">report_name</span> <span class="o">=</span> <span class="s">&#39;dummy.rpt&#39;</span><span class="p">,</span> <span class="n">dti</span><span class="o">=</span> <span class="s">&#39;I&#39;</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="n">delete_report</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Wraps ``MakeFieldOutputReport`` and ``ReadFieldOutputReport`` in a single function to mimic the behavior ``GetFieldOutput``.</span>
<span class="sd">  </span>
<span class="sd">  :param odb: output database to be used.</span>
<span class="sd">  :type odb: odb instance produced by ``odbAccess.openOdb``</span>
<span class="sd">  :param instance: instance to use.</span>
<span class="sd">  :type instance: string</span>
<span class="sd">  :param step: step to use, this argument can be either the step number or the step label.</span>
<span class="sd">  :type step: string or int</span>
<span class="sd">  :param frame: frame number, can be negative for reverse counting.</span>
<span class="sd">  :type frame: int</span>
<span class="sd">  :param original_position: position at which the field is expressed. Can be &#39;NODAL&#39;, &#39;WHOLE_ELEMENT&#39; or &#39;INTEGRATION_POINT&#39;.</span>
<span class="sd">  :type string:</span>
<span class="sd">  :param new_position: position at which you would like the field to be expressed. Can be &#39;NODAL&#39;, &#39;WHOLE_ELEMENT&#39; or &#39;INTEGRATION_POINT&#39; or &#39;ELEMENT_NODAL&#39;. Note that ``ReadFieldOutputReport`` will be capable of averaging values over elements when &#39;INTEGRATION_POINT&#39; or &#39;ELEMENT_NODAL&#39; option is sellected.</span>
<span class="sd">  :type new_position: string</span>
<span class="sd">  :param position: position where the ``FieldOutput`` is to be declared. The function will look at the first and the last column of the report. The first will be considered as the label (*i. e.* element or node) and the last the value. In some case, like reports written using &#39;ELEMENT_NODAL&#39; or &#39;INTEGRATION_POINT&#39; locations, each label will appear several times. The present function will collect all the corresponding values and average them. At the end, the only possibilities for this parameter should be &#39;node&#39; or &#39;element&#39; as described in the doc of ``FieldOutput``.</span>
<span class="sd">  :type position: &#39;node&#39; or &#39;element&#39;</span>
<span class="sd">  :param field: field to export, example: &#39;S&#39;, &#39;U&#39;, &#39;EVOL&#39;,...</span>
<span class="sd">  :type field: string</span>
<span class="sd">  :param sub_field: can be a component of an invariant, example: 11, 2, &#39;Mises&#39;, &#39;Magnitude&#39;. </span>
<span class="sd">  :type sub_field: string or int</span>
<span class="sd">  :param sub_set: set to which the report is restricted, must be the label of an existing node or element set.</span>
<span class="sd">  :type sub_set: string</span>
<span class="sd">  :param sub_set_type: type of the sub_set, can be node or element.</span>
<span class="sd">  :type sub_set_type: string</span>
<span class="sd">  :param report_name: name or path+name of the report to written.</span>
<span class="sd">  :type report_name: string</span>
<span class="sd">  :param dti: int data type in array.array</span>
<span class="sd">  :type dti: &#39;I&#39;, &#39;H&#39;</span>
<span class="sd">  :param dtf: float data type in array.array</span>
<span class="sd">  :type dtf: &#39;f&#39;, &#39;d&#39;</span>
<span class="sd">  :param delete_report: if True, report will be deleted, if false, it will remain.</span>
<span class="sd">  :type delete_report: boolean</span>
<span class="sd">  :rtype: ``FieldOutput`` instance.</span>
<span class="sd">  </span>
<span class="sd">  &gt;&gt;&gt; from odbAccess import openOdb</span>
<span class="sd">  &gt;&gt;&gt; from abapy.postproc import GetFieldOutput_byRpt</span>
<span class="sd">  &gt;&gt;&gt; odb_name = &#39;indentation.odb&#39;</span>
<span class="sd">  &gt;&gt;&gt; odb = openOdb(odb_name)</span>
<span class="sd">  &gt;&gt;&gt; S11 = GetFieldOutput_byRpt(</span>
<span class="sd">  ...   odb = odb, </span>
<span class="sd">  ...   instance = &#39;I_SAMPLE&#39;, </span>
<span class="sd">  ...   step = 0,</span>
<span class="sd">  ...   frame = -1,</span>
<span class="sd">  ...   original_position = &#39;INTEGRATION_POINT&#39;, </span>
<span class="sd">  ...   new_position = &#39;NODAL&#39;, </span>
<span class="sd">  ...   position = &#39;node&#39;,</span>
<span class="sd">  ...   field = &#39;S&#39;, </span>
<span class="sd">  ...   sub_field = 11, </span>
<span class="sd">  ...   sub_set_type = &#39;element&#39;, </span>
<span class="sd">  ...   sub_set = &#39;CORE&#39;,</span>
<span class="sd">  ...   delete_report = False)</span>

<span class="sd">  &#39;&#39;&#39;</span>
  <span class="kn">import</span> <span class="nn">os</span>
  <span class="n">MakeFieldOutputReport</span><span class="p">(</span>
    <span class="n">odb</span> <span class="o">=</span> <span class="n">odb</span><span class="p">,</span> 
    <span class="n">instance</span> <span class="o">=</span> <span class="n">instance</span><span class="p">,</span> 
    <span class="n">step</span> <span class="o">=</span> <span class="n">step</span><span class="p">,</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="p">,</span>
    <span class="n">report_name</span> <span class="o">=</span> <span class="n">report_name</span><span class="p">,</span> 
    <span class="n">original_position</span> <span class="o">=</span> <span class="n">original_position</span><span class="p">,</span> 
    <span class="n">new_position</span> <span class="o">=</span> <span class="n">new_position</span><span class="p">,</span> 
    <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="p">,</span> 
    <span class="n">sub_field</span> <span class="o">=</span> <span class="n">sub_field</span><span class="p">,</span> 
    <span class="n">sub_set_type</span> <span class="o">=</span> <span class="n">sub_set_type</span><span class="p">,</span> 
    <span class="n">sub_set</span> <span class="o">=</span> <span class="n">sub_set</span><span class="p">)</span>
  <span class="n">field</span> <span class="o">=</span> <span class="n">ReadFieldOutputReport</span><span class="p">(</span>
    <span class="n">report_name</span> <span class="o">=</span> <span class="n">report_name</span><span class="p">,</span> 
    <span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span>
    <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span>
    <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">delete_report</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s">&#39;rm &#39;</span> <span class="o">+</span> <span class="n">report_name</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">field</span>
</div>
<div class="viewcode-block" id="GetVectorFieldOutput_byRpt"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.GetVectorFieldOutput_byRpt">[docs]</a><span class="k">def</span> <span class="nf">GetVectorFieldOutput_byRpt</span><span class="p">(</span><span class="n">odb</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">original_position</span><span class="p">,</span> <span class="n">new_position</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">sub_set_type</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">sub_set</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">report_name</span> <span class="o">=</span> <span class="s">&#39;dummy.rpt&#39;</span><span class="p">,</span> <span class="n">dti</span><span class="o">=</span> <span class="s">&#39;I&#39;</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="n">delete_report</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Uses ``GetFieldOutput_byRpt`` to produce VectorFieldOutput. </span>
<span class="sd">  </span>
<span class="sd">  :param odb: output database to be used.</span>
<span class="sd">  :type odb: odb instance produced by ``odbAccess.openOdb``</span>
<span class="sd">  :param instance: instance to use.</span>
<span class="sd">  :type instance: string</span>
<span class="sd">  :param step: step to use, this argument can be either the step number or the step label.</span>
<span class="sd">  :type step: string or int</span>
<span class="sd">  :param frame: frame number, can be negative for reverse counting.</span>
<span class="sd">  :type frame: int</span>
<span class="sd">  :param original_position: position at which the field is expressed. Can be &#39;NODAL&#39;, &#39;WHOLE_ELEMENT&#39; or &#39;INTEGRATION_POINT&#39;.</span>
<span class="sd">  :type string:</span>
<span class="sd">  :param new_position: position at which you would like the field to be expressed. Can be &#39;NODAL&#39;, &#39;WHOLE_ELEMENT&#39; or &#39;INTEGRATION_POINT&#39; or &#39;ELEMENT_NODAL&#39;. Note that ``ReadFieldOutputReport`` will be capable of averaging values over elements when &#39;INTEGRATION_POINT&#39; or &#39;ELEMENT_NODAL&#39; option is sellected.</span>
<span class="sd">  :type new_position: string</span>
<span class="sd">  :param position: position where the ``FieldOutput`` is to be declared. The function will look at the first and the last column of the report. The first will be considered as the label (*i. e.* element or node) and the last the value. In some case, like reports written using &#39;ELEMENT_NODAL&#39; or &#39;INTEGRATION_POINT&#39; locations, each label will appear several times. The present function will collect all the corresponding values and average them. At the end, the only possibilities for this parameter should be &#39;node&#39; or &#39;element&#39; as described in the doc of ``FieldOutput``.</span>
<span class="sd">  :type position: &#39;node&#39; or &#39;element&#39;</span>
<span class="sd">  :param field: field to export, example: &#39;S&#39;, &#39;U&#39;, &#39;EVOL&#39;,...</span>
<span class="sd">  :type field: string</span>
<span class="sd">  :param sub_set: set to which the report is restricted, must be the label of an existing node or element set.</span>
<span class="sd">  :type sub_set: string</span>
<span class="sd">  :param sub_set_type: type of the sub_set, can be node or element.</span>
<span class="sd">  :type sub_set_type: string</span>
<span class="sd">  :param report_name: name or path+name of the report to written.</span>
<span class="sd">  :type report_name: string</span>
<span class="sd">  :param dti: int data type in array.array</span>
<span class="sd">  :type dti: &#39;I&#39;, &#39;H&#39;</span>
<span class="sd">  :param dtf: float data type in array.array</span>
<span class="sd">  :type dtf: &#39;f&#39;, &#39;d&#39;</span>
<span class="sd">  :param delete_report: if True, report will be deleted, if false, it will remain.</span>
<span class="sd">  :type delete_report: boolean</span>
<span class="sd">  :rtype: ``VectorFieldOutput`` instance.</span>
<span class="sd">  </span>
<span class="sd">  &gt;&gt;&gt; from odbAccess import openOdb</span>
<span class="sd">  &gt;&gt;&gt; from abapy.postproc import GetVectorFieldOutput_byRpt</span>
<span class="sd">  &gt;&gt;&gt; odb_name = &#39;indentation.odb&#39;</span>
<span class="sd">  &gt;&gt;&gt; odb = openOdb(odb_name)</span>
<span class="sd">  &gt;&gt;&gt; U = GetVectorFieldOutput_byRpt(</span>
<span class="sd">  ...   odb = odb, </span>
<span class="sd">  ...   instance = &#39;I_SAMPLE&#39;, </span>
<span class="sd">  ...   step = 0,</span>
<span class="sd">  ...   frame = -1,</span>
<span class="sd">  ...   original_position = &#39;NODAL&#39;, </span>
<span class="sd">  ...   new_position = &#39;NODAL&#39;, </span>
<span class="sd">  ...   position = &#39;node&#39;,</span>
<span class="sd">  ...   field = &#39;U&#39;, </span>
<span class="sd">  ...   sub_set_type = &#39;element&#39;, </span>
<span class="sd">  ...   sub_set = &#39;CORE&#39;,</span>
<span class="sd">  ...   delete_report = True)</span>

<span class="sd">  &#39;&#39;&#39;</span>
  
  <span class="n">field1</span> <span class="o">=</span><span class="n">GetFieldOutput_byRpt</span><span class="p">(</span>
  <span class="n">odb</span> <span class="o">=</span> <span class="n">odb</span><span class="p">,</span> 
  <span class="n">instance</span> <span class="o">=</span> <span class="n">instance</span><span class="p">,</span> 
  <span class="n">step</span> <span class="o">=</span> <span class="n">step</span><span class="p">,</span>
  <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="p">,</span>
  <span class="n">original_position</span> <span class="o">=</span> <span class="n">original_position</span><span class="p">,</span> 
  <span class="n">new_position</span> <span class="o">=</span> <span class="n">new_position</span><span class="p">,</span> 
  <span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span>
  <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="p">,</span> 
  <span class="n">sub_field</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> 
  <span class="n">sub_set_type</span> <span class="o">=</span> <span class="n">sub_set_type</span><span class="p">,</span> 
  <span class="n">sub_set</span> <span class="o">=</span> <span class="n">sub_set</span><span class="p">,</span>
  <span class="n">delete_report</span> <span class="o">=</span> <span class="n">delete_report</span><span class="p">,</span>
  <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span>
  <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
  
  <span class="n">field2</span> <span class="o">=</span><span class="n">GetFieldOutput_byRpt</span><span class="p">(</span>
  <span class="n">odb</span> <span class="o">=</span> <span class="n">odb</span><span class="p">,</span> 
  <span class="n">instance</span> <span class="o">=</span> <span class="n">instance</span><span class="p">,</span> 
  <span class="n">step</span> <span class="o">=</span> <span class="n">step</span><span class="p">,</span>
  <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="p">,</span>
  <span class="n">original_position</span> <span class="o">=</span> <span class="n">original_position</span><span class="p">,</span> 
  <span class="n">new_position</span> <span class="o">=</span> <span class="n">new_position</span><span class="p">,</span> 
  <span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span>
  <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="p">,</span> 
  <span class="n">sub_field</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> 
  <span class="n">sub_set_type</span> <span class="o">=</span> <span class="n">sub_set_type</span><span class="p">,</span> 
  <span class="n">sub_set</span> <span class="o">=</span> <span class="n">sub_set</span><span class="p">,</span>
  <span class="n">delete_report</span> <span class="o">=</span> <span class="n">delete_report</span><span class="p">,</span>
  <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span>
  <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
  
  <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">step</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">stepLabel</span> <span class="o">=</span> <span class="n">odb</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="n">step</span><span class="p">]</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">stepLabel</span> <span class="o">=</span> <span class="n">step</span> <span class="c"># Merci Jonathan !</span>
  <span class="n">componentLabels</span> <span class="o">=</span> <span class="n">odb</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">stepLabel</span><span class="p">]</span><span class="o">.</span><span class="n">frames</span><span class="p">[</span><span class="n">frame</span><span class="p">]</span><span class="o">.</span><span class="n">fieldOutputs</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">componentLabels</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">componentLabels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
     
    <span class="n">field3</span> <span class="o">=</span><span class="n">GetFieldOutput_byRpt</span><span class="p">(</span>
    <span class="n">odb</span> <span class="o">=</span> <span class="n">odb</span><span class="p">,</span> 
    <span class="n">instance</span> <span class="o">=</span> <span class="n">instance</span><span class="p">,</span> 
    <span class="n">step</span> <span class="o">=</span> <span class="n">step</span><span class="p">,</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="p">,</span>
    <span class="n">original_position</span> <span class="o">=</span> <span class="n">original_position</span><span class="p">,</span> 
    <span class="n">new_position</span> <span class="o">=</span> <span class="n">new_position</span><span class="p">,</span> 
    <span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span>
    <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="p">,</span> 
    <span class="n">sub_field</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> 
    <span class="n">sub_set_type</span> <span class="o">=</span> <span class="n">sub_set_type</span><span class="p">,</span> 
    <span class="n">sub_set</span> <span class="o">=</span> <span class="n">sub_set</span><span class="p">,</span>
    <span class="n">delete_report</span> <span class="o">=</span> <span class="n">delete_report</span><span class="p">,</span>
    <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span>
    <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
  
    <span class="n">vector_field</span> <span class="o">=</span> <span class="n">VectorFieldOutput</span><span class="p">(</span>
      <span class="n">data1</span> <span class="o">=</span> <span class="n">field1</span><span class="p">,</span>
      <span class="n">data2</span> <span class="o">=</span> <span class="n">field2</span><span class="p">,</span>
      <span class="n">data3</span> <span class="o">=</span> <span class="n">field3</span><span class="p">,</span>
      <span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span>
      <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span>
      <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">vector_field</span> <span class="o">=</span> <span class="n">VectorFieldOutput</span><span class="p">(</span>
      <span class="n">data1</span> <span class="o">=</span> <span class="n">field1</span><span class="p">,</span>
      <span class="n">data2</span> <span class="o">=</span> <span class="n">field2</span><span class="p">,</span>
      <span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span>
      <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span>
      <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">vector_field</span>
  
</div>
<div class="viewcode-block" id="GetTensorFieldOutput_byRpt"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.GetTensorFieldOutput_byRpt">[docs]</a><span class="k">def</span> <span class="nf">GetTensorFieldOutput_byRpt</span><span class="p">(</span><span class="n">odb</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">original_position</span><span class="p">,</span> <span class="n">new_position</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">sub_set_type</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">sub_set</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">report_name</span> <span class="o">=</span> <span class="s">&#39;dummy.rpt&#39;</span><span class="p">,</span> <span class="n">dti</span><span class="o">=</span> <span class="s">&#39;I&#39;</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="n">delete_report</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Uses ``GetFieldOutput_byRpt`` to produce TensorFieldOutput. </span>
<span class="sd">  </span>
<span class="sd">  :param odb: output database to be used.</span>
<span class="sd">  :type odb: odb instance produced by ``odbAccess.openOdb``</span>
<span class="sd">  :param instance: instance to use.</span>
<span class="sd">  :type instance: string</span>
<span class="sd">  :param step: step to use, this argument can be either the step number or the step label.</span>
<span class="sd">  :type step: string or int</span>
<span class="sd">  :param frame: frame number, can be negative for reverse counting.</span>
<span class="sd">  :type frame: int</span>
<span class="sd">  :param original_position: position at which the field is expressed. Can be &#39;NODAL&#39;, &#39;WHOLE_ELEMENT&#39; or &#39;INTEGRATION_POINT&#39;.</span>
<span class="sd">  :type string:</span>
<span class="sd">  :param new_position: position at which you would like the field to be expressed. Can be &#39;NODAL&#39;, &#39;WHOLE_ELEMENT&#39; or &#39;INTEGRATION_POINT&#39; or &#39;ELEMENT_NODAL&#39;. Note that ``ReadFieldOutputReport`` will be capable of averaging values over elements when &#39;INTEGRATION_POINT&#39; or &#39;ELEMENT_NODAL&#39; option is sellected.</span>
<span class="sd">  :type new_position: string</span>
<span class="sd">  :param position: position where the ``FieldOutput`` is to be declared. The function will look at the first and the last column of the report. The first will be considered as the label (*i. e.* element or node) and the last the value. In some case, like reports written using &#39;ELEMENT_NODAL&#39; or &#39;INTEGRATION_POINT&#39; locations, each label will appear several times. The present function will collect all the corresponding values and average them. At the end, the only possibilities for this parameter should be &#39;node&#39; or &#39;element&#39; as described in the doc of ``FieldOutput``.</span>
<span class="sd">  :type position: &#39;node&#39; or &#39;element&#39;</span>
<span class="sd">  :param field: field to export, example: &#39;S&#39;, &#39;U&#39;, &#39;EVOL&#39;,...</span>
<span class="sd">  :type field: string</span>
<span class="sd">  :param sub_set: set to which the report is restricted, must be the label of an existing node or element set.</span>
<span class="sd">  :type sub_set: string</span>
<span class="sd">  :param sub_set_type: type of the sub_set, can be node or element.</span>
<span class="sd">  :type sub_set_type: string</span>
<span class="sd">  :param report_name: name or path+name of the report to written.</span>
<span class="sd">  :type report_name: string</span>
<span class="sd">  :param dti: int data type in array.array</span>
<span class="sd">  :type dti: &#39;I&#39;, &#39;H&#39;</span>
<span class="sd">  :param dtf: float data type in array.array</span>
<span class="sd">  :type dtf: &#39;f&#39;, &#39;d&#39;</span>
<span class="sd">  :param delete_report: if True, report will be deleted, if false, it will remain.</span>
<span class="sd">  :type delete_report: boolean</span>
<span class="sd">  :rtype: ``TensorFieldOutput`` instance.</span>
<span class="sd">  </span>
<span class="sd">  &gt;&gt;&gt; from odbAccess import openOdb</span>
<span class="sd">  &gt;&gt;&gt; from abapy.postproc import GetTensorFieldOutput_byRpt</span>
<span class="sd">  &gt;&gt;&gt; odb_name = &#39;indentation.odb&#39;</span>
<span class="sd">  &gt;&gt;&gt; odb = openOdb(odb_name)</span>
<span class="sd">  &gt;&gt;&gt; S = GetTensorFieldOutput_byRpt(</span>
<span class="sd">  ...   odb = odb, </span>
<span class="sd">  ...   instance = &#39;I_SAMPLE&#39;, </span>
<span class="sd">  ...   step = 0,</span>
<span class="sd">  ...   frame = -1,</span>
<span class="sd">  ...   original_position = &#39;INTEGRATION_POINT&#39;, </span>
<span class="sd">  ...   new_position = &#39;NODAL&#39;, </span>
<span class="sd">  ...   position = &#39;node&#39;,</span>
<span class="sd">  ...   field = &#39;S&#39;, </span>
<span class="sd">  ...   sub_set_type = &#39;element&#39;, </span>
<span class="sd">  ...   sub_set = &#39;CORE&#39;,</span>
<span class="sd">  ...   delete_report = True)</span>


<span class="sd">  &#39;&#39;&#39;</span>
  
  <span class="n">field11</span> <span class="o">=</span><span class="n">GetFieldOutput_byRpt</span><span class="p">(</span>
  <span class="n">odb</span> <span class="o">=</span> <span class="n">odb</span><span class="p">,</span> 
  <span class="n">instance</span> <span class="o">=</span> <span class="n">instance</span><span class="p">,</span> 
  <span class="n">step</span> <span class="o">=</span> <span class="n">step</span><span class="p">,</span>
  <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="p">,</span>
  <span class="n">original_position</span> <span class="o">=</span> <span class="n">original_position</span><span class="p">,</span> 
  <span class="n">new_position</span> <span class="o">=</span> <span class="n">new_position</span><span class="p">,</span> 
  <span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span>
  <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="p">,</span> 
  <span class="n">sub_field</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span> 
  <span class="n">sub_set_type</span> <span class="o">=</span> <span class="n">sub_set_type</span><span class="p">,</span> 
  <span class="n">sub_set</span> <span class="o">=</span> <span class="n">sub_set</span><span class="p">,</span>
  <span class="n">delete_report</span> <span class="o">=</span> <span class="n">delete_report</span><span class="p">,</span>
  <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span>
  <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
  
  <span class="n">field22</span> <span class="o">=</span><span class="n">GetFieldOutput_byRpt</span><span class="p">(</span>
  <span class="n">odb</span> <span class="o">=</span> <span class="n">odb</span><span class="p">,</span> 
  <span class="n">instance</span> <span class="o">=</span> <span class="n">instance</span><span class="p">,</span> 
  <span class="n">step</span> <span class="o">=</span> <span class="n">step</span><span class="p">,</span>
  <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="p">,</span>
  <span class="n">original_position</span> <span class="o">=</span> <span class="n">original_position</span><span class="p">,</span> 
  <span class="n">new_position</span> <span class="o">=</span> <span class="n">new_position</span><span class="p">,</span> 
  <span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span>
  <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="p">,</span> 
  <span class="n">sub_field</span> <span class="o">=</span> <span class="mi">22</span><span class="p">,</span> 
  <span class="n">sub_set_type</span> <span class="o">=</span> <span class="n">sub_set_type</span><span class="p">,</span> 
  <span class="n">sub_set</span> <span class="o">=</span> <span class="n">sub_set</span><span class="p">,</span>
  <span class="n">delete_report</span> <span class="o">=</span> <span class="n">delete_report</span><span class="p">,</span>
  <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span>
  <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
  
  <span class="n">field33</span> <span class="o">=</span><span class="n">GetFieldOutput_byRpt</span><span class="p">(</span>
  <span class="n">odb</span> <span class="o">=</span> <span class="n">odb</span><span class="p">,</span> 
  <span class="n">instance</span> <span class="o">=</span> <span class="n">instance</span><span class="p">,</span> 
  <span class="n">step</span> <span class="o">=</span> <span class="n">step</span><span class="p">,</span>
  <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="p">,</span>
  <span class="n">original_position</span> <span class="o">=</span> <span class="n">original_position</span><span class="p">,</span> 
  <span class="n">new_position</span> <span class="o">=</span> <span class="n">new_position</span><span class="p">,</span> 
  <span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span>
  <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="p">,</span> 
  <span class="n">sub_field</span> <span class="o">=</span> <span class="mi">33</span><span class="p">,</span> 
  <span class="n">sub_set_type</span> <span class="o">=</span> <span class="n">sub_set_type</span><span class="p">,</span> 
  <span class="n">sub_set</span> <span class="o">=</span> <span class="n">sub_set</span><span class="p">,</span>
  <span class="n">delete_report</span> <span class="o">=</span> <span class="n">delete_report</span><span class="p">,</span>
  <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span>
  <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
  
  <span class="n">field12</span> <span class="o">=</span><span class="n">GetFieldOutput_byRpt</span><span class="p">(</span>
  <span class="n">odb</span> <span class="o">=</span> <span class="n">odb</span><span class="p">,</span> 
  <span class="n">instance</span> <span class="o">=</span> <span class="n">instance</span><span class="p">,</span> 
  <span class="n">step</span> <span class="o">=</span> <span class="n">step</span><span class="p">,</span>
  <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="p">,</span>
  <span class="n">original_position</span> <span class="o">=</span> <span class="n">original_position</span><span class="p">,</span> 
  <span class="n">new_position</span> <span class="o">=</span> <span class="n">new_position</span><span class="p">,</span> 
  <span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span>
  <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="p">,</span> 
  <span class="n">sub_field</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> 
  <span class="n">sub_set_type</span> <span class="o">=</span> <span class="n">sub_set_type</span><span class="p">,</span> 
  <span class="n">sub_set</span> <span class="o">=</span> <span class="n">sub_set</span><span class="p">,</span>
  <span class="n">delete_report</span> <span class="o">=</span> <span class="n">delete_report</span><span class="p">,</span>
  <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span>
  <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
  
  <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">step</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
    <span class="n">stepLabel</span> <span class="o">=</span> <span class="n">odb</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="n">step</span><span class="p">]</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">stepLabel</span> <span class="o">=</span> <span class="n">step</span> <span class="c"># Merci Jonathan !</span>
  <span class="n">componentLabels</span> <span class="o">=</span> <span class="n">odb</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">stepLabel</span><span class="p">]</span><span class="o">.</span><span class="n">frames</span><span class="p">[</span><span class="n">frame</span><span class="p">]</span><span class="o">.</span><span class="n">fieldOutputs</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">componentLabels</span>
  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">componentLabels</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
     
    <span class="n">field13</span> <span class="o">=</span><span class="n">GetFieldOutput_byRpt</span><span class="p">(</span>
    <span class="n">odb</span> <span class="o">=</span> <span class="n">odb</span><span class="p">,</span> 
    <span class="n">instance</span> <span class="o">=</span> <span class="n">instance</span><span class="p">,</span> 
    <span class="n">step</span> <span class="o">=</span> <span class="n">step</span><span class="p">,</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="p">,</span>
    <span class="n">original_position</span> <span class="o">=</span> <span class="n">original_position</span><span class="p">,</span> 
    <span class="n">new_position</span> <span class="o">=</span> <span class="n">new_position</span><span class="p">,</span> 
    <span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span>
    <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="p">,</span> 
    <span class="n">sub_field</span> <span class="o">=</span> <span class="mi">13</span><span class="p">,</span> 
    <span class="n">sub_set_type</span> <span class="o">=</span> <span class="n">sub_set_type</span><span class="p">,</span> 
    <span class="n">sub_set</span> <span class="o">=</span> <span class="n">sub_set</span><span class="p">,</span>
    <span class="n">delete_report</span> <span class="o">=</span> <span class="n">delete_report</span><span class="p">,</span>
    <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span>
    <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    
    <span class="n">field23</span> <span class="o">=</span><span class="n">GetFieldOutput_byRpt</span><span class="p">(</span>
    <span class="n">odb</span> <span class="o">=</span> <span class="n">odb</span><span class="p">,</span> 
    <span class="n">instance</span> <span class="o">=</span> <span class="n">instance</span><span class="p">,</span> 
    <span class="n">step</span> <span class="o">=</span> <span class="n">step</span><span class="p">,</span>
    <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="p">,</span>
    <span class="n">original_position</span> <span class="o">=</span> <span class="n">original_position</span><span class="p">,</span> 
    <span class="n">new_position</span> <span class="o">=</span> <span class="n">new_position</span><span class="p">,</span> 
    <span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span>
    <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="p">,</span> 
    <span class="n">sub_field</span> <span class="o">=</span> <span class="mi">23</span><span class="p">,</span> 
    <span class="n">sub_set_type</span> <span class="o">=</span> <span class="n">sub_set_type</span><span class="p">,</span> 
    <span class="n">sub_set</span> <span class="o">=</span> <span class="n">sub_set</span><span class="p">,</span>
    <span class="n">delete_report</span> <span class="o">=</span> <span class="n">delete_report</span><span class="p">,</span>
    <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span>
    <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
  
    <span class="n">tensor_field</span> <span class="o">=</span> <span class="n">TensorFieldOutput</span><span class="p">(</span>
      <span class="n">data11</span> <span class="o">=</span> <span class="n">field11</span><span class="p">,</span>
      <span class="n">data22</span> <span class="o">=</span> <span class="n">field22</span><span class="p">,</span>
      <span class="n">data33</span> <span class="o">=</span> <span class="n">field33</span><span class="p">,</span>
      <span class="n">data12</span> <span class="o">=</span> <span class="n">field12</span><span class="p">,</span>
      <span class="n">data13</span> <span class="o">=</span> <span class="n">field13</span><span class="p">,</span>
      <span class="n">data23</span> <span class="o">=</span> <span class="n">field23</span><span class="p">,</span>
      <span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span>
      <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span>
      <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">tensor_field</span> <span class="o">=</span> <span class="n">TensorFieldOutput</span><span class="p">(</span>
      <span class="n">data11</span> <span class="o">=</span> <span class="n">field11</span><span class="p">,</span>
      <span class="n">data22</span> <span class="o">=</span> <span class="n">field22</span><span class="p">,</span>
      <span class="n">data33</span> <span class="o">=</span> <span class="n">field33</span><span class="p">,</span>
      <span class="n">data12</span> <span class="o">=</span> <span class="n">field12</span><span class="p">,</span>
      <span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span>
      <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span>
      <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">tensor_field</span>
  </div>
<div class="viewcode-block" id="FieldOutput"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.FieldOutput">[docs]</a><span class="k">class</span> <span class="nc">FieldOutput</span><span class="p">:</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Scalar output representing a field evaluated on nodes or elements referenced by their labels. A FieldOutput instance cannot be interpreted with its mesh. On initiation, labels and data will be reordered to have labels sorted. </span>
<span class="sd"> </span>
<span class="sd">  :param position: location of the field evaluation</span>
<span class="sd">  :type position: &#39;node&#39; or &#39;element&#39;</span>
<span class="sd">  :param data: value of the field where it is evaluated</span>
<span class="sd">  :type data: list, array.array, numpy.array containing floats</span>
<span class="sd">  :param labels: labels of the nodes/elements where the field is evaluated. If None, labels will be [1,2,...,len(data)+1] </span>
<span class="sd">  :type labels: list, array.array, numpy.array containt ints or None. </span>
<span class="sd">  :param dti: int data type in array.array</span>
<span class="sd">  :type dti: &#39;I&#39;, &#39;H&#39;</span>
<span class="sd">  :param dtf: float data type in array.array</span>
<span class="sd">  :type dtf: &#39;f&#39;, &#39;d&#39;</span>
<span class="sd">  </span>
<span class="sd">  &gt;&gt;&gt; from abapy.postproc import FieldOutput</span>
<span class="sd">  &gt;&gt;&gt; data = [-1.,5.,3.]</span>
<span class="sd">  &gt;&gt;&gt; labels = [1,3,2]</span>
<span class="sd">  &gt;&gt;&gt; fo = FieldOutput(data=data, labels = labels, position = &#39;node&#39;)</span>
<span class="sd">  &gt;&gt;&gt; print fo # data is sorted by labels</span>
<span class="sd">  FieldOutput instance</span>
<span class="sd">  Position = node</span>
<span class="sd">  Label	Data</span>
<span class="sd">  1	-1.0</span>
<span class="sd">  2	3.0</span>
<span class="sd">  3	5.0</span>
<span class="sd">  &gt;&gt;&gt; print fo[1:2] # slicing</span>
<span class="sd">  FieldOutput instance</span>
<span class="sd">  Position = node</span>
<span class="sd">  Label	Data</span>
<span class="sd">  1	-1.0</span>
<span class="sd">  &gt;&gt;&gt; print fo[2] # indexing</span>
<span class="sd">  FieldOutput instance</span>
<span class="sd">  Position = node</span>
<span class="sd">  Label	Data</span>
<span class="sd">  2	3.0</span>
<span class="sd">  &gt;&gt;&gt; print fo[1,3] # multiple indexing</span>
<span class="sd">  FieldOutput instance</span>
<span class="sd">  Position = node</span>
<span class="sd">  Label	Data</span>
<span class="sd">  1	-1.0</span>
<span class="sd">  3	5.0</span>
<span class="sd">  &gt;&gt;&gt; print fo*2 # multiplication</span>
<span class="sd">  FieldOutput instance</span>
<span class="sd">  Position = node</span>
<span class="sd">  Label	Data</span>
<span class="sd">  1	-2.0</span>
<span class="sd">  2	6.0</span>
<span class="sd">  3	10.0</span>
<span class="sd">  &gt;&gt;&gt; fo2 = fo**2  #power</span>
<span class="sd">  &gt;&gt;&gt; print fo2</span>
<span class="sd">  FieldOutput instance</span>
<span class="sd">  Position = node</span>
<span class="sd">  Label	Data</span>
<span class="sd">  1	1.0</span>
<span class="sd">  2	9.0</span>
<span class="sd">  3	25.0</span>
<span class="sd">  &gt;&gt;&gt; print fo * fo2</span>
<span class="sd">  FieldOutput instance</span>
<span class="sd">  Position = node</span>
<span class="sd">  Label	Data</span>
<span class="sd">  1	-1.0</span>
<span class="sd">  2	27.0</span>
<span class="sd">  3	125.0</span>
<span class="sd">  &gt;&gt;&gt; print fo + fo2</span>
<span class="sd">  FieldOutput instance</span>
<span class="sd">  Position = node</span>
<span class="sd">  Label	Data</span>
<span class="sd">  1	0.0</span>
<span class="sd">  2	12.0</span>
<span class="sd">  3	30.0</span>
<span class="sd">  &gt;&gt;&gt; print abs(fo) </span>
<span class="sd">  FieldOutput instance</span>
<span class="sd">  Position = node</span>
<span class="sd">  Label	Data</span>
<span class="sd">  1	1.0</span>
<span class="sd">  2	3.0</span>
<span class="sd">  3	5.0</span>

<span class="sd">  .. note::</span>
<span class="sd">       If dti=&#39;H&#39; is chosen, labels are stored as unsigned 16 bits ints. If more than 65k labels are stored, an OverFlow error will be raised.</span>
<span class="sd">       </span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">position</span><span class="o">=</span><span class="s">&#39;node&#39;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">labels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">dti</span><span class="o">=</span><span class="s">&#39;I&#39;</span><span class="p">,</span><span class="n">dtf</span><span class="o">=</span><span class="s">&#39;f&#39;</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dti</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">position</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,[])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dti</span><span class="p">,[])</span>
    <span class="k">if</span> <span class="n">data</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">labels</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;labels and data must have the same length&#39;</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;labels must be int &gt; 0&#39;</span>
        <span class="n">zipped</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
        <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="n">zipped</span><span class="p">))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dti</span><span class="p">,</span><span class="n">labels</span><span class="p">)</span> 
      <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">      if len(data) == len(labels):</span>
<span class="sd">        for i in xrange(len(labels)):</span>
<span class="sd">          self.add_data(labels[i],data[i])</span>
<span class="sd">      &#39;&#39;&#39;</span>
      
<div class="viewcode-block" id="FieldOutput.add_data"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.FieldOutput.add_data">[docs]</a>  <span class="k">def</span> <span class="nf">add_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Adds one point to a FieldOutput instance. Label must not already exist in the current FieldOutput, if not so, nothing will be changed. Data and label will be inserted in self.data, self.labels in order to keep self.labels sorted.</span>
<span class="sd">   </span>
<span class="sd">   &gt;&gt;&gt; from abapy.postproc import FieldOutput</span>
<span class="sd">   &gt;&gt;&gt; data = [5.5, 2.2]</span>
<span class="sd">   &gt;&gt;&gt; labels = [1,4]</span>
<span class="sd">   &gt;&gt;&gt; temperature = FieldOutput(labels = labels, data = data, position = &#39;node&#39;)</span>
<span class="sd">   &gt;&gt;&gt; temperature.add_data(2, 5.)</span>
<span class="sd">   &gt;&gt;&gt; temperature.data # labels are sorted</span>
<span class="sd">   array(&#39;f&#39;, [5.5, 5.0, 2.200000047683716])</span>
<span class="sd">   &gt;&gt;&gt; temperature.labels # data was sorted like labels</span>
<span class="sd">   array(&#39;I&#39;, [1L, 2L, 4L]) </span>

<span class="sd">   </span>
<span class="sd">  </span>
<span class="sd"> </span>
<span class="sd">  :param label: labels of the nodes/elements where the field is evaluated.</span>
<span class="sd">  :type labels: int &gt; 0</span>
<span class="sd">  :param data: value of the field where it is evaluated</span>
<span class="sd">  :type data: float</span>
<span class="sd">  </span>
<span class="sd">  &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&#39;data already exists at this node&#39;</span>
      <span class="k">return</span> 
    <span class="k">else</span><span class="p">:</span>
      <span class="n">self_data</span><span class="p">,</span> <span class="n">self_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
      <span class="n">self_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
      <span class="n">self_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
      <span class="n">zipped</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">self_labels</span><span class="p">,</span><span class="n">self_data</span><span class="p">)</span>
      <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="n">zipped</span><span class="p">))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dti</span><span class="p">,</span><span class="n">labels</span><span class="p">)</span>  
      </div>
<div class="viewcode-block" id="FieldOutput.dump2vtk"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.FieldOutput.dump2vtk">[docs]</a>  <span class="k">def</span> <span class="nf">dump2vtk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;fieldOutput&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts the FieldOutput instance to VTK format which can be directly read by Mayavi2 or Paraview. This method is very useful to quickly and efficiently plot 3D mesh and fields.</span>
<span class="sd">    </span>
<span class="sd">    :param name: name used for the field in the output.</span>
<span class="sd">    :type name: string</span>
<span class="sd">    :rtype: string</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from abapy.postproc import FieldOutput</span>
<span class="sd">    &gt;&gt;&gt; from abapy.mesh import Mesh, Nodes</span>
<span class="sd">    &gt;&gt;&gt; x = [0.,1.,0.]</span>
<span class="sd">    &gt;&gt;&gt; y = [0.,0.,1.]</span>
<span class="sd">    &gt;&gt;&gt; z = [0.,0.,0.]</span>
<span class="sd">    &gt;&gt;&gt; labels = [1,2,3]</span>
<span class="sd">    &gt;&gt;&gt; nodes = Nodes(x=x,y=y,z=z, labels=labels)</span>
<span class="sd">    &gt;&gt;&gt; mesh = Mesh(nodes=nodes)</span>
<span class="sd">    &gt;&gt;&gt; mesh.add_element(label = 1 , connectivity = [1,2,3], space = 2 , name = &#39;tri3&#39;) # triangle element</span>
<span class="sd">    &gt;&gt;&gt; nodeField = FieldOutput()</span>
<span class="sd">    &gt;&gt;&gt; nodeField.add_data(data = 0., label = 1)</span>
<span class="sd">    &gt;&gt;&gt; nodeField.add_data(data = 10., label = 2)</span>
<span class="sd">    &gt;&gt;&gt; nodeField.add_data(data = 20., label = 3)</span>
<span class="sd">    &gt;&gt;&gt; elementField = FieldOutput(position=&#39;element&#39;)</span>
<span class="sd">    &gt;&gt;&gt; elementField.add_data(label = 1, data =10.)</span>
<span class="sd">    &gt;&gt;&gt; out = &#39;&#39;</span>
<span class="sd">    &gt;&gt;&gt; out+=mesh.dump2vtk()</span>
<span class="sd">    &gt;&gt;&gt; out+=nodeField.dump2vtk(&#39;nodeField&#39;)</span>
<span class="sd">    &gt;&gt;&gt; out+=elementField.dump2vtk(&#39;elementField&#39;)</span>
<span class="sd">    &gt;&gt;&gt; print out</span>
<span class="sd">    # vtk DataFile Version 2.0</span>
<span class="sd">    Unstructured Grid Example</span>
<span class="sd">    ASCII</span>
<span class="sd">    DATASET UNSTRUCTURED_GRID</span>
<span class="sd">    POINTS 3 float</span>
<span class="sd">    0.0 0.0 0.0</span>
<span class="sd">    1.0 0.0 0.0</span>
<span class="sd">    0.0 1.0 0.0</span>
<span class="sd">    CELLS 1 4</span>
<span class="sd">    3 0 1 2 </span>
<span class="sd">    CELL_TYPES 1</span>
<span class="sd">    5</span>
<span class="sd">    POINT_DATA 3</span>
<span class="sd">    SCALARS nodeField float 1</span>
<span class="sd">    LOOKUP_TABLE default</span>
<span class="sd">    0.0</span>
<span class="sd">    10.0</span>
<span class="sd">    20.0</span>
<span class="sd">    CELL_DATA 1</span>
<span class="sd">    SCALARS elementField float 1</span>
<span class="sd">    LOOKUP_TABLE default</span>
<span class="sd">    10.0</span>
<span class="sd">    </span>
<span class="sd">    Result in Paraview:</span>
<span class="sd">    </span>
<span class="sd">    .. image:: images/FIeldOutput-dump2vkt_paraview.png</span>
<span class="sd">       :width: 750</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ld</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="s">&#39;node&#39;</span><span class="p">:</span> <span class="n">dataType</span> <span class="o">=</span> <span class="s">&#39;POINT_DATA&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="s">&#39;element&#39;</span><span class="p">:</span> <span class="n">dataType</span> <span class="o">=</span> <span class="s">&#39;CELL_DATA&#39;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s">&#39;{2} {0}</span><span class="se">\n</span><span class="s">SCALARS {1} float 1</span><span class="se">\n</span><span class="s">LOOKUP_TABLE default</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ld</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">dataType</span><span class="p">)</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;{0}</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
      <span class="n">out</span> <span class="o">+=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>
  
 </div>
  <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&#39;&lt;FieldOutput instance: {0} locations&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
  
  <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">nan</span>
    <span class="n">labs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="n">labs</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">slice</span><span class="p">:</span>
      <span class="n">start</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">start</span>
      <span class="n">stop</span>  <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">stop</span>
      <span class="n">step</span>  <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">step</span>
      <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">labs</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="n">step</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span> <span class="n">array</span><span class="p">]:</span>  
      <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span><span class="n">labs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
       
    <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
    <span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span>
    <span class="n">dti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dti</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
    <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
    <span class="n">fo</span> <span class="o">=</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labs</span><span class="p">:</span>    
      <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">l</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">l</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">nan</span><span class="p">)</span>  
    <span class="k">return</span> <span class="n">fo</span>     
  
  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">labels</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s">&#39;FieldOutput instance</span><span class="se">\n</span><span class="s">Position = {0}</span><span class="se">\n</span><span class="s">Label</span><span class="se">\t</span><span class="s">Data</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;{0}</span><span class="se">\t</span><span class="s">{1}</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span> <span class="n">out</span> <span class="o">+=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">out</span>
  
<div class="viewcode-block" id="FieldOutput.get_data"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.FieldOutput.get_data">[docs]</a>  <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns data at a location with given label. </span>
<span class="sd">    </span>
<span class="sd">    :param label: location&#39;s label.</span>
<span class="sd">    :type label: int &gt; 0</span>
<span class="sd">    :rtype: float</span>
<span class="sd">        </span>
<span class="sd">    .. note:: Requesting data at a label that does not exist in the instance will just lead in a warning but if label is negative or is not int, then an Exception will be raised.</span>
<span class="sd">    &#39;&#39;&#39;</span>
     
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]</span> <span class="ow">or</span> <span class="n">label</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;label must be int &gt; 0, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>  
    <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
      <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
    <span class="k">else</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&#39;Info: requesting data at non existant location, returning None&#39;</span>    
  </div>
  <span class="k">def</span> <span class="nf">_PreProcess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Preprocesses internal operations such as ``__add__``, ``__mul__`` by checking position, labels dtype compatibility and preparing operands to fasten computations. Other can be None, in this case no checking are performed and self.data preprocessing is still perfomed.</span>
<span class="sd">    </span>
<span class="sd">    .. note:: uses Numpy.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span> <span class="k">as</span> <span class="n">a_array</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span> <span class="k">as</span> <span class="n">n_array</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">float32</span><span class="p">,</span> <span class="n">float64</span><span class="p">,</span> <span class="n">uint16</span><span class="p">,</span> <span class="n">uint32</span>
    <span class="k">if</span> <span class="n">other</span> <span class="o">==</span> <span class="bp">None</span> <span class="p">:</span> <span class="n">other</span> <span class="o">=</span> <span class="mf">1.</span> 
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span><span class="n">FieldOutput</span><span class="p">):</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;operands labels must be identicals.&#39;</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">!=</span> <span class="n">other</span><span class="o">.</span><span class="n">position</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;operands position must be identicals.&#39;</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dti</span> <span class="o">==</span> <span class="s">&#39;H&#39;</span> <span class="ow">and</span> <span class="n">other</span><span class="o">.</span><span class="n">dti</span> <span class="o">==</span> <span class="s">&#39;H&#39;</span><span class="p">:</span>
        <span class="n">dti</span> <span class="o">=</span> <span class="s">&#39;H&#39;</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">dti</span> <span class="o">=</span> <span class="s">&#39;I&#39;</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;d&#39;</span> <span class="ow">or</span> <span class="n">other</span><span class="o">.</span><span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;d&#39;</span><span class="p">:</span>
        <span class="n">dtf</span> <span class="o">=</span> <span class="s">&#39;d&#39;</span>
      <span class="k">else</span><span class="p">:</span> 
        <span class="n">dtf</span> <span class="o">=</span> <span class="s">&#39;f&#39;</span>
      <span class="n">out</span> <span class="o">=</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">dti</span><span class="o">=</span><span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span><span class="o">=</span><span class="n">dtf</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
      <span class="n">other_data</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">data</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dti</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span>
      <span class="n">out</span> <span class="o">=</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
      <span class="n">other_data</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;f&#39;</span><span class="p">:</span> <span class="n">ndtf</span> <span class="o">=</span> <span class="n">float32</span>  
    <span class="k">if</span> <span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="n">ndtf</span> <span class="o">=</span> <span class="n">float64</span>    
    <span class="n">other_data</span> <span class="o">=</span> <span class="n">n_array</span><span class="p">(</span><span class="n">other_data</span><span class="p">,</span><span class="n">ndtf</span><span class="p">)</span>
    <span class="n">self_data</span> <span class="o">=</span> <span class="n">n_array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="n">ndtf</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span><span class="p">,</span> <span class="n">self_data</span><span class="p">,</span> <span class="n">other_data</span>
  
  <span class="k">def</span> <span class="nf">_PostProcess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">new_data</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Postprocesses internal operations such as ``__add__``, ``__mul__``.</span>
<span class="sd">    </span>
<span class="sd">    .. note:: uses Numpy.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="n">out</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
    <span class="n">out</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span> <span class="n">out</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span> <span class="n">new_data</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>
  
  <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">long</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">FieldOutput</span><span class="p">))</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="n">out</span><span class="p">,</span> <span class="n">self_data</span><span class="p">,</span> <span class="n">other_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="n">new_data</span> <span class="o">=</span> <span class="n">self_data</span> <span class="o">+</span> <span class="n">other_data</span> 
    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PostProcess</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="n">new_data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span> 
    
  <span class="n">__radd__</span> <span class="o">=</span> <span class="n">__add__</span> 
  
  <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">long</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">FieldOutput</span><span class="p">))</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="n">out</span><span class="p">,</span> <span class="n">self_data</span><span class="p">,</span> <span class="n">other_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="n">new_data</span> <span class="o">=</span> <span class="n">self_data</span> <span class="o">-</span> <span class="n">other_data</span> 
    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PostProcess</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="n">new_data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span> 
  
  <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">long</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">FieldOutput</span><span class="p">))</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="n">other</span> 
  
  <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">long</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">FieldOutput</span><span class="p">))</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="k">return</span> <span class="o">-</span><span class="bp">self</span> <span class="o">+</span> <span class="n">other</span> 
    
  <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">long</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">FieldOutput</span><span class="p">))</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="n">out</span><span class="p">,</span> <span class="n">self_data</span><span class="p">,</span> <span class="n">other_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="n">new_data</span> <span class="o">=</span> <span class="n">self_data</span> <span class="o">*</span> <span class="n">other_data</span> 
    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PostProcess</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="n">new_data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>  
  
  <span class="n">__rmul__</span> <span class="o">=</span> <span class="n">__mul__</span>  
    
  <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">long</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">FieldOutput</span><span class="p">))</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="n">out</span><span class="p">,</span> <span class="n">self_data</span><span class="p">,</span> <span class="n">other_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="n">new_data</span> <span class="o">=</span> <span class="n">self_data</span> <span class="o">/</span> <span class="n">other_data</span> 
    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PostProcess</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="n">new_data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span> 
  
  <span class="k">def</span> <span class="nf">__rdiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">long</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">FieldOutput</span><span class="p">))</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="k">return</span> <span class="n">other</span> <span class="o">*</span>  <span class="bp">self</span><span class="o">**-</span><span class="mi">1</span>  
    
  <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">long</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">FieldOutput</span><span class="p">))</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="n">out</span><span class="p">,</span> <span class="n">self_data</span><span class="p">,</span> <span class="n">other_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="n">new_data</span> <span class="o">=</span> <span class="n">self_data</span> <span class="o">**</span> <span class="n">other_data</span> 
    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PostProcess</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="n">new_data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span> 
      
  <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">out</span><span class="p">,</span> <span class="n">self_data</span><span class="p">,</span> <span class="n">other_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="p">)</span>
    <span class="n">new_data</span> <span class="o">=</span> <span class="n">self_data</span> <span class="o">*</span> <span class="n">other_data</span> 
    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PostProcess</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="n">new_data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span> 
  
  <span class="k">def</span> <span class="nf">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">out</span><span class="p">,</span> <span class="n">self_data</span><span class="p">,</span> <span class="n">other_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">()</span>
    <span class="n">new_data</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">self_data</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PostProcess</span><span class="p">(</span><span class="n">out</span><span class="p">,</span><span class="n">new_data</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span> 
  
     </div>
<div class="viewcode-block" id="ZeroFieldOutput_like"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.ZeroFieldOutput_like">[docs]</a><span class="k">def</span> <span class="nf">ZeroFieldOutput_like</span><span class="p">(</span><span class="n">fo</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  A FieldOutput containing only zeros but with the same position, labels and dtypes as the input. </span>
<span class="sd"> </span>
<span class="sd">  :param fo: field output to be used.</span>
<span class="sd">  :type fo: FieldOutput instance</span>
<span class="sd">  :rtype: FieldOutput instance</span>
<span class="sd">  </span>
<span class="sd">  .. note:: uses Numpy.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
  <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
  <span class="c">#from numpy import zeros_like # LC 12/04/2012: commented to use a non numpy method instead.</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fo</span><span class="p">,</span><span class="n">FieldOutput</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;input must be FieldOutput instance.&#39;</span>
  <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">dti</span><span class="p">,</span> <span class="n">fo</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span> <span class="n">fo</span><span class="o">.</span><span class="n">position</span>
  <span class="c">#data = array(dtf, zeros_like(fo.data).tolist()) # LC 12/04/2012: commented to use a non numpy method instead.</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,</span> <span class="p">[</span> <span class="mf">0.</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">fo</span><span class="o">.</span><span class="n">data</span><span class="p">])</span>
  <span class="n">labels</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">fo</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">dti</span><span class="o">=</span><span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span><span class="o">=</span><span class="n">dtf</span><span class="p">)</span>
  </div>
<div class="viewcode-block" id="OneFieldOutput_like"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.OneFieldOutput_like">[docs]</a><span class="k">def</span> <span class="nf">OneFieldOutput_like</span><span class="p">(</span><span class="n">fo</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  A FieldOutput containing only ones but with the same position, labels and dtypes as the input. </span>
<span class="sd"> </span>
<span class="sd">  :param fo: field output to be used.</span>
<span class="sd">  :type fo: FieldOutput instance</span>
<span class="sd">  :rtype: FieldOutput instance</span>
<span class="sd">  </span>
<span class="sd">  .. note:: uses Numpy.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
  <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
  <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">ones_like</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fo</span><span class="p">,</span><span class="n">FieldOutput</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;input must be FieldOutput instance.&#39;</span>
  <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="n">fo</span><span class="o">.</span><span class="n">dti</span><span class="p">,</span> <span class="n">fo</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span> <span class="n">fo</span><span class="o">.</span><span class="n">position</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,</span> <span class="n">ones_like</span><span class="p">(</span><span class="n">fo</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
  <span class="n">labels</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">fo</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span> <span class="n">dti</span><span class="o">=</span><span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span><span class="o">=</span><span class="n">dtf</span><span class="p">)</span>
  
  
</div>
<div class="viewcode-block" id="VectorFieldOutput"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.VectorFieldOutput">[docs]</a><span class="k">class</span> <span class="nc">VectorFieldOutput</span><span class="p">:</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  3D vector field output. Using this class instead of 3 scalar FieldOutput instances is efficient because labels are stored only since and allows all vector operations like dot, cross, norm.</span>
<span class="sd"> </span>
<span class="sd">  :param data1: x coordinate</span>
<span class="sd">  :type data1: FieldOutput instance or None</span>
<span class="sd">  :param data2: y coordinate</span>
<span class="sd">  :type data2: FieldOutput instance or None</span>
<span class="sd">  :param data3: z coordinate</span>
<span class="sd">  :type data3: FieldOutput instance or None</span>
<span class="sd">  :param position: position at which data is computed</span>
<span class="sd">  :type position: &#39;node&#39; or &#39;element&#39;</span>
<span class="sd">  :param dti: array.array int data type</span>
<span class="sd">  :type dti: &#39;I&#39; for uint32 or &#39;H&#39; for uint16</span>
<span class="sd">  :param dtf: array.array int data type</span>
<span class="sd">  :type dtf: &#39;f&#39; float32 or &#39;d&#39; for float64</span>
<span class="sd">  </span>
<span class="sd">  &gt;&gt;&gt; from abapy.postproc import FieldOutput, VectorFieldOutput</span>
<span class="sd">  &gt;&gt;&gt; data1 = [1,2,3,5,6,0]</span>
<span class="sd">  &gt;&gt;&gt; data2 = [1. for i in data1]</span>
<span class="sd">  &gt;&gt;&gt; labels = range(1,len(data1)+1)</span>
<span class="sd">  &gt;&gt;&gt; fo1, fo2 = FieldOutput(labels = labels, data=data1, position=&#39;node&#39; ), FieldOutput(labels = labels, data=data2,position=&#39;node&#39;)</span>
<span class="sd">  &gt;&gt;&gt; vector = VectorFieldOutput(data1 = fo1, data2 = fo2 )</span>
<span class="sd">  &gt;&gt;&gt; vector2 = VectorFieldOutput(data2 = fo2 )</span>
<span class="sd">  &gt;&gt;&gt; vector # short description</span>
<span class="sd">  &lt;VectorFieldOutput instance: 6 locations&gt;</span>
<span class="sd">  &gt;&gt;&gt; print vector # long description</span>
<span class="sd">  VectorFieldOutput instance</span>
<span class="sd">  Position = node</span>
<span class="sd">  Label	Data1	Data2	Data3</span>
<span class="sd">  1	1.0	1.0	0.0</span>
<span class="sd">  2	2.0	1.0	0.0</span>
<span class="sd">  3	3.0	1.0	0.0</span>
<span class="sd">  4	5.0	1.0	0.0</span>
<span class="sd">  5	6.0	1.0	0.0</span>
<span class="sd">  6	0.0	1.0	0.0</span>
<span class="sd">  &gt;&gt;&gt; print vector[6] # Returns a VectorFieldOutput instance</span>
<span class="sd">  VectorFieldOutput instance</span>
<span class="sd">  Position = node</span>
<span class="sd">  Label	Data1	Data2	Data3</span>
<span class="sd">  6	0.0	1.0	1.0</span>
<span class="sd">  &gt;&gt;&gt; print vector[1,4,6] # Picking label by label</span>
<span class="sd">  VectorFieldOutput instance</span>
<span class="sd">  Position = node</span>
<span class="sd">  Label	Data1	Data2	Data3</span>
<span class="sd">  1	1.0	1.0	1.0</span>
<span class="sd">  4	5.0	1.0	1.0</span>
<span class="sd">  6	0.0	1.0	1.0</span>
<span class="sd">  &gt;&gt;&gt; print vector[1:6:2] # Slicing</span>
<span class="sd">  VectorFieldOutput instance</span>
<span class="sd">  Position = node</span>
<span class="sd">  Label	Data1	Data2	Data3</span>
<span class="sd">  1	1.0	1.0	1.0</span>
<span class="sd">  3	3.0	1.0	1.0</span>
<span class="sd">  5	6.0	1.0	1.0</span>
<span class="sd">  &gt;&gt;&gt; vector.get_data(6) # Returns 3 floats</span>
<span class="sd">  (0.0, 1.0, 0.0)</span>
<span class="sd">  &gt;&gt;&gt; vector.norm() # Returns norm</span>
<span class="sd">  &lt;FieldOutput instance: 6 locations&gt;</span>
<span class="sd">  &gt;&gt;&gt; vector.sum() # returns the sum of coords</span>
<span class="sd">  &lt;FieldOutput instance: 6 locations&gt;</span>
<span class="sd">  &gt;&gt;&gt; vector * vector2 # Itemwise product (like numpy, unlike matlab)</span>
<span class="sd">  &lt;VectorFieldOutput instance: 6 locations&gt;</span>
<span class="sd">  &gt;&gt;&gt; vector.dot(vector2) # Dot/Scalar product</span>
<span class="sd">  &lt;FieldOutput instance: 6 locations&gt;</span>
<span class="sd">  &gt;&gt;&gt; vector.cross(vector2) # Cross/Vector product</span>
<span class="sd">  &lt;VectorFieldOutput instance: 6 locations&gt;</span>
<span class="sd">  &gt;&gt;&gt; vector + 2 # Itemwise addition</span>
<span class="sd">  &lt;VectorFieldOutput instance: 6 locations&gt;</span>
<span class="sd">  &gt;&gt;&gt; vector * 2 # Itemwise multiplication</span>
<span class="sd">  &lt;VectorFieldOutput instance: 6 locations&gt;</span>
<span class="sd">  &gt;&gt;&gt; vector / 2 # Itemwise division</span>
<span class="sd">  &lt;VectorFieldOutput instance: 6 locations&gt;</span>
<span class="sd">  &gt;&gt;&gt; vector / vector2 # Itemwise division between vectors (numpy way)</span>
<span class="sd">  Warning: divide by zero encountered in divide</span>
<span class="sd">  Warning: invalid value encountered in divide</span>
<span class="sd">  &lt;VectorFieldOutput instance: 6 locations&gt;</span>
<span class="sd">  &gt;&gt;&gt; abs(vector) # Absolute value</span>
<span class="sd">  &lt;VectorFieldOutput instance: 6 locations&gt;</span>
<span class="sd">  &gt;&gt;&gt; vector ** 2 # Power</span>
<span class="sd">  &lt;VectorFieldOutput instance: 6 locations&gt;</span>
<span class="sd">  &gt;&gt;&gt; vector ** vector # Itemwize power</span>
<span class="sd">  &lt;VectorFieldOutput instance: 6 locations&gt;</span>
<span class="sd"> </span>
<span class="sd">  .. note::</span>
<span class="sd">       * data1, data2 and data3 must have same position and label or be None. If one data is None, it is supposed to be zero. </span>
<span class="sd">       * Storage data dype is the highest standard of all 3 data.</span>
<span class="sd">       * Numpy is not used in the constructor to allow the creation of instances in Abaqus Python but most other operation require numpy for speed reasons.&#39;&#39;&#39;</span>
       
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data1</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">data2</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">data3</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="s">&#39;node&#39;</span><span class="p">,</span> <span class="n">dti</span><span class="o">=</span><span class="s">&#39;I&#39;</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="s">&#39;f&#39;</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">position</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dti</span><span class="p">,[])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data3</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,[]),</span> <span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,[]),</span> <span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,[])</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">,</span> <span class="n">data3</span><span class="p">]</span>
    <span class="n">isNone</span> <span class="o">=</span> <span class="p">[</span><span class="n">data1</span> <span class="o">==</span> <span class="bp">None</span><span class="p">,</span> <span class="n">data2</span> <span class="o">==</span> <span class="bp">None</span><span class="p">,</span> <span class="n">data3</span> <span class="o">==</span> <span class="bp">None</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">FieldOutput</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;data1, data2 and data3 must be FieldOutput instances.&#39;</span>
    <span class="k">if</span> <span class="n">isNone</span> <span class="o">!=</span> <span class="p">[</span><span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">]:</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span> <span class="n">refData</span> <span class="o">=</span> <span class="n">d</span>
      <span class="n">labels</span> <span class="o">=</span> <span class="n">refData</span><span class="o">.</span><span class="n">labels</span>
      <span class="n">useShortInts</span> <span class="o">=</span> <span class="bp">True</span>
      <span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ZeroFieldOutput_like</span><span class="p">(</span><span class="n">refData</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">labels</span> <span class="o">!=</span> <span class="n">labels</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;data1, data2 and data3 must be fieldOutputs sharing the same labels.&#39;</span>    
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;d&#39;</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dti</span> <span class="o">==</span> <span class="s">&#39;I&#39;</span><span class="p">:</span> <span class="n">useShortInts</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">useShortInts</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dti</span> <span class="o">=</span> <span class="s">&#39;H&#39;</span>            
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">positions</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;inputs must have the same position or be None.&#39;</span>
      <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">      for i in xrange(len(labels)):</span>
<span class="sd">        l = labels[i]</span>
<span class="sd">        d1, d2, d3 = data[0].data[i] , data[1].data[i] , data[2].data[i]</span>
<span class="sd">        self.add_data(label = l, data1 = d1, data2 = d2, data3 = d3)</span>
<span class="sd">      &#39;&#39;&#39;</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">data1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    
<div class="viewcode-block" id="VectorFieldOutput.norm"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.VectorFieldOutput.norm">[docs]</a>  <span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Computes norm of the vector at each location and returns it as a scalar FieldOutput.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; norm = Vec.norm()</span>
<span class="sd">    </span>
<span class="sd">    :rtype: FieldOutput instance</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">((</span> <span class="bp">self</span> <span class="o">*</span> <span class="bp">self</span> <span class="p">)</span><span class="o">**.</span><span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
     </div>
<div class="viewcode-block" id="VectorFieldOutput.get_coord"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.VectorFieldOutput.get_coord">[docs]</a>  <span class="k">def</span> <span class="nf">get_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">number</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns a coordinate of the vector as a FieldOutput.</span>
<span class="sd">       </span>
<span class="sd">    :param number: requested coordinate number, 1 is x and so on.</span>
<span class="sd">    :type number: 1,2 or 3  </span>
<span class="sd">    :rtype: FieldOutput instance</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; v1 = Vec.get_coord(1)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="c">#from copy import copy</span>
    <span class="k">if</span> <span class="n">number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;number must be 1,2 or 3&#39;</span>  
    <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dti</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span>
    <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
    <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data1</span>
    <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data2</span>
    <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data3</span>
    <span class="k">return</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="n">dti</span><span class="o">=</span><span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span><span class="o">=</span><span class="n">dtf</span> <span class="p">)</span>
    </div>
<div class="viewcode-block" id="VectorFieldOutput.get_data"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.VectorFieldOutput.get_data">[docs]</a>  <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns coordinates at a location with given label. </span>
<span class="sd">    </span>
<span class="sd">    :param label: location&#39;s label.</span>
<span class="sd">    :type label: int &gt; 0</span>
<span class="sd">    :rtype: float, float, float</span>
<span class="sd">        </span>
<span class="sd">    .. note:: Requesting data at a label that does not exist in the instance will just lead in a warning but if label is negative or is not int, then an Exception will be raised.</span>
<span class="sd">    &#39;&#39;&#39;</span>
     
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]</span> <span class="ow">or</span> <span class="n">label</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;label must be int &gt; 0, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>  
    <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
      <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
    <span class="k">else</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&#39;Info: requesting data at non existant location, returning None&#39;</span>
 </div>
  <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&#39;&lt;VectorFieldOutput instance: {0} locations&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">nan</span>
    <span class="n">labs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="n">labs</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">slice</span><span class="p">:</span>
      <span class="n">start</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">start</span>
      <span class="n">stop</span>  <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">stop</span>
      <span class="n">step</span>  <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">step</span>
      <span class="n">labs</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="n">step</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span> <span class="n">array</span><span class="p">]:</span>  
      <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span><span class="n">labs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
       
    <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
    <span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span>
    <span class="n">dti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dti</span>
    <span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">,</span> <span class="n">data3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data3</span>
    <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
    <span class="n">fo</span> <span class="o">=</span> <span class="n">VectorFieldOutput</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labs</span><span class="p">:</span>    
      <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">l</span><span class="p">,</span> <span class="n">data1</span> <span class="o">=</span> <span class="n">data1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data2</span> <span class="o">=</span> <span class="n">data2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data3</span> <span class="o">=</span> <span class="n">data3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">l</span><span class="p">,</span> <span class="n">data1</span> <span class="o">=</span> <span class="n">nan</span><span class="p">,</span> <span class="n">data2</span> <span class="o">=</span> <span class="n">nan</span><span class="p">,</span> <span class="n">data3</span> <span class="o">=</span> <span class="n">nan</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">fo</span>     
  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">labels</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
    <span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">,</span> <span class="n">data3</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">data1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data3</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s">&#39;VectorFieldOutput instance</span><span class="se">\n</span><span class="s">Position = {0}</span><span class="se">\n</span><span class="s">Label</span><span class="se">\t</span><span class="s">Data1</span><span class="se">\t</span><span class="s">Data2</span><span class="se">\t</span><span class="s">Data3</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;{0}</span><span class="se">\t</span><span class="s">{1}</span><span class="se">\t</span><span class="s">{2}</span><span class="se">\t</span><span class="s">{3}</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span> <span class="n">out</span> <span class="o">+=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data3</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">out</span>
<div class="viewcode-block" id="VectorFieldOutput.add_data"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.VectorFieldOutput.add_data">[docs]</a>  <span class="k">def</span> <span class="nf">add_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">,</span> <span class="n">data1</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">data2</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">data3</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Adds one point to a VectorFieldOutput instance. Label must not already exist in the current FieldOutput, if not so, nothing will be changed. Data and label will be inserted in self.data, self.labels in order to keep self.labels sorted.</span>
<span class="sd">   </span>
<span class="sd">    :param label: labels of the nodes/elements where the field is evaluated.</span>
<span class="sd">    :type labels: int &gt; 0</span>
<span class="sd">    :param data1: value of the coordinate 1 of the field where it is evaluated.</span>
<span class="sd">    :type data1: float</span>
<span class="sd">    :param data2: value of the coordinate 2 of the field where it is evaluated.</span>
<span class="sd">    :type data2: float</span>
<span class="sd">    :param data3: value of the coordinate 3 of the field where it is evaluated.</span>
<span class="sd">    :type data3: float</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    from copy import deepcopy</span>
<span class="sd">    if label in self.labels:</span>
<span class="sd">      print &#39;data already exists at this node&#39;</span>
<span class="sd">      return </span>
<span class="sd">    if len(self.labels) != 0:  </span>
<span class="sd">      if label &gt; max(self.labels):</span>
<span class="sd">        self.data1.append(data1)</span>
<span class="sd">        self.data2.append(data2)</span>
<span class="sd">        self.data3.append(data3)</span>
<span class="sd">        self.labels.append(label)</span>
<span class="sd">      else:</span>
<span class="sd">        lab = deepcopy(self.labels)</span>
<span class="sd">        lab.append(label)</span>
<span class="sd">        lab = sorted(lab)</span>
<span class="sd">        indice = lab.index(label)</span>
<span class="sd">        self.labels.insert(indice,label)</span>
<span class="sd">        self.data1.insert(indice,data1)</span>
<span class="sd">        self.data2.insert(indice,data2)</span>
<span class="sd">        self.data3.insert(indice,data3)</span>
<span class="sd">    else:</span>
<span class="sd">      self.data1.append(data1)</span>
<span class="sd">      self.data2.append(data2)</span>
<span class="sd">      self.data3.append(data3)</span>
<span class="sd">      self.labels.append(label)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="n">dti</span><span class="p">,</span><span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dti</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&#39;data already exists at this node&#39;</span>
      <span class="k">return</span> 
    <span class="k">else</span><span class="p">:</span>
      <span class="n">self_data1</span><span class="p">,</span> <span class="n">self_data2</span><span class="p">,</span> <span class="n">self_data3</span><span class="p">,</span> <span class="n">self_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data3</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
      <span class="n">self_data1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data1</span><span class="p">)</span>
      <span class="n">self_data2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data2</span><span class="p">)</span>
      <span class="n">self_data3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data3</span><span class="p">)</span>
      <span class="n">self_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
      <span class="n">zipped</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">self_labels</span><span class="p">,</span><span class="n">self_data1</span><span class="p">,</span> <span class="n">self_data2</span><span class="p">,</span> <span class="n">self_data3</span><span class="p">)</span>
      <span class="n">labels</span><span class="p">,</span> <span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">,</span> <span class="n">data3</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="n">zipped</span><span class="p">))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">data1</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span><span class="n">data1</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">data2</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span><span class="n">data2</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">data3</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span><span class="n">data3</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dti</span><span class="p">,</span><span class="n">labels</span><span class="p">)</span>   
  </div>
<div class="viewcode-block" id="VectorFieldOutput.dump2vtk"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.VectorFieldOutput.dump2vtk">[docs]</a>  <span class="k">def</span> <span class="nf">dump2vtk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;vectorFieldOutput&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts the VectorFieldOutput instance to VTK format which can be directly read by Mayavi2 or Paraview. This method is very useful to quickly and efficiently plot 3D mesh and fields.</span>
<span class="sd">    </span>
<span class="sd">    :param name: name used for the field in the output.</span>
<span class="sd">    :type name: string</span>
<span class="sd">    :rtype: string</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from abapy.postproc import FieldOutput, VectorFieldOutput</span>
<span class="sd">    &gt;&gt;&gt; from abapy.mesh import RegularQuadMesh</span>
<span class="sd">    &gt;&gt;&gt; mesh = RegularQuadMesh()</span>
<span class="sd">    &gt;&gt;&gt; data1 = [2,2,5,10]</span>
<span class="sd">    &gt;&gt;&gt; data2 = [1. for i in data1]</span>
<span class="sd">    &gt;&gt;&gt; labels = range(1,len(data1)+1)</span>
<span class="sd">    &gt;&gt;&gt; fo1, fo2 = FieldOutput(labels = labels, data=data1, position=&#39;node&#39; ), FieldOutput(labels = labels, data=data2,position=&#39;node&#39;)</span>
<span class="sd">    &gt;&gt;&gt; vector = VectorFieldOutput(data1 = fo1, data2 = fo2 )</span>
<span class="sd">    &gt;&gt;&gt; out = mesh.dump2vtk() + vector.dump2vtk()</span>
<span class="sd">    &gt;&gt;&gt; f = open(&#39;vector.vtk&#39;,&#39;w&#39;)</span>
<span class="sd">    &gt;&gt;&gt; f.write(out)</span>
<span class="sd">    &gt;&gt;&gt; f.close()</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">d3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data3</span>
    <span class="n">ld</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">d1</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="s">&#39;node&#39;</span><span class="p">:</span> <span class="n">dataType</span> <span class="o">=</span> <span class="s">&#39;POINT_DATA&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="s">&#39;element&#39;</span><span class="p">:</span> <span class="n">dataType</span> <span class="o">=</span> <span class="s">&#39;CELL_DATA&#39;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s">&#39;{2} {0}</span><span class="se">\n</span><span class="s">VECTORS {1} float</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ld</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">dataType</span><span class="p">)</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;{0} {1} {2}</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">ld</span><span class="p">):</span>
      <span class="n">out</span> <span class="o">+=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">d2</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">d3</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">out</span>
   </div>
  <span class="k">def</span> <span class="nf">_PreProcess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_coord</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_coord</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_coord</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VectorFieldOutput</span><span class="p">):</span>
      <span class="n">o1</span><span class="p">,</span> <span class="n">o2</span><span class="p">,</span> <span class="n">o3</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">get_coord</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">other</span><span class="o">.</span><span class="n">get_coord</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">other</span><span class="o">.</span><span class="n">get_coord</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">FieldOutput</span><span class="p">):</span>
      <span class="n">o1</span><span class="p">,</span> <span class="n">o2</span><span class="p">,</span> <span class="n">o3</span> <span class="o">=</span> <span class="n">other</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">other</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="n">o</span> <span class="o">=</span> <span class="n">other</span> <span class="o">*</span> <span class="n">OneFieldOutput_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_coord</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
      <span class="n">o1</span><span class="p">,</span> <span class="n">o2</span><span class="p">,</span> <span class="n">o3</span>  <span class="o">=</span> <span class="n">o</span><span class="p">,</span> <span class="n">o</span><span class="p">,</span> <span class="n">o</span>
    <span class="k">return</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">,</span> <span class="n">o1</span><span class="p">,</span> <span class="n">o2</span><span class="p">,</span> <span class="n">o3</span>
     
  <span class="k">def</span> <span class="nf">_PostProcess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out1</span><span class="p">,</span> <span class="n">out2</span><span class="p">,</span> <span class="n">out3</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">VectorFieldOutput</span><span class="p">(</span><span class="n">data1</span> <span class="o">=</span> <span class="n">out1</span><span class="p">,</span> <span class="n">data2</span> <span class="o">=</span> <span class="n">out2</span><span class="p">,</span> <span class="n">data3</span> <span class="o">=</span> <span class="n">out3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>
     
  <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">long</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">FieldOutput</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VectorFieldOutput</span><span class="p">))</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">,</span> <span class="n">o1</span><span class="p">,</span> <span class="n">o2</span><span class="p">,</span> <span class="n">o3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="n">out1</span><span class="p">,</span> <span class="n">out2</span><span class="p">,</span> <span class="n">out3</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">+</span> <span class="n">o1</span><span class="p">,</span> <span class="n">s2</span> <span class="o">+</span> <span class="n">o2</span><span class="p">,</span> <span class="n">s3</span> <span class="o">+</span> <span class="n">o3</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PostProcess</span><span class="p">(</span><span class="n">out1</span><span class="p">,</span> <span class="n">out2</span><span class="p">,</span> <span class="n">out3</span><span class="p">)</span>
  
  <span class="n">__radd__</span> <span class="o">=</span> <span class="n">__add__</span>
      
  <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="c"># term wise product</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">long</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">FieldOutput</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VectorFieldOutput</span><span class="p">))</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">,</span> <span class="n">o1</span><span class="p">,</span> <span class="n">o2</span><span class="p">,</span> <span class="n">o3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="n">out1</span><span class="p">,</span> <span class="n">out2</span><span class="p">,</span> <span class="n">out3</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">*</span> <span class="n">o1</span><span class="p">,</span> <span class="n">s2</span> <span class="o">*</span> <span class="n">o2</span><span class="p">,</span> <span class="n">s3</span> <span class="o">*</span> <span class="n">o3</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PostProcess</span><span class="p">(</span><span class="n">out1</span><span class="p">,</span> <span class="n">out2</span><span class="p">,</span> <span class="n">out3</span><span class="p">)</span>
    
  <span class="n">__rmul__</span> <span class="o">=</span> <span class="n">__mul__</span>
  
<div class="viewcode-block" id="VectorFieldOutput.dot"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.VectorFieldOutput.dot">[docs]</a>  <span class="k">def</span> <span class="nf">dot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="c"># dot (scalar) product</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the dot (*i. e.* scalar) product of two vector field outputs.</span>
<span class="sd">    </span>
<span class="sd">    :param other: Another vector field</span>
<span class="sd">    :type other: ``VectorFieldOutput``</span>
<span class="sd">    :rtype: ``FieldOutput``</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">long</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">FieldOutput</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VectorFieldOutput</span><span class="p">))</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span> <span class="o">*</span> <span class="n">other</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    </div>
  <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">long</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">FieldOutput</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VectorFieldOutput</span><span class="p">))</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="n">other</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_coord</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_coord</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_coord</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">VectorFieldOutput</span><span class="p">(</span><span class="n">data1</span> <span class="o">=</span> <span class="o">-</span><span class="n">s1</span><span class="p">,</span> <span class="n">data2</span> <span class="o">=</span> <span class="o">-</span><span class="n">s2</span><span class="p">,</span> <span class="n">data3</span> <span class="o">=</span> <span class="o">-</span><span class="n">s3</span><span class="p">)</span>
    
  <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">long</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">FieldOutput</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VectorFieldOutput</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="n">other</span><span class="p">)</span>   
  
  <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">long</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">FieldOutput</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VectorFieldOutput</span><span class="p">))</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="k">return</span> <span class="o">-</span><span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>
    
    
  <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">long</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">FieldOutput</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VectorFieldOutput</span><span class="p">))</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">,</span> <span class="n">o1</span><span class="p">,</span> <span class="n">o2</span><span class="p">,</span> <span class="n">o3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="n">out1</span><span class="p">,</span> <span class="n">out2</span><span class="p">,</span> <span class="n">out3</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">/</span> <span class="n">o1</span><span class="p">,</span> <span class="n">s2</span> <span class="o">/</span> <span class="n">o2</span><span class="p">,</span> <span class="n">s3</span> <span class="o">/</span> <span class="n">o3</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PostProcess</span><span class="p">(</span><span class="n">out1</span><span class="p">,</span> <span class="n">out2</span><span class="p">,</span> <span class="n">out3</span><span class="p">)</span>
    
  <span class="k">def</span> <span class="nf">__rdiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">long</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">FieldOutput</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VectorFieldOutput</span><span class="p">))</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="k">return</span> <span class="n">other</span> <span class="o">*</span> <span class="bp">self</span><span class="o">**-</span><span class="mi">1</span>
    
<div class="viewcode-block" id="VectorFieldOutput.cross"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.VectorFieldOutput.cross">[docs]</a>  <span class="k">def</span> <span class="nf">cross</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="c"># cross (vector) product</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the cross product of two vector field outputs.</span>
<span class="sd">    </span>
<span class="sd">    :param other: Another vector field</span>
<span class="sd">    :type other: ``VectorFieldOutput``</span>
<span class="sd">    :rtype: ``VectorFieldOutput``</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VectorFieldOutput</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">,</span> <span class="n">o1</span><span class="p">,</span> <span class="n">o2</span><span class="p">,</span> <span class="n">o3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="n">out1</span> <span class="o">=</span> <span class="n">s2</span> <span class="o">*</span> <span class="n">o3</span> <span class="o">-</span> <span class="n">s3</span> <span class="o">*</span> <span class="n">o2</span>
    <span class="n">out2</span> <span class="o">=</span> <span class="n">s3</span> <span class="o">*</span> <span class="n">o1</span> <span class="o">-</span> <span class="n">s1</span> <span class="o">*</span> <span class="n">o3</span>
    <span class="n">out3</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">*</span> <span class="n">o2</span> <span class="o">-</span> <span class="n">s2</span> <span class="o">*</span> <span class="n">o1</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PostProcess</span><span class="p">(</span><span class="n">out1</span><span class="p">,</span> <span class="n">out2</span><span class="p">,</span> <span class="n">out3</span><span class="p">)</span>
  </div>
  <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> 
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">long</span><span class="p">]</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">FieldOutput</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VectorFieldOutput</span><span class="p">))</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">NotImplemented</span>
    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">,</span> <span class="n">o1</span><span class="p">,</span> <span class="n">o2</span><span class="p">,</span> <span class="n">o3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="n">out1</span><span class="p">,</span> <span class="n">out2</span><span class="p">,</span> <span class="n">out3</span> <span class="o">=</span> <span class="n">s1</span> <span class="o">**</span> <span class="n">o1</span><span class="p">,</span> <span class="n">s2</span> <span class="o">**</span> <span class="n">o2</span><span class="p">,</span> <span class="n">s3</span> <span class="o">**</span> <span class="n">o3</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PostProcess</span><span class="p">(</span><span class="n">out1</span><span class="p">,</span> <span class="n">out2</span><span class="p">,</span> <span class="n">out3</span><span class="p">)</span>
    
  <span class="k">def</span> <span class="nf">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_coord</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_coord</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_coord</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">VectorFieldOutput</span><span class="p">(</span><span class="n">data1</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s1</span><span class="p">),</span> <span class="n">data2</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s2</span><span class="p">),</span> <span class="n">data3</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s3</span><span class="p">))</span>
     
<div class="viewcode-block" id="VectorFieldOutput.sum"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.VectorFieldOutput.sum">[docs]</a>  <span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the sum of all coordinates.</span>
<span class="sd">    </span>
<span class="sd">    :rtype: FieldOutput instance</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_coord</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_coord</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_coord</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    
    </div></div>
<div class="viewcode-block" id="TensorFieldOutput"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.TensorFieldOutput">[docs]</a><span class="k">class</span> <span class="nc">TensorFieldOutput</span><span class="p">:</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Symmetric tensor field output. Using this class instead of 6 scalar FieldOutput instances is efficient because labels are stored only since and allows all operations like invariants, product, sum...</span>
<span class="sd"> </span>
<span class="sd">  :param data11: 11 component</span>
<span class="sd">  :type data11: FieldOutput instance or None</span>
<span class="sd">  :param data22: 22 component</span>
<span class="sd">  :type data22: FieldOutput instance or None</span>
<span class="sd">  :param data33: 33 component</span>
<span class="sd">  :type data33: FieldOutput instance or None</span>
<span class="sd">  :param data12: 12 component</span>
<span class="sd">  :type data12: FieldOutput instance or None</span>
<span class="sd">  :param data13: 13 component</span>
<span class="sd">  :type data13: FieldOutput instance or None</span>
<span class="sd">  :param data23: 23 component</span>
<span class="sd">  :type data23: FieldOutput instance or None</span>
<span class="sd">  :param position: position at which data is computed</span>
<span class="sd">  :type position: &#39;node&#39; or &#39;element&#39;</span>
<span class="sd">  :param dti: array.array int data type</span>
<span class="sd">  :type dti: &#39;I&#39; for uint32 or &#39;H&#39; for uint16</span>
<span class="sd">  :param dtf: array.array int data type</span>
<span class="sd">  :type dtf: &#39;f&#39; float32 or &#39;d&#39; for float64</span>
<span class="sd">  </span>
<span class="sd">  &gt;&gt;&gt; from abapy.postproc import FieldOutput, TensorFieldOutput, VectorFieldOutput</span>
<span class="sd">  &gt;&gt;&gt; data11 = [1., 1., 1.]</span>
<span class="sd">  &gt;&gt;&gt; data22 = [2., 4., -1]</span>
<span class="sd">  &gt;&gt;&gt; data12 = [1., 2., 0.]</span>
<span class="sd">  &gt;&gt;&gt; labels = range(1,len(data11)+1)</span>
<span class="sd">  &gt;&gt;&gt; fo11 = FieldOutput(labels = labels, data=data11,position=&#39;node&#39;)</span>
<span class="sd">  &gt;&gt;&gt; fo22 = FieldOutput(labels = labels, data=data22,position=&#39;node&#39;)</span>
<span class="sd">  &gt;&gt;&gt; fo12 = FieldOutput(labels = labels, data=data12,position=&#39;node&#39;)</span>
<span class="sd">  &gt;&gt;&gt; tensor = TensorFieldOutput(data11 = fo11, data22 = fo22, data12 = fo12 )</span>
<span class="sd">  &gt;&gt;&gt; tensor2 = TensorFieldOutput(data11= fo22 )</span>
<span class="sd">  &gt;&gt;&gt; tensor</span>
<span class="sd">  &lt;TensorFieldOutput instance: 3 locations&gt;</span>
<span class="sd">  &gt;&gt;&gt; print tensor</span>
<span class="sd">  TensorFieldOutput instance</span>
<span class="sd">  Position = node</span>
<span class="sd">  Label	Data11	Data22	Data33	Data12	Data13	Data23</span>
<span class="sd">  1	1.0e+00	2.0e+00	0.0e+00	1.0e+00	0.0e+00	0.0e+00</span>
<span class="sd">  2	1.0e+00	4.0e+00	0.0e+00	2.0e+00	0.0e+00	0.0e+00</span>
<span class="sd">  3	1.0e+00	-1.0e+00	0.0e+00	0.0e+00	0.0e+00	0.0e+00</span>
<span class="sd">  &gt;&gt;&gt; print tensor[1,2] </span>
<span class="sd">  TensorFieldOutput instance</span>
<span class="sd">  Position = node</span>
<span class="sd">  Label	Data11	Data22	Data33	Data12	Data13	Data23</span>
<span class="sd">  1	1.0e+00	2.0e+00	0.0e+00	1.0e+00	0.0e+00	0.0e+00</span>
<span class="sd">  2	1.0e+00	4.0e+00	0.0e+00	2.0e+00	0.0e+00	0.0e+00</span>
<span class="sd">  &gt;&gt;&gt; print tensor *2. + 1.</span>
<span class="sd">  TensorFieldOutput instance</span>
<span class="sd">  Position = node</span>
<span class="sd">  Label	Data11	Data22	Data33	Data12	Data13	Data23</span>
<span class="sd">  1	3.0e+00	5.0e+00	1.0e+00	3.0e+00	1.0e+00	1.0e+00</span>
<span class="sd">  2	3.0e+00	9.0e+00	1.0e+00	5.0e+00	1.0e+00	1.0e+00</span>
<span class="sd">  3	3.0e+00	-1.0e+00	1.0e+00	1.0e+00	1.0e+00	1.0e+00</span>
<span class="sd">  &gt;&gt;&gt; print tensor ** 2 # Piecewise power</span>
<span class="sd">  TensorFieldOutput instance</span>
<span class="sd">  Position = node</span>
<span class="sd">  Label	Data11	Data22	Data33	Data12	Data13	Data23</span>
<span class="sd">  1	1.0e+00	4.0e+00	0.0e+00	1.0e+00	0.0e+00	0.0e+00</span>
<span class="sd">  2	1.0e+00	1.6e+01	0.0e+00	4.0e+00	0.0e+00	0.0e+00</span>
<span class="sd">  3	1.0e+00	1.0e+00	0.0e+00	0.0e+00	0.0e+00	0.0e+00</span>
<span class="sd">  &gt;&gt;&gt; vector = VectorFieldOutput(data1 = fo11)</span>
<span class="sd">  &gt;&gt;&gt; print tensor * vector # Matrix product</span>
<span class="sd">  VectorFieldOutput instance</span>
<span class="sd">  Position = node</span>
<span class="sd">  Label	Data1	Data2	Data3</span>
<span class="sd">  1	1.0	1.0	0.0</span>
<span class="sd">  2	1.0	2.0	0.0</span>
<span class="sd">  3	1.0	0.0	0.0</span>
<span class="sd">  &gt;&gt;&gt; print tensor * tensor2 # Contracted tensor product</span>
<span class="sd">  FieldOutput instance</span>
<span class="sd">  Position = node</span>
<span class="sd">  Label	Data</span>
<span class="sd">  1	2.0</span>
<span class="sd">  2	4.0</span>
<span class="sd">  3	-1.0</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data11</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">data22</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">data33</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">data12</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">data13</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">data23</span><span class="o">=</span><span class="bp">None</span> <span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="s">&#39;node&#39;</span><span class="p">,</span> <span class="n">dti</span><span class="o">=</span><span class="s">&#39;I&#39;</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="s">&#39;f&#39;</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">position</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dti</span><span class="p">,[])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data11</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data22</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data33</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,[]),</span> <span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,[]),</span> <span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,[])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">data12</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data13</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data23</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,[]),</span> <span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,[]),</span> <span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,[])</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">data11</span><span class="p">,</span> <span class="n">data22</span><span class="p">,</span> <span class="n">data33</span><span class="p">,</span> <span class="n">data12</span><span class="p">,</span> <span class="n">data13</span><span class="p">,</span> <span class="n">data23</span><span class="p">]</span>
    <span class="n">isNone</span> <span class="o">=</span> <span class="p">[</span><span class="n">data11</span> <span class="o">==</span> <span class="bp">None</span><span class="p">,</span> <span class="n">data22</span> <span class="o">==</span> <span class="bp">None</span><span class="p">,</span> <span class="n">data33</span> <span class="o">==</span> <span class="bp">None</span><span class="p">,</span> <span class="n">data12</span> <span class="o">==</span> <span class="bp">None</span><span class="p">,</span> <span class="n">data13</span> <span class="o">==</span> <span class="bp">None</span><span class="p">,</span> <span class="n">data23</span> <span class="o">==</span> <span class="bp">None</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">FieldOutput</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span> <span class="ow">and</span> <span class="n">d</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;data11, data22, data33, data12, data13 and data23 must be FieldOutput instances.&#39;</span>
    <span class="k">if</span> <span class="n">isNone</span> <span class="o">!=</span> <span class="p">[</span><span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">]:</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span> <span class="n">refData</span> <span class="o">=</span> <span class="n">d</span>
      <span class="n">labels</span> <span class="o">=</span> <span class="n">refData</span><span class="o">.</span><span class="n">labels</span>
      <span class="n">useShortInts</span> <span class="o">=</span> <span class="bp">True</span>
      <span class="n">positions</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ZeroFieldOutput_like</span><span class="p">(</span><span class="n">refData</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">labels</span> <span class="o">!=</span> <span class="n">labels</span><span class="p">:</span>
          <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;data11, data22, data33, data12, data13 and data23 must be fieldOutputs sharing the same labels.&#39;</span>    
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;d&#39;</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">dti</span> <span class="o">==</span> <span class="s">&#39;I&#39;</span><span class="p">:</span> <span class="n">useShortInts</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="n">positions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">useShortInts</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dti</span> <span class="o">=</span> <span class="s">&#39;H&#39;</span>            
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">positions</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;inputs must have the same position or be None.&#39;</span>
      <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">      for i in xrange(len(labels)):</span>
<span class="sd">        l = labels[i]</span>
<span class="sd">        d1, d2, d3 = data[0].data[i] , data[1].data[i] , data[2].data[i]</span>
<span class="sd">        self.add_data(label = l, data1 = d1, data2 = d2, data3 = d3)</span>
<span class="sd">      &#39;&#39;&#39;</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">data11</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data22</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data33</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>  
      <span class="bp">self</span><span class="o">.</span><span class="n">data12</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data13</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data23</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>  
  
<div class="viewcode-block" id="TensorFieldOutput.get_component"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.TensorFieldOutput.get_component">[docs]</a>  <span class="k">def</span> <span class="nf">get_component</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">number</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns a component of the vector as a FieldOutput.</span>
<span class="sd">       </span>
<span class="sd">    :param number: requested coordinate number, 1 is x and so on.</span>
<span class="sd">    :type number: 11, 22, 33, 12, 13 or 23  </span>
<span class="sd">    :rtype: FieldOutput instance</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; v1 = Vec.get_coord(1)</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="c">#from copy import copy</span>
    <span class="k">if</span> <span class="n">number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">23</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;number must be 11, 22, 33, 12, 13 or 23&#39;</span>  
    <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dti</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span>
    <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
    <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">11</span><span class="p">:</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data11</span>
    <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">22</span><span class="p">:</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data22</span>
    <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">33</span><span class="p">:</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data33</span>
    <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">12</span><span class="p">:</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data12</span>
    <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">13</span><span class="p">:</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data23</span>
    <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">23</span><span class="p">:</span> <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data23</span>
    <span class="k">return</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="n">dti</span><span class="o">=</span><span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span><span class="o">=</span><span class="n">dtf</span> <span class="p">)</span>
    </div>
<div class="viewcode-block" id="TensorFieldOutput.get_data"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.TensorFieldOutput.get_data">[docs]</a>  <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the components (*11, 22, 33, 12, 13 or 23*) at a location with given label. </span>
<span class="sd">    </span>
<span class="sd">    :param label: location&#39;s label.</span>
<span class="sd">    :type label: int &gt; 0</span>
<span class="sd">    :rtype: float, float, float, float, float, float</span>
<span class="sd">        </span>
<span class="sd">    .. note:: Requesting data at a label that does not exist in the instance will just lead in a warning but if label is negative or is not int, then an Exception will be raised.</span>
<span class="sd">    &#39;&#39;&#39;</span>
     
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]</span> <span class="ow">or</span> <span class="n">label</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;label must be int &gt; 0, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>  
    <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
      <span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data11</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data22</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data33</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data12</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data13</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data23</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> 
    <span class="k">else</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&#39;Info: requesting data at non existant location, returning None&#39;</span>
      </div>
<div class="viewcode-block" id="TensorFieldOutput.add_data"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.TensorFieldOutput.add_data">[docs]</a>  <span class="k">def</span> <span class="nf">add_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">label</span><span class="p">,</span> <span class="n">data11</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">data22</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">data33</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">data12</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">data13</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">data23</span><span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Adds one point to a VectorFieldOutput instance. Label must not already exist in the current FieldOutput, if not so, nothing will be changed. Data and label will be inserted in self.data, self.labels in order to keep self.labels sorted.</span>
<span class="sd">   </span>
<span class="sd">    :param label: labels of the nodes/elements where the field is evaluated.</span>
<span class="sd">    :type labels: int &gt; 0</span>
<span class="sd">    :param data11: value of the component 11 of the field where it is evaluated.</span>
<span class="sd">    :type data1: float</span>
<span class="sd">    :param data22: value of the component 22 of the field where it is evaluated.</span>
<span class="sd">    :type data2: float</span>
<span class="sd">    :param data33: value of the component 33 of the field where it is evaluated.</span>
<span class="sd">    :type data3: float</span>
<span class="sd">    :param data12: value of the component 12 of the field where it is evaluated.</span>
<span class="sd">    :type data1: float</span>
<span class="sd">    :param data13: value of the component 13 of the field where it is evaluated.</span>
<span class="sd">    :type data2: float</span>
<span class="sd">    :param data23: value of the component 23 of the field where it is evaluated.</span>
<span class="sd">    :type data3: float</span>
<span class="sd">    &#39;&#39;&#39;</span>
       
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="n">dti</span><span class="p">,</span><span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dti</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">:</span>
      <span class="k">print</span> <span class="s">&#39;data already exists at this node&#39;</span>
      <span class="k">return</span> 
    <span class="k">else</span><span class="p">:</span>
      <span class="n">self_data11</span><span class="p">,</span> <span class="n">self_data22</span><span class="p">,</span> <span class="n">self_data33</span><span class="p">,</span> <span class="n">self_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data11</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data22</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data33</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
      <span class="n">self_data12</span><span class="p">,</span> <span class="n">self_data13</span><span class="p">,</span> <span class="n">self_data23</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data12</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data13</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data23</span>
      <span class="n">self_data11</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data11</span><span class="p">)</span>
      <span class="n">self_data22</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data22</span><span class="p">)</span>
      <span class="n">self_data33</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data33</span><span class="p">)</span>
      <span class="n">self_data12</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data12</span><span class="p">)</span>
      <span class="n">self_data13</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data13</span><span class="p">)</span>
      <span class="n">self_data23</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data23</span><span class="p">)</span>
      <span class="n">self_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
      <span class="n">zipped</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">self_labels</span><span class="p">,</span><span class="n">self_data11</span><span class="p">,</span> <span class="n">self_data22</span><span class="p">,</span> <span class="n">self_data33</span><span class="p">,</span><span class="n">self_data12</span><span class="p">,</span> <span class="n">self_data13</span><span class="p">,</span> <span class="n">self_data23</span><span class="p">)</span>
      <span class="n">labels</span><span class="p">,</span><span class="n">data11</span><span class="p">,</span> <span class="n">data22</span><span class="p">,</span> <span class="n">data33</span><span class="p">,</span><span class="n">data12</span><span class="p">,</span> <span class="n">data13</span><span class="p">,</span> <span class="n">data23</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="n">zipped</span><span class="p">))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">data11</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span><span class="n">data11</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">data22</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span><span class="n">data22</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">data33</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span><span class="n">data33</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">data12</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span><span class="n">data12</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">data13</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span><span class="n">data13</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">data23</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span><span class="n">data23</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dti</span><span class="p">,</span><span class="n">labels</span><span class="p">)</span>   
  </div>
<div class="viewcode-block" id="TensorFieldOutput.dump2vtk"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.TensorFieldOutput.dump2vtk">[docs]</a>  <span class="k">def</span> <span class="nf">dump2vtk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;tensorFieldOutput&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Converts the TensorFieldOutput instance to VTK format which can be directly read by Mayavi2 or Paraview. This method is very useful to quickly and efficiently plot 3D mesh and fields.</span>
<span class="sd">    </span>
<span class="sd">    :param name: name used for the field in the output.</span>
<span class="sd">    :type name: string</span>
<span class="sd">    :rtype: string</span>
<span class="sd">    </span>
<span class="sd">    .. note:: this method has not been fully tested yet, bugs are probably still in.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">d11</span><span class="p">,</span> <span class="n">d22</span><span class="p">,</span> <span class="n">d33</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data11</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data22</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data33</span>
    <span class="n">d12</span><span class="p">,</span> <span class="n">d13</span><span class="p">,</span> <span class="n">d23</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data12</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data13</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data23</span>
    <span class="n">ld</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">d11</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="s">&#39;node&#39;</span><span class="p">:</span> <span class="n">dataType</span> <span class="o">=</span> <span class="s">&#39;POINT_DATA&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="s">&#39;element&#39;</span><span class="p">:</span> <span class="n">dataType</span> <span class="o">=</span> <span class="s">&#39;CELL_DATA&#39;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s">&#39;{2} {0}</span><span class="se">\n</span><span class="s">TENSORS {1} float</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ld</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">dataType</span><span class="p">)</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;{0} {3} {4}</span><span class="se">\n</span><span class="s">{3} {1} {5}</span><span class="se">\n</span><span class="s">{4} {5} {2}</span><span class="se">\n\n</span><span class="s">&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">ld</span><span class="p">):</span>
      <span class="n">out</span> <span class="o">+=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">d11</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">d22</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">d33</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">d12</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">d13</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">d23</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">out</span>
    </div>
  <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">labels</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
    <span class="n">data11</span><span class="p">,</span> <span class="n">data22</span><span class="p">,</span> <span class="n">data33</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">data11</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data22</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data33</span>
    <span class="n">data12</span><span class="p">,</span> <span class="n">data13</span><span class="p">,</span> <span class="n">data23</span> <span class="o">=</span>  <span class="bp">self</span><span class="o">.</span><span class="n">data12</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data13</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data23</span>
    <span class="n">out</span> <span class="o">=</span> <span class="s">&#39;TensorFieldOutput instance</span><span class="se">\n</span><span class="s">Position = {0}</span><span class="se">\n</span><span class="s">Label</span><span class="se">\t</span><span class="s">Data11</span><span class="se">\t</span><span class="s">Data22</span><span class="se">\t</span><span class="s">Data33</span><span class="se">\t</span><span class="s">Data12</span><span class="se">\t</span><span class="s">Data13</span><span class="se">\t</span><span class="s">Data23</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;{0}</span><span class="se">\t</span><span class="s">{1:.1e}</span><span class="se">\t</span><span class="s">{2:.1e}</span><span class="se">\t</span><span class="s">{3:.1e}</span><span class="se">\t</span><span class="s">{4:.1e}</span><span class="se">\t</span><span class="s">{5:.1e}</span><span class="se">\t</span><span class="s">{6:.1e}</span><span class="se">\n</span><span class="s">&#39;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span> <span class="n">out</span> <span class="o">+=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data11</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data22</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data33</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data12</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data13</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data23</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">out</span>
    
  <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&#39;&lt;TensorFieldOutput instance: {0} locations&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">s</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">nan</span>
    <span class="n">labs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="n">labs</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">slice</span><span class="p">:</span>
      <span class="n">start</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">start</span>
      <span class="n">stop</span>  <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">stop</span>
      <span class="n">step</span>  <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">step</span>
      <span class="n">labs</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span><span class="n">stop</span><span class="p">,</span><span class="n">step</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">,</span><span class="n">array</span><span class="p">]:</span>  
      <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span><span class="n">labs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
       
    <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
    <span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span>
    <span class="n">dti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dti</span>
    <span class="n">data11</span><span class="p">,</span> <span class="n">data22</span><span class="p">,</span> <span class="n">data33</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data11</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data22</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data33</span>
    <span class="n">data12</span><span class="p">,</span> <span class="n">data13</span><span class="p">,</span> <span class="n">data23</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data12</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data13</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">data23</span>
    <span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
    <span class="n">fo</span> <span class="o">=</span> <span class="n">TensorFieldOutput</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">position</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labs</span><span class="p">:</span>    
      <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">l</span><span class="p">,</span> <span class="n">data11</span> <span class="o">=</span> <span class="n">data11</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data22</span> <span class="o">=</span> <span class="n">data22</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data33</span> <span class="o">=</span> <span class="n">data33</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data12</span> <span class="o">=</span> <span class="n">data12</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data13</span> <span class="o">=</span> <span class="n">data13</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data23</span> <span class="o">=</span> <span class="n">data23</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="n">l</span><span class="p">,</span> <span class="n">data11</span> <span class="o">=</span> <span class="n">nan</span><span class="p">,</span> <span class="n">data22</span> <span class="o">=</span> <span class="n">nan</span><span class="p">,</span> <span class="n">data33</span> <span class="o">=</span> <span class="n">nan</span><span class="p">,</span> <span class="n">data12</span> <span class="o">=</span> <span class="n">nan</span><span class="p">,</span> <span class="n">data13</span> <span class="o">=</span> <span class="n">nan</span><span class="p">,</span> <span class="n">data23</span> <span class="o">=</span> <span class="n">nan</span> <span class="p">)</span>  
    <span class="k">return</span> <span class="n">fo</span>
    
    
  <span class="k">def</span> <span class="nf">_PreProcess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="n">s11</span><span class="p">,</span> <span class="n">s22</span><span class="p">,</span> <span class="n">s33</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_component</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_component</span><span class="p">(</span><span class="mi">22</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_component</span><span class="p">(</span><span class="mi">33</span><span class="p">)</span>
    <span class="n">s12</span><span class="p">,</span> <span class="n">s13</span><span class="p">,</span> <span class="n">s23</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_component</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_component</span><span class="p">(</span><span class="mi">13</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_component</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">TensorFieldOutput</span><span class="p">):</span>
      <span class="n">o11</span><span class="p">,</span> <span class="n">o22</span><span class="p">,</span> <span class="n">o33</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">get_component</span><span class="p">(</span><span class="mi">11</span><span class="p">),</span> <span class="n">other</span><span class="o">.</span><span class="n">get_component</span><span class="p">(</span><span class="mi">22</span><span class="p">),</span> <span class="n">other</span><span class="o">.</span><span class="n">get_component</span><span class="p">(</span><span class="mi">33</span><span class="p">)</span>
      <span class="n">o12</span><span class="p">,</span> <span class="n">o13</span><span class="p">,</span> <span class="n">o23</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">get_component</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span> <span class="n">other</span><span class="o">.</span><span class="n">get_component</span><span class="p">(</span><span class="mi">13</span><span class="p">),</span> <span class="n">other</span><span class="o">.</span><span class="n">get_component</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span>
      <span class="n">o</span> <span class="o">=</span> <span class="p">(</span><span class="n">o11</span><span class="p">,</span> <span class="n">o22</span><span class="p">,</span> <span class="n">o33</span><span class="p">,</span> <span class="n">o12</span><span class="p">,</span> <span class="n">o13</span><span class="p">,</span> <span class="n">o23</span><span class="p">)</span>
      <span class="n">otype</span> <span class="o">=</span> <span class="s">&#39;tensor&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">VectorFieldOutput</span><span class="p">):</span>
      <span class="n">o1</span><span class="p">,</span> <span class="n">o2</span><span class="p">,</span> <span class="n">o3</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">get_coord</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">other</span><span class="o">.</span><span class="n">get_coord</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">other</span><span class="o">.</span><span class="n">get_coord</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
      <span class="n">o</span> <span class="o">=</span> <span class="p">(</span><span class="n">o1</span><span class="p">,</span> <span class="n">o2</span><span class="p">,</span> <span class="n">o3</span><span class="p">)</span>
      <span class="n">otype</span> <span class="o">=</span> <span class="s">&#39;vector&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">FieldOutput</span><span class="p">):</span>
      <span class="n">o</span> <span class="o">=</span> <span class="n">other</span>
      <span class="n">otype</span> <span class="o">=</span> <span class="s">&#39;scalar&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">other</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="n">o</span> <span class="o">=</span> <span class="n">other</span> <span class="o">*</span> <span class="n">OneFieldOutput_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_component</span><span class="p">(</span><span class="mi">11</span><span class="p">))</span>
      <span class="n">otype</span> <span class="o">=</span> <span class="s">&#39;scalar&#39;</span>
    <span class="k">return</span> <span class="n">s11</span><span class="p">,</span> <span class="n">s22</span><span class="p">,</span> <span class="n">s33</span><span class="p">,</span> <span class="n">s12</span><span class="p">,</span> <span class="n">s13</span><span class="p">,</span> <span class="n">s23</span><span class="p">,</span> <span class="n">otype</span><span class="p">,</span> <span class="n">o</span>
     
  <span class="k">def</span> <span class="nf">_TensorPostProcess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out11</span><span class="p">,</span> <span class="n">out22</span><span class="p">,</span> <span class="n">out33</span><span class="p">,</span> <span class="n">out12</span><span class="p">,</span> <span class="n">out13</span><span class="p">,</span> <span class="n">out23</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">TensorFieldOutput</span><span class="p">(</span><span class="n">data11</span> <span class="o">=</span> <span class="n">out11</span><span class="p">,</span> <span class="n">data22</span> <span class="o">=</span> <span class="n">out22</span><span class="p">,</span> <span class="n">data33</span> <span class="o">=</span> <span class="n">out33</span><span class="p">,</span> <span class="n">data12</span> <span class="o">=</span> <span class="n">out12</span><span class="p">,</span> <span class="n">data13</span> <span class="o">=</span> <span class="n">out13</span><span class="p">,</span> <span class="n">data23</span> <span class="o">=</span> <span class="n">out23</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>
  
  <span class="k">def</span> <span class="nf">_VectorPostProcess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out1</span><span class="p">,</span> <span class="n">out2</span><span class="p">,</span> <span class="n">out3</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">VectorFieldOutput</span><span class="p">(</span><span class="n">data1</span> <span class="o">=</span> <span class="n">out1</span><span class="p">,</span> <span class="n">data2</span> <span class="o">=</span> <span class="n">out2</span><span class="p">,</span> <span class="n">data3</span> <span class="o">=</span> <span class="n">out3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span>
  
  <span class="k">def</span> <span class="nf">_ScalarPostProcess</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span> <span class="o">*</span> <span class="n">OneFieldOutput_like</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_component</span><span class="p">(</span><span class="mi">11</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">out</span>
  
  <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="n">s11</span><span class="p">,</span> <span class="n">s22</span><span class="p">,</span> <span class="n">s33</span><span class="p">,</span> <span class="n">s12</span><span class="p">,</span> <span class="n">s13</span><span class="p">,</span> <span class="n">s23</span><span class="p">,</span> <span class="n">otype</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">otype</span> <span class="o">==</span> <span class="s">&#39;scalar&#39;</span><span class="p">:</span>
      <span class="n">out11</span><span class="p">,</span> <span class="n">out22</span><span class="p">,</span> <span class="n">out33</span> <span class="o">=</span> <span class="n">s11</span> <span class="o">+</span> <span class="n">o</span><span class="p">,</span> <span class="n">s22</span> <span class="o">+</span> <span class="n">o</span><span class="p">,</span> <span class="n">s33</span> <span class="o">+</span> <span class="n">o</span>
      <span class="n">out12</span><span class="p">,</span> <span class="n">out13</span><span class="p">,</span> <span class="n">out23</span> <span class="o">=</span> <span class="n">s12</span> <span class="o">+</span> <span class="n">o</span><span class="p">,</span> <span class="n">s13</span> <span class="o">+</span> <span class="n">o</span><span class="p">,</span> <span class="n">s23</span> <span class="o">+</span> <span class="n">o</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TensorPostProcess</span><span class="p">(</span><span class="n">out11</span><span class="p">,</span> <span class="n">out22</span><span class="p">,</span> <span class="n">out33</span><span class="p">,</span> <span class="n">out12</span><span class="p">,</span> <span class="n">out13</span><span class="p">,</span> <span class="n">out23</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">otype</span> <span class="o">==</span> <span class="s">&#39;vector&#39;</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;Tensors and vectors cannot be added.&#39;</span>
    <span class="k">if</span> <span class="n">otype</span> <span class="o">==</span> <span class="s">&#39;tensor&#39;</span><span class="p">:</span>
      <span class="n">o11</span><span class="p">,</span> <span class="n">o22</span><span class="p">,</span> <span class="n">o33</span><span class="p">,</span> <span class="n">o12</span><span class="p">,</span> <span class="n">o13</span><span class="p">,</span> <span class="n">o23</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">o</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">o</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">o</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> 
      <span class="n">out11</span><span class="p">,</span> <span class="n">out22</span><span class="p">,</span> <span class="n">out33</span> <span class="o">=</span> <span class="n">s11</span> <span class="o">+</span> <span class="n">o11</span><span class="p">,</span> <span class="n">s22</span> <span class="o">+</span> <span class="n">o22</span><span class="p">,</span> <span class="n">s33</span> <span class="o">+</span> <span class="n">o33</span>
      <span class="n">out12</span><span class="p">,</span> <span class="n">out13</span><span class="p">,</span> <span class="n">out23</span> <span class="o">=</span> <span class="n">s12</span> <span class="o">+</span> <span class="n">o12</span><span class="p">,</span> <span class="n">s13</span> <span class="o">+</span> <span class="n">o13</span><span class="p">,</span> <span class="n">s23</span> <span class="o">+</span> <span class="n">o23</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TensorPostProcess</span><span class="p">(</span><span class="n">out11</span><span class="p">,</span> <span class="n">out22</span><span class="p">,</span> <span class="n">out33</span><span class="p">,</span> <span class="n">out12</span><span class="p">,</span> <span class="n">out13</span><span class="p">,</span> <span class="n">out23</span><span class="p">)</span>
    
  <span class="n">__radd__</span> <span class="o">=</span> <span class="n">__add__</span>
      
  <span class="k">def</span> <span class="nf">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> 
    <span class="n">s11</span><span class="p">,</span> <span class="n">s22</span><span class="p">,</span> <span class="n">s33</span><span class="p">,</span> <span class="n">s12</span><span class="p">,</span> <span class="n">s13</span><span class="p">,</span> <span class="n">s23</span><span class="p">,</span> <span class="n">otype</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">otype</span> <span class="o">==</span> <span class="s">&#39;scalar&#39;</span><span class="p">:</span> <span class="c"># term wise product</span>
      <span class="n">out11</span><span class="p">,</span> <span class="n">out22</span><span class="p">,</span> <span class="n">out33</span> <span class="o">=</span> <span class="n">s11</span> <span class="o">*</span> <span class="n">o</span><span class="p">,</span> <span class="n">s22</span> <span class="o">*</span> <span class="n">o</span><span class="p">,</span> <span class="n">s33</span> <span class="o">*</span> <span class="n">o</span>
      <span class="n">out12</span><span class="p">,</span> <span class="n">out13</span><span class="p">,</span> <span class="n">out23</span> <span class="o">=</span> <span class="n">s12</span> <span class="o">*</span> <span class="n">o</span><span class="p">,</span> <span class="n">s13</span> <span class="o">*</span> <span class="n">o</span><span class="p">,</span> <span class="n">s23</span> <span class="o">*</span> <span class="n">o</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TensorPostProcess</span><span class="p">(</span><span class="n">out11</span><span class="p">,</span> <span class="n">out22</span><span class="p">,</span> <span class="n">out33</span><span class="p">,</span> <span class="n">out12</span><span class="p">,</span> <span class="n">out13</span><span class="p">,</span> <span class="n">out23</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">otype</span> <span class="o">==</span> <span class="s">&#39;vector&#39;</span><span class="p">:</span> 
      <span class="n">o1</span><span class="p">,</span> <span class="n">o2</span><span class="p">,</span> <span class="n">o3</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
      <span class="n">out1</span> <span class="o">=</span> <span class="n">s11</span> <span class="o">*</span> <span class="n">o1</span> <span class="o">+</span> <span class="n">s12</span> <span class="o">*</span> <span class="n">o2</span> <span class="o">+</span> <span class="n">s13</span> <span class="o">*</span> <span class="n">o3</span>   
      <span class="n">out2</span> <span class="o">=</span> <span class="n">s12</span> <span class="o">*</span> <span class="n">o1</span> <span class="o">+</span> <span class="n">s22</span> <span class="o">*</span> <span class="n">o2</span> <span class="o">+</span> <span class="n">s23</span> <span class="o">*</span> <span class="n">o3</span>
      <span class="n">out3</span> <span class="o">=</span> <span class="n">s13</span> <span class="o">*</span> <span class="n">o1</span> <span class="o">+</span> <span class="n">s23</span> <span class="o">*</span> <span class="n">o2</span> <span class="o">+</span> <span class="n">s33</span> <span class="o">*</span> <span class="n">o3</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_VectorPostProcess</span><span class="p">(</span><span class="n">out1</span><span class="p">,</span> <span class="n">out2</span><span class="p">,</span> <span class="n">out3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">otype</span> <span class="o">==</span> <span class="s">&#39;tensor&#39;</span><span class="p">:</span> <span class="c"># doubly contracted product</span>
      <span class="n">o11</span><span class="p">,</span> <span class="n">o22</span><span class="p">,</span> <span class="n">o33</span><span class="p">,</span> <span class="n">o12</span><span class="p">,</span> <span class="n">o13</span><span class="p">,</span> <span class="n">o23</span> <span class="o">=</span> <span class="n">o</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">o</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">o</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">o</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">o</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">o</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> 
      <span class="n">out</span> <span class="o">=</span> <span class="n">s11</span> <span class="o">*</span> <span class="n">o11</span> <span class="o">+</span> <span class="n">s22</span> <span class="o">*</span> <span class="n">o22</span> <span class="o">+</span> <span class="n">s33</span> <span class="o">*</span> <span class="n">o33</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span><span class="p">(</span> <span class="n">s12</span> <span class="o">*</span> <span class="n">o12</span> <span class="o">+</span> <span class="n">s13</span> <span class="o">*</span> <span class="n">o13</span> <span class="o">+</span> <span class="n">s23</span> <span class="o">*</span> <span class="n">o23</span> <span class="p">)</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ScalarPostProcess</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    
  <span class="n">__rmul__</span> <span class="o">=</span> <span class="n">__mul__</span> <span class="c"># Here we accept that vector * tensor = tensor * vector. This is theoretically dangerous but in this context, it cannot lead to wrong results. It can be further discussed if necessary.</span>
  
  
    
  <span class="k">def</span> <span class="nf">__neg__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">other</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="n">s11</span><span class="p">,</span> <span class="n">s22</span><span class="p">,</span> <span class="n">s33</span><span class="p">,</span> <span class="n">s12</span><span class="p">,</span> <span class="n">s13</span><span class="p">,</span> <span class="n">s23</span><span class="p">,</span> <span class="n">otype</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TensorPostProcess</span><span class="p">(</span><span class="o">-</span><span class="n">s11</span><span class="p">,</span> <span class="o">-</span><span class="n">s22</span><span class="p">,</span> <span class="o">-</span><span class="n">s33</span><span class="p">,</span> <span class="o">-</span><span class="n">s12</span><span class="p">,</span> <span class="o">-</span><span class="n">s13</span><span class="p">,</span> <span class="o">-</span><span class="n">s23</span><span class="p">)</span>
    
      
  <span class="k">def</span> <span class="nf">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="p">(</span><span class="o">-</span><span class="n">other</span><span class="p">)</span>   
  
  <span class="k">def</span> <span class="nf">__rsub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>
    
  <span class="k">def</span> <span class="nf">__div__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="n">s11</span><span class="p">,</span> <span class="n">s22</span><span class="p">,</span> <span class="n">s33</span><span class="p">,</span> <span class="n">s12</span><span class="p">,</span> <span class="n">s13</span><span class="p">,</span> <span class="n">s23</span><span class="p">,</span> <span class="n">otype</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">otype</span> <span class="o">==</span> <span class="s">&#39;scalar&#39;</span><span class="p">:</span> 
      <span class="n">out11</span><span class="p">,</span> <span class="n">out22</span><span class="p">,</span> <span class="n">out33</span> <span class="o">=</span> <span class="n">s11</span> <span class="o">/</span> <span class="n">o</span><span class="p">,</span> <span class="n">s22</span> <span class="o">/</span> <span class="n">o</span><span class="p">,</span> <span class="n">s33</span> <span class="o">/</span> <span class="n">o</span>
      <span class="n">out12</span><span class="p">,</span> <span class="n">out13</span><span class="p">,</span> <span class="n">out23</span> <span class="o">=</span> <span class="n">s12</span> <span class="o">/</span> <span class="n">o</span><span class="p">,</span> <span class="n">s13</span> <span class="o">/</span> <span class="n">o</span><span class="p">,</span> <span class="n">s23</span> <span class="o">/</span> <span class="n">o</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TensorPostProcess</span><span class="p">(</span><span class="n">out11</span><span class="p">,</span> <span class="n">out22</span><span class="p">,</span> <span class="n">out33</span><span class="p">,</span> <span class="n">out12</span><span class="p">,</span> <span class="n">out13</span><span class="p">,</span> <span class="n">out23</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">otype</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;tensor, vector&#39;</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;tensor division is only defined with scalars.&#39;</span>
         
  <span class="k">def</span> <span class="nf">__rdiv__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">other</span> <span class="o">*</span> <span class="bp">self</span><span class="o">**-</span><span class="mi">1</span>
    
    
  <span class="k">def</span> <span class="nf">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span> <span class="c"># Piecewise power</span>
    <span class="n">s11</span><span class="p">,</span> <span class="n">s22</span><span class="p">,</span> <span class="n">s33</span><span class="p">,</span> <span class="n">s12</span><span class="p">,</span> <span class="n">s13</span><span class="p">,</span> <span class="n">s23</span><span class="p">,</span> <span class="n">otype</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">otype</span> <span class="o">==</span> <span class="s">&#39;scalar&#39;</span><span class="p">:</span> 
      <span class="n">out11</span><span class="p">,</span> <span class="n">out22</span><span class="p">,</span> <span class="n">out33</span> <span class="o">=</span> <span class="n">s11</span> <span class="o">**</span> <span class="n">o</span><span class="p">,</span> <span class="n">s22</span> <span class="o">**</span> <span class="n">o</span><span class="p">,</span> <span class="n">s33</span> <span class="o">**</span> <span class="n">o</span>
      <span class="n">out12</span><span class="p">,</span> <span class="n">out13</span><span class="p">,</span> <span class="n">out23</span> <span class="o">=</span> <span class="n">s12</span> <span class="o">**</span> <span class="n">o</span><span class="p">,</span> <span class="n">s13</span> <span class="o">**</span> <span class="n">o</span><span class="p">,</span> <span class="n">s23</span> <span class="o">**</span> <span class="n">o</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TensorPostProcess</span><span class="p">(</span><span class="n">out11</span><span class="p">,</span> <span class="n">out22</span><span class="p">,</span> <span class="n">out33</span><span class="p">,</span> <span class="n">out12</span><span class="p">,</span> <span class="n">out13</span><span class="p">,</span> <span class="n">out23</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">otype</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&#39;tensor, vector&#39;</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;tensor power is only defined with scalars.&#39;</span>
    
  <span class="k">def</span> <span class="nf">__abs__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
    <span class="n">other</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="n">s11</span><span class="p">,</span> <span class="n">s22</span><span class="p">,</span> <span class="n">s33</span><span class="p">,</span> <span class="n">s12</span><span class="p">,</span> <span class="n">s13</span><span class="p">,</span> <span class="n">s23</span><span class="p">,</span> <span class="n">otype</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_TensorPostProcess</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">s11</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s22</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s33</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s12</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s13</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">s23</span><span class="p">))</span>
    
    
<div class="viewcode-block" id="TensorFieldOutput.sum"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.TensorFieldOutput.sum">[docs]</a>  <span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the sum of all components of the tensor.</span>
<span class="sd">    </span>
<span class="sd">    :rtype: ``FieldOutput`` instance.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">other</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="n">s11</span><span class="p">,</span> <span class="n">s22</span><span class="p">,</span> <span class="n">s33</span><span class="p">,</span> <span class="n">s12</span><span class="p">,</span> <span class="n">s13</span><span class="p">,</span> <span class="n">s23</span><span class="p">,</span> <span class="n">otype</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s11</span> <span class="o">+</span> <span class="n">s22</span> <span class="o">+</span> <span class="n">s33</span> <span class="o">+</span> <span class="n">s12</span> <span class="o">+</span> <span class="n">s13</span> <span class="o">+</span> <span class="n">s23</span>
  </div>
<div class="viewcode-block" id="TensorFieldOutput.trace"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.TensorFieldOutput.trace">[docs]</a>  <span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the trace of the tensor: :math:`trace(T) = T_{11} + T_{22} + T_{33}`</span>
<span class="sd">    </span>
<span class="sd">    :rtype: ``FieldOutput`` instance.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">other</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="n">s11</span><span class="p">,</span> <span class="n">s22</span><span class="p">,</span> <span class="n">s33</span><span class="p">,</span> <span class="n">s12</span><span class="p">,</span> <span class="n">s13</span><span class="p">,</span> <span class="n">s23</span><span class="p">,</span> <span class="n">otype</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s11</span> <span class="o">+</span> <span class="n">s22</span> <span class="o">+</span> <span class="n">s33</span>
  </div>
<div class="viewcode-block" id="TensorFieldOutput.deviatoric"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.TensorFieldOutput.deviatoric">[docs]</a>  <span class="k">def</span> <span class="nf">deviatoric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the deviatoric part tensor: :math:`T_{d} = T - T_{s}`</span>
<span class="sd">    </span>
<span class="sd">    :rtype: ``TensorFieldOutput`` instance</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">spheric</span><span class="p">()</span>
    </div>
<div class="viewcode-block" id="TensorFieldOutput.spheric"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.TensorFieldOutput.spheric">[docs]</a>  <span class="k">def</span> <span class="nf">spheric</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the spheric part of the tensor: :math:`T_{s} = \\frac{1}{3} trace(T) I_3`</span>
<span class="sd">    </span>
<span class="sd">    :rtype: ``TensorFieldOutput`` instance</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">()</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">)</span> <span class="o">*</span> <span class="n">Identity_like</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
  </div>
<div class="viewcode-block" id="TensorFieldOutput.i1"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.TensorFieldOutput.i1">[docs]</a>  <span class="k">def</span> <span class="nf">i1</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the first invariant, is equivalent to trace. </span>
<span class="sd">    </span>
<span class="sd">    :rtype: ``FieldOutput`` instance.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">()</span>
    </div>
<div class="viewcode-block" id="TensorFieldOutput.pressure"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.TensorFieldOutput.pressure">[docs]</a>  <span class="k">def</span> <span class="nf">pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the pressure. </span>
<span class="sd">    </span>
<span class="sd">    :rtype: ``FieldOutput`` instance.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="p">()</span><span class="o">/</span><span class="mf">3.</span>
   </div>
<div class="viewcode-block" id="TensorFieldOutput.i2"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.TensorFieldOutput.i2">[docs]</a>  <span class="k">def</span> <span class="nf">i2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the second invariant of the tensor defined as: :math:`inv2(T) = trace(T.T)`</span>
<span class="sd">        </span>
<span class="sd">    :rtype: ``FieldOutput`` instance.</span>
<span class="sd">    </span>
<span class="sd">    .. note:: this definition is the most practical one for mechanical engineering but not the only one possible. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">*</span><span class="bp">self</span>
    </div>
<div class="viewcode-block" id="TensorFieldOutput.j2"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.TensorFieldOutput.j2">[docs]</a>  <span class="k">def</span> <span class="nf">j2</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the second invariant of the deviatoric part of the tensor defined as: :math:`inv2(T) = trace(T_d.T_d)`</span>
<span class="sd">        </span>
<span class="sd">    :rtype: ``FieldOutput`` instance.</span>
<span class="sd">    </span>
<span class="sd">    .. note:: this definition is not the mathematical definition but is the most practical one for mechanical engineering. This should be debated.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deviatoric</span><span class="p">()</span><span class="o">.</span><span class="n">i2</span><span class="p">()</span>
  </div>
<div class="viewcode-block" id="TensorFieldOutput.i3"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.TensorFieldOutput.i3">[docs]</a>  <span class="k">def</span> <span class="nf">i3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the third invariant of the tensor: :math:`inv3(T) = \\det(T)`</span>
<span class="sd">    </span>
<span class="sd">    :rtype: ``FieldOutput`` instance.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">other</span> <span class="o">=</span> <span class="mf">1.</span>
    <span class="n">s11</span><span class="p">,</span> <span class="n">s22</span><span class="p">,</span> <span class="n">s33</span><span class="p">,</span> <span class="n">s12</span><span class="p">,</span> <span class="n">s13</span><span class="p">,</span> <span class="n">s23</span><span class="p">,</span> <span class="n">otype</span><span class="p">,</span> <span class="n">o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_PreProcess</span><span class="p">(</span><span class="n">other</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">s11</span> <span class="o">*</span> <span class="n">s22</span> <span class="o">*</span> <span class="n">s33</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">s12</span> <span class="o">*</span> <span class="n">s23</span> <span class="o">*</span> <span class="n">s13</span> <span class="o">-</span> <span class="n">s12</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">s33</span> <span class="o">-</span> <span class="n">s23</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">s11</span> <span class="o">-</span> <span class="n">s13</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">s22</span><span class="p">)</span>
  </div>
<div class="viewcode-block" id="TensorFieldOutput.j3"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.TensorFieldOutput.j3">[docs]</a>  <span class="k">def</span> <span class="nf">j3</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the third invariant of the deviatoric part of the tensor: :math:`inv3(T) = \\det(T_d)`</span>
<span class="sd">    </span>
<span class="sd">    :rtype: ``FieldOutput`` instance.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deviatoric</span><span class="p">()</span><span class="o">.</span><span class="n">i3</span><span class="p">()</span>
  </div>
<div class="viewcode-block" id="TensorFieldOutput.vonmises"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.TensorFieldOutput.vonmises">[docs]</a>  <span class="k">def</span> <span class="nf">vonmises</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the von Mises equivalent equivalent *stress* of the tensor: :math:`vonmises(T) = \\sqrt{\\frac{3}{2} trace(T_d.T_d)}`</span>
<span class="sd">    </span>
<span class="sd">    :rtype: ``FieldOutput`` instance.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">j2</span><span class="p">())</span><span class="o">**.</span><span class="mi">5</span>
    </div>
<div class="viewcode-block" id="TensorFieldOutput.tresca"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.TensorFieldOutput.tresca">[docs]</a>  <span class="k">def</span> <span class="nf">tresca</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the tresca equivalent *stress* of the tensor: :math:`tresca(T) = max\\left( |t_1 - t_2|, |t_1 - t_3|, |t_2 - t_3|  \\right)` where :math:`t_i` is the i-est eigen value of T.</span>
<span class="sd">    </span>
<span class="sd">    :rtype: ``FieldOutput`` instance.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigen</span><span class="p">()</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
    <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dti</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span>
    <span class="n">d1</span><span class="p">,</span> <span class="n">d2</span><span class="p">,</span> <span class="n">d3</span> <span class="o">=</span> <span class="n">s1</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">s2</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">s3</span><span class="o">.</span><span class="n">data</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">[]</span> 
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
      <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="nb">max</span><span class="p">([</span> <span class="nb">abs</span><span class="p">(</span><span class="n">d1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">d2</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">d1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">d3</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">d3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">d2</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="p">])</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">t</span><span class="p">,</span> <span class="n">position</span> <span class="o">=</span> <span class="n">pos</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="TensorFieldOutput.eigen"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.TensorFieldOutput.eigen">[docs]</a>  <span class="k">def</span> <span class="nf">eigen</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the three eigenvalues with decreasing sorting and the 3 normed respective eigenvectors.</span>
<span class="sd">    </span>
<span class="sd">    :rtype: 3 ``FieldOutput`` instances and 3 ``VectorFieldOutput`` instances.</span>
<span class="sd">    </span>
<span class="sd">    &gt;&gt;&gt; from abapy.postproc import FieldOutput, TensorFieldOutput, VectorFieldOutput, Identity_like</span>
<span class="sd">    &gt;&gt;&gt; data11 = [0., 0., 1.]</span>
<span class="sd">    &gt;&gt;&gt; data22 = [0., 0., -1]</span>
<span class="sd">    &gt;&gt;&gt; data12 = [1., 2., 0.]</span>
<span class="sd">    &gt;&gt;&gt; labels = range(1,len(data11)+1)</span>
<span class="sd">    &gt;&gt;&gt; fo11 = FieldOutput(labels = labels, data=data11,position=&#39;node&#39;)</span>
<span class="sd">    &gt;&gt;&gt; fo22 = FieldOutput(labels = labels, data=data22,position=&#39;node&#39;)</span>
<span class="sd">    &gt;&gt;&gt; fo12 = FieldOutput(labels = labels, data=data12,position=&#39;node&#39;)</span>
<span class="sd">    &gt;&gt;&gt; tensor = TensorFieldOutput(data11 = fo11, data22 = fo22, data12 = fo12 )</span>
<span class="sd">    &gt;&gt;&gt; t1, t2, t3, v1, v2, v3 = tensor.eigen()</span>
<span class="sd">    &gt;&gt;&gt; print t1</span>
<span class="sd">    FieldOutput instance</span>
<span class="sd">    Position = node</span>
<span class="sd">    Label	Data</span>
<span class="sd">    1	1.0</span>
<span class="sd">    2	2.0</span>
<span class="sd">    3	1.0</span>
<span class="sd">    &gt;&gt;&gt; print v1</span>
<span class="sd">    VectorFieldOutput instance</span>
<span class="sd">    Position = node</span>
<span class="sd">    Label	Data1	Data2	Data3</span>
<span class="sd">    1	0.707106769085	0.707106769085	0.0</span>
<span class="sd">    2	0.707106769085	0.707106769085	0.0</span>
<span class="sd">    3	1.0	0.0	0.0</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="kn">import</span> <span class="n">eig</span> <span class="c"># eigen value/vectors function</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span><span class="p">,</span> <span class="n">zeros_like</span><span class="p">,</span> <span class="n">float32</span><span class="p">,</span> <span class="n">float64</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">labels</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>
    <span class="n">dti</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dti</span>
    <span class="n">dtf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span>
    <span class="k">if</span> <span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;f&#39;</span><span class="p">:</span> <span class="n">ndtf</span> <span class="o">=</span> <span class="n">float32</span>
    <span class="k">if</span> <span class="n">dtf</span> <span class="o">==</span> <span class="s">&#39;d&#39;</span><span class="p">:</span> <span class="n">ndtf</span> <span class="o">=</span> <span class="n">float64</span>
    <span class="n">eigval1</span><span class="p">,</span> <span class="n">eigval2</span><span class="p">,</span> <span class="n">eigval3</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span> 
    <span class="n">eigvec1</span><span class="p">,</span> <span class="n">eigvec2</span><span class="p">,</span> <span class="n">eigvec3</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
      <span class="n">label</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">s11</span><span class="p">,</span> <span class="n">s22</span><span class="p">,</span> <span class="n">s33</span><span class="p">,</span> <span class="n">s12</span><span class="p">,</span> <span class="n">s13</span><span class="p">,</span> <span class="n">s23</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_data</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
      <span class="n">t</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span> <span class="p">[</span><span class="n">s11</span><span class="p">,</span> <span class="n">s12</span><span class="p">,</span> <span class="n">s13</span><span class="p">]</span> <span class="p">,</span> <span class="p">[</span><span class="n">s12</span><span class="p">,</span> <span class="n">s22</span><span class="p">,</span> <span class="n">s23</span><span class="p">]</span> <span class="p">,</span> <span class="p">[</span><span class="n">s13</span><span class="p">,</span> <span class="n">s23</span><span class="p">,</span> <span class="n">s33</span><span class="p">]</span> <span class="p">],</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">ndtf</span><span class="p">)</span>
      <span class="n">vals</span><span class="p">,</span> <span class="n">vects</span> <span class="o">=</span> <span class="n">eig</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
      <span class="n">vects</span> <span class="o">=</span> <span class="n">vects</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span> <span class="c"># so vects[i] is the eigenvector associated with vals[i]</span>
      <span class="n">zipped</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
      <span class="n">vals</span><span class="p">,</span> <span class="n">vec_pos</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span> <span class="o">*</span><span class="nb">sorted</span><span class="p">(</span><span class="n">zipped</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="p">)</span>
      <span class="n">eigval1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="n">eigval2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
      <span class="n">eigval3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
      <span class="n">eigvec1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vects</span><span class="p">[</span><span class="n">vec_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
      <span class="n">eigvec2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vects</span><span class="p">[</span><span class="n">vec_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
      <span class="n">eigvec3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vects</span><span class="p">[</span><span class="n">vec_pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
    <span class="n">eigvec1</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">eigvec1</span><span class="p">)</span>
    <span class="n">eigvec2</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">eigvec2</span><span class="p">)</span>
    <span class="n">eigvec3</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">eigvec3</span><span class="p">)</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">pos</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">eigval1</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">pos</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">eigval2</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="n">s3</span> <span class="o">=</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">pos</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">eigval3</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="n">v11</span> <span class="o">=</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">pos</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">eigvec1</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="n">v12</span> <span class="o">=</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">pos</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">eigvec1</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="n">v13</span> <span class="o">=</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">pos</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">eigvec1</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="n">v21</span> <span class="o">=</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">pos</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">eigvec2</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="n">v22</span> <span class="o">=</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">pos</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">eigvec2</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="n">v23</span> <span class="o">=</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">pos</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">eigvec2</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="n">v31</span> <span class="o">=</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">pos</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">eigvec3</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="n">v32</span> <span class="o">=</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">pos</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">eigvec3</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="n">v33</span> <span class="o">=</span> <span class="n">FieldOutput</span><span class="p">(</span><span class="n">position</span> <span class="o">=</span> <span class="n">pos</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">eigvec3</span><span class="p">[:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">)</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="n">VectorFieldOutput</span><span class="p">(</span><span class="n">data1</span> <span class="o">=</span> <span class="n">v11</span><span class="p">,</span> <span class="n">data2</span> <span class="o">=</span> <span class="n">v12</span><span class="p">,</span> <span class="n">data3</span> <span class="o">=</span> <span class="n">v13</span><span class="p">)</span>
    <span class="n">v2</span> <span class="o">=</span> <span class="n">VectorFieldOutput</span><span class="p">(</span><span class="n">data1</span> <span class="o">=</span> <span class="n">v21</span><span class="p">,</span> <span class="n">data2</span> <span class="o">=</span> <span class="n">v22</span><span class="p">,</span> <span class="n">data3</span> <span class="o">=</span> <span class="n">v23</span><span class="p">)</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="n">VectorFieldOutput</span><span class="p">(</span><span class="n">data1</span> <span class="o">=</span> <span class="n">v31</span><span class="p">,</span> <span class="n">data2</span> <span class="o">=</span> <span class="n">v32</span><span class="p">,</span> <span class="n">data3</span> <span class="o">=</span> <span class="n">v33</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span>
    </div></div>
<div class="viewcode-block" id="Identity_like"><a class="viewcode-back" href="../../postproc.html#abapy.postproc.Identity_like">[docs]</a><span class="k">def</span> <span class="nf">Identity_like</span><span class="p">(</span><span class="n">fo</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  A TensorFieldOutput containing only identity but with the same position, labels and dtypes as the input. </span>
<span class="sd"> </span>
<span class="sd">  :param fo: tensor field output to be used.</span>
<span class="sd">  :type fo: TensorFieldOutput instance</span>
<span class="sd">  :rtype: TensorFieldOutput instance</span>
<span class="sd">  </span>
<span class="sd">  &gt;&gt;&gt; from abapy.postproc import FieldOutput, TensorFieldOutput, Identity_like</span>
<span class="sd">  &gt;&gt;&gt; data1 = [1,2,3,5,6,]</span>
<span class="sd">  &gt;&gt;&gt; data2 = [1. for i in data1]</span>
<span class="sd">  &gt;&gt;&gt; labels = range(1,len(data1)+1)</span>
<span class="sd">  &gt;&gt;&gt; fo1, fo2 = FieldOutput(labels = labels, data=data1, position=&#39;node&#39; ), FieldOutput(labels = labels, data=data2,position=&#39;node&#39;)</span>
<span class="sd">  &gt;&gt;&gt; tensor = TensorFieldOutput(data11 = fo1, data22 = fo2 )</span>
<span class="sd">  &gt;&gt;&gt; identity = Identity_like(tensor)</span>
<span class="sd">  &gt;&gt;&gt; print identity</span>
<span class="sd">  TensorFieldOutput instance</span>
<span class="sd">  Position = node</span>
<span class="sd">  Label	Data11	Data22	Data33	Data12	Data13	Data23</span>
<span class="sd">  1	1.0e+00	1.0e+00	1.0e+00	0.0e+00	0.0e+00	0.0e+00</span>
<span class="sd">  2	1.0e+00	1.0e+00	1.0e+00	0.0e+00	0.0e+00	0.0e+00</span>
<span class="sd">  3	1.0e+00	1.0e+00	1.0e+00	0.0e+00	0.0e+00	0.0e+00</span>
<span class="sd">  4	1.0e+00	1.0e+00	1.0e+00	0.0e+00	0.0e+00	0.0e+00</span>
<span class="sd">  5	1.0e+00	1.0e+00	1.0e+00	0.0e+00	0.0e+00	0.0e+00</span>

<span class="sd">  &#39;&#39;&#39;</span>
  <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
  <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
  <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">ones_like</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fo</span><span class="p">,</span><span class="n">TensorFieldOutput</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;input must be TensorFieldOutput instance.&#39;</span>
  <span class="n">d11</span> <span class="o">=</span> <span class="n">OneFieldOutput_like</span><span class="p">(</span><span class="n">fo</span><span class="o">.</span><span class="n">get_component</span><span class="p">(</span><span class="mi">11</span><span class="p">))</span>
  <span class="n">d22</span> <span class="o">=</span> <span class="n">OneFieldOutput_like</span><span class="p">(</span><span class="n">fo</span><span class="o">.</span><span class="n">get_component</span><span class="p">(</span><span class="mi">11</span><span class="p">))</span>
  <span class="n">d33</span> <span class="o">=</span> <span class="n">OneFieldOutput_like</span><span class="p">(</span><span class="n">fo</span><span class="o">.</span><span class="n">get_component</span><span class="p">(</span><span class="mi">11</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">TensorFieldOutput</span><span class="p">(</span><span class="n">data11</span> <span class="o">=</span> <span class="n">d11</span><span class="p">,</span> <span class="n">data22</span> <span class="o">=</span> <span class="n">d22</span><span class="p">,</span> <span class="n">data33</span> <span class="o">=</span> <span class="n">d33</span><span class="p">)</span></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">abapy 2.3.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Ludovic Charleux.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>