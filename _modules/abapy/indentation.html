

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>abapy.indentation &mdash; abapy 2.3.0 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '2.3.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="abapy 2.3.0 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">abapy 2.3.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for abapy.indentation</h1><div class="highlight"><pre>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Indentation</span>
<span class="sd">===========</span>
<span class="sd">&#39;&#39;&#39;</span>



<div class="viewcode-block" id="ParamInfiniteMesh"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.ParamInfiniteMesh">[docs]</a><span class="k">def</span> <span class="nf">ParamInfiniteMesh</span><span class="p">(</span><span class="n">Na</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">Nb</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">core_name</span> <span class="o">=</span> <span class="s">&#39;CAX4&#39;</span><span class="p">,</span> <span class="n">add_shell</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">shell_name</span> <span class="o">=</span> <span class="s">&#39;CINAX4&#39;</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="s">&#39;I&#39;</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="s">&#39;d&#39;</span><span class="p">):</span>

  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Returns a mesh dedicated to 2D/Axisymmetrical indentation. It is composed of a core of quadrangle elements and a shell of infinite elements. The core is divided into three zones. The center is core_1, the right is core_2 and the bottom is core_3. Core_1 is a Na x Na square mesh whereas core_2 and core_3 are respectively Nb x Na and Na x Nb structured meshes that have been transformed to be connected and guaranty element size progression.</span>
<span class="sd">  </span>
<span class="sd">  :param Na: number of elements per side in core_1</span>
<span class="sd">  :type Na: int &gt; 1</span>
<span class="sd">  :param Nb: number of radial elements in core_2 and core_3 </span>
<span class="sd">  :type Nb: int &gt; 0</span>
<span class="sd">  :param l: core_1 size</span>
<span class="sd">  :type l: float &gt; 0</span>
<span class="sd">  :param core_name: element name in core</span>
<span class="sd">  :type core_name: string</span>
<span class="sd">  :param add_shell: True if the shell of infinite elements is to be used, False if not.</span>
<span class="sd">  :type add_shell: boolean</span>
<span class="sd">  :param shell_name: element name in shell, should be infinite</span>
<span class="sd">  :type shell_name: string  </span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="kn">from</span> <span class="nn">mesh</span> <span class="kn">import</span> <span class="n">RegularQuadMesh</span><span class="p">,</span> <span class="n">RegularQuadMesh_like</span>
  <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">zeros_like</span><span class="p">,</span> <span class="n">ones_like</span><span class="p">,</span> <span class="n">linspace</span><span class="p">,</span> <span class="n">where</span>
  <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
  <span class="k">def</span> <span class="nf">disp2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
    <span class="n">ux</span> <span class="o">=</span> <span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">uy</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">l</span> <span class="o">+</span> <span class="n">ux</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="o">/</span><span class="n">l</span>
    <span class="n">uz</span> <span class="o">=</span> <span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ux</span><span class="p">,</span> <span class="n">uy</span><span class="p">,</span> <span class="n">uz</span>
  <span class="k">def</span> <span class="nf">disp3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
    <span class="n">uy</span> <span class="o">=</span> <span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ux</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">l</span> <span class="o">+</span> <span class="n">uy</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="o">/</span><span class="n">l</span>
    <span class="n">uz</span> <span class="o">=</span> <span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ux</span><span class="p">,</span> <span class="n">uy</span><span class="p">,</span> <span class="n">uz</span>  
  <span class="k">def</span> <span class="nf">conn_permutation</span><span class="p">(</span><span class="n">conn</span><span class="p">):</span> <span class="c"># permutes nodes in connectivity to have a particular orientation. Flips CLOCKWISE.</span>
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
    <span class="n">conn2</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">conn</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">conn</span><span class="p">)):</span> <span class="n">conn2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">conn</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">conn2</span>
  <span class="n">m1</span> <span class="o">=</span> <span class="n">RegularQuadMesh_like</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">Na</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">l</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="n">Na</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">name</span> <span class="o">=</span> <span class="n">core_name</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span> <span class="p">)</span>
  <span class="n">axis</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;left&#39;</span><span class="p">])</span>
  <span class="n">top</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;top&#39;</span><span class="p">])</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;core&#39;</span><span class="p">,</span><span class="n">m1</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;core_1&#39;</span><span class="p">,</span><span class="n">m1</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;top_elem&#39;</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span> <span class="n">Na</span> <span class="o">*</span> <span class="p">(</span><span class="n">Na</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">Na</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mi">1</span>  <span class="p">))</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;core&#39;</span><span class="p">,</span><span class="n">m1</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
  <span class="n">x2</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="p">]</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">Nb</span><span class="p">):</span> <span class="n">x2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Na</span><span class="o">/</span><span class="p">(</span><span class="n">Na</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
  <span class="n">y2</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">l</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">Na</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">m2</span> <span class="o">=</span> <span class="n">RegularQuadMesh_like</span><span class="p">(</span><span class="n">x_list</span> <span class="o">=</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y_list</span> <span class="o">=</span> <span class="n">y2</span> <span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">core_name</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span> <span class="p">)</span>
  <span class="n">m2</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">m2</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;core&#39;</span><span class="p">,</span><span class="n">m2</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
  <span class="n">m2</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;core_2&#39;</span><span class="p">,</span><span class="n">m2</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
  <span class="n">m2</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;top_elem&#39;</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span> <span class="n">Nb</span> <span class="o">*</span> <span class="p">(</span><span class="n">Na</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">Na</span><span class="o">*</span><span class="n">Nb</span><span class="o">+</span><span class="mi">1</span>  <span class="p">))</span>
  <span class="n">m2</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;core&#39;</span><span class="p">,</span><span class="n">m2</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
  <span class="n">y3</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">l</span><span class="p">]</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">Nb</span><span class="p">):</span> <span class="n">y3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y3</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Na</span><span class="o">/</span><span class="p">(</span><span class="n">Na</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
  <span class="n">y3</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
  <span class="n">x3</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">Na</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">m3</span> <span class="o">=</span> <span class="n">RegularQuadMesh_like</span><span class="p">(</span><span class="n">x_list</span> <span class="o">=</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y_list</span> <span class="o">=</span> <span class="n">y3</span> <span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">core_name</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span> <span class="p">)</span>
  <span class="n">m3</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">m3</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;core&#39;</span><span class="p">,</span><span class="n">m3</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
  <span class="n">m3</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;core&#39;</span><span class="p">,</span><span class="n">m3</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
  <span class="n">m3</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;core_3&#39;</span><span class="p">,</span><span class="n">m3</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">add_shell</span><span class="p">:</span>
    <span class="n">m4</span> <span class="o">=</span> <span class="n">RegularQuadMesh_like</span><span class="p">(</span><span class="n">x_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="o">*</span><span class="n">x2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]],</span> <span class="n">y_list</span> <span class="o">=</span> <span class="n">y2</span> <span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">shell_name</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span> <span class="p">)</span>
    <span class="n">m4</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">m4</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;shell&#39;</span><span class="p">,</span><span class="n">m4</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">m5</span> <span class="o">=</span> <span class="n">RegularQuadMesh_like</span><span class="p">(</span><span class="n">x_list</span> <span class="o">=</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y_list</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">y3</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y3</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">shell_name</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span> <span class="p">)</span>
    <span class="n">m5</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">m5</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;shell&#39;</span><span class="p">,</span><span class="n">m5</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m4</span><span class="o">.</span><span class="n">labels</span><span class="p">)):</span> <span class="c"># permutates 1 time</span>
      <span class="n">m4</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">conn_permutation</span><span class="p">(</span><span class="n">m4</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>   
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">m5</span><span class="o">.</span><span class="n">labels</span><span class="p">)):</span> <span class="c"># permutates 2 times</span>
      <span class="n">m5</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">conn_permutation</span><span class="p">(</span><span class="n">m5</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
      <span class="n">m5</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">conn_permutation</span><span class="p">(</span><span class="n">m5</span><span class="o">.</span><span class="n">connectivity</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> 
    <span class="n">m2</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">m4</span><span class="p">)</span>
    <span class="n">m3</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">m5</span><span class="p">)</span>
  <span class="n">U2</span> <span class="o">=</span> <span class="n">m2</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">eval_vectorFunction</span><span class="p">(</span><span class="n">disp2</span><span class="p">)</span>
  <span class="n">m2</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">apply_displacement</span><span class="p">(</span><span class="n">U2</span><span class="p">)</span>
  <span class="n">U3</span> <span class="o">=</span> <span class="n">m3</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">eval_vectorFunction</span><span class="p">(</span><span class="n">disp3</span><span class="p">)</span>
  <span class="n">m3</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">apply_displacement</span><span class="p">(</span><span class="n">U3</span><span class="p">)</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">m2</span><span class="p">)</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">m3</span><span class="p">)</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_set_by_func</span><span class="p">(</span><span class="s">&#39;top&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">y</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">)</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_set_by_func</span><span class="p">(</span><span class="s">&#39;axis&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">)</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;all_elements&#39;</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">add_surface</span><span class="p">(</span><span class="s">&#39;samp_surf&#39;</span><span class="p">,[</span> <span class="p">(</span><span class="s">&#39;top_elem&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="p">])</span>
  <span class="k">return</span> <span class="n">m1</span>
</div>
<div class="viewcode-block" id="IndentationMesh"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.IndentationMesh">[docs]</a><span class="k">def</span> <span class="nf">IndentationMesh</span><span class="p">(</span><span class="n">Na</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="n">Nb</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="n">Ns</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">Nf</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">,</span> <span class="n">l</span> <span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;CAX4&#39;</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="s">&#39;f&#39;</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="s">&#39;I&#39;</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  An indentation oriented full quad mesh.</span>
<span class="sd">  </span>
<span class="sd">  :param Na: number of elements along x axis in the finely meshed contact zone. *Must be power of 2*.</span>
<span class="sd">  :type Na: int</span>
<span class="sd">  :param Nb: number of elements along y axis in the finely meshed contact zone. *Must be power of 2*.</span>
<span class="sd">  :type Nb: int</span>
<span class="sd">  :param Ns: number of radial elements in the shell. </span>
<span class="sd">  :type Ns: int</span>
<span class="sd">  :param Nf: number of orthoradial elements in each half shell. Must be &gt; 0.</span>
<span class="sd">  :type Nf: int</span>
<span class="sd">  :param l: length of the square zone. </span>
<span class="sd">  :type l: float.</span>
<span class="sd">  :param name: name of the elements. Note that this mesh if full quad so only one name is required.</span>
<span class="sd">  :type name: string</span>
<span class="sd">  :param dtf: float data type in ``array.array``, &#39;d&#39; for float64 or &#39;f&#39; for float32.</span>
<span class="sd">  :type dtf: string</span>
<span class="sd">  :param dti: int data type in ``array.array``, &#39;I&#39; for unsignedint32 or &#39;H&#39; for unsignedint16 (dangerous in some cases).</span>
<span class="sd">  :type dti: string</span>
<span class="sd">  </span>
<span class="sd">  .. plot:: example_code/indentation/IndentationMesh.py</span>
<span class="sd">      :include-source:    </span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="kn">from</span> <span class="nn">abapy.mesh</span> <span class="kn">import</span> <span class="n">Mesh</span><span class="p">,</span> <span class="n">RegularQuadMesh</span><span class="p">,</span> <span class="n">RegularQuadMesh</span><span class="p">,</span> <span class="n">RegularQuadMesh_like</span>
  <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">radians</span>
  <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">zeros_like</span><span class="p">,</span> <span class="n">ones_like</span><span class="p">,</span> <span class="n">linspace</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">tan</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">logical_and</span>
  <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>

  <span class="k">def</span> <span class="nf">disp2</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
    <span class="n">xa</span> <span class="o">=</span> <span class="n">l</span>
    <span class="n">ya</span> <span class="o">=</span> <span class="n">y</span>
    <span class="n">xmax</span><span class="p">,</span> <span class="n">xmin</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="o">-</span><span class="n">y</span><span class="o">/</span><span class="n">ymin</span> <span class="o">*</span> <span class="n">pi</span><span class="o">/</span><span class="mf">4.</span>
    <span class="n">xb</span> <span class="o">=</span> <span class="n">xmax</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">yb</span> <span class="o">=</span> <span class="n">xmax</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">xb</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">xa</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">yb</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">ya</span>
    <span class="k">return</span> <span class="n">x2</span> <span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y</span><span class="p">,</span>  <span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
   
  <span class="k">def</span> <span class="nf">disp3</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
    <span class="n">ya</span> <span class="o">=</span> <span class="o">-</span><span class="n">l</span>
    <span class="n">xa</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">xmax</span><span class="p">,</span> <span class="n">xmin</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">x</span><span class="o">/</span><span class="n">xmax</span> <span class="o">*</span> <span class="n">pi</span><span class="o">/</span><span class="mf">4.</span><span class="o">-</span> <span class="n">pi</span><span class="o">/</span><span class="mf">2.</span>
    <span class="n">xb</span> <span class="o">=</span> <span class="o">-</span><span class="n">ymin</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">yb</span> <span class="o">=</span> <span class="o">-</span><span class="n">ymin</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">y</span> <span class="o">+</span> <span class="n">ymax</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="o">-</span><span class="n">ymin</span> <span class="o">+</span> <span class="n">ymax</span><span class="p">)</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">xb</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">xa</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">yb</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">ya</span>
    <span class="k">return</span> <span class="n">x2</span> <span class="o">-</span><span class="n">x</span><span class="p">,</span> <span class="n">y2</span> <span class="o">-</span> <span class="n">y</span><span class="p">,</span>  <span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">UnitTransition</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;CAX4&#39;</span><span class="p">):</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">()</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">nodes</span>
    <span class="n">n</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
    <span class="n">n</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
    <span class="n">n</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.</span><span class="p">)</span>
    <span class="n">n</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">n</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">n</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">n</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="mi">7</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>  
    <span class="n">n</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
    <span class="n">n</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
    <span class="n">n</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
    <span class="n">n</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="mi">11</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">0.75</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span> 
    <span class="n">n</span><span class="o">.</span><span class="n">add_node</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">connectivity</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">space</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">connectivity</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">5</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">space</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">connectivity</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">space</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">connectivity</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">space</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">m</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">connectivity</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">8</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">space</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span>  
    <span class="n">m</span><span class="o">.</span><span class="n">add_element</span><span class="p">(</span><span class="n">connectivity</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">11</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">space</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> 
    <span class="k">return</span> <span class="n">m</span>

  <span class="k">def</span> <span class="nf">Transition</span><span class="p">(</span><span class="n">N</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">l1</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">l2</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;CAX4&#39;</span><span class="p">,</span> <span class="n">crit_distance</span> <span class="o">=</span> <span class="mf">1.e-6</span> <span class="p">):</span>
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">N</span> <span class="o">/</span> <span class="mi">4</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">UnitTransition</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">m0</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">N</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
        <span class="n">m2</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">m0</span><span class="p">)</span>
        <span class="n">m2</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="n">m</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span> <span class="n">crit_distance</span> <span class="o">=</span> <span class="n">crit_distance</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">x</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">y</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
      <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">*</span> <span class="n">l1</span>
      <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">l2</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">m</span>

  <span class="k">def</span> <span class="nf">PolarTransition</span><span class="p">(</span><span class="n">N</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">radius</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">theta0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">90.</span><span class="p">,</span> <span class="n">theta1</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;CAX4&#39;</span> <span class="p">):</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">Transition</span><span class="p">(</span><span class="n">N</span> <span class="o">=</span> <span class="n">N</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;CAX4&#39;</span><span class="p">)</span>
    <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">theta0</span><span class="p">),</span> <span class="n">radians</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">size</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span> <span class="p">)</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">/</span>  <span class="n">N</span> 
    <span class="k">def</span> <span class="nf">dispTrans</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
      <span class="n">ux</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">radius</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">size</span> <span class="o">*</span>  <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">y</span><span class="p">))</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="p">(</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
      <span class="n">uy</span> <span class="o">=</span> <span class="o">-</span><span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="n">radius</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">size</span> <span class="o">*</span>  <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">y</span><span class="p">))</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="p">(</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="p">)</span> 
      <span class="n">uz</span> <span class="o">=</span> <span class="mf">0.</span> <span class="o">*</span> <span class="n">z</span>
      <span class="k">return</span> <span class="n">ux</span><span class="p">,</span> <span class="n">uy</span><span class="p">,</span> <span class="n">uz</span>
    <span class="n">Utrans</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">eval_vectorFunction</span><span class="p">(</span><span class="n">dispTrans</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">apply_displacement</span><span class="p">(</span><span class="n">Utrans</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mesh</span>
    
  
    
  <span class="k">def</span> <span class="nf">PolarShell</span><span class="p">(</span><span class="n">radius</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">2</span> <span class="p">,</span> <span class="n">Ns</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">theta0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">90.</span><span class="p">,</span> <span class="n">theta1</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;CAX4&#39;</span><span class="p">):</span>
    <span class="n">t0</span><span class="p">,</span> <span class="n">t1</span> <span class="o">=</span> <span class="n">radians</span><span class="p">(</span><span class="n">theta0</span><span class="p">),</span> <span class="n">radians</span><span class="p">(</span><span class="n">theta1</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span><span class="o">/</span><span class="n">N</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">k</span> <span class="o">=</span> <span class="n">t</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span> <span class="n">t</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="p">[</span><span class="n">radius</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">Ns</span><span class="p">):</span> <span class="n">y1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y1</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">y1</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">RegularQuadMesh_like</span><span class="p">(</span><span class="n">x_list</span> <span class="o">=</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y_list</span> <span class="o">=</span> <span class="n">y1</span> <span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span> <span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">sets</span><span class="o">=</span> <span class="p">{}</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">def</span> <span class="nf">dispTrans</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">labels</span><span class="p">):</span>
      
      <span class="n">ux</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="p">(</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>
      <span class="n">uy</span> <span class="o">=</span> <span class="o">-</span><span class="n">y</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">t0</span> <span class="o">+</span> <span class="p">(</span><span class="n">t1</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span> <span class="p">)</span> 
      <span class="n">uz</span> <span class="o">=</span> <span class="mf">0.</span> <span class="o">*</span> <span class="n">z</span>
      <span class="k">return</span> <span class="n">ux</span><span class="p">,</span> <span class="n">uy</span><span class="p">,</span> <span class="n">uz</span>
    <span class="n">U</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">eval_vectorFunction</span><span class="p">(</span><span class="n">dispTrans</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">apply_displacement</span><span class="p">(</span><span class="n">U</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">mesh</span>
  
  <span class="n">Nmin</span><span class="p">,</span> <span class="n">Nmax</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Na</span><span class="p">,</span> <span class="n">Nb</span><span class="p">)</span> <span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">Na</span><span class="p">,</span> <span class="n">Nb</span><span class="p">)</span> 
  <span class="n">crit_distance</span> <span class="o">=</span> <span class="n">l</span><span class="o">/</span><span class="n">Nmax</span><span class="o">/</span><span class="mf">100.</span>
  <span class="n">m1</span> <span class="o">=</span> <span class="n">RegularQuadMesh_like</span><span class="p">(</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">Na</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">l</span><span class="p">,</span><span class="mf">0.</span><span class="p">,</span><span class="n">Nb</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span> <span class="p">)</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">sets</span> <span class="o">=</span> <span class="p">{}</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="o">=</span><span class="p">{}</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;surface_elements&#39;</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span> <span class="n">Na</span> <span class="o">*</span> <span class="p">(</span><span class="n">Nb</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">Na</span><span class="o">*</span><span class="n">Nb</span><span class="o">+</span><span class="mi">1</span>  <span class="p">))</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;core_elements&#39;</span><span class="p">,</span><span class="n">m1</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;core_nodes&#39;</span><span class="p">,</span><span class="n">m1</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
  <span class="n">x2</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span><span class="p">]</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">Nmin</span><span class="p">):</span> <span class="n">x2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x2</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Nmin</span><span class="o">/</span><span class="p">(</span><span class="n">Nmin</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
  <span class="n">y2</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">l</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">Nb</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">m2</span> <span class="o">=</span> <span class="n">RegularQuadMesh_like</span><span class="p">(</span><span class="n">x_list</span> <span class="o">=</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y_list</span> <span class="o">=</span> <span class="n">y2</span> <span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span> <span class="p">)</span>
  <span class="n">y3</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">l</span><span class="p">]</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">Nmin</span><span class="p">):</span> <span class="n">y3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y3</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">Nmin</span><span class="o">/</span><span class="p">(</span><span class="n">Nmin</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
  <span class="n">y3</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
  <span class="n">x3</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">Na</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">m3</span> <span class="o">=</span> <span class="n">RegularQuadMesh_like</span><span class="p">(</span><span class="n">x_list</span> <span class="o">=</span> <span class="n">x3</span><span class="p">,</span> <span class="n">y_list</span> <span class="o">=</span> <span class="n">y3</span> <span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span><span class="p">,</span> <span class="n">dti</span> <span class="o">=</span> <span class="n">dti</span> <span class="p">)</span>
  <span class="n">U2</span> <span class="o">=</span> <span class="n">m2</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">eval_vectorFunction</span><span class="p">(</span><span class="n">disp2</span><span class="p">)</span>
  <span class="n">m2</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">apply_displacement</span><span class="p">(</span><span class="n">U2</span><span class="p">)</span>
  <span class="n">U3</span> <span class="o">=</span> <span class="n">m3</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">eval_vectorFunction</span><span class="p">(</span><span class="n">disp3</span><span class="p">)</span>
  <span class="n">m3</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">apply_displacement</span><span class="p">(</span><span class="n">U3</span><span class="p">)</span>
  <span class="n">m2</span><span class="o">.</span><span class="n">sets</span><span class="o">=</span><span class="p">{}</span>
  <span class="n">m2</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="o">=</span><span class="p">{}</span>
  <span class="n">m2</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;surface_elements&#39;</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span> <span class="n">Nmin</span> <span class="o">*</span> <span class="p">(</span><span class="n">Nb</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">Nmin</span><span class="o">*</span><span class="n">Nb</span><span class="o">+</span><span class="mi">1</span>  <span class="p">))</span>
  <span class="n">m2</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;core_elements&#39;</span><span class="p">,</span><span class="n">m2</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
  <span class="n">m2</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;core_nodes&#39;</span><span class="p">,</span><span class="n">m2</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
  <span class="n">m3</span><span class="o">.</span><span class="n">sets</span><span class="o">=</span><span class="p">{}</span>
  <span class="n">m3</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="o">=</span><span class="p">{}</span>
  <span class="n">m3</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;core_elements&#39;</span><span class="p">,</span><span class="n">m3</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
  <span class="n">m3</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;core_nodes&#39;</span><span class="p">,</span><span class="n">m3</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">m2</span><span class="p">,</span> <span class="n">crit_distance</span> <span class="o">=</span> <span class="n">crit_distance</span><span class="p">)</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">m3</span><span class="p">,</span> <span class="n">crit_distance</span> <span class="o">=</span> <span class="n">crit_distance</span><span class="p">)</span>
  <span class="n">surface_radius</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
  <span class="n">Nta</span><span class="p">,</span> <span class="n">Ntb</span> <span class="o">=</span> <span class="n">Na</span><span class="p">,</span> <span class="n">Nb</span> 
  <span class="k">while</span> <span class="n">Nta</span> <span class="o">&gt;</span> <span class="n">Nf</span> <span class="ow">and</span> <span class="n">Ntb</span> <span class="o">&gt;</span> <span class="n">Nf</span><span class="p">:</span>
    <span class="n">radius</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
    <span class="n">size</span> <span class="o">=</span> <span class="p">(</span><span class="n">pi</span><span class="o">/</span><span class="mf">4.</span> <span class="p">)</span> <span class="o">*</span> <span class="n">radius</span> <span class="o">/</span> <span class="nb">min</span><span class="p">(</span><span class="n">Nta</span><span class="p">,</span> <span class="n">Ntb</span><span class="p">)</span>
    <span class="n">transa</span> <span class="o">=</span> <span class="n">PolarTransition</span><span class="p">(</span> <span class="n">N</span> <span class="o">=</span> <span class="n">Nta</span><span class="p">,</span> <span class="n">theta0</span><span class="o">=-</span><span class="mf">90.</span><span class="p">,</span> <span class="n">theta1</span><span class="o">=-</span><span class="mf">45.</span><span class="p">,</span> <span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">size</span><span class="p">)</span>
    <span class="n">transb</span> <span class="o">=</span> <span class="n">PolarTransition</span><span class="p">(</span> <span class="n">N</span> <span class="o">=</span> <span class="n">Ntb</span><span class="p">,</span> <span class="n">theta0</span><span class="o">=-</span><span class="mf">45.</span><span class="p">,</span> <span class="n">theta1</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="n">size</span><span class="p">)</span>
    <span class="n">transa</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">transb</span><span class="p">,</span> <span class="n">crit_distance</span> <span class="o">=</span> <span class="n">crit_distance</span><span class="p">)</span>
    <span class="n">transa</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;shell_elements&#39;</span><span class="p">,</span><span class="n">transa</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">transa</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;shell_nodes&#39;</span><span class="p">,</span><span class="n">transa</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
    <span class="n">m1</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">transa</span><span class="p">,</span> <span class="n">crit_distance</span> <span class="o">=</span> <span class="n">crit_distance</span><span class="p">)</span>
    <span class="n">Nta</span><span class="p">,</span> <span class="n">Ntb</span> <span class="o">=</span> <span class="n">Nta</span> <span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">Ntb</span><span class="o">/</span><span class="mi">2</span>

  <span class="n">radius</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
  <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">pi</span><span class="o">/</span><span class="mf">4.</span><span class="p">)</span><span class="o">/</span><span class="nb">min</span><span class="p">(</span><span class="n">Nta</span><span class="p">,</span> <span class="n">Ntb</span><span class="p">)</span>
  <span class="n">k</span> <span class="o">=</span> <span class="n">t</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span> <span class="n">t</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
  <span class="n">shella</span> <span class="o">=</span> <span class="n">PolarShell</span><span class="p">(</span><span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">Nta</span><span class="p">,</span> <span class="n">Ns</span> <span class="o">=</span> <span class="n">Ns</span><span class="p">,</span> <span class="n">theta0</span><span class="o">=-</span><span class="mf">90.</span><span class="p">,</span> <span class="n">theta1</span><span class="o">=-</span><span class="mf">45.</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">k</span><span class="p">)</span>
  <span class="n">shellb</span> <span class="o">=</span> <span class="n">PolarShell</span><span class="p">(</span><span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">Ntb</span><span class="p">,</span> <span class="n">Ns</span> <span class="o">=</span> <span class="n">Ns</span><span class="p">,</span> <span class="n">theta0</span><span class="o">=-</span><span class="mf">45.</span><span class="p">,</span> <span class="n">theta1</span><span class="o">=</span>  <span class="mf">0.</span><span class="p">,</span>  <span class="n">k</span> <span class="o">=</span> <span class="n">k</span><span class="p">)</span>
  <span class="n">shella</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">shellb</span><span class="p">,</span> <span class="n">crit_distance</span> <span class="o">=</span> <span class="n">crit_distance</span><span class="p">)</span>
  <span class="n">shella</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;shell_elements&#39;</span><span class="p">,</span><span class="n">shella</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
  <span class="n">shella</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;shell_nodes&#39;</span><span class="p">,</span><span class="n">shella</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">shella</span><span class="p">,</span> <span class="n">crit_distance</span> <span class="o">=</span> <span class="n">crit_distance</span><span class="p">)</span>
  <span class="c"># Correcting some rounding errors:</span>
  <span class="n">n1</span> <span class="o">=</span> <span class="n">m1</span><span class="o">.</span><span class="n">nodes</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n1</span><span class="o">.</span><span class="n">x</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">n1</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">crit_distance</span><span class="p">:</span> <span class="n">n1</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="k">if</span> <span class="n">n1</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="n">crit_distance</span><span class="p">:</span> <span class="n">n1</span><span class="o">.</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
  <span class="c"># Managing sets</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_set_by_func</span><span class="p">(</span><span class="s">&#39;top_nodes&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">logical_and</span><span class="p">(</span><span class="n">y</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">surface_radius</span><span class="p">))</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_set_by_func</span><span class="p">(</span><span class="s">&#39;surface_nodes&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">logical_and</span><span class="p">(</span><span class="n">y</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">x</span> <span class="o">&lt;=</span> <span class="n">surface_radius</span><span class="p">))</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_set_by_func</span><span class="p">(</span><span class="s">&#39;axis_nodes&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">)</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;all_nodes&#39;</span><span class="p">,</span><span class="n">m1</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">add_surface</span><span class="p">(</span><span class="s">&#39;surface_faces&#39;</span><span class="p">,[</span> <span class="p">(</span><span class="s">&#39;surface_elements&#39;</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="p">])</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;all_elements&#39;</span><span class="p">,</span> <span class="n">m1</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_set_by_func</span><span class="p">(</span><span class="s">&#39;tip_node&#39;</span><span class="p">,</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">logical_and</span><span class="p">(</span><span class="n">y</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">x</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">))</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_set_by_func</span><span class="p">(</span><span class="s">&#39;ref_node&#39;</span><span class="p">,</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="n">logical_and</span><span class="p">(</span><span class="n">y</span> <span class="o">==</span> <span class="nb">min</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="n">x</span><span class="o">==</span><span class="mf">0.</span><span class="p">))</span>
  <span class="n">radius</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">m1</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
  <span class="n">error</span> <span class="o">=</span> <span class="mf">0.001</span>
  <span class="n">m1</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_set_by_func</span><span class="p">(</span><span class="s">&#39;bottom_nodes&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">labels</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**.</span><span class="mi">5</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">error</span><span class="p">)</span><span class="o">*</span><span class="n">radius</span> <span class="p">)</span> 
  
  <span class="k">return</span> <span class="n">m1</span>
</div>
<div class="viewcode-block" id="RigidCone2D"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.RigidCone2D">[docs]</a><span class="k">class</span> <span class="nc">RigidCone2D</span><span class="p">:</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  A rigid cone usable in 2D and Axisymmetric simulations.</span>
<span class="sd">  </span>
<span class="sd">  :param half_angle: half_angle in DEGREES.</span>
<span class="sd">  :type half_angle: float &gt; 0.</span>
<span class="sd">  :param width: width of the indenter</span>
<span class="sd">  :type width: float &gt; 0.</span>
<span class="sd">  :param summit_position: position of the summit in a 2D space.</span>
<span class="sd">  :type summit_position: tuple or list containing two floats.</span>
<span class="sd">  &#39;&#39;&#39;</span>
  
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">half_angle</span><span class="o">=</span> <span class="mf">70.3</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">10.</span><span class="p">,</span><span class="n">summit_position</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_half_angle</span><span class="p">(</span><span class="n">half_angle</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_width</span><span class="p">(</span><span class="n">width</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_summit_position</span><span class="p">(</span><span class="n">summit_position</span><span class="p">)</span>
        
<div class="viewcode-block" id="RigidCone2D.set_summit_position"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.RigidCone2D.set_summit_position">[docs]</a>  <span class="k">def</span> <span class="nf">set_summit_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summit_position</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the position of the indenter.</span>
<span class="sd">    </span>
<span class="sd">    :param summit_position: position of the summit in a 2D space.</span>
<span class="sd">    :type summit_position: tuple or list containing two floats.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">summit_position</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;summit_position length must be 2, got {0} instead.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">summit_position</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">summit_position</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">summit_position</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">summit_position</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
  </div>
<div class="viewcode-block" id="RigidCone2D.set_half_angle"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.RigidCone2D.set_half_angle">[docs]</a>  <span class="k">def</span> <span class="nf">set_half_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">half_angle</span> <span class="o">=</span> <span class="mf">70.3</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the half angle of the indenter. Default is equivalent to modified Berkovich indenter in volume.</span>
<span class="sd">    </span>
<span class="sd">    :param half_angle: half_angle in DEGREES.</span>
<span class="sd">    :type half_angle: float &gt; 0.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">half_angle</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;half angle must be float, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">half_angle</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">half_angle</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">half_angle</span><span class="p">))</span></div>
<div class="viewcode-block" id="RigidCone2D.set_width"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.RigidCone2D.set_width">[docs]</a>  <span class="k">def</span> <span class="nf">set_width</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">width</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the width of the indenter.</span>
<span class="sd">    </span>
<span class="sd">    :param width: width</span>
<span class="sd">    :type width: float &gt; 0.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">width</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;width must be float, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">width</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">width</span><span class="p">))</span>
  
  
     
    </div>
<div class="viewcode-block" id="RigidCone2D.dump2inp"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.RigidCone2D.dump2inp">[docs]</a>  <span class="k">def</span> <span class="nf">dump2inp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Dumps to Abaqus INP format.</span>
<span class="sd">    </span>
<span class="sd">    :rtype: string</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">radians</span><span class="p">,</span> <span class="n">tan</span>
    <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
    <span class="n">ha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">half_angle</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;*NODE, NSET = REFERENCE</span>
<span class="s">1,0.,1.,0.</span>
<span class="s">*NSET, NSET=AXIS</span>
<span class="s">1</span>
<span class="s">*NSET, NSET=BOTTOM</span>
<span class="s">1</span>
<span class="s">*NSET, NSET=TIP</span>
<span class="s">1</span>
<span class="s">*SURFACE, TYPE = SEGMENTS, NAME = IND_SURF</span>
<span class="s">START, {0}, {1}</span>
<span class="s">LINE, 0., 0.</span>
<span class="s">*RIGID BODY, REF NODE = REFERENCE, ANALYTICAL SURFACE = IND_SURF&#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="n">pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">w</span><span class="o">/</span><span class="n">tan</span><span class="p">(</span><span class="n">radians</span><span class="p">(</span><span class="n">ha</span><span class="p">)))</span></div>
<div class="viewcode-block" id="RigidCone2D.get_edges"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.RigidCone2D.get_edges">[docs]</a>  <span class="k">def</span> <span class="nf">get_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns a plotable version of the indenter usable directly in ``matplotlib.pyplot``.</span>
<span class="sd">    </span>
<span class="sd">    :rtype: x and y lists</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">radians</span><span class="p">,</span> <span class="n">tan</span>
    <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summit_position</span>
    <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
    <span class="n">ha</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">half_angle</span>
    <span class="k">return</span> <span class="p">[</span> <span class="n">w</span> <span class="o">+</span> <span class="n">xs</span><span class="p">,</span> <span class="n">xs</span> <span class="p">],</span> <span class="p">[</span> <span class="n">w</span> <span class="o">/</span> <span class="n">tan</span><span class="p">(</span><span class="n">radians</span><span class="p">(</span><span class="n">ha</span><span class="p">))</span> <span class="o">+</span> <span class="n">ys</span><span class="p">,</span> <span class="n">ys</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">]</span>
    </div>
<div class="viewcode-block" id="RigidCone2D.apply_displacement"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.RigidCone2D.apply_displacement">[docs]</a>  <span class="k">def</span> <span class="nf">apply_displacement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">disp</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Applies a displacement field to the indenter.</span>
<span class="sd">    </span>
<span class="sd">    :param disp: displacement field (with only one location).</span>
<span class="sd">    :type disp: ``abapy.postproc.VectorFieldOutput`` instance.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">abapy.postproc</span> <span class="kn">import</span> <span class="n">VectorFieldOutput</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">disp</span><span class="p">,</span> <span class="n">VectorFieldOutput</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;disp must be VectorFieldOutput instance, got {0} instead&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">disp</span><span class="p">))</span>
    <span class="n">sp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summit_position</span>
    <span class="n">new_position</span> <span class="o">=</span> <span class="p">(</span> <span class="n">sp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">disp</span><span class="o">.</span><span class="n">data1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">disp</span><span class="o">.</span><span class="n">data2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_summit_position</span><span class="p">(</span><span class="n">new_position</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="DeformableCone2D"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone2D">[docs]</a><span class="k">class</span> <span class="nc">DeformableCone2D</span><span class="p">:</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  A deformable cone usable in 2D and Axisymmetric simulations.</span>
<span class="sd">  </span>
<span class="sd">  :param half_angle: half_angle in DEGREES.</span>
<span class="sd">  :type half_angle: float &gt; 0.</span>
<span class="sd">  :param Na: number of elements along x axis in the finely meshed contact zone. *Must be power of 2*.</span>
<span class="sd">  :type Na: int</span>
<span class="sd">  :param Nb: number of elements along y axis in the finely meshed contact zone. *Must be power of 2*.</span>
<span class="sd">  :type Nb: int</span>
<span class="sd">  :param Ns: number of radial elements in the shell. </span>
<span class="sd">  :type Ns: int</span>
<span class="sd">  :param Nf: number of orthoradial elements in each half shell. Must be &gt; 0.</span>
<span class="sd">  :type Nf: int</span>
<span class="sd">  :param l: length of the square zone. </span>
<span class="sd">  :type l: float.</span>
<span class="sd">  :param mat_label: label of the constitutive material of the indenter. </span>
<span class="sd">  :type mat_label: any material class instance</span>
<span class="sd">  :param summit_position: position of the summit in a 2D space.</span>
<span class="sd">  :type summit_position: tuple or list containing two floats.</span>
<span class="sd">  :param rigid: True if indenter is to be rigid or False if the indenter is to be deformable. If the rigid behavior is chosen, the material label will be necessary but will not influence the results of the simulation.</span>
<span class="sd">  </span>
<span class="sd">  .. plot:: example_code/indentation/DeformableCone2D.py</span>
<span class="sd">      :include-source:    </span>
<span class="sd">  &#39;&#39;&#39;</span>
  
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">half_angle</span><span class="o">=</span> <span class="mf">70.3</span><span class="p">,</span> <span class="n">Na</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">Nb</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">Ns</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">Nf</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">mat_label</span> <span class="o">=</span> <span class="s">&#39;INDENTER_MAT&#39;</span><span class="p">,</span> <span class="n">summit_position</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">rigid</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_half_angle</span><span class="p">(</span><span class="n">half_angle</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_l</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_Na</span><span class="p">(</span><span class="n">Na</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_Nb</span><span class="p">(</span><span class="n">Nb</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_Ns</span><span class="p">(</span><span class="n">Ns</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_Nf</span><span class="p">(</span><span class="n">Nf</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_mat_label</span><span class="p">(</span><span class="n">mat_label</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_summit_position</span><span class="p">(</span><span class="n">summit_position</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_rigid</span><span class="p">(</span><span class="n">rigid</span><span class="p">)</span>
    
    
<div class="viewcode-block" id="DeformableCone2D.set_summit_position"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone2D.set_summit_position">[docs]</a>  <span class="k">def</span> <span class="nf">set_summit_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summit_position</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the position of the indenter.</span>
<span class="sd">    </span>
<span class="sd">    :param summit_position: position of the summit in a 2D space.</span>
<span class="sd">    :type summit_position: tuple or list containing two floats.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">summit_position</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;summit_position length must be 2, got {0} instead.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">summit_position</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">summit_position</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">summit_position</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">summit_position</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
  </div>
<div class="viewcode-block" id="DeformableCone2D.set_half_angle"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone2D.set_half_angle">[docs]</a>  <span class="k">def</span> <span class="nf">set_half_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">half_angle</span> <span class="o">=</span> <span class="mf">70.3</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the half angle of the indenter. Default is equivalent to modified Berkovich indenter in volume.</span>
<span class="sd">    </span>
<span class="sd">    :param half_angle: half_angle in DEGREES.</span>
<span class="sd">    :type half_angle: float &gt; 0.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">half_angle</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;half angle must be float, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">half_angle</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">half_angle</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">half_angle</span><span class="p">))</span></div>
<div class="viewcode-block" id="DeformableCone2D.set_l"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone2D.set_l">[docs]</a>  <span class="k">def</span> <span class="nf">set_l</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">l</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the l parameter of the indenter (see ``ParamInfiniteMesh`` for explanations) </span>
<span class="sd">    </span>
<span class="sd">    :param l: l</span>
<span class="sd">    :type l: float &gt; 0.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;l must be float, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
    </div>
<div class="viewcode-block" id="DeformableCone2D.set_Na"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone2D.set_Na">[docs]</a>  <span class="k">def</span> <span class="nf">set_Na</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Na</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the Na parameter of the indenter (see ``IndentationMesh`` for explanations).</span>
<span class="sd">    </span>
<span class="sd">    :param Na: Na</span>
<span class="sd">    :type Na: int &gt; 1</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Na</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;Na must be int &gt; 1, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Na</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Na</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Na</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="DeformableCone2D.set_Nb"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone2D.set_Nb">[docs]</a>  <span class="k">def</span> <span class="nf">set_Nb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Nb</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the Nb parameter of the indenter (see ``IndentationMesh`` for explanations).</span>
<span class="sd">    </span>
<span class="sd">    :param Nb: Nb</span>
<span class="sd">    :type Nb: int &gt; 1</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Nb</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;Nb must be int &gt; 1, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Nb</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Nb</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Nb</span><span class="p">)</span>
  </div>
<div class="viewcode-block" id="DeformableCone2D.set_Ns"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone2D.set_Ns">[docs]</a>  <span class="k">def</span> <span class="nf">set_Ns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Ns</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the Ns parameter of the indenter (see ```IndentationMesh`` for explanations).</span>
<span class="sd">    </span>
<span class="sd">    :param Ns: Ns</span>
<span class="sd">    :type Ns: int &gt; 1</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Ns</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;Ns must be int &gt; 1, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Ns</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ns</span><span class="p">)</span>
  </div>
<div class="viewcode-block" id="DeformableCone2D.set_Nf"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone2D.set_Nf">[docs]</a>  <span class="k">def</span> <span class="nf">set_Nf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Nf</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the Nf parameter of the indenter (see ``IndentationMesh`` for explanations).</span>
<span class="sd">    </span>
<span class="sd">    :param Nf: Nf</span>
<span class="sd">    :type Nf: int &gt; 1</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Nf</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;Nf must be int &gt; 1, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Nf</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Nf</span><span class="p">)</span>
  </div>
<div class="viewcode-block" id="DeformableCone2D.set_mat_label"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone2D.set_mat_label">[docs]</a>  <span class="k">def</span> <span class="nf">set_mat_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mat_label</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the label of the constitutive material of the indenter.</span>
<span class="sd">    </span>
<span class="sd">    :param mat_label: mat_label</span>
<span class="sd">    :type mat_label: string</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">mat_label</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;mat_label must be string, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">mat_label</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mat_label</span> <span class="o">=</span> <span class="n">mat_label</span>
  </div>
<div class="viewcode-block" id="DeformableCone2D.set_rigid"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone2D.set_rigid">[docs]</a>  <span class="k">def</span> <span class="nf">set_rigid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rigid</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the indenter to be rigid (True) or deformable (False).</span>
<span class="sd">    </span>
<span class="sd">    :param rigid: True for rigid, False for deformable (default)</span>
<span class="sd">    :type rigid: bool</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">rigid</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;rigid must be bool type, got {0} instead&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">rigid</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span> <span class="o">=</span> <span class="n">rigid</span>
    
  </div>
  <span class="k">def</span> <span class="nf">make_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">tan</span><span class="p">,</span> <span class="n">radians</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">arcsin</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">IndentationMesh</span><span class="p">(</span><span class="n">Na</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Na</span><span class="p">,</span> <span class="n">Nb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nb</span><span class="p">,</span> <span class="n">Ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span><span class="p">,</span> <span class="n">Nf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;CAX4&#39;</span><span class="p">)</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">apply_reflection</span><span class="p">(</span><span class="n">point</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">normal</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">ymax</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
    <span class="c">#mesh.nodes.add_set_by_func(&#39;bottom&#39;, lambda x, y, z, labels: y == ymax)</span>
    <span class="c">#mesh.nodes.add_set_by_func(&#39;reference&#39;, lambda x, y, z, labels: (x==0.) * (y==ymax) )</span>
    <span class="c">#mesh.nodes.add_set(&#39;tip&#39;, 1)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="n">rigid_nodes</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;bottom_nodes&#39;</span><span class="p">]</span>
      <span class="n">xsym_nodes</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;axis_nodes&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">rigid_nodes</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;all_nodes&#39;</span><span class="p">]</span>
      <span class="n">xsym_nodes</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;ref_node&#39;</span><span class="p">]</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;rigid_nodes&#39;</span><span class="p">,</span> <span class="n">rigid_nodes</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;xsym_nodes&#39;</span><span class="p">,</span> <span class="n">xsym_nodes</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">surfaces</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">add_surface</span><span class="p">(</span><span class="s">&#39;surface_faces&#39;</span><span class="p">,[</span> <span class="p">(</span><span class="s">&#39;surface_elements&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="p">])</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    def dispf( x, y, z, labels): </span>
<span class="sd">      return 0.* x, x * (ymax-y)/ymax * tan(pi/2. - radians(self.half_angle)), 0.* x</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">dispf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">labels</span><span class="p">):</span>
      <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**.</span><span class="mi">5</span>
      <span class="n">r1</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="mf">1.</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">)</span> <span class="c"># Removing zeros</span>
      <span class="n">theta</span> <span class="o">=</span> <span class="n">arcsin</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">half_angle</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
      
      <span class="n">x1</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
      <span class="n">y1</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span> <span class="n">y1</span> <span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="mf">0.</span> <span class="o">*</span> <span class="n">x</span>
    <span class="n">disp</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">eval_vectorFunction</span><span class="p">(</span><span class="n">dispf</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">apply_displacement</span><span class="p">(</span><span class="n">disp</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summit_position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summit_position</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span>
      
<div class="viewcode-block" id="DeformableCone2D.dump2inp"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone2D.dump2inp">[docs]</a>  <span class="k">def</span> <span class="nf">dump2inp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Dumps to Abaqus INP format.</span>
<span class="sd">    </span>
<span class="sd">    :rtype: string</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">make_mesh</span><span class="p">()</span>
    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">dump2inp</span><span class="p">()</span>
    <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">**----------------------------------</span>
<span class="s">** ELEMENT SURFACES</span>
<span class="s">**----------------------------------</span>
<span class="s">*SOLID SECTION, ELSET = ALL_ELEMENTS, MATERIAL = {0}</span>
<span class="s">*RIGID BODY, REF NODE = REF_NODE, PIN NSET=RIGID_NODES&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mat_label</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    
    <span class="k">return</span> <span class="n">out</span>
    </div>
<div class="viewcode-block" id="DeformableCone2D.get_edges"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone2D.get_edges">[docs]</a>  <span class="k">def</span> <span class="nf">get_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns a plotable version of the indenter usable directly in ``matplotlib.pyplot``.</span>
<span class="sd">    </span>
<span class="sd">    :rtype: x and y lists</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">get_edges</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
  </div>
<div class="viewcode-block" id="DeformableCone2D.get_border"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone2D.get_border">[docs]</a>  <span class="k">def</span> <span class="nf">get_border</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns a plotable version of the border of the indenter usable directly in ``matplotlib.pyplot``.</span>
<span class="sd">    </span>
<span class="sd">    :rtype: x and y lists</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">get_border</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="DeformableCone2D.apply_displacement"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone2D.apply_displacement">[docs]</a>  <span class="k">def</span> <span class="nf">apply_displacement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">disp</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Applies a displacement field to the indenter.</span>
<span class="sd">    </span>
<span class="sd">    :param disp: displacement field (with only one location).</span>
<span class="sd">    :type disp: ``abapy.postproc.VectorFieldOutput`` instance.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">apply_displacement</span><span class="p">(</span><span class="n">disp</span><span class="p">)</span></div>
<div class="viewcode-block" id="DeformableCone2D.equivalent_half_angle"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone2D.equivalent_half_angle">[docs]</a>  <span class="k">def</span> <span class="nf">equivalent_half_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">half_angle</span>
  

<span class="c">#-----------------------------------------------------------</span>
<span class="c"># WORK IN PROGRESS</span>
<span class="c"># Meta Indenter Class</span></div></div>
<span class="k">class</span> <span class="nc">DeformableIndenter2D</span><span class="p">:</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  A deformable indenter meta class usable in 2D and Axisymmetric simulations.</span>
<span class="sd">  </span>
<span class="sd">  :param half_angle: half_angle in DEGREES.</span>
<span class="sd">  :type half_angle: float &gt; 0.</span>
<span class="sd">  :param Na: number of elements along x axis in the finely meshed contact zone. *Must be power of 2*.</span>
<span class="sd">  :type Na: int</span>
<span class="sd">  :param Nb: number of elements along y axis in the finely meshed contact zone. *Must be power of 2*.</span>
<span class="sd">  :type Nb: int</span>
<span class="sd">  :param Ns: number of radial elements in the shell. </span>
<span class="sd">  :type Ns: int</span>
<span class="sd">  :param Nf: number of orthoradial elements in each half shell. Must be &gt; 0.</span>
<span class="sd">  :type Nf: int</span>
<span class="sd">  :param l: length of the square zone. </span>
<span class="sd">  :type l: float.</span>
<span class="sd">  :param mat_label: label of the constitutive material of the indenter. </span>
<span class="sd">  :type mat_label: any material class instance</span>
<span class="sd">  :param summit_position: position of the summit in a 2D space.</span>
<span class="sd">  :type summit_position: tuple or list containing two floats.</span>
<span class="sd">  :param rigid: True if indenter is to be rigid or False if the indenter is to be deformable. If the rigid behavior is chosen, the material label will be necessary but will not influence the results of the simulation.</span>
<span class="sd">  </span>
<span class="sd">  .. plot:: example_code/indentation/DeformableCone2D.py</span>
<span class="sd">      :include-source:    </span>
<span class="sd">  &#39;&#39;&#39;</span>
  
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dispf</span><span class="p">,</span> <span class="n">mesher</span><span class="p">,</span> <span class="n">mat_label</span> <span class="o">=</span> <span class="s">&#39;INDENTER_MAT&#39;</span><span class="p">,</span> <span class="n">summit_position</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">rigid</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_dispf</span><span class="p">(</span><span class="n">dispf</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_mesher</span><span class="p">(</span><span class="n">mesher</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_mat_label</span><span class="p">(</span><span class="n">mat_label</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_summit_position</span><span class="p">(</span><span class="n">summit_position</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_rigid</span><span class="p">(</span><span class="n">rigid</span><span class="p">)</span>
    
    
  <span class="k">def</span> <span class="nf">set_summit_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summit_position</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the position of the indenter.</span>
<span class="sd">    </span>
<span class="sd">    :param summit_position: position of the summit in a 2D space.</span>
<span class="sd">    :type summit_position: tuple or list containing two floats.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">summit_position</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;summit_position length must be 2, got {0} instead.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">summit_position</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">summit_position</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">summit_position</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">summit_position</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
  
  <span class="k">def</span> <span class="nf">set_half_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">half_angle</span> <span class="o">=</span> <span class="mf">70.3</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the half angle of the indenter. Default is equivalent to modified Berkovich indenter in volume.</span>
<span class="sd">    </span>
<span class="sd">    :param half_angle: half_angle in DEGREES.</span>
<span class="sd">    :type half_angle: float &gt; 0.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">half_angle</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;half angle must be float, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">half_angle</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">half_angle</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">half_angle</span><span class="p">))</span>
  <span class="k">def</span> <span class="nf">set_l</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">l</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the l parameter of the indenter (see ``ParamInfiniteMesh`` for explanations) </span>
<span class="sd">    </span>
<span class="sd">    :param l: l</span>
<span class="sd">    :type l: float &gt; 0.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;l must be float, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
    
  <span class="k">def</span> <span class="nf">set_Na</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Na</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the Na parameter of the indenter (see ``IndentationMesh`` for explanations).</span>
<span class="sd">    </span>
<span class="sd">    :param Na: Na</span>
<span class="sd">    :type Na: int &gt; 1</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Na</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;Na must be int &gt; 1, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Na</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Na</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Na</span><span class="p">)</span>
    
  <span class="k">def</span> <span class="nf">set_Nb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Nb</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the Nb parameter of the indenter (see ``IndentationMesh`` for explanations).</span>
<span class="sd">    </span>
<span class="sd">    :param Nb: Nb</span>
<span class="sd">    :type Nb: int &gt; 1</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Nb</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;Nb must be int &gt; 1, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Nb</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Nb</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Nb</span><span class="p">)</span>
  
  <span class="k">def</span> <span class="nf">set_Ns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Ns</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the Ns parameter of the indenter (see ```IndentationMesh`` for explanations).</span>
<span class="sd">    </span>
<span class="sd">    :param Ns: Ns</span>
<span class="sd">    :type Ns: int &gt; 1</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Ns</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;Ns must be int &gt; 1, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Ns</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ns</span><span class="p">)</span>
  
  <span class="k">def</span> <span class="nf">set_Nf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Nf</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the Nf parameter of the indenter (see ``IndentationMesh`` for explanations).</span>
<span class="sd">    </span>
<span class="sd">    :param Nf: Nf</span>
<span class="sd">    :type Nf: int &gt; 1</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Nf</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;Nf must be int &gt; 1, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Nf</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Nf</span><span class="p">)</span>
  
  <span class="k">def</span> <span class="nf">set_mat_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mat_label</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the label of the constitutive material of the indenter.</span>
<span class="sd">    </span>
<span class="sd">    :param mat_label: mat_label</span>
<span class="sd">    :type mat_label: string</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">mat_label</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;mat_label must be string, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">mat_label</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mat_label</span> <span class="o">=</span> <span class="n">mat_label</span>
  
  <span class="k">def</span> <span class="nf">set_rigid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rigid</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the indenter to be rigid (True) or deformable (False).</span>
<span class="sd">    </span>
<span class="sd">    :param rigid: True for rigid, False for deformable (default)</span>
<span class="sd">    :type rigid: bool</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">rigid</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;rigid must be bool type, got {0} instead&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">rigid</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span> <span class="o">=</span> <span class="n">rigid</span>
    
  
  <span class="k">def</span> <span class="nf">make_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">tan</span><span class="p">,</span> <span class="n">radians</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">arcsin</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">IndentationMesh</span><span class="p">(</span><span class="n">Na</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Na</span><span class="p">,</span> <span class="n">Nb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nb</span><span class="p">,</span> <span class="n">Ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span><span class="p">,</span> <span class="n">Nf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;CAX4&#39;</span><span class="p">)</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">apply_reflection</span><span class="p">(</span><span class="n">point</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">normal</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span> <span class="p">)</span>
    <span class="n">ymax</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
    <span class="c">#mesh.nodes.add_set_by_func(&#39;bottom&#39;, lambda x, y, z, labels: y == ymax)</span>
    <span class="c">#mesh.nodes.add_set_by_func(&#39;reference&#39;, lambda x, y, z, labels: (x==0.) * (y==ymax) )</span>
    <span class="c">#mesh.nodes.add_set(&#39;tip&#39;, 1)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="n">rigid_nodes</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;bottom_nodes&#39;</span><span class="p">]</span>
      <span class="n">xsym_nodes</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;axis_nodes&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">rigid_nodes</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;all_nodes&#39;</span><span class="p">]</span>
      <span class="n">xsym_nodes</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;ref_node&#39;</span><span class="p">]</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;rigid_nodes&#39;</span><span class="p">,</span> <span class="n">rigid_nodes</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;xsym_nodes&#39;</span><span class="p">,</span> <span class="n">xsym_nodes</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">surfaces</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">add_surface</span><span class="p">(</span><span class="s">&#39;surface_faces&#39;</span><span class="p">,[</span> <span class="p">(</span><span class="s">&#39;surface_elements&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="p">])</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    def dispf( x, y, z, labels): </span>
<span class="sd">      return 0.* x, x * (ymax-y)/ymax * tan(pi/2. - radians(self.half_angle)), 0.* x</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="nf">dispf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">labels</span><span class="p">):</span>
      <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**.</span><span class="mi">5</span>
      <span class="n">r1</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="mf">1.</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">)</span> <span class="c"># Removing zeros</span>
      <span class="n">theta</span> <span class="o">=</span> <span class="n">arcsin</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">half_angle</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
      
      <span class="n">x1</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
      <span class="n">y1</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span> <span class="n">y1</span> <span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="mf">0.</span> <span class="o">*</span> <span class="n">x</span>
    <span class="n">disp</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">eval_vectorFunction</span><span class="p">(</span><span class="n">dispf</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">apply_displacement</span><span class="p">(</span><span class="n">disp</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summit_position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summit_position</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span>
      
  <span class="k">def</span> <span class="nf">dump2inp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Dumps to Abaqus INP format.</span>
<span class="sd">    </span>
<span class="sd">    :rtype: string</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">make_mesh</span><span class="p">()</span>
    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">dump2inp</span><span class="p">()</span>
    <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">**----------------------------------</span>
<span class="s">** ELEMENT SURFACES</span>
<span class="s">**----------------------------------</span>
<span class="s">*SOLID SECTION, ELSET = ALL_ELEMENTS, MATERIAL = {0}</span>
<span class="s">*RIGID BODY, REF NODE = REF_NODE, PIN NSET=RIGID_NODES&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mat_label</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    
    <span class="k">return</span> <span class="n">out</span>
    
  <span class="k">def</span> <span class="nf">get_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns a plotable version of the indenter usable directly in ``matplotlib.pyplot``.</span>
<span class="sd">    </span>
<span class="sd">    :rtype: x and y lists</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">get_edges</span><span class="p">()</span>
  
  <span class="k">def</span> <span class="nf">get_border</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns a plotable version of the border of the indenter usable directly in ``matplotlib.pyplot``.</span>
<span class="sd">    </span>
<span class="sd">    :rtype: x and y lists</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">get_border</span><span class="p">()</span>
    
  <span class="k">def</span> <span class="nf">apply_displacement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">disp</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Applies a displacement field to the indenter.</span>
<span class="sd">    </span>
<span class="sd">    :param disp: displacement field (with only one location).</span>
<span class="sd">    :type disp: ``abapy.postproc.VectorFieldOutput`` instance.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">apply_displacement</span><span class="p">(</span><span class="n">disp</span><span class="p">)</span>
  <span class="k">def</span> <span class="nf">equivalent_half_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">half_angle</span>

<span class="c">#-----------------------------------------------------------</span>


  
<div class="viewcode-block" id="DeformableCone3D"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone3D">[docs]</a><span class="k">class</span> <span class="nc">DeformableCone3D</span><span class="p">:</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  A deformable cone usable in 3D simulations.</span>
<span class="sd">  </span>
<span class="sd">  :param half_angle: half_angle in DEGREES.</span>
<span class="sd">  :type half_angle: float &gt; 0.</span>
<span class="sd">  :param Na: number of elements along x axis in the finely meshed contact zone. *Must be power of 2*.</span>
<span class="sd">  :type Na: int</span>
<span class="sd">  :param Nb: number of elements along y axis in the finely meshed contact zone. *Must be power of 2*.</span>
<span class="sd">  :type Nb: int</span>
<span class="sd">  :param Ns: number of radial elements in the shell. </span>
<span class="sd">  :type Ns: int</span>
<span class="sd">  :param Nf: number of orthoradial elements in each half shell. Must be &gt; 0.</span>
<span class="sd">  :type Nf: int</span>
<span class="sd">  :param l: length of the square zone. </span>
<span class="sd">  :type l: float.</span>
<span class="sd">  :param N: Number of sweeped elements. </span>
<span class="sd">  :type N: int.</span>
<span class="sd">  :param sweep_angle: sweep angle. </span>
<span class="sd">  :type l: float.</span>
<span class="sd">  :param mat_label: label of the constitutive material of the indenter. </span>
<span class="sd">  :type mat_label: any material class instance</span>
<span class="sd">  :param summit_position: position of the summit in a 2D space.</span>
<span class="sd">  :type summit_position: tuple or list containing two floats.</span>
<span class="sd">  :param rigid: True if indenter is to be rigid or False if the indenter is to be deformable. If the rigid behavior is chosen, the material label will be necessary but will not influence the results of the simulation.</span>
<span class="sd">  :param pyramid:  Sets the indenter as a revolution cone (False) or a pyramid (True). I the case of the pyramid, the half angle becomes the axis to face angle.</span>
<span class="sd">  :type pyramid: bool</span>
<span class="sd">  </span>
<span class="sd">  For common 3D indenters, following parameters can be used:</span>
<span class="sd">     </span>
<span class="sd">  +---------------------+------------------+------------------+</span>
<span class="sd">  | Indenter            |     half_angle   |     sweep_angle  |</span>
<span class="sd">  +=====================+==================+==================+</span>
<span class="sd">  | Berkovich           |       65.03      |      60.00       |</span>
<span class="sd">  +---------------------+------------------+------------------+</span>
<span class="sd">  | Modified Berkovich  |       65.27      |      60.00       |</span>
<span class="sd">  +---------------------+------------------+------------------+</span>
<span class="sd">  | Cube Corner         |       35.26      |      60.00       |</span>
<span class="sd">  +---------------------+------------------+------------------+</span>
<span class="sd">  | Vickers             |       68.00      |      45.00       |</span>
<span class="sd">  +---------------------+------------------+------------------+</span>
<span class="sd">  </span>
<span class="sd">  .. plot:: example_code/indentation/DeformableCone3D.py</span>
<span class="sd">      :include-source:    </span>
<span class="sd">      </span>
<span class="sd">  </span>
<span class="sd">  &#39;&#39;&#39;</span>
  
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">half_angle</span><span class="o">=</span> <span class="mf">70.3</span><span class="p">,</span> <span class="n">Na</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">Nb</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">Ns</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">Nf</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">sweep_angle</span><span class="o">=</span><span class="mf">45.</span><span class="p">,</span> <span class="n">mat_label</span> <span class="o">=</span> <span class="s">&#39;INDENTER_MAT&#39;</span><span class="p">,</span> <span class="n">summit_position</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">rigid</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">pyramid</span> <span class="o">=</span> <span class="bp">False</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_half_angle</span><span class="p">(</span><span class="n">half_angle</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_l</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_Na</span><span class="p">(</span><span class="n">Na</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_Nb</span><span class="p">(</span><span class="n">Nb</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_Ns</span><span class="p">(</span><span class="n">Ns</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_Nf</span><span class="p">(</span><span class="n">Nf</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_N</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_sweep_angle</span><span class="p">(</span><span class="n">sweep_angle</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_mat_label</span><span class="p">(</span><span class="n">mat_label</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_summit_position</span><span class="p">(</span><span class="n">summit_position</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_rigid</span><span class="p">(</span><span class="n">rigid</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_pyramid</span><span class="p">(</span><span class="n">pyramid</span><span class="p">)</span>
    
    
<div class="viewcode-block" id="DeformableCone3D.set_summit_position"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone3D.set_summit_position">[docs]</a>  <span class="k">def</span> <span class="nf">set_summit_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">summit_position</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the position of the indenter.</span>
<span class="sd">    </span>
<span class="sd">    :param summit_position: position of the summit in a 2D space.</span>
<span class="sd">    :type summit_position: tuple or list containing two floats.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">summit_position</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;summit_position length must be 2, got {0} instead.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">summit_position</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">summit_position</span> <span class="o">=</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">summit_position</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">summit_position</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="p">)</span>
  </div>
<div class="viewcode-block" id="DeformableCone3D.set_half_angle"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone3D.set_half_angle">[docs]</a>  <span class="k">def</span> <span class="nf">set_half_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">half_angle</span> <span class="o">=</span> <span class="mf">70.3</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the half angle of the indenter. Default is equivalent to modified Berkovich indenter in volume.</span>
<span class="sd">    </span>
<span class="sd">    :param half_angle: half_angle in DEGREES.</span>
<span class="sd">    :type half_angle: float &gt; 0.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">half_angle</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;half angle must be float, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">half_angle</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">half_angle</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">half_angle</span><span class="p">))</span></div>
<div class="viewcode-block" id="DeformableCone3D.set_l"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone3D.set_l">[docs]</a>  <span class="k">def</span> <span class="nf">set_l</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">l</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the l parameter of the indenter (see ``ParamInfiniteMesh`` for explanations) </span>
<span class="sd">    </span>
<span class="sd">    :param l: l</span>
<span class="sd">    :type l: float &gt; 0.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;l must be float, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">l</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">l</span><span class="p">))</span>
    </div>
<div class="viewcode-block" id="DeformableCone3D.set_Na"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone3D.set_Na">[docs]</a>  <span class="k">def</span> <span class="nf">set_Na</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Na</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the Na parameter of the indenter (see ``IndentationMesh`` for explanations).</span>
<span class="sd">    </span>
<span class="sd">    :param Na: Na</span>
<span class="sd">    :type Na: int &gt; 1</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Na</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;Na must be int &gt; 1, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Na</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Na</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Na</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="DeformableCone3D.set_Nb"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone3D.set_Nb">[docs]</a>  <span class="k">def</span> <span class="nf">set_Nb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Nb</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the Nb parameter of the indenter (see ``IndentationMesh`` for explanations).</span>
<span class="sd">    </span>
<span class="sd">    :param Nb: Nb</span>
<span class="sd">    :type Nb: int &gt; 1</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Nb</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;Nb must be int &gt; 1, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Nb</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Nb</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Nb</span><span class="p">)</span>
  </div>
<div class="viewcode-block" id="DeformableCone3D.set_Ns"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone3D.set_Ns">[docs]</a>  <span class="k">def</span> <span class="nf">set_Ns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Ns</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the Ns parameter of the indenter (see ```IndentationMesh`` for explanations).</span>
<span class="sd">    </span>
<span class="sd">    :param Ns: Ns</span>
<span class="sd">    :type Ns: int &gt; 1</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Ns</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;Ns must be int &gt; 1, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Ns</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Ns</span><span class="p">)</span>
  </div>
<div class="viewcode-block" id="DeformableCone3D.set_Nf"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone3D.set_Nf">[docs]</a>  <span class="k">def</span> <span class="nf">set_Nf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Nf</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the Nf parameter of the indenter (see ``IndentationMesh`` for explanations).</span>
<span class="sd">    </span>
<span class="sd">    :param Nf: Nf</span>
<span class="sd">    :type Nf: int &gt; 1</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">Nf</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;Nf must be int &gt; 1, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">Nf</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">Nf</span><span class="p">)</span>
  </div>
<div class="viewcode-block" id="DeformableCone3D.set_N"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone3D.set_N">[docs]</a>  <span class="k">def</span> <span class="nf">set_N</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the number of sweeped elements</span>
<span class="sd">    </span>
<span class="sd">    :param N: N</span>
<span class="sd">    :type N: int &gt; 1</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;N must be int &gt; 0, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
  </div>
<div class="viewcode-block" id="DeformableCone3D.set_sweep_angle"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone3D.set_sweep_angle">[docs]</a>  <span class="k">def</span> <span class="nf">set_sweep_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sweep_angle</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the sweep angle.</span>
<span class="sd">    </span>
<span class="sd">    :param sweep_angle: sweep_angle</span>
<span class="sd">    :type sweep_angle: int &gt; 1</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sweep_angle</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">float</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;sweep_angle must be float, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">sweep_angle</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">sweep_angle</span> <span class="o">=</span> <span class="n">sweep_angle</span>
  </div>
<div class="viewcode-block" id="DeformableCone3D.set_mat_label"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone3D.set_mat_label">[docs]</a>  <span class="k">def</span> <span class="nf">set_mat_label</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mat_label</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the label of the constitutive material of the indenter.</span>
<span class="sd">    </span>
<span class="sd">    :param mat_label: mat_label</span>
<span class="sd">    :type mat_label: string</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">mat_label</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;mat_label must be string, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">mat_label</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mat_label</span> <span class="o">=</span> <span class="n">mat_label</span>
  </div>
<div class="viewcode-block" id="DeformableCone3D.set_rigid"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone3D.set_rigid">[docs]</a>  <span class="k">def</span> <span class="nf">set_rigid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rigid</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the indenter to be rigid (True) or deformable (False).</span>
<span class="sd">    </span>
<span class="sd">    :param rigid: True for rigid, False for deformable (default)</span>
<span class="sd">    :type rigid: bool</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">rigid</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;rigid must be bool type, got {0} instead&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">rigid</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span> <span class="o">=</span> <span class="n">rigid</span>
  </div>
<div class="viewcode-block" id="DeformableCone3D.set_pyramid"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone3D.set_pyramid">[docs]</a>  <span class="k">def</span> <span class="nf">set_pyramid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pyramid</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the indenter as a revolution cone (False) or a pyramid (True). I the case of the pyramid, the half angle becomes the axis to face angle.</span>
<span class="sd">    </span>
<span class="sd">    :param pyramid: True for pyramid, False for revolution (default).</span>
<span class="sd">    :type pyramid: bool</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pyramid</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;pyramid must be bool type, got {0} instead&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">pyramid</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pyramid</span> <span class="o">=</span> <span class="n">pyramid</span>  
  </div>
<div class="viewcode-block" id="DeformableCone3D.equivalent_half_angle"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone3D.equivalent_half_angle">[docs]</a>  <span class="k">def</span> <span class="nf">equivalent_half_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the half angle (in degrees) of the equivalent cone in terms of cross area and volume.</span>
<span class="sd">    :retype: float</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyramid</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">half_angle</span> 
    <span class="k">else</span><span class="p">:</span>
      <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
      <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">half_angle</span><span class="p">)</span>
      <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">sweep_angle</span><span class="p">)</span>
      <span class="n">Ap</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
      <span class="n">rc</span> <span class="o">=</span> <span class="p">(</span> <span class="n">Ap</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="p">)</span><span class="o">**.</span><span class="mi">5</span>
      <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
  </div>
  <span class="k">def</span> <span class="nf">make_mesh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">tan</span><span class="p">,</span> <span class="n">radians</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">arcsin</span><span class="p">,</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span>
    <span class="kn">import</span> <span class="nn">copy</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">IndentationMesh</span><span class="p">(</span><span class="n">Na</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Na</span><span class="p">,</span> <span class="n">Nb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nb</span><span class="p">,</span> <span class="n">Ns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ns</span><span class="p">,</span> <span class="n">Nf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Nf</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;CAX4&#39;</span><span class="p">)</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">apply_reflection</span><span class="p">(</span><span class="n">point</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="n">normal</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span> <span class="p">)</span>
    <span class="k">def</span> <span class="nf">dispf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">labels</span><span class="p">):</span>
      <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**.</span><span class="mi">5</span>
      <span class="n">r1</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="mf">1.</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">)</span> <span class="c"># Removing zeros</span>
      <span class="n">theta</span> <span class="o">=</span> <span class="n">arcsin</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="n">r1</span><span class="p">)</span> <span class="o">*</span> <span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">half_angle</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">pi</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span>
      <span class="n">x1</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
      <span class="n">y1</span> <span class="o">=</span> <span class="n">r</span> <span class="o">*</span> <span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">x1</span> <span class="o">-</span> <span class="n">x</span><span class="p">,</span> <span class="n">y1</span> <span class="o">-</span><span class="n">y</span><span class="p">,</span> <span class="mf">0.</span> <span class="o">*</span> <span class="n">x</span>
    <span class="n">disp</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">eval_vectorFunction</span><span class="p">(</span><span class="n">dispf</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">apply_displacement</span><span class="p">(</span><span class="n">disp</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summit_position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">summit_position</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">surfaces</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">add_surface</span><span class="p">(</span><span class="s">&#39;surface_faces&#39;</span><span class="p">,[</span> <span class="p">(</span><span class="s">&#39;surface_elements&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="p">])</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">sweep</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">sweep_angle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_angle</span><span class="p">,</span> <span class="n">extrude</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pyramid</span><span class="p">)</span>
    <span class="c"># Removing some sets intersections</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;all_front_nodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;front_nodes&#39;</span><span class="p">])</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;all_back_nodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;back_nodes&#39;</span><span class="p">])</span>
    <span class="n">front_nodes</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;front_nodes&#39;</span><span class="p">]</span>
    <span class="n">back_nodes</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;back_nodes&#39;</span><span class="p">]</span>
    <span class="n">axis_nodes</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;axis_nodes&#39;</span><span class="p">]</span>
    <span class="n">bottom_nodes</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;bottom_nodes&#39;</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">remove_intersection</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
      <span class="n">inter0</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">axis_nodes</span><span class="p">)</span>
      <span class="n">inter1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">bottom_nodes</span><span class="p">)</span>
      <span class="n">inter</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inter0</span> <span class="o">|</span> <span class="n">inter1</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">inter</span><span class="p">:</span> <span class="n">target</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
      
    <span class="n">remove_intersection</span><span class="p">(</span><span class="n">back_nodes</span><span class="p">)</span>
    <span class="n">remove_intersection</span><span class="p">(</span><span class="n">front_nodes</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rigid</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="n">rigid_nodes</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;bottom_nodes&#39;</span><span class="p">]</span>
      <span class="n">xsym_nodes</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;axis_nodes&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">rigid_nodes</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;all_nodes&#39;</span><span class="p">]</span>
      <span class="n">xsym_nodes</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;ref_node&#39;</span><span class="p">]</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;rigid_nodes&#39;</span><span class="p">,</span> <span class="n">rigid_nodes</span><span class="p">)</span>
    <span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">add_set</span><span class="p">(</span><span class="s">&#39;xsym_nodes&#39;</span><span class="p">,</span> <span class="n">xsym_nodes</span><span class="p">)</span>
    
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    def dispf( x, y, z, labels): </span>
<span class="sd">      return 0.* x, x * (ymax-y)/ymax * tan(pi/2. - radians(self.half_angle)), 0.* x</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span> <span class="o">=</span> <span class="n">mesh</span>
      
<div class="viewcode-block" id="DeformableCone3D.dump2inp"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone3D.dump2inp">[docs]</a>  <span class="k">def</span> <span class="nf">dump2inp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Dumps to Abaqus INP format.</span>
<span class="sd">    </span>
<span class="sd">    :rtype: string</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">make_mesh</span><span class="p">()</span>
    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">dump2inp</span><span class="p">()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sweep_angle</span> <span class="o">!=</span> <span class="mf">360.</span> <span class="p">:</span> 
      <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">**----------------------------------</span>
<span class="s">** CSYS CHANGE TO CYLINDRICAL</span>
<span class="s">**----------------------------------</span>
<span class="s">*TRANSFORM, TYPE=C, NSET=FRONT_NODES</span>
<span class="s"> 0., 0., 0., 0., 1.,0.    </span>
<span class="s">*TRANSFORM, TYPE=C, NSET=BACK_NODES</span>
<span class="s"> 0., 0., 0., 0., 1.,0.&#39;&#39;&#39;</span>    
    <span class="n">out</span> <span class="o">+=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">**----------------------------------</span>
<span class="s">** SOLID SECTION</span>
<span class="s">**----------------------------------</span>
<span class="s">*SOLID SECTION, ELSET = ALL_ELEMENTS, MATERIAL = {0}</span>
<span class="s">**----------------------------------</span>
<span class="s">** RIGID BODY</span>
<span class="s">**----------------------------------</span>
<span class="s">*RIGID BODY, REF NODE = REF_NODE, PIN NSET=RIGID_NODES&#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mat_label</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
    
    <span class="k">return</span> <span class="n">out</span>
    </div>
<div class="viewcode-block" id="DeformableCone3D.get_edges"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone3D.get_edges">[docs]</a>  <span class="k">def</span> <span class="nf">get_edges</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns a plotable version of the indenter usable directly in ``matplotlib.pyplot``.</span>
<span class="sd">    </span>
<span class="sd">    :rtype: x and y lists</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">get_edges</span><span class="p">()</span>
  </div>
<div class="viewcode-block" id="DeformableCone3D.get_border"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone3D.get_border">[docs]</a>  <span class="k">def</span> <span class="nf">get_border</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns a plotable version of the border of the indenter usable directly in ``matplotlib.pyplot``.</span>
<span class="sd">    </span>
<span class="sd">    :rtype: x and y lists</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">get_border</span><span class="p">()</span>
    </div>
<div class="viewcode-block" id="DeformableCone3D.apply_displacement"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.DeformableCone3D.apply_displacement">[docs]</a>  <span class="k">def</span> <span class="nf">apply_displacement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">disp</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Applies a displacement field to the indenter.</span>
<span class="sd">    </span>
<span class="sd">    :param disp: displacement field (with only one location).</span>
<span class="sd">    :type disp: ``abapy.postproc.VectorFieldOutput`` instance.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">apply_displacement</span><span class="p">(</span><span class="n">disp</span><span class="p">)</span>
  </div></div>
<div class="viewcode-block" id="Step"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Step">[docs]</a><span class="k">class</span> <span class="nc">Step</span><span class="p">:</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Builds a typical indentation step.</span>
<span class="sd">  </span>
<span class="sd">  :param name: step name.</span>
<span class="sd">  :type name: string</span>
<span class="sd">  :param disp: displacement.</span>
<span class="sd">  :type disp: float &gt; 0.</span>
<span class="sd">  :param nframes: frame number.</span>
<span class="sd">  :type nframes: int</span>
<span class="sd">  :param nlgeom: nlgeom state.</span>
<span class="sd">  :type nlgeom: boolean</span>
<span class="sd">  :param fieldOutputFreq: field output frequency</span>
<span class="sd">  :type fieldOutputFreq: int</span>
<span class="sd">  :param boundaries_3D: 3D or 2D boundary conditions. If 3D is True, then boundary conditions will be applied to the node sets ``front`` and ``back``.</span>
<span class="sd">  :type boundaries_3D: boolean </span>
<span class="sd">  : param full_3D: set to True if the model is a complete 3D model without symmetries and then does not need side boundaries.</span>
<span class="sd">  :type full_3D: boolean</span>
<span class="sd">  :param rigid_indenter_3D: Set to True if a 3D indenter is rigid  </span>
<span class="sd">  :type rigid_indenter_3D: boolean</span>
<span class="sd">  :param nodeFieldOutput: node outputs.</span>
<span class="sd">  :type nodeFieldOutput: string or list of strings</span>
<span class="sd">  :param elemFieldOutput: node outputs.</span>
<span class="sd">  :type elemFieldOutput: string or list of strings</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">disp</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">nlgeom</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">nframes</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">fieldOutputFreq</span> <span class="o">=</span> <span class="mi">999999</span><span class="p">,</span> <span class="n">boundaries_3D</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">full_3D</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">rigid_indenter_3D</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>  <span class="n">nodeFieldOutput</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;COORD&#39;</span><span class="p">,</span> <span class="s">&#39;U&#39;</span><span class="p">],</span> <span class="n">elemFieldOutput</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;LE&#39;</span><span class="p">,</span> <span class="s">&#39;EE&#39;</span><span class="p">,</span> <span class="s">&#39;PE&#39;</span><span class="p">,</span> <span class="s">&#39;PEEQ&#39;</span><span class="p">,</span> <span class="s">&#39;S&#39;</span><span class="p">],</span> <span class="n">mode</span> <span class="o">=</span> <span class="s">&#39;bulk&#39;</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_displacement</span><span class="p">(</span><span class="n">disp</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_nframes</span><span class="p">(</span><span class="n">nframes</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_nlgeom</span><span class="p">(</span><span class="n">nlgeom</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_fieldOutputFreq</span><span class="p">(</span><span class="n">fieldOutputFreq</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_boundaries_3D</span><span class="p">(</span><span class="n">boundaries_3D</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_rigid_indenter_3D</span><span class="p">(</span><span class="n">rigid_indenter_3D</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_full_3D</span><span class="p">(</span><span class="n">full_3D</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_nodeFieldOutput</span><span class="p">(</span><span class="n">nodeFieldOutput</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_elemFieldOutput</span><span class="p">(</span><span class="n">elemFieldOutput</span><span class="p">)</span>
    <span class="n">modes</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;bulk&#39;</span><span class="p">,</span> <span class="s">&#39;film&#39;</span><span class="p">,</span> <span class="s">&#39;film_substrate&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">modes</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;mode must be in {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">modes</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">mode</span>
    
<div class="viewcode-block" id="Step.set_name"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Step.set_name">[docs]</a>  <span class="k">def</span> <span class="nf">set_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets step name.</span>
<span class="sd">    </span>
<span class="sd">    :param name: step name.</span>
<span class="sd">    :type name: string</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;name must be str, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">anme</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span></div>
<div class="viewcode-block" id="Step.set_displacement"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Step.set_displacement">[docs]</a>  <span class="k">def</span> <span class="nf">set_displacement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">disp</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the displacement.</span>
<span class="sd">    </span>
<span class="sd">    :param disp: displacement.</span>
<span class="sd">    :type disp: float &gt; 0.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">disp</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;disp must be float, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">disp</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">disp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">disp</span><span class="p">)</span></div>
<div class="viewcode-block" id="Step.set_nframes"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Step.set_nframes">[docs]</a>  <span class="k">def</span> <span class="nf">set_nframes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nframes</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the number of frames.</span>
<span class="sd">    </span>
<span class="sd">    :param nframes: frame number.</span>
<span class="sd">    :type nframes: int</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">nframes</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;disp must be int &gt; 0, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">nframes</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nframes</span> <span class="o">=</span> <span class="n">nframes</span></div>
<div class="viewcode-block" id="Step.set_nlgeom"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Step.set_nlgeom">[docs]</a>  <span class="k">def</span> <span class="nf">set_nlgeom</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nlgeom</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets NLGEOM on or off.</span>
<span class="sd">    </span>
<span class="sd">    :param nlgeom: nlgeom state.</span>
<span class="sd">    :type nlgeom: boolean</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">nlgeom</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">bool</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;nlgeom must be boolean, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">nlgeom</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nlgeom</span> <span class="o">=</span> <span class="n">nlgeom</span></div>
<div class="viewcode-block" id="Step.set_fieldOutputFreq"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Step.set_fieldOutputFreq">[docs]</a>  <span class="k">def</span> <span class="nf">set_fieldOutputFreq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">freq</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the field output period.</span>
<span class="sd">    </span>
<span class="sd">    :param freq: field output frequency</span>
<span class="sd">    :type freq: int</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;freq must be int, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">freq</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fieldOutputFreq</span> <span class="o">=</span> <span class="n">freq</span>
    </div>
  <span class="k">def</span> <span class="nf">set_boundaries_3D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">boundaries_3D</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the 3D mode for step.</span>
<span class="sd">    </span>
<span class="sd">    :param boundaries_3D: 3D or 2D boundary conditions. If 3D is True, then boundary conditions will be applied to the node sets ``front`` and ``back``.</span>
<span class="sd">  :type boundaries_3D: boolean </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">boundaries_3D</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">bool</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;boundaries_3D must be bool, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">boundaries_3D</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">boundaries_3D</span> <span class="o">=</span> <span class="n">boundaries_3D</span>
    
  <span class="k">def</span> <span class="nf">set_full_3D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">full_3D</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the 3D mode for step.</span>
<span class="sd">    </span>
<span class="sd">    :param full_3D: set to True if the model is a complete 3D model without symmetries and then does not need side boundaries.</span>
<span class="sd">  :type full_3D: boolean </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">full_3D</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">bool</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;full_3D must be bool, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">full_3D</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">full_3D</span> <span class="o">=</span> <span class="n">full_3D</span>  
  
  <span class="k">def</span> <span class="nf">set_rigid_indenter_3D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rigid_indenter_3D</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the 3D rigid indenter.</span>
<span class="sd">    </span>
<span class="sd">    :param rigid_indenter_3D: Set to True if a 3D indenter is rigid  </span>
<span class="sd">  :type rigid_indenter_3D: boolean</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">rigid_indenter_3D</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">bool</span> <span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;rigid_indenter_3D must be bool, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">rigid_indenter_3D</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rigid_indenter_3D</span> <span class="o">=</span> <span class="n">rigid_indenter_3D</span>
    
<div class="viewcode-block" id="Step.set_nodeFieldOutput"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Step.set_nodeFieldOutput">[docs]</a>  <span class="k">def</span> <span class="nf">set_nodeFieldOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodeOutput</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the node field output to be recorded.</span>
<span class="sd">    </span>
<span class="sd">    :param nodeOutput: node outputs.</span>
<span class="sd">    :type nodeOutput: string or list of strings</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">nodeOutput</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">nodeFieldOutput</span> <span class="o">=</span> <span class="p">[</span><span class="n">nodeOutput</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">no</span> <span class="ow">in</span> <span class="n">nodeOutput</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">no</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;node outputs must be strings, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">no</span><span class="p">))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">nodeFieldOutput</span> <span class="o">=</span> <span class="n">nodeOutput</span></div>
<div class="viewcode-block" id="Step.set_elemFieldOutput"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Step.set_elemFieldOutput">[docs]</a>  <span class="k">def</span> <span class="nf">set_elemFieldOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elemOutput</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the element field output to be recorded.</span>
<span class="sd">    </span>
<span class="sd">    :param elemOutput: node outputs.</span>
<span class="sd">    :type elemOutput: string or list of strings</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">elemOutput</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">elemFieldOutput</span> <span class="o">=</span> <span class="p">[</span><span class="n">nodeOutput</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">eo</span> <span class="ow">in</span> <span class="n">elemOutput</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">eo</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;element outputs must be strings, got {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">no</span><span class="p">))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">elemFieldOutput</span> <span class="o">=</span> <span class="n">elemOutput</span></div>
<div class="viewcode-block" id="Step.dump2inp"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Step.dump2inp">[docs]</a>  <span class="k">def</span> <span class="nf">dump2inp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Dumps the step to Abaqus INP format.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">stepPattern</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;*STEP, NAME = {0}, NLGEOM = {1}, INC=1000000</span>
<span class="s">*STATIC, DIRECT</span>
<span class="s">{2}, 1.</span>
<span class="s">*BOUNDARY</span>
<span class="s">I_SAMPLE.AXIS_NODES, 1, 1</span>
<span class="s">I_SAMPLE.BOTTOM_NODES, 1, 3{7}</span>
<span class="s">I_INDENTER.XSYM_NODES, 1, 1</span>
<span class="s">I_INDENTER.XSYM_NODES, 3, 3</span>
<span class="s">I_INDENTER.REF_NODE, 4, 6 </span>
<span class="s">I_INDENTER.REF_NODE, 2, 2, {3}</span>
<span class="s">*RESTART, WRITE, FREQUENCY = 0</span>
<span class="s">*OUTPUT, FIELD, FREQUENCY = {4}</span>
<span class="s">*NODE OUTPUT</span>
<span class="s">{5}</span>
<span class="s">*NODE OUTPUT, NSET=I_INDENTER.REF_NODE</span>
<span class="s">U</span>
<span class="s">*ELEMENT OUTPUT, ELSET=I_SAMPLE.ALL_ELEMENTS, DIRECTIONS = YES, POSITION=NODES</span>
<span class="s">{6}</span>
<span class="s">*ELEMENT OUTPUT, ELSET=I_INDENTER.ALL_ELEMENTS, DIRECTIONS = YES, POSITION=NODES</span>
<span class="s">{6}</span>
<span class="s">*OUTPUT, HISTORY</span>
<span class="s">*ENERGY OUTPUT</span>
<span class="s">ALLFD, ALLWK</span>
<span class="s">*ENERGY OUTPUT, ELSET=I_SAMPLE.ALL_ELEMENTS</span>
<span class="s">ALLPD</span>
<span class="s">*ENERGY OUTPUT, ELSET=I_SAMPLE.ALL_ELEMENTS</span>
<span class="s">ALLSE</span>
<span class="s">*ENERGY OUTPUT, ELSET=I_INDENTER.ALL_ELEMENTS</span>
<span class="s">ALLSE</span>
<span class="s">*CONTACT OUTPUT, NSET=I_SAMPLE.TOP_NODES</span>
<span class="s">CPRESS</span>
<span class="s">*NODE OUTPUT, NSET=I_INDENTER.REF_NODE</span>
<span class="s">U2</span>
<span class="s">*NODE OUTPUT, NSET=I_INDENTER.TIP_NODE</span>
<span class="s">U2</span>
<span class="s">*NODE OUTPUT, NSET=I_INDENTER.REF_NODE</span>
<span class="s">RF2</span>
<span class="s">*NODE OUTPUT, NSET = I_SAMPLE.TOP_NODES</span>
<span class="s">COOR1, COOR2, COOR3</span>
<span class="s">*END STEP</span>
<span class="s">&#39;&#39;&#39;</span>
    <span class="c"># NLGEOM</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">nlgeom</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> 
      <span class="n">nlgeom</span> <span class="o">=</span> <span class="s">&#39;YES&#39;</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">nlgeom</span> <span class="o">=</span> <span class="s">&#39;NO&#39;</span>
      
    <span class="c"># BOUNDARY CONDITIONS</span>
    <span class="n">bc_3D</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundaries_3D</span><span class="p">:</span>
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_3D</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
        <span class="n">bc_3D</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">I_SAMPLE.FRONT_NODES, 2, 2</span><span class="se">\n</span><span class="s">I_SAMPLE.BACK_NODES, 2, 2</span><span class="se">\n</span><span class="s">I_SAMPLE.AXIS_NODES, 3, 3</span><span class="se">\n</span><span class="s">I_INDENTER.REF_NODE, 3, 6&#39;</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">bc_3D</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">I_SAMPLE.AXIS_NODES, 3, 3</span><span class="se">\n</span><span class="s">I_INDENTER.REF_NODE, 3, 6&#39;</span>  
      <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rigid_indenter_3D</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
        <span class="n">bc_3D</span> <span class="o">+=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">I_INDENTER.FRONT_NODES, 2, 2</span><span class="se">\n</span><span class="s">I_INDENTER.BACK_NODES, 2, 2</span><span class="se">\n</span><span class="s">I_INDENTER.AXIS_NODES, 1, 1</span><span class="se">\n</span><span class="s">I_INDENTER.AXIS_NODES, 3, 3&#39;</span>
      
    <span class="c"># FIELD OUTPUTS  </span>
    <span class="n">efos</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">fo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">elemFieldOutput</span><span class="p">:</span>
      <span class="n">efos</span> <span class="o">+=</span> <span class="s">&#39;{0}, &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fo</span><span class="p">)</span>   
    <span class="n">nfos</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">fo</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodeFieldOutput</span><span class="p">:</span>
      <span class="n">nfos</span> <span class="o">+=</span> <span class="s">&#39;{0}, &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fo</span><span class="p">)</span>      
    <span class="n">out</span> <span class="o">=</span>  <span class="n">stepPattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="n">nlgeom</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">nframes</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">disp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fieldOutputFreq</span><span class="p">,</span> <span class="n">nfos</span><span class="p">,</span> <span class="n">efos</span><span class="p">,</span> <span class="n">bc_3D</span><span class="p">)</span> 
    <span class="k">return</span> <span class="n">out</span>
    
    </div></div>
<div class="viewcode-block" id="MakeInp"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.MakeInp">[docs]</a><span class="k">def</span> <span class="nf">MakeInp</span><span class="p">(</span><span class="n">sample_mesh</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">indenter</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">sample_mat</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">indenter_mat</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">friction</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">steps</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">is_3D</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">heading</span> <span class="o">=</span> <span class="s">&#39;Abapy Indentation Simulation&#39;</span><span class="p">):</span>
  <span class="kn">import</span> <span class="nn">copy</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Builds a complete indentation INP for Abaqus and returns it as a string.</span>
<span class="sd">  </span>
<span class="sd">  :param sample_mesh: mesh to use for the sample. If None, default ``ParamInfiniteMesh`` will be used.</span>
<span class="sd">  :type sample_mesh: ``abapy.mesh.Mesh`` instance or None </span>
<span class="sd">  :param indenter: indenter to use. If None, default ``RigidCone2D`` will be used.</span>
<span class="sd">  :type indenter: any indenter instance or None</span>
<span class="sd">  :param sample_mat: sample material to use. If None, default ``abapy.materials.VonMises`` will be used.</span>
<span class="sd">  :type sample_mat: any material instance or None</span>
<span class="sd">  :param indenter_mat: indenter material to use. If None, a default elastic material will be used. If a rigid indenter is chosen, this material will not interfer with the simulation results.</span>
<span class="sd">  :type indenter_mat: any material instance or None</span>
<span class="sd">  :param friction: friction coefficient between indenter and sample.</span>
<span class="sd">  :type friction: float &gt;= 0.</span>
<span class="sd">  :param steps: steps to used during the test.</span>
<span class="sd">  :type steps: list of ``Step`` instances or None</span>
<span class="sd">  :rtype: string</span>
<span class="sd">  :type is_3D: set to True if the model is 3D, it will allow needed CSYS changes to cylindrical to be done.</span>
<span class="sd">  :type 3D: bool</span>
<span class="sd">  </span>
<span class="sd">  </span>
<span class="sd">  .. literalinclude:: example_code/indentation/MakeInp.py</span>
<span class="sd">  </span>
<span class="sd">  Returns: </span>
<span class="sd">  </span>
<span class="sd">  :download:`indentation_axi.inp &lt;example_code/indentation/workdir/indentation_axi.inp&gt;`</span>
<span class="sd">  </span>
<span class="sd">  :download:`indentation_berko.inp &lt;example_code/indentation/workdir/indentation_berko.inp&gt;`</span>
<span class="sd">&#39;&#39;&#39;</span>

  <span class="n">introPattern</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;**----------------------------------</span>
<span class="s">**INDENTATION SIMULATION</span>
<span class="s">**----------------------------------</span>
<span class="s">*HEADING</span>
<span class="s">{6}</span>
<span class="s">*PREPRINT, ECHO=NO, MODEL=NO, HISTORY=NO, CONTACT=NO</span>
<span class="s">**----------------------------------</span>
<span class="s">** SAMPLE DEFINITION</span>
<span class="s">*PART, NAME = P_SAMPLE</span>
<span class="s">{0}</span>
<span class="s">*SOLID SECTION, ELSET = ALL_ELEMENTS, MATERIAL = SAMPLE_MAT{5}</span>
<span class="s">*END PART</span>
<span class="s">**----------------------------------</span>
<span class="s">** INDENTER DEFINITION</span>
<span class="s">**----------------------------------</span>
<span class="s">*PART, NAME = P_INDENTER</span>
<span class="s">{1}</span>
<span class="s">*END PART</span>
<span class="s">**----------------------------------</span>
<span class="s">** ASSEMBLY</span>
<span class="s">**----------------------------------</span>
<span class="s">*ASSEMBLY, NAME = ASSEMBLY</span>
<span class="s">*INSTANCE, NAME = I_SAMPLE, PART = P_SAMPLE</span>
<span class="s">*END INSTANCE</span>
<span class="s">*INSTANCE, NAME = I_INDENTER, PART= P_INDENTER</span>
<span class="s">*END INSTANCE</span>
<span class="s">*END ASSEMBLY</span>
<span class="s">**----------------------------------</span>
<span class="s">** SURFACE INTERACTIONS</span>
<span class="s">**----------------------------------</span>
<span class="s">*SURFACE INTERACTION, NAME = SURF_INT</span>
<span class="s">*FRICTION</span>
<span class="s">{2},</span>
<span class="s">*SURFACE BEHAVIOR, PRESSURE-OVERCLOSURE = HARD</span>
<span class="s">*CONTACT PAIR, INTERACTION = SURF_INT, SUPPLEMENTARY CONSTRAINTS = NO, TYPE= SURFACE TO SURFACE</span>
<span class="s">I_SAMPLE.SURFACE_FACES, I_INDENTER.SURFACE_FACES</span>
<span class="s">**----------------------------------</span>
<span class="s">** MATERIALS</span>
<span class="s">**----------------------------------</span>
<span class="s">** SAMPLE MATERIAL</span>
<span class="s">{3}</span>
<span class="s">** INDENTER MATERIAL</span>
<span class="s">{4}</span>
<span class="s">**----------------------------------</span>
<span class="s">** STEPS</span>
<span class="s">**----------------------------------</span>
<span class="s">&#39;&#39;&#39;</span>
  <span class="k">if</span> <span class="n">sample_mesh</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">sample_mesh</span> <span class="o">=</span>  <span class="n">ParamInfiniteMesh</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">indenter</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">indenter</span> <span class="o">=</span> <span class="n">RigidCone2D</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">sample_mat</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">materials</span> <span class="kn">import</span> <span class="n">VonMises</span>
    <span class="n">sample_mat</span> <span class="o">=</span> <span class="n">VonMises</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="s">&#39;SAMPLE_MAT&#39;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">indenter_mat</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">materials</span> <span class="kn">import</span> <span class="n">Elastic</span>
    <span class="n">indenter_mat</span> <span class="o">=</span> <span class="n">Elastic</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="s">&#39;INDENTER_MAT&#39;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">is_3D</span><span class="p">:</span>
    <span class="n">csys</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\n</span><span class="s">*TRANSFORM, TYPE=C, NSET=FRONT_NODES</span>
<span class="s">0., 0., 0., 0., 1.,0.</span>
<span class="s">*TRANSFORM, TYPE=C, NSET=BACK_NODES</span>
<span class="s">0., 0., 0., 0., 1.,0.&#39;&#39;&#39;</span>
    <span class="c"># Removing some sets intersections</span>
    <span class="n">sample_mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;all_front_nodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">sample_mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;front_nodes&#39;</span><span class="p">])</span>
    <span class="n">sample_mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;all_back_nodes&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">sample_mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;back_nodes&#39;</span><span class="p">])</span>
    <span class="n">front_nodes</span> <span class="o">=</span> <span class="n">sample_mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;front_nodes&#39;</span><span class="p">]</span>
    <span class="n">back_nodes</span> <span class="o">=</span> <span class="n">sample_mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;back_nodes&#39;</span><span class="p">]</span>
    <span class="n">axis_nodes</span> <span class="o">=</span> <span class="n">sample_mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;axis_nodes&#39;</span><span class="p">]</span>
    <span class="n">bottom_nodes</span> <span class="o">=</span> <span class="n">sample_mesh</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">sets</span><span class="p">[</span><span class="s">&#39;bottom_nodes&#39;</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">remove_intersection</span><span class="p">(</span><span class="n">target</span><span class="p">):</span>
      <span class="n">inter0</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">axis_nodes</span><span class="p">)</span>
      <span class="n">inter1</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">bottom_nodes</span><span class="p">)</span>
      <span class="n">inter</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">inter0</span> <span class="o">|</span> <span class="n">inter1</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">inter</span><span class="p">:</span> <span class="n">target</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
      
    <span class="n">remove_intersection</span><span class="p">(</span><span class="n">back_nodes</span><span class="p">)</span>
    <span class="n">remove_intersection</span><span class="p">(</span><span class="n">front_nodes</span><span class="p">)</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">csys</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
  <span class="k">if</span> <span class="n">steps</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
    <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="n">Step</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;LOADING&#39;</span><span class="p">,</span> <span class="n">disp</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">Step</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;UNLOADING&#39;</span><span class="p">,</span> <span class="n">disp</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">)]</span>
  <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">steps</span><span class="p">,</span> <span class="n">Step</span><span class="p">):</span> <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="n">steps</span><span class="p">]</span>
  <span class="n">sample_mat</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;SAMPLE_MAT&#39;</span><span class="p">]</span>
  <span class="n">indenter_mat</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;INDENTER_MAT&#39;</span><span class="p">]</span>
  <span class="n">out</span> <span class="o">=</span> <span class="n">introPattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sample_mesh</span><span class="o">.</span><span class="n">dump2inp</span><span class="p">(),</span> <span class="n">indenter</span><span class="o">.</span><span class="n">dump2inp</span><span class="p">(),</span> <span class="n">friction</span> <span class="p">,</span> <span class="n">sample_mat</span><span class="o">.</span><span class="n">dump2inp</span><span class="p">(),</span> <span class="n">indenter_mat</span><span class="o">.</span><span class="n">dump2inp</span><span class="p">(),</span> <span class="n">csys</span><span class="p">,</span> <span class="n">heading</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">:</span>
    <span class="n">out</span> <span class="o">+=</span> <span class="n">step</span><span class="o">.</span><span class="n">dump2inp</span><span class="p">()</span>
  
    
  <span class="k">return</span> <span class="n">out</span>

</div>
<div class="viewcode-block" id="Manager"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Manager">[docs]</a><span class="k">class</span> <span class="nc">Manager</span><span class="p">:</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  The spirit of the simulation manager is to allow you to work at a higher level.   Using it allows you to define once and for all where you work, where Abaqus is, it fill manage subprocesses (Abaqus, Abaqus python) automatically. It is particularly interresting to perform parametric simulation because you can modify one parameter (material property, inenter property, ...) and keep all other parameters fixed and rerun directly the simulation process without making any mistake.</span>
<span class="sd">  </span>
<span class="sd">  .. note:: This class is still under developpement, important changes may then happen.</span>

<span class="sd">  </span>
<span class="sd">  :param workdir: work directory where simulation is to be run.</span>
<span class="sd">  :type workdir: string</span>
<span class="sd">  :param abqlauncher: abaqus launcher or path to it. Take care about aliases under linux because they often don&#39;t work under non interactive shells. A direct path to the launcher may be a good idea.</span>
<span class="sd">  :type abqlauncher: string</span>
<span class="sd">  :param samplemesh: mesh to be used by ``MakeInp``, None will let ``MakeInp`` use it&#39;s own default.</span>
<span class="sd">  :type samplemesh: ``abapy.mesh.Mesh`` instance or None</span>
<span class="sd">  :param indenter: indenter to be used by ``MakeInp``, None will let ``MakeInp`` use it&#39;s own default.</span>
<span class="sd">  :type indenter: indenter instance or None</span>
<span class="sd">  :param samplemat: sample material to be used by ``MakeInp``, None will let ``MakeInp`` use it&#39;s own default.</span>
<span class="sd">  :type samplemat: material instance or None</span>
<span class="sd">  :param indentermat: indenter material to be used by ``MakeInp``, None will let ``MakeInp`` use it&#39;s own default.</span>
<span class="sd">  :type indentermat: material instance or None</span>
<span class="sd">  :param steps: steps to use during the test.</span>
<span class="sd">  :type steps: list of ``Step`` instances.</span>
<span class="sd">  :param is_3D: has to be True if the simulation is 3D, else must be False.</span>
<span class="sd">  :type is_3D: Bool</span>
<span class="sd">  :param simname: simulation name used for all files.</span>
<span class="sd">  :type simname: string</span>
<span class="sd">  :param files2delete: file types to delete when cleaning work directory.</span>
<span class="sd">  :type files2delete: list of strings.</span>
<span class="sd"> </span>
<span class="sd">  .. literalinclude:: example_code/indentation/Manager.py</span>
<span class="sd">  </span>
<span class="sd">  Gives:</span>
<span class="sd">  </span>
<span class="sd">  .. image:: example_code/indentation/workdir/indentation_field.png</span>
<span class="sd">  .. image:: example_code/indentation/workdir/indentation_load-disp.png</span>
<span class="sd">  </span>
<span class="sd">  .. note:: In order to used abaqus Python, you have to build a post processing script that is executed in ``abaqus python``. Here is an example :download:`abqpostproc.py &lt;example_code/indentation/workdir/abqpostproc.py&gt;`:</span>
<span class="sd">  </span>
<span class="sd">  .. literalinclude:: example_code/indentation/workdir/abqpostproc.py</span>

<span class="sd">  .. note:: This class is still unfinished, post processing part remains unwritten (LC, April 12 2012) </span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workdir</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">abqlauncher</span> <span class="o">=</span> <span class="s">&#39;abaqus&#39;</span><span class="p">,</span> <span class="n">samplemesh</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">indenter</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">samplemat</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">indentermat</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">friction</span> <span class="o">=</span> <span class="mf">0.</span> <span class="p">,</span><span class="n">steps</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">is_3D</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">simname</span> <span class="o">=</span> <span class="s">&#39;indentation&#39;</span><span class="p">,</span> <span class="n">files2delete</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;sta&#39;</span><span class="p">,</span> <span class="s">&#39;sim&#39;</span><span class="p">,</span> <span class="s">&#39;prt&#39;</span><span class="p">,</span> <span class="s">&#39;odb&#39;</span><span class="p">,</span> <span class="s">&#39;msg&#39;</span><span class="p">,</span> <span class="s">&#39;log&#39;</span><span class="p">,</span> <span class="s">&#39;dat&#39;</span><span class="p">,</span> <span class="s">&#39;com&#39;</span><span class="p">,</span> <span class="s">&#39;inp&#39;</span><span class="p">,</span><span class="s">&#39;lck&#39;</span><span class="p">,</span><span class="s">&#39;pckl&#39;</span><span class="p">],</span> <span class="n">abqpostproc</span> <span class="o">=</span> <span class="s">&#39;abqpostproc.py&#39;</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">materials</span> <span class="kn">import</span> <span class="n">Elastic</span><span class="p">,</span> <span class="n">VonMises</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_workdir</span><span class="p">(</span><span class="n">workdir</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_abqlauncher</span><span class="p">(</span><span class="n">abqlauncher</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">samplemesh</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">samplemesh</span> <span class="o">=</span> <span class="n">ParamInfiniteMesh</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_samplemesh</span><span class="p">(</span><span class="n">samplemesh</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">indenter</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">indenter</span> <span class="o">=</span> <span class="n">RigidCone2D</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_indenter</span><span class="p">(</span><span class="n">indenter</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">samplemat</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
      <span class="kn">from</span> <span class="nn">abapy.materials</span> <span class="kn">import</span> <span class="n">VonMises</span>
      <span class="n">samplemat</span> <span class="o">=</span> <span class="n">VonMises</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">indentermat</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
      <span class="kn">from</span> <span class="nn">abapy.materials</span> <span class="kn">import</span> <span class="n">Elastic</span>
      <span class="n">indentermat</span> <span class="o">=</span> <span class="n">Elastic</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_samplemat</span><span class="p">(</span><span class="n">samplemat</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_indentermat</span><span class="p">(</span><span class="n">indentermat</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_friction</span><span class="p">(</span><span class="n">friction</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">steps</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> 
      <span class="n">steps</span> <span class="o">=</span> <span class="p">[</span><span class="n">Step</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;loading&#39;</span><span class="p">,</span> <span class="n">disp</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">),</span><span class="n">Step</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;unloading&#39;</span><span class="p">,</span> <span class="n">disp</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">)</span> <span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_steps</span><span class="p">(</span><span class="n">steps</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_is_3D</span><span class="p">(</span><span class="n">is_3D</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_simname</span><span class="p">(</span><span class="n">simname</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_files2delete</span><span class="p">(</span><span class="n">files2delete</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">set_abqpostproc</span><span class="p">(</span><span class="n">abqpostproc</span><span class="p">)</span>
    
    
    
<div class="viewcode-block" id="Manager.set_workdir"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Manager.set_workdir">[docs]</a>  <span class="k">def</span> <span class="nf">set_workdir</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">workdir</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets work directory</span>
<span class="sd">    </span>
<span class="sd">    :param workdir: relative or absolute path to workdir where simulations are run.</span>
<span class="sd">    :type workdir: string</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">workdir</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;workdir must be string, got {0} instead.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">workdir</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">=</span>  <span class="n">workdir</span></div>
<div class="viewcode-block" id="Manager.set_abqlauncher"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Manager.set_abqlauncher">[docs]</a>  <span class="k">def</span> <span class="nf">set_abqlauncher</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">abqlauncher</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets Abaqus launcher</span>
<span class="sd">    :param abqlauncher: alias, relative path or absolute path to abaqus launcher. </span>
<span class="sd">    :type abqlaucher: string</span>
<span class="sd">    </span>
<span class="sd">    .. note: aliases may not work because they are often limited to interactive shells.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">abqlauncher</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;workdir must be string, got {0} instead.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">abqlauncher</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">abqlauncher</span> <span class="o">=</span>  <span class="n">abqlauncher</span></div>
<div class="viewcode-block" id="Manager.set_samplemesh"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Manager.set_samplemesh">[docs]</a>  <span class="k">def</span> <span class="nf">set_samplemesh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samplemesh</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets sample mesh.</span>
<span class="sd">    </span>
<span class="sd">    :param samplemesh: sample mesh.</span>
<span class="sd">    :type samplemesh: ``abapy.mesh.Mesh`` instance</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">mesh</span> <span class="kn">import</span> <span class="n">Mesh</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">samplemesh</span><span class="p">,</span> <span class="n">Mesh</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;samplemesh must be Mesh instance, got {0} instead.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">samplemesh</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">samplemesh</span> <span class="o">=</span> <span class="n">samplemesh</span></div>
<div class="viewcode-block" id="Manager.set_indenter"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Manager.set_indenter">[docs]</a>  <span class="k">def</span> <span class="nf">set_indenter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indenter</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets indenter.</span>
<span class="sd">    </span>
<span class="sd">    :param indenter: indenter to be used.</span>
<span class="sd">    :type indenter: instance of any indenter class</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">indenter</span> <span class="o">=</span> <span class="n">indenter</span></div>
<div class="viewcode-block" id="Manager.set_samplemat"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Manager.set_samplemat">[docs]</a>  <span class="k">def</span> <span class="nf">set_samplemat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">samplemat</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets sample material.</span>
<span class="sd">    </span>
<span class="sd">    :param samplemat: core material.</span>
<span class="sd">    :type samplemat: instance of any material class</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">samplemat</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;SAMPLE_MAT&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">samplemat</span> <span class="o">=</span> <span class="n">samplemat</span>
  </div>
  <span class="k">def</span> <span class="nf">set_indentermat</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indentermat</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets indenter material.</span>
<span class="sd">    </span>
<span class="sd">    :param indentermat: indenter material.</span>
<span class="sd">    :type indentermat: instance of any material class</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">indentermat</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;SAMPLE_MAT&#39;</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">indentermat</span> <span class="o">=</span> <span class="n">indentermat</span>
 
  <span class="k">def</span> <span class="nf">set_friction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">friction</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the friction coefficient.</span>
<span class="sd">    </span>
<span class="sd">    :param friction: friction coefficient.</span>
<span class="sd">    :type friction: float &gt;= 0.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">friction</span> <span class="o">=</span> <span class="n">friction</span>
    
<div class="viewcode-block" id="Manager.set_steps"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Manager.set_steps">[docs]</a>  <span class="k">def</span> <span class="nf">set_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">steps</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets steps</span>
<span class="sd">    </span>
<span class="sd">    :param steps: description of steps.</span>
<span class="sd">    :type steps: list ``of Steps`` instances</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="n">steps</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">Step</span><span class="p">)</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;step must be Step instance, got {0} instead.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">step</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="n">steps</span>
  </div>
  <span class="k">def</span> <span class="nf">set_is_3D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_3D</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the 3D flag as True or False.</span>
<span class="sd">    </span>
<span class="sd">    :param is_3D: has to be True if the simulation is 3D, else must be False.</span>
<span class="sd">    :type is_3D: Bool</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_3D</span> <span class="o">=</span> <span class="n">is_3D</span>
  
<div class="viewcode-block" id="Manager.set_simname"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Manager.set_simname">[docs]</a>  <span class="k">def</span> <span class="nf">set_simname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">simname</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets simname.</span>
<span class="sd">    </span>
<span class="sd">    :param simname: simulation name that is used to name simulation files.</span>
<span class="sd">    :type simname: string</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">simname</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;simname must be string, got {0} instead.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">simname</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">simname</span> <span class="o">=</span> <span class="n">simname</span></div>
<div class="viewcode-block" id="Manager.set_files2delete"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Manager.set_files2delete">[docs]</a>  <span class="k">def</span> <span class="nf">set_files2delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">files2delete</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets files to delete when cleaning.</span>
<span class="sd">    </span>
<span class="sd">    :param files2delete: files types to be deleted when cleaning workdir.</span>
<span class="sd">    :type files2delete: list of strings.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files2delete</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;file must be string, got {0} instead&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">files2delete</span> <span class="o">=</span> <span class="n">files2delete</span></div>
<div class="viewcode-block" id="Manager.make_inp"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Manager.make_inp">[docs]</a>  <span class="k">def</span> <span class="nf">make_inp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Builds the INP file using ``MakeInp`` and stores it in workdir as &quot;simname.inp&quot;.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">MakeInp</span><span class="p">(</span><span class="n">sample_mesh</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samplemesh</span><span class="p">,</span> <span class="n">indenter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indenter</span><span class="p">,</span> <span class="n">sample_mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">samplemat</span><span class="p">,</span> <span class="n">indenter_mat</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">indentermat</span><span class="p">,</span> <span class="n">friction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">friction</span><span class="p">,</span> <span class="n">steps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps</span><span class="p">,</span> <span class="n">is_3D</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_3D</span><span class="p">)</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;{0}{1}.inp&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">simname</span> <span class="p">)</span>
    <span class="k">print</span> <span class="s">&#39;&lt; Creating INP file: {0} &gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">pattern</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>
<div class="viewcode-block" id="Manager.run_sim"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Manager.run_sim">[docs]</a>  <span class="k">def</span> <span class="nf">run_sim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Runs the simulation.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">subprocess</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">print</span> <span class="s">&#39;&lt; Running simulation {0} in Abaqus&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simname</span><span class="p">)</span> 
    <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span> <span class="s">&#39;{0} job={1} input={1}.inp interactive&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abqlauncher</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">simname</span><span class="p">),</span> <span class="n">cwd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">stdout</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">trash</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">print</span> <span class="s">&#39;&lt; Ran {0} in Abaqus: duration {1:.2f}s&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simname</span><span class="p">,</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>   
  </div>
  <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
    <span class="k">return</span> <span class="s">&#39;&lt;abapy.indentation.Manager instance&gt;&#39;</span>  
  
<div class="viewcode-block" id="Manager.erase_files"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Manager.erase_files">[docs]</a>  <span class="k">def</span> <span class="nf">erase_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Erases all files with types declared in files2delete in the work directory with the name *simname*.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="k">print</span> <span class="s">&#39;&lt; Removing temporary files&gt;&#39;</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;rm -f {0}{1}.{2}&#39;</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">files2delete</span><span class="p">:</span>
      <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span> <span class="n">pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">simname</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="p">)</span>
    </div>
<div class="viewcode-block" id="Manager.set_abqpostproc"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Manager.set_abqpostproc">[docs]</a>  <span class="k">def</span> <span class="nf">set_abqpostproc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">abqpostproc</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the path to the abaqus post-processing python script, this path must be absolute or relative to workdir.</span>
<span class="sd">    </span>
<span class="sd">    :param abqpostproc: link to the abaqus post processing script.</span>
<span class="sd">    :type abqpostproc: string</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">abqpostproc</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">,</span> <span class="s">&#39;abqpostproc must be string&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">abqpostproc</span> <span class="o">=</span> <span class="n">abqpostproc</span>
  </div>
<div class="viewcode-block" id="Manager.run_abqpostproc"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Manager.run_abqpostproc">[docs]</a>  <span class="k">def</span> <span class="nf">run_abqpostproc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Runs the first pass of post processing inside Abaqus Python.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">subprocess</span><span class="o">,</span> <span class="nn">time</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="c">#p = subprocess.Popen( [self.abqlauncher, &#39;python&#39; ,self.abqpostproc, self.simname], cwd = self.workdir,stdout = subprocess.PIPE )</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">abqlauncher</span><span class="p">,</span>  <span class="s">&#39;viewer&#39;</span><span class="p">,</span> <span class="s">&#39;noGUI={0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">abqpostproc</span><span class="p">)],</span> <span class="n">cwd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">workdir</span><span class="p">,</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span> <span class="p">)</span>
    <span class="n">trash</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">print</span> <span class="s">&#39;&lt; Post Processed {0} in Abaqus: duration {1:.2f}s&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simname</span><span class="p">,</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>   
    
    </div>
<div class="viewcode-block" id="Manager.set_pypostprocfunc"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Manager.set_pypostprocfunc">[docs]</a>  <span class="k">def</span> <span class="nf">set_pypostprocfunc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Sets the Python post processing function.</span>
<span class="sd">    </span>
<span class="sd">    :param func: post processing function of the data produced by abaqus post processing.</span>
<span class="sd">    :type func: function</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pypostprocfunc</span> <span class="o">=</span> <span class="n">func</span>
      </div>
<div class="viewcode-block" id="Manager.run_pypostproc"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Manager.run_pypostproc">[docs]</a>  <span class="k">def</span> <span class="nf">run_pypostproc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Runs the Python post processing function.</span>
<span class="sd">    </span>
<span class="sd">    :rtype: data returned by pypostprocfunc</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">import</span> <span class="nn">time</span>
    <span class="kn">from</span> <span class="nn">abapy.misc</span> <span class="kn">import</span> <span class="n">load</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">abqdata</span> <span class="o">=</span> <span class="n">load</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">workdir</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">simname</span> <span class="o">+</span> <span class="s">&#39;.pckl&#39;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pypostprocfunc</span><span class="p">(</span><span class="n">abqdata</span><span class="p">)</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="k">print</span> <span class="s">&#39;&lt; Post Processed {0} in Python: duration {1:.2f}s&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">simname</span><span class="p">,</span> <span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span>  
    <span class="k">return</span> <span class="n">data</span> 
    </div></div>
<div class="viewcode-block" id="ContactData"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.ContactData">[docs]</a><span class="k">class</span> <span class="nc">ContactData</span><span class="p">:</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  ContactData class aims to store and proceed all contact related data:</span>
<span class="sd">  </span>
<span class="sd">  * Position of nodes involved in the contact relationship.</span>
<span class="sd">  * Contact pressure on these nodes.</span>
<span class="sd">  </span>
<span class="sd">  This class can be used to perform various tasks:</span>
<span class="sd">  </span>
<span class="sd">  * Find contact shape.</span>
<span class="sd">  * Compute contact area.</span>
<span class="sd">  * Find contact contour.</span>
<span class="sd">  * Produce matrix (AFM-like) images using the SPYM module.</span>
<span class="sd">  </span>
<span class="sd">:param repeat: this parameter is only used in the case of 3D contact. Due to symmetries, only a portion of the problem is computed. To get back to complete problem, a symmetry has to be performed and then a given number of copies of the result, this number is repeat. For example, to simulate a Vickers 4 sided indenter indentation, you will compute only 1 / 8 of the problem. So after a symmetry, you will need 4 copies of the result, the repeat = 4. To summarize, repeat is the number of faces of the indenter.</span>
<span class="sd">:type repeat: int &gt; 0</span>
<span class="sd">:param is_3D: True for 3D contact, False for axisymmetric contact.</span>
<span class="sd">:type is_3D: bool</span>
<span class="sd">:param dtf: ``array.array`` data type for floats, &#39;f&#39; for 32 bit float, &#39;d&#39; for 64 float.</span>
<span class="sd">:type dtf: string</span>
<span class="sd">  </span>
<span class="sd">.. plot:: example_code/indentation/ContactData.py</span>
<span class="sd">   :include-source:    </span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">repeat</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">is_3D</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">dtf</span> <span class="o">=</span> <span class="s">&#39;f&#39;</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coor1</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,</span> <span class="p">[])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">coor2</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,</span> <span class="p">[])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">altitude</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,</span> <span class="p">[])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">dtf</span><span class="p">,</span> <span class="p">[])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span> <span class="o">=</span> <span class="n">repeat</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">is_3D</span> <span class="o">=</span> <span class="n">is_3D</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">dtf</span> <span class="o">=</span> <span class="n">dtf</span>
    
<div class="viewcode-block" id="ContactData.add_data"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.ContactData.add_data">[docs]</a>  <span class="k">def</span> <span class="nf">add_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">coor1</span><span class="p">,</span> <span class="n">coor2</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">altitude</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">pressure</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Adds data to a ContactData instance.</span>
<span class="sd">    </span>
<span class="sd">    :param coor1: radial position in the axisymmetric case or in plane position first coordinate in the 3D case.</span>
<span class="sd">    :type coor1: float or list like</span>
<span class="sd">    :param coor2: orthoradial position in the axisymmetric case of second in plane coordinate in the 3D case.</span>
<span class="sd">    :type coor2: float of list like</span>
<span class="sd">    :param altitude: out of plane position.</span>
<span class="sd">    :type altitude: float or list like</span>
<span class="sd">    :param pressure: normal contact pressure.</span>
<span class="sd">    :type pressure: float or list like</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">coor1</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">]:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">coor1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">coor1</span><span class="p">))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">coor2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">coor2</span><span class="p">))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">altitude</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">altitude</span><span class="p">))</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">pressure</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">coor1</span><span class="p">,</span> <span class="s">&#39;__contains__&#39;</span><span class="p">):</span>
      <span class="n">coor1</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span> <span class="n">coor1</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">coor2</span><span class="p">,</span> <span class="s">&#39;__contains__&#39;</span><span class="p">):</span>
        <span class="n">coor2</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span> <span class="n">coor2</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span> 
        <span class="n">coor2</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span> <span class="p">[</span><span class="n">coor2</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coor1</span><span class="p">))])</span>
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">altitude</span><span class="p">,</span> <span class="s">&#39;__contains__&#39;</span><span class="p">):</span>
        <span class="n">altitude</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span> <span class="n">altitude</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span> 
        <span class="n">altitude</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span> <span class="p">[</span><span class="n">altitude</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coor1</span><span class="p">))])</span>
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">pressure</span><span class="p">,</span> <span class="s">&#39;__contains__&#39;</span><span class="p">):</span>
        <span class="n">pressure</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span> <span class="n">pressure</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span> 
        <span class="n">pressure</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtf</span><span class="p">,</span> <span class="p">[</span><span class="n">pressure</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coor1</span><span class="p">))])</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">coor1</span> <span class="o">+=</span> <span class="n">coor1</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">coor2</span> <span class="o">+=</span> <span class="n">coor2</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">altitude</span> <span class="o">+=</span> <span class="n">altitude</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span> <span class="o">+=</span> <span class="n">pressure</span>
      
      
      </div>
  <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;&lt;ContactData instance w. {0} data points&gt;&#39;</span>
    <span class="k">return</span> <span class="n">pattern</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coor1</span><span class="p">))</span>
   
   
<div class="viewcode-block" id="ContactData.get_3D_data"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.ContactData.get_3D_data">[docs]</a>  <span class="k">def</span> <span class="nf">get_3D_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axi_repeat</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">delaunay_disp</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">crit_dist</span> <span class="o">=</span> <span class="mf">1.e-5</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns full 3D data usable for interpolation or for ploting. This method performs all the copy and paste needed to get the complete contact (due to symmetries) and also producec a triangular mesh of the surface using the Delaunay algorithm (via ``scipy``).</span>
<span class="sd">    </span>
<span class="sd">:param axi_repeat: number of times axisymmetric profile has to be pasted orthoradially.</span>
<span class="sd">:type axi_repeat: int &gt; 0</span>
<span class="sd">:rtype: 3 arrays points, alt, press and conn</span>
<span class="sd">    </span>
<span class="sd">.. plot:: example_code/indentation/ContactData-get_3D_data.py</span>
<span class="sd">  :include-source:    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">Delaunay</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="n">array</span><span class="p">,</span> <span class="n">append</span><span class="p">,</span> <span class="n">delete</span>
    <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">copy</span>
    <span class="kn">from</span> <span class="nn">mesh</span> <span class="kn">import</span> <span class="n">get_neighbors</span>
    <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">alt</span><span class="p">,</span> <span class="n">press</span> <span class="o">=</span> <span class="n">array</span><span class="p">([]),</span><span class="n">array</span><span class="p">([]),</span><span class="n">array</span><span class="p">([]),</span><span class="n">array</span><span class="p">([])</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_3D</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="n">delta</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span><span class="n">pi</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">axi_repeat</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">axi_repeat</span><span class="p">):</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span> <span class="n">c1</span><span class="p">,</span> <span class="n">cos</span><span class="p">(</span><span class="n">delta</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coor1</span><span class="p">)</span> <span class="p">))</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span> <span class="n">c2</span><span class="p">,</span> <span class="n">sin</span><span class="p">(</span><span class="n">delta</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coor1</span><span class="p">)</span> <span class="p">))</span>
        <span class="n">alt</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">alt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">altitude</span><span class="p">)</span>
        <span class="n">press</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">press</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pressure</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">c1_0</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coor1</span><span class="p">)</span>
      <span class="n">c2_0</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coor2</span><span class="p">)</span>
      <span class="n">alt_0</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">altitude</span><span class="p">)</span>
      <span class="n">press_0</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pressure</span><span class="p">)</span>
      <span class="c"># Applying symmetry</span>
      <span class="n">c1_0</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">c1_0</span><span class="p">,</span> <span class="n">c1_0</span><span class="p">)</span>
      <span class="n">c2_0</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">c2_0</span><span class="p">,</span> <span class="o">-</span><span class="n">c2_0</span><span class="p">)</span>
      <span class="n">alt_0</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">alt_0</span><span class="p">,</span> <span class="n">alt_0</span><span class="p">)</span>
      <span class="n">press_0</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">press_0</span><span class="p">,</span> <span class="n">press_0</span><span class="p">)</span> 
      <span class="n">delta</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">repeat</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">repeat</span><span class="p">):</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">cos</span><span class="p">(</span><span class="n">delta</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">c1_0</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">delta</span> <span class="o">*</span> <span class="n">i</span> <span class="p">)</span> <span class="o">*</span> <span class="n">c2_0</span><span class="p">)</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span> <span class="n">cos</span><span class="p">(</span><span class="n">delta</span> <span class="o">*</span> <span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">c2_0</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">delta</span> <span class="o">*</span> <span class="n">i</span> <span class="p">)</span> <span class="o">*</span> <span class="n">c1_0</span><span class="p">)</span>
        <span class="n">alt</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">alt</span><span class="p">,</span> <span class="n">alt_0</span><span class="p">)</span>
        <span class="n">press</span> <span class="o">=</span> <span class="n">append</span><span class="p">(</span><span class="n">press</span><span class="p">,</span> <span class="n">press_0</span><span class="p">)</span>
    
    
    <span class="n">points</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>    
    <span class="n">neighbors</span> <span class="o">=</span> <span class="n">get_neighbors</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">crit_dist</span> <span class="o">=</span> <span class="n">crit_dist</span><span class="p">)</span>
    <span class="n">to_delete</span> <span class="o">=</span> <span class="p">[</span> <span class="p">]</span>
    <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">neighbors</span><span class="p">:</span> <span class="n">to_delete</span> <span class="o">+=</span> <span class="n">neighbor</span>
    <span class="c">#print to_delete</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">to_delete</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  
    <span class="n">alt</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="n">alt</span><span class="p">,</span> <span class="n">to_delete</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  
    <span class="n">press</span> <span class="o">=</span> <span class="n">delete</span><span class="p">(</span><span class="n">press</span><span class="p">,</span> <span class="n">to_delete</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> 
    <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">delaunay_disp</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">c1_temp</span><span class="p">,</span> <span class="n">c2_temp</span> <span class="o">=</span> <span class="n">copy</span><span class="p">(</span><span class="n">c1</span><span class="p">),</span> <span class="n">copy</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
      <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="o">=</span> <span class="n">delaunay_disp</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">)</span>
        
    <span class="n">points</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>        
    <span class="n">conn</span> <span class="o">=</span> <span class="n">Delaunay</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">.</span><span class="n">vertices</span>
    <span class="k">if</span> <span class="n">delaunay_disp</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span> 
      <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="o">=</span> <span class="n">c1_temp</span><span class="p">,</span> <span class="n">c2_temp</span>
      <span class="n">points</span> <span class="o">=</span> <span class="n">array</span><span class="p">([</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">])</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>  
    <span class="k">return</span> <span class="n">points</span><span class="p">,</span> <span class="n">alt</span><span class="p">,</span> <span class="n">press</span><span class="p">,</span> <span class="n">conn</span>
  </div>
<div class="viewcode-block" id="ContactData.export2spym"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.ContactData.export2spym">[docs]</a>  <span class="k">def</span> <span class="nf">export2spym</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lx</span><span class="p">,</span> <span class="n">ly</span><span class="p">,</span> <span class="n">xc</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">yc</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">nx</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="mi">256</span><span class="p">,</span> <span class="n">xy_unit</span> <span class="o">=</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">alt_unit</span> <span class="o">=</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="n">press_unit</span> <span class="o">=</span> <span class="s">&#39;Pa&#39;</span><span class="p">,</span> <span class="n">axi_repeat</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">delaunay_disp</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s">&#39;linear&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Exports data to ``spym.generic.Spm_image`` format.</span>
<span class="sd">    </span>
<span class="sd">    :param lx: length on x axis</span>
<span class="sd">    :type lx: float</span>
<span class="sd">    :param ly: length on y axis</span>
<span class="sd">    :type ly: float</span>
<span class="sd">    :param xc: position of the center of the image on the x axis</span>
<span class="sd">    :type xc: float</span>
<span class="sd">    :param yc: position of the center of the image on the y axis</span>
<span class="sd">    :type yc: float</span>
<span class="sd">    :param nx: x resolution</span>
<span class="sd">    :type nx: uint</span>
<span class="sd">    :param ny: y resolution</span>
<span class="sd">    :type ny: uint</span>
<span class="sd">    :param xy_unit: xy unit</span>
<span class="sd">    :type xy_unit: str</span>
<span class="sd">    :param alt_unit: altitude unit</span>
<span class="sd">    :type alt_unit: str</span>
<span class="sd">    :param press_unit: contact pressure unit</span>
<span class="sd">    :type press_unit: str</span>
<span class="sd">     </span>
<span class="sd">    See get_3D_data for other params.</span>
<span class="sd">    </span>
<span class="sd">    .. plot:: example_code/indentation/ContactData-export2spym.py</span>
<span class="sd">      :include-source:  </span>
<span class="sd">    </span>
<span class="sd">    This script also produces a GSF image file, readable by both ``spym`` and Gwyddion: :download:`image.gsf &lt;example_code/indentation/image.gsf&gt;`</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">spym.generic</span> <span class="kn">import</span> <span class="n">Spm_image</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">lx</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">lx</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span> <span class="o">+</span> <span class="n">xc</span> 
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">ly</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">ly</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">ny</span><span class="p">)</span> <span class="o">+</span> <span class="n">yc</span> 
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    <span class="n">alt</span><span class="p">,</span> <span class="n">press</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">axi_repeat</span><span class="p">,</span> <span class="n">delaunay_disp</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
    <span class="n">Alt</span> <span class="o">=</span> <span class="n">Spm_image</span><span class="p">(</span>
      <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Altitude&#39;</span><span class="p">,</span> 
      <span class="n">data</span> <span class="o">=</span> <span class="n">alt</span><span class="p">,</span> 
      <span class="n">lx</span> <span class="o">=</span> <span class="n">lx</span><span class="p">,</span> <span class="n">ly</span> <span class="o">=</span> <span class="n">ly</span><span class="p">,</span> 
      <span class="n">xc</span> <span class="o">=</span><span class="n">lx</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">yc</span> <span class="o">=</span> <span class="n">ly</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> 
      <span class="n">xy_unit</span> <span class="o">=</span> <span class="n">xy_unit</span><span class="p">,</span> 
      <span class="n">z_unit</span> <span class="o">=</span> <span class="n">alt_unit</span><span class="p">,</span> 
      <span class="n">channel</span> <span class="o">=</span> <span class="s">&#39;Altitude&#39;</span><span class="p">)</span>
    <span class="n">Press</span> <span class="o">=</span> <span class="n">Spm_image</span><span class="p">(</span>
      <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;Contact Pressure&#39;</span><span class="p">,</span> 
      <span class="n">data</span> <span class="o">=</span> <span class="n">press</span><span class="p">,</span> 
      <span class="n">lx</span> <span class="o">=</span> <span class="n">lx</span><span class="p">,</span> <span class="n">ly</span> <span class="o">=</span> <span class="n">ly</span><span class="p">,</span> 
      <span class="n">xc</span> <span class="o">=</span><span class="n">lx</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> <span class="n">yc</span> <span class="o">=</span> <span class="n">ly</span><span class="o">/</span><span class="mf">2.</span><span class="p">,</span> 
      <span class="n">xy_unit</span> <span class="o">=</span> <span class="n">xy_unit</span><span class="p">,</span> 
      <span class="n">z_unit</span> <span class="o">=</span> <span class="n">press_unit</span><span class="p">,</span> 
      <span class="n">channel</span> <span class="o">=</span> <span class="s">&#39;Pressure&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Alt</span><span class="p">,</span> <span class="n">Press</span>
      </div>
<div class="viewcode-block" id="ContactData.interpolate"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.ContactData.interpolate">[docs]</a>  <span class="k">def</span> <span class="nf">interpolate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coor1</span><span class="p">,</span> <span class="n">coor2</span><span class="p">,</span> <span class="n">axi_repeat</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="n">delaunay_disp</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">method</span> <span class="o">=</span> <span class="s">&#39;linear&#39;</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Allows general interpolation on the a contact data instance. </span>
<span class="sd">    </span>
<span class="sd">  :param coor1: radial position in the axisymmetric case or in plane position first coordinate in the 3D case.</span>
<span class="sd">  :type coor1: any list/array of floats</span>
<span class="sd">  :param coor2: orthoradial position in the axisymmetric case of second in plane coordinate in the 3D case.</span>
<span class="sd">  :type coor2: any list/array of floats</span>
<span class="sd">  :param axi_repeat: number of times axisymmetric profile has to be pasted orthoradially.</span>
<span class="sd">  :type axi_repeat: int &gt; 0</span>
<span class="sd">    </span>
<span class="sd">  .. plot:: example_code/indentation/ContactData-interpolate.py</span>
<span class="sd">    :include-source:   </span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">griddata</span>
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    <span class="n">points</span><span class="p">,</span> <span class="n">alt</span><span class="p">,</span> <span class="n">press</span><span class="p">,</span> <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_3D_data</span><span class="p">(</span><span class="n">axi_repeat</span> <span class="o">=</span> <span class="n">axi_repeat</span><span class="p">,</span> <span class="n">delaunay_disp</span> <span class="o">=</span> <span class="n">delaunay_disp</span><span class="p">)</span>
    <span class="n">Alt</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">alt</span><span class="p">,</span> <span class="p">(</span><span class="n">coor1</span><span class="p">,</span> <span class="n">coor2</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
    <span class="n">Press</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">press</span><span class="p">,</span> <span class="p">(</span><span class="n">coor1</span><span class="p">,</span> <span class="n">coor2</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Alt</span><span class="p">,</span> <span class="n">Press</span>
     </div>
<div class="viewcode-block" id="ContactData.contact_area"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.ContactData.contact_area">[docs]</a>  <span class="k">def</span> <span class="nf">contact_area</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delaunay_disp</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the cross area of contact using the contact pressure field. The contact area is computed using a Delaunay triangulation of the available data points. This triangulation can be oriented using the delaunay_disp option (use very carefuly).     </span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
    
    <span class="c"># Computing Triangle Area</span>
    <span class="k">def</span> <span class="nf">triangle_area</span><span class="p">(</span><span class="n">points</span><span class="p">,</span><span class="n">conn</span><span class="p">):</span>
      <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">area</span> <span class="o">=</span> <span class="mf">0.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">conn</span><span class="p">))</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">conn</span><span class="p">)):</span>
        <span class="n">tri</span> <span class="o">=</span> <span class="n">conn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">xt</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">tri</span><span class="p">]</span>
        <span class="n">yt</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">tri</span><span class="p">]</span>
        <span class="n">xb</span><span class="p">,</span> <span class="n">xc</span> <span class="o">=</span> <span class="n">xt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="n">xt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">xt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">yb</span><span class="p">,</span> <span class="n">yc</span> <span class="o">=</span> <span class="n">yt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">yt</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>  <span class="n">yt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">yt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">area</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span> <span class="n">xb</span> <span class="o">*</span> <span class="n">yc</span> <span class="o">-</span> <span class="n">xc</span> <span class="o">*</span> <span class="n">yb</span> <span class="p">)</span>
      <span class="k">return</span> <span class="n">area</span>    
    
    <span class="c"># Computing numerical 2D integration</span>
    <span class="k">def</span> <span class="nf">triangle_integration</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">areas</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">coeffs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]):</span>
      <span class="n">out</span> <span class="o">=</span> <span class="mf">0.</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">conn</span><span class="p">)):</span>
        <span class="n">tri</span> <span class="o">=</span> <span class="n">conn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">area</span> <span class="o">=</span> <span class="n">areas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="n">tri</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="n">coeffs</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="o">*</span> <span class="n">area</span> 
      <span class="k">return</span> <span class="n">out</span>
    
    <span class="c"># Computing the area of all triangle where all summits have a non zero pressure</span>
    <span class="k">def</span> <span class="nf">triangle_non_zero</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">areas</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
      <span class="n">out</span> <span class="o">=</span> <span class="mf">0.</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">conn</span><span class="p">)):</span>
        <span class="n">tri</span> <span class="o">=</span> <span class="n">conn</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">area</span> <span class="o">=</span> <span class="n">areas</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="n">tri</span><span class="p">]</span>
        <span class="n">out</span> <span class="o">+=</span> <span class="nb">int</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">)</span> <span class="o">*</span> <span class="n">area</span>
      <span class="k">return</span> <span class="n">out</span>
    
    <span class="n">points</span><span class="p">,</span> <span class="n">alt</span><span class="p">,</span> <span class="n">press</span><span class="p">,</span> <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_3D_data</span><span class="p">(</span><span class="n">delaunay_disp</span> <span class="o">=</span> <span class="n">delaunay_disp</span><span class="p">)</span>
    <span class="n">areas</span> <span class="o">=</span> <span class="n">triangle_area</span><span class="p">(</span><span class="n">points</span><span class="p">,</span><span class="n">conn</span><span class="p">)</span>
    <span class="n">norm_press</span> <span class="o">=</span> <span class="p">(</span><span class="n">press</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="o">+</span> <span class="mi">0</span>
    <span class="c">#out1 = triangle_integration(conn, areas, norm_press, coeffs = [0., 0., 0., 1.])</span>
    <span class="n">out1</span> <span class="o">=</span> <span class="n">triangle_integration</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">areas</span><span class="p">,</span> <span class="n">norm_press</span><span class="p">,</span> <span class="n">coeffs</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">2.</span><span class="o">/</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">])</span>
    <span class="c">#out2 = triangle_integration(conn, areas, norm_press, coeffs = [0., 1., 1., 1.])</span>
    <span class="c">#out = triangle_non_zero(conn, areas, norm_press)</span>
    <span class="c">#return np.array([out0, out1, out2])</span>
    <span class="k">return</span> <span class="n">out1</span>
    </div>
<div class="viewcode-block" id="ContactData.contact_contour"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.ContactData.contact_contour">[docs]</a>  <span class="k">def</span> <span class="nf">contact_contour</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">delaunay_disp</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the contour of the contact zone.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
    <span class="n">points</span><span class="p">,</span> <span class="n">alt</span><span class="p">,</span> <span class="n">press</span><span class="p">,</span> <span class="n">conn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_3D_data</span><span class="p">(</span><span class="n">delaunay_disp</span> <span class="o">=</span> <span class="n">delaunay_disp</span><span class="p">)</span>
    <span class="n">norm_press</span> <span class="o">=</span> <span class="p">(</span><span class="n">press</span> <span class="o">&gt;</span> <span class="mf">0.</span><span class="p">)</span> <span class="o">+</span> <span class="mi">0</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">points</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">points</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">tricontour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">norm_press</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0001</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.9999</span> <span class="p">])</span><span class="o">.</span><span class="n">collections</span>
    <span class="n">points0</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">get_paths</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">vertices</span>
    <span class="n">points1</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">get_paths</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">vertices</span>
    <span class="n">points2</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">get_paths</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">vertices</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">points2</span><span class="p">,</span> <span class="n">points1</span><span class="p">,</span> <span class="n">points0</span>
  </div>
<div class="viewcode-block" id="ContactData.max_altitude"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.ContactData.max_altitude">[docs]</a>  <span class="k">def</span> <span class="nf">max_altitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the maximum altitude.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">altitude</span><span class="p">)</span>
  </div>
<div class="viewcode-block" id="ContactData.min_altitude"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.ContactData.min_altitude">[docs]</a>  <span class="k">def</span> <span class="nf">min_altitude</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the minimum altitude.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">altitude</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="ContactData.max_pressure"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.ContactData.max_pressure">[docs]</a>  <span class="k">def</span> <span class="nf">max_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the maximum pressure.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pressure</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="ContactData.min_pressure"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.ContactData.min_pressure">[docs]</a>  <span class="k">def</span> <span class="nf">min_pressure</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the minimum pressure.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pressure</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="Get_ContactData"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Get_ContactData">[docs]</a><span class="k">def</span> <span class="nf">Get_ContactData</span><span class="p">(</span><span class="n">odb</span><span class="p">,</span> <span class="n">instance</span><span class="p">,</span> <span class="n">node_set</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Finds and reformulate contact data on a given node set and a give instance. This function aims to read in Abaqus odb files and is then only usable in ``abaqus python`` and ``abaqus viewer -noGUI``. Following conventions are used:</span>
<span class="sd">  </span>
<span class="sd">  * The normal to the initial surface must be the y axis. </span>
<span class="sd">  * In axisymmetrical simulations, this is nearly automatic. In 3D simulations, the initial plane surface must be in parallel to the (x,z) plane. </span>
<span class="sd">  * As a consequence, coor1 will be x, coor2 will be z and the altitude is y.</span>
<span class="sd">  </span>
<span class="sd">  :param odb: the odb instance where needed data is.</span>
<span class="sd">  :type odb: odb instance obtained using ``odbAccess.openOdb``.</span>
<span class="sd">  :param instance: name of an instance in contact.</span>
<span class="sd">  :type instance: string</span>
<span class="sd">  :param node_set: name of a node set belonging to the instance.</span>
<span class="sd">  :type node_set: string</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="kn">from</span> <span class="nn">abapy.postproc</span> <span class="kn">import</span> <span class="n">GetHistoryOutputByKey</span> <span class="k">as</span> <span class="n">gho</span>
  <span class="kn">from</span> <span class="nn">abapy.indentation</span> <span class="kn">import</span> <span class="n">ContactData</span>
  <span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
  <span class="kn">from</span> <span class="nn">abaqusConstants</span> <span class="kn">import</span> <span class="n">THREE_D</span>
  <span class="c"># Checking embedded space</span>
  <span class="n">is_3D</span> <span class="o">=</span> <span class="bp">False</span> <span class="c"># Let&#39;s suppose that the instance is axisymmetric</span>
  <span class="k">if</span> <span class="n">odb</span><span class="o">.</span><span class="n">rootAssembly</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="n">instance</span><span class="p">]</span><span class="o">.</span><span class="n">embeddedSpace</span> <span class="o">==</span> <span class="n">THREE_D</span><span class="p">:</span> <span class="n">is_3D</span> <span class="o">=</span> <span class="bp">True</span>
  <span class="c"># Finding nodes in the specified node set</span>
  <span class="n">NodeSet</span> <span class="o">=</span> <span class="n">odb</span><span class="o">.</span><span class="n">rootAssembly</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="n">instance</span><span class="p">]</span><span class="o">.</span><span class="n">nodeSets</span><span class="p">[</span><span class="n">node_set</span><span class="p">]</span><span class="o">.</span><span class="n">nodes</span>
  <span class="n">topNodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">label</span> <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">NodeSet</span><span class="p">]</span> <span class="c"># Labels of the contact nodes</span>
  <span class="c"># let&#39;s check which nodes have available contact history</span>
  <span class="n">hist_region_key_pattern</span> <span class="o">=</span> <span class="s">&#39;Node &#39;</span> <span class="o">+</span> <span class="n">instance</span> <span class="o">+</span> <span class="s">&#39;.&#39;</span> 
  <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">topNodes</span><span class="p">:</span>
    <span class="n">available_hist</span> <span class="o">=</span> <span class="n">odb</span><span class="o">.</span><span class="n">steps</span><span class="p">[</span><span class="n">odb</span><span class="o">.</span><span class="n">steps</span><span class="o">.</span><span class="n">keys</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">historyRegions</span><span class="p">[</span><span class="n">hist_region_key_pattern</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">label</span><span class="p">)]</span><span class="o">.</span><span class="n">historyOutputs</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="n">cpress_available</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">available_hist</span><span class="p">:</span>
      <span class="k">if</span> <span class="s">&#39;CPRESS&#39;</span> <span class="ow">in</span> <span class="n">key</span><span class="p">:</span> 
        <span class="n">cpress_available</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">hist_target_key</span> <span class="o">=</span> <span class="n">key</span>
    <span class="k">if</span> <span class="n">cpress_available</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span> <span class="n">topNodes</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">label</span><span class="p">)</span> 
  <span class="c"># Getting data</span>
  <span class="n">coor1</span> <span class="o">=</span> <span class="n">gho</span><span class="p">(</span><span class="n">odb</span><span class="p">,</span> <span class="s">&#39;COOR1&#39;</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">is_3D</span><span class="p">:</span> <span class="n">coor2</span> <span class="o">=</span> <span class="n">gho</span><span class="p">(</span><span class="n">odb</span><span class="p">,</span> <span class="s">&#39;COOR3&#39;</span><span class="p">)</span> <span class="c"># Only in 3D</span>
  <span class="n">altitude</span> <span class="o">=</span> <span class="n">gho</span><span class="p">(</span><span class="n">odb</span><span class="p">,</span> <span class="s">&#39;COOR2&#39;</span><span class="p">)</span>
  <span class="n">pressure</span> <span class="o">=</span> <span class="n">gho</span><span class="p">(</span><span class="n">odb</span><span class="p">,</span> <span class="n">hist_target_key</span><span class="p">)</span>
  <span class="c"># Reformating data</span>
  <span class="n">keys</span> <span class="o">=</span> <span class="n">coor1</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
  <span class="n">Coor1</span><span class="p">,</span> <span class="n">Coor2</span><span class="p">,</span> <span class="n">Altitude</span><span class="p">,</span> <span class="n">Pressure</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
    <span class="n">Coor1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coor1</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_3D</span><span class="p">:</span> <span class="n">Coor2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coor2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">Altitude</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">altitude</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">Pressure</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pressure</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
  <span class="n">n_nodes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="c"># Number of contact nodes</span>
  <span class="n">n_steps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Coor1</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="c"># Number of available steps</span>
  <span class="n">out</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">st</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n_steps</span><span class="p">):</span>
    <span class="n">out</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
    <span class="n">out_step</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">fr</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Coor1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">st</span><span class="p">])):</span> <span class="c"># fr in the indice of the frame</span>
      <span class="n">out_step</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ContactData</span><span class="p">(</span><span class="n">is_3D</span> <span class="o">=</span> <span class="n">is_3D</span><span class="p">))</span>
      <span class="n">cd</span> <span class="o">=</span> <span class="n">out_step</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">coor1_temp</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,[])</span>
      <span class="n">coor2_temp</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,[])</span>
      <span class="n">altitude_temp</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,[])</span>
      <span class="n">pressure_temp</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="s">&#39;d&#39;</span><span class="p">,[])</span>
      <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">):</span>
        <span class="n">coor1_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Coor1</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">st</span><span class="p">][</span><span class="n">fr</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">is_3D</span><span class="p">:</span> 
          <span class="n">coor2_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Coor2</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">st</span><span class="p">][</span><span class="n">fr</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">coor2_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span>
        <span class="n">altitude_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Altitude</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">st</span><span class="p">][</span><span class="n">fr</span><span class="p">])</span>
        <span class="n">pressure_temp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Pressure</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="n">st</span><span class="p">][</span><span class="n">fr</span><span class="p">])</span>
      <span class="n">cd</span><span class="o">.</span><span class="n">add_data</span><span class="p">(</span><span class="n">coor1</span> <span class="o">=</span> <span class="n">coor1_temp</span><span class="p">,</span> <span class="n">coor2</span> <span class="o">=</span> <span class="n">coor2_temp</span><span class="p">,</span> <span class="n">altitude</span> <span class="o">=</span> <span class="n">altitude_temp</span><span class="p">,</span> <span class="n">pressure</span> <span class="o">=</span> <span class="n">pressure_temp</span><span class="p">)</span>
  
  <span class="k">return</span> <span class="n">out</span>
  
  </div>
<div class="viewcode-block" id="equivalent_half_angle"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.equivalent_half_angle">[docs]</a><span class="k">def</span> <span class="nf">equivalent_half_angle</span><span class="p">(</span><span class="n">half_angle</span><span class="p">,</span> <span class="n">sweep_angle</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Returns the half angle (in degrees) of the equivalent cone in terms of cross area and volume of a pyramidal indenter.</span>
<span class="sd">  :param half_angle: indenter half angle in degrees</span>
<span class="sd">  :type half_angle: float</span>
<span class="sd">  :param sweep_angle: sweep angle in degrees</span>
<span class="sd">  :type sweep_angle: float</span>
<span class="sd">  :rtype: float</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
  <span class="n">psi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">half_angle</span><span class="p">)</span>
  <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">sweep_angle</span><span class="p">)</span>
  <span class="n">Ap</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.</span>
  <span class="n">rc</span> <span class="o">=</span> <span class="p">(</span> <span class="n">Ap</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="p">)</span><span class="o">**.</span><span class="mi">5</span>
  <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan</span><span class="p">(</span><span class="n">rc</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
  
<span class="c"># Hertz contact</span>
<span class="c"># Author: A. Faivre</span>
</div>
<div class="viewcode-block" id="Hertz"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Hertz">[docs]</a><span class="k">class</span> <span class="nc">Hertz</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Hertz spherical indentation model.</span>
<span class="sd"> </span>
<span class="sd">  .. plot:: example_code/indentation/Hertz.py</span>
<span class="sd">     :include-source:   </span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">F</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">R</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">nu</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="n">R</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">E</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nu</span> <span class="o">=</span> <span class="n">nu</span>
    
    
    <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;a, F or h are not define, one at least must be defined&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">F</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_force</span><span class="p">()</span>
      
    <span class="k">if</span> <span class="n">F</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">F</span> <span class="o">=</span> <span class="n">F</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_contact_r</span><span class="p">()</span>
      
    <span class="k">if</span> <span class="n">h</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">==</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">F</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">h</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_depth_a</span><span class="p">()</span>    
      <span class="bp">self</span><span class="o">.</span><span class="n">F</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_depth_F</span><span class="p">()</span>
    
<span class="c"># with a         </span>
  <span class="k">def</span> <span class="nf">set_force</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">F</span> <span class="o">=</span> <span class="p">(</span><span class="mf">4.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Eeq</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">3.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">F</span>

<span class="c"># with F    </span>
  <span class="k">def</span> <span class="nf">set_contact_r</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span> <span class="p">(</span><span class="mf">3.</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">4.</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">Eeq</span><span class="p">)</span> <span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span>      
    <span class="k">return</span> <span class="n">a</span>

<span class="c"># with h </span>
  <span class="k">def</span> <span class="nf">set_depth_a</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">h</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span><span class="o">**.</span><span class="mi">5</span>
    <span class="k">return</span> <span class="n">a</span>
      
  <span class="k">def</span> <span class="nf">set_depth_F</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">F</span> <span class="o">=</span> <span class="p">(</span><span class="mf">4.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Eeq</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">3.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">F</span>
  
<span class="c"># Some outputs   </span>
<div class="viewcode-block" id="Hertz.get_Eeq"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Hertz.get_Eeq">[docs]</a>  <span class="k">def</span> <span class="nf">get_Eeq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Eeq: equivalent modulus (GPa)&#39;&#39;&#39;</span>
    <span class="n">Eeq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Eeq</span></div>
  <span class="n">Eeq</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_Eeq</span><span class="p">)</span>
    
  <span class="k">def</span> <span class="nf">get_mean_p</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> 
    <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span>   
    <span class="sd">&#39;&#39;&#39;pm: mean pressure (GPa)&#39;&#39;&#39;</span>
    <span class="n">pm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">F</span> <span class="o">/</span> <span class="p">(</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pm</span>
  <span class="n">mean_p</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_mean_p</span><span class="p">)</span>
    
<span class="c">#Sigma</span>
<div class="viewcode-block" id="Hertz.sigma"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Hertz.sigma">[docs]</a>  <span class="k">def</span> <span class="nf">sigma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    To do.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">zeros_like</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_rr</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">t</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_zz</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">t</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_tt</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">t</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_rz</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">t</span><span class="p">),</span> <span class="mf">0.</span> <span class="o">*</span> <span class="n">r</span><span class="p">,</span> <span class="mf">0.</span> <span class="o">*</span> <span class="n">r</span> 
    
<span class="c">#Sigma rr</span></div>
  <span class="k">def</span> <span class="nf">sigma_rr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span><span class="p">,</span> <span class="n">float64</span><span class="p">,</span> <span class="n">arctan</span>
    <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span>
    <span class="n">pm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_p</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">array</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="c">#r, z = remove_zeros(r), remove_zeros(z) </span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">u</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span> <span class="n">b</span> <span class="o">+</span> <span class="p">(</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span><span class="o">**.</span><span class="mi">5</span> <span class="p">)</span>           
    <span class="k">return</span> <span class="mf">3.</span><span class="o">/</span><span class="mf">2.</span><span class="o">*</span><span class="p">(</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="mf">2.</span><span class="o">*</span><span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="mf">3.</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="n">r</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span> <span class="p">(</span><span class="n">z</span><span class="o">/</span><span class="p">(</span><span class="n">u</span><span class="o">**.</span><span class="mi">5</span><span class="p">))</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">z</span><span class="o">/</span><span class="p">(</span><span class="n">u</span><span class="o">**.</span><span class="mi">5</span><span class="p">))</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span> <span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">u</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span> <span class="o">+</span> <span class="n">z</span><span class="o">/</span><span class="p">(</span><span class="n">u</span><span class="o">**.</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span><span class="n">u</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">v</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">u</span><span class="o">**.</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="n">a</span> <span class="o">*</span> <span class="n">arctan</span><span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="p">(</span><span class="n">u</span><span class="o">**.</span><span class="mi">5</span><span class="p">))</span> <span class="o">-</span> <span class="mf">2.</span><span class="p">)</span> <span class="p">)</span> <span class="o">*</span> <span class="n">pm</span>
    
    
    <span class="k">return</span> <span class="n">set_sigma_rr</span>

<span class="c">#Sigma zz</span>
  <span class="k">def</span> <span class="nf">sigma_zz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span><span class="p">,</span> <span class="n">float64</span>
    <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span>
    <span class="n">pm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_p</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">array</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="c">#r, z = remove_zeros(r), remove_zeros(z) </span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span> <span class="n">b</span> <span class="o">+</span> <span class="p">(</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span><span class="o">**.</span><span class="mi">5</span> <span class="p">)</span> 
    <span class="k">return</span> <span class="o">-</span><span class="mf">3.</span><span class="o">/</span><span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span><span class="n">z</span><span class="o">/</span><span class="p">(</span><span class="n">u</span><span class="o">**.</span><span class="mi">5</span><span class="p">))</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span> <span class="p">(</span><span class="n">u</span> <span class="o">*</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span> <span class="o">*</span> <span class="n">pm</span>
    

<span class="c">#Sigma tt</span>
  <span class="k">def</span> <span class="nf">sigma_tt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span><span class="p">,</span> <span class="n">float64</span><span class="p">,</span> <span class="n">arctan</span>
    <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span>
    <span class="n">pm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_p</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">array</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="c">#r, z = remove_zeros(r), remove_zeros(z) </span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span> <span class="n">b</span> <span class="o">+</span> <span class="p">(</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span><span class="o">**.</span><span class="mi">5</span> <span class="p">)</span> 
    <span class="k">return</span> <span class="o">-</span><span class="mf">3.</span><span class="o">/</span><span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="mf">2.</span><span class="o">*</span><span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="mf">3.</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="n">r</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="p">(</span><span class="n">z</span><span class="o">/</span><span class="n">u</span><span class="o">**.</span><span class="mi">5</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">z</span><span class="o">/</span><span class="n">u</span><span class="o">**.</span><span class="mi">5</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">v</span> <span class="o">+</span> <span class="n">u</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">v</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">u</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">u</span><span class="o">**.</span><span class="mi">5</span><span class="o">/</span><span class="n">a</span><span class="p">)</span><span class="o">*</span><span class="n">arctan</span><span class="p">(</span><span class="n">a</span><span class="o">/</span><span class="n">u</span><span class="o">**.</span><span class="mi">5</span><span class="p">)))</span> <span class="o">*</span> <span class="n">pm</span>
       

<span class="c">#Sigma_rz</span>
  <span class="k">def</span> <span class="nf">sigma_rz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span><span class="p">,</span> <span class="n">float64</span>
    <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span>
    <span class="n">pm</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_p</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">array</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="c">#r, z = remove_zeros(r), remove_zeros(z) </span>
    <span class="n">b</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span> <span class="n">b</span> <span class="o">+</span> <span class="p">(</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="n">z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="p">)</span><span class="o">**.</span><span class="mi">5</span> <span class="p">)</span> 
    <span class="k">return</span> <span class="o">-</span><span class="mf">3.</span><span class="o">/</span><span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span> <span class="p">(</span><span class="n">r</span> <span class="o">*</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">u</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">z</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span> <span class="o">*</span> <span class="p">(</span> <span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">u</span><span class="o">**.</span><span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">u</span><span class="p">)</span> <span class="p">)</span> <span class="o">*</span> <span class="n">pm</span>
    
  </div>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">HANSON conical indentation</span>
<span class="sd">===============</span>
<span class="sd">&#39;&#39;&#39;</span>


<div class="viewcode-block" id="Hanson"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Hanson">[docs]</a><span class="k">class</span> <span class="nc">Hanson</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Hanson conical indentation model.</span>
<span class="sd"> </span>
<span class="sd">  .. plot:: example_code/indentation/Hanson.py</span>
<span class="sd">     :include-source:   </span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">F</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">a</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">half_angle</span> <span class="o">=</span> <span class="mf">70.29</span><span class="p">,</span> <span class="n">E</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">nu</span> <span class="o">=</span> <span class="mf">0.3</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">E</span> <span class="o">=</span> <span class="n">E</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nu</span> <span class="o">=</span> <span class="n">nu</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">half_angle</span> <span class="o">=</span> <span class="n">half_angle</span>
   
 
    <span class="k">if</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">h</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;a, F or h are not defined, at least one must be defined&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span>
    <span class="k">if</span> <span class="n">F</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">F</span> <span class="o">=</span> <span class="n">F</span>
    <span class="k">if</span> <span class="n">h</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">h</span>    
    


    

<span class="c"># Managing Force    </span>
  <span class="k">def</span> <span class="nf">set_F</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">F</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">tan</span><span class="p">,</span> <span class="n">radians</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a</span>  <span class="o">=</span> <span class="p">(</span> <span class="mf">2.</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">*</span> <span class="n">F</span> <span class="o">*</span><span class="n">tan</span><span class="p">(</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">half_angle</span><span class="p">))</span> <span class="p">)</span><span class="o">**.</span><span class="mi">5</span>  
  <span class="k">def</span> <span class="nf">get_F</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">tan</span><span class="p">,</span> <span class="n">radians</span>
    <span class="n">F</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span> <span class="mf">2.</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">H</span> <span class="o">*</span> <span class="n">tan</span><span class="p">(</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">half_angle</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">F</span>  
  <span class="n">F</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_F</span><span class="p">,</span> <span class="n">set_F</span><span class="p">)</span>  


    
<span class="c"># Managing penetration</span>
  <span class="k">def</span> <span class="nf">set_h</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span><span class="p">,</span> <span class="n">tan</span><span class="p">,</span> <span class="n">radians</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">/</span> <span class="n">pi</span> <span class="o">*</span> <span class="n">tan</span><span class="p">(</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">half_angle</span><span class="p">))</span> <span class="o">*</span> <span class="n">h</span>
  <span class="k">def</span> <span class="nf">get_h</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">/</span> <span class="p">(</span> <span class="n">tan</span><span class="p">(</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">half_angle</span><span class="p">))</span> <span class="o">*</span> <span class="mf">2.</span><span class="p">)</span>    
  <span class="n">h</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_h</span><span class="p">,</span> <span class="n">set_h</span><span class="p">)</span>
  
<span class="c"># Model internal parameters   </span>
  <span class="k">def</span> <span class="nf">get_H</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span>
    <span class="n">H</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">pi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">H</span>
  <span class="n">H</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_H</span><span class="p">)</span>
  
  <span class="k">def</span> <span class="nf">get_epsilon</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">tan</span><span class="p">,</span> <span class="n">radians</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span> <span class="o">/</span> <span class="n">tan</span><span class="p">(</span><span class="n">radians</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">half_angle</span><span class="p">))</span>
  <span class="n">epsilon</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_epsilon</span><span class="p">)</span>
  
<div class="viewcode-block" id="Hanson.get_Eeq"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Hanson.get_Eeq">[docs]</a>  <span class="k">def</span> <span class="nf">get_Eeq</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Eeq: equivalent modulus (GPa)&#39;&#39;&#39;</span>
    <span class="n">Eeq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span><span class="o">/</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">nu</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Eeq</span></div>
  <span class="n">Eeq</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">get_Eeq</span><span class="p">)</span>  
  
  <span class="k">def</span>  <span class="nf">l1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>  
    <span class="k">return</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span> <span class="p">((</span><span class="n">r</span><span class="o">+</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**.</span><span class="mi">5</span> <span class="o">-</span> <span class="p">((</span><span class="n">r</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**.</span><span class="mi">5</span> <span class="p">)</span>
  
  
  <span class="k">def</span> <span class="nf">l2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span><span class="mf">0.</span><span class="p">):</span>
    <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
    <span class="k">return</span> <span class="mf">1.</span><span class="o">/</span><span class="mf">2.</span> <span class="o">*</span> <span class="p">(</span> <span class="p">((</span><span class="n">r</span><span class="o">+</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**.</span><span class="mi">5</span> <span class="o">+</span> <span class="p">((</span><span class="n">r</span><span class="o">-</span><span class="n">a</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**.</span><span class="mi">5</span> <span class="p">)</span>
  

<span class="c">#Sigma</span>
<div class="viewcode-block" id="Hanson.sigma"><a class="viewcode-back" href="../../indentation.html#abapy.indentation.Hanson.sigma">[docs]</a>  <span class="k">def</span> <span class="nf">sigma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    To do.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">zeros_like</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_rr</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">t</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_zz</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">t</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_tt</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">t</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_rz</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">t</span><span class="p">),</span> <span class="mf">0.</span> <span class="o">*</span> <span class="n">r</span><span class="p">,</span> <span class="mf">0.</span> <span class="o">*</span> <span class="n">r</span>
    
<span class="c">#Sigma 1</span></div>
  <span class="k">def</span> <span class="nf">sigma_1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span><span class="p">,</span> <span class="n">log</span>
    <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span>
    <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span>
    <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">array</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l1</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>  <span class="bp">self</span><span class="o">.</span><span class="n">l2</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span> <span class="p">(</span><span class="n">E</span><span class="o">*</span><span class="n">e</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">(</span> <span class="p">(</span><span class="mf">1.</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="n">log</span><span class="p">((</span><span class="n">l2</span><span class="o">+</span><span class="p">(</span><span class="n">l2</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**.</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">z</span><span class="o">+</span><span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**.</span><span class="mi">5</span><span class="p">))</span><span class="o">+</span> <span class="n">z</span><span class="o">*</span><span class="p">((</span><span class="n">l2</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**.</span><span class="mi">5</span><span class="o">/</span><span class="p">(</span><span class="n">l2</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">l1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**.</span><span class="mi">5</span><span class="p">))</span>
    
  
    
<span class="c">#Sigma 2</span>
  <span class="k">def</span> <span class="nf">sigma_2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span><span class="p">,</span> <span class="n">log</span>
    <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span>
    <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span>
    <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">array</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l1</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>  <span class="bp">self</span><span class="o">.</span><span class="n">l2</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span> <span class="p">(</span><span class="n">E</span><span class="o">*</span><span class="n">e</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">(</span> <span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="mf">2.</span><span class="o">*</span><span class="n">v</span><span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="mf">1.</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span><span class="o">*</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">l2</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">l1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**.</span><span class="mi">5</span> <span class="o">+</span> <span class="p">(</span><span class="n">z</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**.</span><span class="mi">5</span><span class="p">)</span><span class="o">/</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">l1</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="mf">2.</span><span class="o">*</span><span class="n">l2</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">l1</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">l2</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">l1</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="p">(</span><span class="n">z</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="mf">2.</span><span class="o">*</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**.</span><span class="mi">5</span><span class="p">)</span> <span class="p">)</span>     
      
    
<span class="c">#Sigma zz   </span>
  <span class="k">def</span> <span class="nf">sigma_zz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span><span class="p">,</span> <span class="n">log</span>
    <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span>
    <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span>
    <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">array</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l1</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>  <span class="bp">self</span><span class="o">.</span><span class="n">l2</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span> <span class="p">(</span><span class="n">E</span><span class="o">*</span><span class="n">e</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span><span class="o">*</span><span class="p">(</span> <span class="n">log</span><span class="p">((</span><span class="n">l2</span><span class="o">+</span><span class="p">(</span><span class="n">l2</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**.</span><span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">z</span><span class="o">+</span><span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**.</span><span class="mi">5</span><span class="p">))</span> <span class="o">-</span> <span class="p">(</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="n">l2</span><span class="p">)</span><span class="o">/</span><span class="p">((</span><span class="n">l2</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**.</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">l2</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">l1</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="n">z</span><span class="o">/</span><span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**.</span><span class="mi">5</span><span class="p">)</span>
   
    
<span class="c">#Sigma rz</span>
  <span class="k">def</span> <span class="nf">sigma_rz</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">array</span><span class="p">,</span> <span class="n">log</span>
    <span class="n">E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E</span>
    <span class="n">e</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span>
    <span class="n">a</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">a</span>
    <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nu</span>
    <span class="n">r</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">array</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">l1</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>  <span class="bp">self</span><span class="o">.</span><span class="n">l2</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span> <span class="p">(</span><span class="n">E</span><span class="o">*</span><span class="n">e</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">2.</span><span class="o">*</span><span class="n">a</span><span class="o">*</span><span class="p">(</span><span class="mf">1.</span><span class="o">-</span><span class="n">v</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="mf">1.</span><span class="o">/</span><span class="n">r</span> <span class="o">*</span> <span class="p">(</span> <span class="p">(</span><span class="n">z</span><span class="o">*</span><span class="n">l2</span><span class="o">*</span><span class="p">(</span><span class="n">l2</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**.</span><span class="mi">5</span><span class="o">/</span><span class="p">(</span><span class="n">l2</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">l1</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span> <span class="o">-</span> <span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">z</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**.</span><span class="mi">5</span><span class="p">)</span>
    
    
<span class="c">#Sigma xx</span>
  <span class="k">def</span> <span class="nf">sigma_rr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_1</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_2</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="p">)</span>

<span class="c">#Sigma tt</span>
  <span class="k">def</span> <span class="nf">sigma_tt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">t</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">.</span><span class="mi">5</span> <span class="o">*</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_1</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">sigma_2</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="p">)</span>    
    

        </div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../index.html">abapy 2.3.0 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Ludovic Charleux.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>